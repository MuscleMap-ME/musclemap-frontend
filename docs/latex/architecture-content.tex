% Architecture content (for inclusion in master document)
% ============================================
\section{Overview}
% ============================================

MuscleMap is a cross-platform fitness tracking application with real-time muscle visualization. The architecture follows a modular, layered approach with clear separation of concerns.

\subsection{Design Principles}

\begin{itemize}[leftmargin=*]
    \item \textbf{Single Source of Truth}: PostgreSQL is the only data store
    \item \textbf{Cross-Platform}: One codebase serves web and mobile
    \item \textbf{Modular}: Clear package boundaries
    \item \textbf{Type-Safe}: TypeScript throughout
\end{itemize}

% ============================================
\section{Technology Stack}
% ============================================

\begin{table}[h]
\centering
\begin{tabular}{@{}lll@{}}
\toprule
\textbf{Layer} & \textbf{Technology} & \textbf{Purpose} \\
\midrule
Frontend Web & React + Vite + TailwindCSS & Single-page application \\
Frontend Mobile & React Native + Expo & iOS \& Android apps \\
API Server & Fastify + TypeScript & REST/GraphQL API \\
Database & PostgreSQL & Primary data store \\
Cache & Redis (optional) & Session/query caching \\
Reverse Proxy & Caddy & HTTPS termination \\
\bottomrule
\end{tabular}
\caption{Technology Stack}
\end{table}

% ============================================
\section{Packages}
% ============================================

The monorepo contains 5 packages:

\begin{table}[h]
\centering
\begin{tabular}{@{}ll@{}}
\toprule
\textbf{Package} & \textbf{Description} \\
\midrule
\texttt{@musclemap/client} & Shared client-side business logic for MuscleMap \\
\texttt{@musclemap/core} & Shared domain types and utilities for MuscleMap \\
\texttt{@musclemap/plugin-sdk} & SDK for building MuscleMap plugins \\
\texttt{@musclemap/shared} & Shared utilities and constants for MuscleMap apps \\
\texttt{@musclemap/ui} & Shared cross-platform UI components for MuscleMap \\
\bottomrule
\end{tabular}
\caption{Monorepo Packages}
\end{table}

% ============================================
\section{Frontend Pages}
% ============================================

The application contains 50 pages:

\begin{longtable}{@{}lcc@{}}
\toprule
\textbf{Page} & \textbf{Protected} & \textbf{Description} \\
\midrule
\endhead
Achievements & No & Achievements page \\
AdminControl & No & AdminControl page \\
AdminFraud & No & AdminFraud page \\
AdminIssues & Yes & Admin Issues Page  Admin dashboard for m \\
AdminMonitoring & Yes & Admin Monitoring Dashboard  Comprehensiv \\
Buddy & No & Buddy page \\
CommunityDashboard & Yes & CommunityDashboard Page  Comprehensive c \\
Competitions & No & Competitions page \\
Credits & No & Credits page \\
Crews & Yes & Crews Page  Crew management and Crew War \\
Dashboard & Yes & Dashboard - MuscleMap Liquid Glass Desig \\
Design & No & Design Page  Showcases MuscleMap's desig \\
DesignSystem & No & Design System Showcase  Demonstrates the \\
DevUpdates & No & Dev Updates Page  Development updates, a \\
Docs & No & Docs page \\
Exercises & No & Exercises page \\
Features & No & Features Page  Showcases MuscleMap featu \\
Goals & Yes & Goals Page - MuscleMap Liquid Glass Desi \\
Health & Yes & Health Page  Wearables integration and h \\
HighFives & No & HighFives page \\
IssueDetail & Yes & Issue Detail Page  Single issue view wit \\
Issues & Yes & Issues Page  Bug and issue tracker with: \\
Journey & Yes & Journey page \\
Landing & No & Landing page \\
Leaderboard & No & Leaderboard page \\
Limitations & Yes & Limitations Page - MuscleMap Liquid Glas \\
Locations & No & Locations page \\
Login & Yes & Login page \\
MartialArts & No & MartialArts page \\
Messages & No & Messages page \\
MyIssues & Yes & My Issues Page  User's submitted issues: \\
NewIssue & Yes & New Issue Page  Create a new bug report, \\
Onboarding & Yes & Onboarding page \\
Privacy & No & Privacy Policy Page  Required for App St \\
Profile & Yes & Profile page \\
Progression & No & Progression page \\
PTTests & Yes & PT Tests Page - MuscleMap Liquid Glass D \\
Rivals & Yes & Rivals Page  1v1 rivalry competition sys \\
Roadmap & No & Roadmap Page  Public roadmap showing: -  \\
Science & No & Science Page  Explains the science behin \\
Settings & No & Settings page \\
Signup & Yes & Signup page \\
Skills & No & Skills page \\
SkinsStore & No & SkinsStore page \\
Stats & Yes & Stats Page  Character stats display with \\
Store & No & Store page \\
Technology & No & Technology Stack Page  Showcases MuscleM \\
TrainerDashboard & No & TrainerDashboard page \\
Wallet & No & Wallet page \\
Workout & No & Workout page \\
\bottomrule
\caption{Frontend Pages}
\end{longtable}

% ============================================
\section{API Endpoints}
% ============================================

The API exposes 447 endpoints:

\begin{longtable}{@{}lll@{}}
\toprule
\textbf{Method} & \textbf{Path} & \textbf{Handler} \\
\midrule
\endhead
\texttt{GET} & \texttt{/\_\_routes} & misc \\
\texttt{GET} & \texttt{/achievements/categories} & achievements \\
\texttt{GET} & \texttt{/achievements/definitions} & achievements \\
\texttt{GET} & \texttt{/achievements/definitions/:key} & achievements \\
\texttt{POST} & \texttt{/admin/abuse-check/:userId} & credits \\
\texttt{POST} & \texttt{/admin/credits/adjust} & credits \\
\texttt{GET} & \texttt{/admin/credits/audit} & credits \\
\texttt{POST} & \texttt{/admin/credits/reverse} & credits \\
\texttt{GET} & \texttt{/admin/disputes} & credits \\
\texttt{POST} & \texttt{/admin/disputes/:disputeId/messages} & credits \\
\texttt{POST} & \texttt{/admin/disputes/:disputeId/resolve} & credits \\
\texttt{PATCH} & \texttt{/admin/disputes/:disputeId/status} & credits \\
\texttt{GET} & \texttt{/admin/economy/metrics} & credits \\
\texttt{GET} & \texttt{/admin/escrow} & credits \\
\texttt{POST} & \texttt{/admin/escrow/:escrowId/refund} & credits \\
\texttt{POST} & \texttt{/admin/escrow/:escrowId/release} & credits \\
\texttt{GET} & \texttt{/admin/fraud-flags} & credits \\
\texttt{POST} & \texttt{/admin/fraud-flags} & credits \\
\texttt{POST} & \texttt{/admin/fraud-flags/:flagId/review} & credits \\
\texttt{GET} & \texttt{/admin/issues} & issues \\
\texttt{POST} & \texttt{/admin/issues/bulk} & issues \\
\texttt{POST} & \texttt{/admin/leaderboard-rewards/trigger} & credits \\
\texttt{GET} & \texttt{/admin/rate-limit-status/:userId} & credits \\
\texttt{GET} & \texttt{/admin/rate-limits} & credits \\
\texttt{PUT} & \texttt{/admin/rate-limits/:action} & credits \\
\texttt{POST} & \texttt{/admin/store/grant} & credits \\
\texttt{POST} & \texttt{/admin/store/revoke} & credits \\
\texttt{PUT} & \texttt{/admin/trainers/:userId/status} & trainers \\
\texttt{GET} & \texttt{/admin/trust/:userId} & credits \\
\texttt{POST} & \texttt{/admin/trust/:userId/override} & credits \\
\bottomrule
\caption{API Endpoints}
\end{longtable}

% ============================================
\section{Data Flow}
% ============================================

\begin{lstlisting}
+-------------+     +-------------+     +-------------+
|   Client    |---->|   Caddy     |---->|   Fastify   |
|  (React)    |<----|   (HTTPS)   |<----|   (API)     |
+-------------+     +-------------+     +-------------+
                                              |
                                              v
                                        +-------------+
                                        | PostgreSQL  |
                                        |  (Data)     |
                                        +-------------+
\end{lstlisting}

% ============================================
\section{Build Process}
% ============================================

\begin{lstlisting}[language=bash]
# Build order
pnpm build:packages  # shared -> core -> plugin-sdk -> client -> ui
pnpm build:api       # API server
pnpm build           # Frontend (Vite)

# Full deployment
./deploy.sh "commit message"
\end{lstlisting}

% ============================================
\section{Scripts}
% ============================================

\begin{table}[h]
\centering
\begin{tabular}{@{}ll@{}}
\toprule
\textbf{Script} & \textbf{Description} \\
\midrule
\texttt{deploy-branch.sh} & \# deploy-branch.sh - Full deployment: commit, push \\
\texttt{deploy.sh} & Deployment helper for MuscleMap \\
\texttt{errors.sh} & errors.sh \\
\texttt{generate-docs.cjs} & MuscleMap Documentation Generator  Analyzes the co \\
\texttt{generate-icons.cjs} & App Icon Generator for MuscleMap Mobile App  Gener \\
\texttt{logs.sh} & Unified Log Viewer for MuscleMap \\
\texttt{maintain.sh} & --- preflight --- \\
\texttt{merge-all.sh} & \# merge-all.sh - Merge all worktree branches into  \\
\texttt{prepare-app-store.cjs} & MuscleMap App Store Preparation Script  Automates  \\
\texttt{production-deploy.sh} & \# production-deploy.sh - Deploy script for MuscleM \\
\texttt{publish-app.sh} & \# MuscleMap App Publishing Script \\
\texttt{repo-cleanup.sh} & If caller sets DRY\_RUN/APPLY explicitly, we do not \\
\texttt{reset-devbox.sh} & ---- toggles (set by menu) ---- \\
\texttt{test.sh} & Create a competition to get an ID (avoid hardcoded \\
\texttt{tidy-root-js.sh} & Collect file basenames referenced by systemd units \\
\bottomrule
\end{tabular}
\caption{Available Scripts}
\end{table}
