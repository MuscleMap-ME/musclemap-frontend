% Architecture content (for inclusion in master document)
% ============================================
\section{Overview}
% ============================================

MuscleMap is a cross-platform fitness tracking application with real-time muscle visualization. The architecture follows a modular, layered approach with clear separation of concerns.

\subsection{Design Principles}

\begin{itemize}[leftmargin=*]
    \item \textbf{Single Source of Truth}: PostgreSQL is the only data store
    \item \textbf{Cross-Platform}: One codebase serves web and mobile
    \item \textbf{Modular}: Clear package boundaries
    \item \textbf{Type-Safe}: TypeScript throughout
\end{itemize}

% ============================================
\section{Technology Stack}
% ============================================

\begin{table}[h]
\centering
\begin{tabular}{@{}lll@{}}
\toprule
\textbf{Layer} & \textbf{Technology} & \textbf{Purpose} \\
\midrule
Frontend Web & React + Vite + TailwindCSS & Single-page application \\
Frontend Mobile & React Native + Expo & iOS \& Android apps \\
API Server & Fastify + TypeScript & REST/GraphQL API \\
Database & PostgreSQL & Primary data store \\
Cache & Redis (optional) & Session/query caching \\
Reverse Proxy & Caddy & HTTPS termination \\
\bottomrule
\end{tabular}
\caption{Technology Stack}
\end{table}

% ============================================
\section{Packages}
% ============================================

The monorepo contains 6 packages:

\begin{table}[h]
\centering
\begin{tabular}{@{}ll@{}}
\toprule
\textbf{Package} & \textbf{Description} \\
\midrule
\texttt{@musclemap/client} & Shared client-side business logic for MuscleMap \\
\texttt{@musclemap/contracts} & Shared GraphQL schema and types for MuscleMap \\
\texttt{@musclemap/core} & Shared domain types and utilities for MuscleMap \\
\texttt{@musclemap/plugin-sdk} & SDK for building MuscleMap plugins \\
\texttt{@musclemap/shared} & Shared utilities and constants for MuscleMap apps \\
\texttt{@musclemap/ui} & Shared cross-platform UI components for MuscleMap \\
\bottomrule
\end{tabular}
\caption{Monorepo Packages}
\end{table}

% ============================================
\section{Frontend Pages}
% ============================================

The application contains 73 pages:

\begin{longtable}{@{}lcc@{}}
\toprule
\textbf{Page} & \textbf{Protected} & \textbf{Description} \\
\midrule
\endhead
Achievements & No & Achievements page \\
AchievementVerification & No & AchievementVerification page \\
AdminControl & No & AdminControl page \\
AdminDisputes & Yes & Admin Disputes Dashboard  Admin interfac \\
AdminFraud & No & AdminFraud page \\
AdminIssues & Yes & Admin Issues Page  Admin dashboard for m \\
AdminMetrics & Yes & Admin Metrics Dashboard  Beautiful visua \\
AdminMonitoring & Yes & Admin Monitoring Dashboard  Comprehensiv \\
Buddy & No & Buddy page \\
CareerGoalPage & Yes & Career Goal Detail Page - MuscleMap  Sho \\
CareerPage & Yes & Career Page - MuscleMap Career Readiness \\
CareerReadiness & Yes & Career Readiness Page - MuscleMap Liquid \\
CareerStandardPage & Yes & Career Standard Detail Page - MuscleMap  \\
CommunityBulletinBoard & No & Community Bulletin Board  A central hub  \\
CommunityDashboard & Yes & CommunityDashboard Page  Comprehensive c \\
Competitions & No & Competitions page \\
ContributeIdeas & No & Contribute Ideas Page  A page showcasing \\
Credits & No & Credits page \\
Crews & Yes & Crews Page  Crew management and Crew War \\
Dashboard & Yes & Dashboard - MuscleMap Liquid Glass Desig \\
Design & No & Design Page  Showcases MuscleMap's desig \\
DesignSystem & No & Design System Showcase  Demonstrates the \\
DevUpdates & No & Dev Updates Page  Development updates, a \\
Docs & No & Docs page \\
EmpireControl & Yes & Empire Control - Master Admin Panel  The \\
Exercises & No & Exercises page \\
Features & No & Features Page  Showcases MuscleMap featu \\
Goals & Yes & Goals Page - MuscleMap Liquid Glass Desi \\
Health & Yes & Health Page  Wearables integration and h \\
HighFives & No & HighFives page \\
IssueDetail & Yes & Issue Detail Page  Single issue view wit \\
Issues & Yes & Issues Page  Bug and issue tracker with: \\
Journey & No & Journey page \\
Landing & No & Landing page \\
Leaderboard & No & Leaderboard page \\
Limitations & Yes & Limitations Page - MuscleMap Liquid Glas \\
LiveActivityMonitor & No & LiveActivityMonitor Page  Real-time acti \\
Locations & No & Locations page \\
Login & Yes & Login page \\
MartialArts & No & MartialArts page \\
MealPlans & No & Meal Plans Page  Create and manage meal  \\
Messages & No & Messages page \\
MyIssues & Yes & My Issues Page  User's submitted issues: \\
MyVerifications & No & MyVerifications page \\
NewIssue & No & New Issue Page  Create a new bug report, \\
Nutrition & No & Nutrition Page  Full nutrition tracking  \\
NutritionHistory & No & Nutrition History Page  View historical  \\
NutritionSettings & No & Nutrition Settings Page  Configure nutri \\
Onboarding & Yes & Handle archetype selection from Archetyp \\
PluginGuide & No & Plugin Development Guide  A visual, step \\
PluginMarketplace & No & PluginMarketplace - Browse and install c \\
PluginSettings & No & PluginSettings - Manage installed plugin \\
Privacy & No & Privacy Policy Page  Required for App St \\
Profile & No & Profile page \\
Progression & No & Progression page \\
PTTests & Yes & PT Tests Page - MuscleMap Liquid Glass D \\
Recipes & No & Recipes Page  Browse, create, and manage \\
Rivals & Yes & Rivals Page  1v1 rivalry competition sys \\
Roadmap & No & Roadmap Page  Public roadmap showing: -  \\
Science & No & Science Page  Explains the science behin \\
Settings & No & Settings page \\
Signup & Yes & Signup page \\
Skills & No & Skills page \\
SkinsStore & No & SkinsStore page \\
Stats & Yes & Stats Page  Character stats display with \\
Store & No & Store page \\
Technology & No & Technology Stack Page  Showcases MuscleM \\
TestScorecard & Yes & Test Scorecard Dashboard  Empire dashboa \\
TrainerDashboard & No & TrainerDashboard page \\
Trainers & Yes & Trainers Page  Browse trainers, manage t \\
Wallet & No & Wallet page \\
WitnessAttestation & No & WitnessAttestation page \\
Workout & No & Workout page \\
\bottomrule
\caption{Frontend Pages}
\end{longtable}

% ============================================
\section{API Endpoints}
% ============================================

The API exposes 695 endpoints:

\begin{longtable}{@{}lll@{}}
\toprule
\textbf{Method} & \textbf{Path} & \textbf{Handler} \\
\midrule
\endhead
\texttt{GET} & \texttt{/\_\_routes} & misc \\
\texttt{DELETE} & \texttt{/:injuryId} & rehabilitation \\
\texttt{GET} & \texttt{/achievements/:id/can-verify} & verifications \\
\texttt{POST} & \texttt{/achievements/:id/verify} & verifications \\
\texttt{GET} & \texttt{/achievements/categories} & achievements \\
\texttt{GET} & \texttt{/achievements/definitions} & achievements \\
\texttt{GET} & \texttt{/achievements/definitions/:key} & achievements \\
\texttt{GET} & \texttt{/achievements/verification-required} & verifications \\
\texttt{GET} & \texttt{/admin-control/audit/credits} & community \\
\texttt{GET} & \texttt{/admin-control/users} & community \\
\texttt{POST} & \texttt{/admin/abuse-check/:userId} & credits \\
\texttt{POST} & \texttt{/admin/credits/adjust} & credits \\
\texttt{GET} & \texttt{/admin/credits/audit} & credits \\
\texttt{POST} & \texttt{/admin/credits/reverse} & credits \\
\texttt{GET} & \texttt{/admin/disputes} & credits \\
\texttt{POST} & \texttt{/admin/disputes/:disputeId/messages} & credits \\
\texttt{POST} & \texttt{/admin/disputes/:disputeId/resolve} & credits \\
\texttt{PATCH} & \texttt{/admin/disputes/:disputeId/status} & credits \\
\texttt{GET} & \texttt{/admin/economy/metrics} & credits \\
\texttt{GET} & \texttt{/admin/escrow} & credits \\
\texttt{POST} & \texttt{/admin/escrow/:escrowId/refund} & credits \\
\texttt{POST} & \texttt{/admin/escrow/:escrowId/release} & credits \\
\texttt{GET} & \texttt{/admin/fraud-flags} & credits \\
\texttt{POST} & \texttt{/admin/fraud-flags} & credits \\
\texttt{POST} & \texttt{/admin/fraud-flags/:flagId/review} & credits \\
\texttt{GET} & \texttt{/admin/issues} & issues \\
\texttt{POST} & \texttt{/admin/issues/bulk} & issues \\
\texttt{POST} & \texttt{/admin/leaderboard-rewards/trigger} & credits \\
\texttt{GET} & \texttt{/admin/rate-limit-status/:userId} & credits \\
\texttt{GET} & \texttt{/admin/rate-limits} & credits \\
\bottomrule
\caption{API Endpoints}
\end{longtable}

% ============================================
\section{Data Flow}
% ============================================

\begin{lstlisting}
+-------------+     +-------------+     +-------------+
|   Client    |---->|   Caddy     |---->|   Fastify   |
|  (React)    |<----|   (HTTPS)   |<----|   (API)     |
+-------------+     +-------------+     +-------------+
                                              |
                                              v
                                        +-------------+
                                        | PostgreSQL  |
                                        |  (Data)     |
                                        +-------------+
\end{lstlisting}

% ============================================
\section{Build Process}
% ============================================

\begin{lstlisting}[language=bash]
# Build order
pnpm build:packages  # shared -> core -> plugin-sdk -> client -> ui
pnpm build:api       # API server
pnpm build           # Frontend (Vite)

# Full deployment
./deploy.sh "commit message"
\end{lstlisting}

% ============================================
\section{Scripts}
% ============================================

\begin{table}[h]
\centering
\begin{tabular}{@{}ll@{}}
\toprule
\textbf{Script} & \textbf{Description} \\
\midrule
\texttt{competitive-analysis.sh} & \# competitive-analysis.sh - Automated Competitive  \\
\texttt{deploy-branch.sh} & \# deploy-branch.sh - Full deployment: commit, push \\
\texttt{deploy.sh} & Deployment helper for MuscleMap \\
\texttt{errors.sh} & errors.sh \\
\texttt{generate-docs.cjs} & MuscleMap Documentation Generator  Analyzes the co \\
\texttt{generate-icons.cjs} & App Icon Generator for MuscleMap Mobile App  Gener \\
\texttt{logs.sh} & Unified Log Viewer for MuscleMap \\
\texttt{maintain.sh} & --- preflight --- \\
\texttt{merge-all.sh} & \# merge-all.sh - Merge all worktree branches into  \\
\texttt{musclemap-start.sh} & \# MuscleMap Local Development Services - START \\
\texttt{musclemap-stop.sh} & \# MuscleMap Local Development Services - STOP \\
\texttt{prepare-app-store.cjs} & MuscleMap App Store Preparation Script  Automates  \\
\texttt{production-deploy.sh} & \# production-deploy.sh - Deploy script for MuscleM \\
\texttt{publish-app.sh} & \# MuscleMap App Publishing Script \\
\texttt{repo-cleanup.sh} & If caller sets DRY\_RUN/APPLY explicitly, we do not \\
\bottomrule
\end{tabular}
\caption{Available Scripts}
\end{table}
