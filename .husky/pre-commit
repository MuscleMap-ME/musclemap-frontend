#!/bin/sh
# Pre-commit hook for MuscleMap
#
# This hook runs automatically before every commit to ensure code quality.
# To bypass (not recommended): git commit --no-verify

# Skip in CI environments
if [ "$CI" = "true" ]; then
    exit 0
fi

echo "ðŸ” Running pre-commit checks..."

# Run lint-staged for staged files
echo ""
echo "ðŸ“ Linting staged files..."
npx lint-staged

# Run migration validation (fast)
echo ""
echo "ðŸ—„ï¸  Validating migrations..."
if [ -f ./scripts/deployment/validate-migrations.sh ]; then
    chmod +x ./scripts/deployment/validate-migrations.sh
    ./scripts/deployment/validate-migrations.sh
fi

# Run TypeScript check (cached for speed)
echo ""
echo "ðŸ“˜ TypeScript check..."
if [ -f ./scripts/pre-deploy-check.sh ]; then
    ./scripts/pre-deploy-check.sh --fast 2>/dev/null || pnpm typecheck
else
    pnpm typecheck
fi

echo ""
echo "âœ… Pre-commit checks passed!"
