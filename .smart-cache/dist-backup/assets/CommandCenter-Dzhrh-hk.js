import{r as a,j as e,i as I}from"./react-vendor-By4WaTeA.js";import{c as w,G as se,x as F,A as T,m as b,aD as P,aR as te,aQ as ae,Z as re,aK as oe,N as ne,aI as ie,aC as ce}from"./index-BWXbdiCA.js";import{S as le}from"./SEO-Mk9r2unt.js";import{L as H}from"./loader-circle-C5TWBMcP.js";import{T as C,R as me}from"./terminal-r2iNx1TO.js";import{H as de}from"./history-BeviyJsz.js";import{C as G}from"./circle-check-big-CiijVxoO.js";import{C as he}from"./copy-cOQLA_bE.js";import{T as O}from"./triangle-alert-Dv3L0ipr.js";import{C as _}from"./chevron-down-CngmuGkJ.js";import{C as D}from"./chevron-right-DoiQoaX2.js";import{S as z}from"./square-C9XBdjBf.js";import{C as M}from"./circle-x-D51H6TmZ.js";import{S as xe}from"./share-2-BVwxy6Pe.js";import{R as ue}from"./refresh-cw-p-yaTekW.js";import{F as pe}from"./file-cJV5on13.js";import{F as ge,L as je,A as fe}from"./lock-CEc1LRTZ.js";import{S as we}from"./shield-alert-D4g_1BkM.js";import{G as ye}from"./gauge-C9gvz3JQ.js";import{H as Ne}from"./hard-drive-B5aL1sG9.js";import{M as be}from"./monitor-C2nGgDIA.js";import{K as ve}from"./key-DpDZ42tF.js";import{A as Ce}from"./arrow-up-down-CzTOotxs.js";import{P as Se}from"./package-CEj5e-go.js";import{D as ke}from"./download-C-UWhxxy.js";import{S as Ae}from"./save-B2kyirg1.js";import{I as Ee}from"./info-DEhOPaBa.js";import{T as Te}from"./trash-2-DedgPl_l.js";import{S as He}from"./server-BgFmfoXd.js";import{F as Me}from"./file-text-q_jsMOqJ.js";import{C as $e}from"./cpu-mzdWOygM.js";import{L as Re}from"./layers-XyFK9hVh.js";import{D as Ie}from"./database-C1hksDc6.js";import{G as _e}from"./git-branch-vF1kbhSx.js";import"./leaflet-vendor-BAre9uld.js";import"./three-vendor-BoD47aQL.js";import"./reactflow-vendor-DlchWpwj.js";import"./recharts-vendor-BBD0wQvA.js";import"./apollo-vendor-CCbilRAb.js";const De=[["path",{d:"M5 21v-6",key:"1hz6c0"}],["path",{d:"M12 21V9",key:"uvy0l4"}],["path",{d:"M19 21V3",key:"11j9sm"}]],Le=w("chart-no-axes-column-increasing",De);const Fe=[["path",{d:"m15 12-9.373 9.373a1 1 0 0 1-3.001-3L12 9",key:"1hayfq"}],["path",{d:"m18 15 4-4",key:"16gjal"}],["path",{d:"m21.5 11.5-1.914-1.914A2 2 0 0 1 19 8.172v-.344a2 2 0 0 0-.586-1.414l-1.657-1.657A6 6 0 0 0 12.516 3H9l1.243 1.243A6 6 0 0 1 12 8.485V10l2 2h1.172a2 2 0 0 1 1.414.586L18.5 14.5",key:"15ts47"}]],Pe=w("hammer",Fe);const Ge=[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]],Oe=w("network",Ge);const ze=[["path",{d:"M12 16h.01",key:"1drbdi"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M15.312 2a2 2 0 0 1 1.414.586l4.688 4.688A2 2 0 0 1 22 8.688v6.624a2 2 0 0 1-.586 1.414l-4.688 4.688a2 2 0 0 1-1.414.586H8.688a2 2 0 0 1-1.414-.586l-4.688-4.688A2 2 0 0 1 2 15.312V8.688a2 2 0 0 1 .586-1.414l4.688-4.688A2 2 0 0 1 8.688 2z",key:"1fd625"}]],Be=w("octagon-alert",ze);const Ve=[["path",{d:"M11 2v2",key:"1539x4"}],["path",{d:"M5 2v2",key:"1yf1q8"}],["path",{d:"M5 3H4a2 2 0 0 0-2 2v4a6 6 0 0 0 12 0V5a2 2 0 0 0-2-2h-1",key:"rb5t3r"}],["path",{d:"M8 15a6 6 0 0 0 12 0v-3",key:"x18d4x"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]],qe=w("stethoscope",Ve);const Ke=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]],We=w("wrench",Ke),L={Activity:e.jsx(ce,{className:"w-4 h-4"}),GitBranch:e.jsx(_e,{className:"w-4 h-4"}),Rocket:e.jsx(me,{className:"w-4 h-4"}),Database:e.jsx(Ie,{className:"w-4 h-4"}),Layers:e.jsx(Re,{className:"w-4 h-4"}),Cpu:e.jsx($e,{className:"w-4 h-4"}),Globe:e.jsx(ie,{className:"w-4 h-4"}),FileText:e.jsx(Me,{className:"w-4 h-4"}),Server:e.jsx(He,{className:"w-4 h-4"}),Shield:e.jsx(ne,{className:"w-4 h-4"}),Trash2:e.jsx(Te,{className:"w-4 h-4"}),Settings:e.jsx(oe,{className:"w-4 h-4"}),AlertOctagon:e.jsx(Be,{className:"w-4 h-4"}),Stethoscope:e.jsx(qe,{className:"w-4 h-4"}),Info:e.jsx(Ee,{className:"w-4 h-4"}),Play:e.jsx(P,{className:"w-4 h-4"}),Save:e.jsx(Ae,{className:"w-4 h-4"}),Download:e.jsx(ke,{className:"w-4 h-4"}),Archive:e.jsx(fe,{className:"w-4 h-4"}),Package:e.jsx(Se,{className:"w-4 h-4"}),Hammer:e.jsx(Pe,{className:"w-4 h-4"}),Terminal:e.jsx(C,{className:"w-4 h-4"}),BarChart:e.jsx(Le,{className:"w-4 h-4"}),Zap:e.jsx(re,{className:"w-4 h-4"}),Wrench:e.jsx(We,{className:"w-4 h-4"}),ArrowUpDown:e.jsx(Ce,{className:"w-4 h-4"}),Key:e.jsx(ve,{className:"w-4 h-4"}),Monitor:e.jsx(be,{className:"w-4 h-4"}),HardDrive:e.jsx(Ne,{className:"w-4 h-4"}),Gauge:e.jsx(ye,{className:"w-4 h-4"}),Network:e.jsx(Oe,{className:"w-4 h-4"}),Search:e.jsx(F,{className:"w-4 h-4"}),Heart:e.jsx(ae,{className:"w-4 h-4"}),Lock:e.jsx(je,{className:"w-4 h-4"}),ShieldAlert:e.jsx(we,{className:"w-4 h-4"}),Code:e.jsx(te,{className:"w-4 h-4"}),FileCode:e.jsx(ge,{className:"w-4 h-4"}),File:e.jsx(pe,{className:"w-4 h-4"}),XCircle:e.jsx(M,{className:"w-4 h-4"}),RefreshCw:e.jsx(ue,{className:"w-4 h-4"}),Share2:e.jsx(xe,{className:"w-4 h-4"})},Qe="";async function N(t,n={}){const m=localStorage.getItem("musclemap_token");return fetch(`${Qe}${t}`,{...n,headers:{...n.headers,Authorization:`Bearer ${m}`,"Content-Type":"application/json"}})}function B({status:t}){const n={running:{color:"text-blue-400",icon:e.jsx(H,{className:"w-3 h-3 animate-spin"}),bg:"bg-blue-500/20"},success:{color:"text-green-400",icon:e.jsx(G,{className:"w-3 h-3"}),bg:"bg-green-500/20"},failed:{color:"text-red-400",icon:e.jsx(M,{className:"w-3 h-3"}),bg:"bg-red-500/20"},timeout:{color:"text-orange-400",icon:e.jsx(O,{className:"w-3 h-3"}),bg:"bg-orange-500/20"},cancelled:{color:"text-gray-400",icon:e.jsx(z,{className:"w-3 h-3"}),bg:"bg-gray-500/20"}},{color:m,icon:h,bg:i}=n[t]||n.running;return e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2 py-1 rounded-full text-xs font-medium ${m} ${i}`,children:[h,t]})}function V({command:t,onExecute:n,disabled:m}){const[h,i]=a.useState(!1),c=async()=>{await navigator.clipboard.writeText(t.cmd),i(!0),setTimeout(()=>i(!1),2e3)};return e.jsxs(b.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`
        p-3 rounded-lg border transition-all duration-200
        ${t.dangerous?"bg-red-500/5 border-red-500/20 hover:border-red-500/40":"bg-white/5 border-white/10 hover:border-white/20"}
      `,children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-300 mb-1",children:t.description}),e.jsx("code",{className:"text-xs text-cyan-400 font-mono break-all",children:t.cmd})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx("button",{onClick:c,className:"p-1.5 rounded text-gray-500 hover:text-gray-300 hover:bg-white/10 transition-colors",title:"Copy command",children:h?e.jsx(G,{className:"w-4 h-4 text-green-400"}):e.jsx(he,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>n(t.cmd),disabled:m,className:`
              p-1.5 rounded transition-colors
              ${t.dangerous?"text-red-400 hover:bg-red-500/20":"text-green-400 hover:bg-green-500/20"}
              disabled:opacity-50 disabled:cursor-not-allowed
            `,title:"Execute command",children:e.jsx(P,{className:"w-4 h-4"})})]})]}),t.dangerous&&e.jsxs("div",{className:"mt-2 flex items-center gap-1.5 text-xs text-red-400",children:[e.jsx(O,{className:"w-3 h-3"}),e.jsx("span",{children:"Dangerous operation"})]})]})}function Ue({category:t,onExecute:n,disabled:m,expandedSubcategories:h,toggleSubcategory:i}){const[c,S]=a.useState(!1);return e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 overflow-hidden",children:[e.jsxs("button",{onClick:()=>S(!c),className:"w-full flex items-center justify-between p-4 hover:bg-white/5 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-gradient-to-br from-cyan-500/20 to-purple-500/20",children:L[t.icon]||e.jsx(C,{className:"w-4 h-4"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"font-semibold text-white",children:t.name}),e.jsx("p",{className:"text-xs text-gray-400",children:t.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:[t.subcategories.reduce((r,p)=>r+p.commands.length,0)," commands"]}),c?e.jsx(_,{className:"w-5 h-5 text-gray-400"}):e.jsx(D,{className:"w-5 h-5 text-gray-400"})]})]}),e.jsx(T,{children:c&&e.jsx(b.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"border-t border-white/10",children:t.subcategories.map(r=>{const p=`${t.name}:${r.name}`,v=h.has(p);return e.jsxs("div",{className:"border-b border-white/5 last:border-b-0",children:[e.jsxs("button",{onClick:()=>i(p),className:"w-full flex items-center justify-between px-4 py-3 hover:bg-white/5 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 rounded bg-white/10",children:L[r.icon]||e.jsx(C,{className:"w-3 h-3"})}),e.jsx("span",{className:"text-sm text-gray-300",children:r.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:r.commands.length}),v?e.jsx(_,{className:"w-4 h-4 text-gray-500"}):e.jsx(D,{className:"w-4 h-4 text-gray-500"})]})]}),e.jsx(T,{children:v&&e.jsx(b.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.15},className:"px-4 pb-4 space-y-2",children:r.commands.map(f=>e.jsx(V,{command:{...f,category:t.name,categoryIcon:t.icon,subcategory:r.name,subcategoryIcon:r.icon},onExecute:n,disabled:m},f.cmd))})})]},r.name)})})})]})}function Ze({execution:t,output:n,onCancel:m,onClose:h}){const i=a.useRef(null);return a.useEffect(()=>{i.current&&(i.current.scrollTop=i.current.scrollHeight)},[n]),t?e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"fixed inset-x-4 bottom-4 md:inset-x-auto md:right-4 md:bottom-4 md:w-[600px] bg-gray-900 rounded-xl border border-white/10 shadow-2xl overflow-hidden z-50",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-white/10 bg-white/5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(B,{status:t.status}),e.jsx("code",{className:"text-xs text-gray-400 font-mono truncate max-w-[300px]",children:t.command})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.status==="running"&&e.jsx("button",{onClick:m,className:"p-1.5 rounded text-red-400 hover:bg-red-500/20 transition-colors",title:"Cancel execution",children:e.jsx(z,{className:"w-4 h-4"})}),e.jsx("button",{onClick:h,className:"p-1.5 rounded text-gray-400 hover:bg-white/10 transition-colors",title:"Close",children:e.jsx(M,{className:"w-4 h-4"})})]})]}),e.jsx("pre",{ref:i,className:"p-4 text-xs font-mono text-gray-300 bg-black/50 h-64 overflow-auto whitespace-pre-wrap",children:n||"Waiting for output..."})]}):null}function Ds(){const{user:t,loading:n,hasHydrated:m}=se(),[h,i]=a.useState([]),[c,S]=a.useState(""),[r,p]=a.useState([]),[v,f]=a.useState(!1),[q,K]=a.useState(new Set),[g,j]=a.useState(null),[W,y]=a.useState(""),[$,Q]=a.useState([]),[k,U]=a.useState(!1),A=a.useRef(null);if(!m||n)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 flex items-center justify-center",children:e.jsx(H,{className:"w-8 h-8 animate-spin text-cyan-500"})});if(!t)return e.jsx(I,{to:"/login",replace:!0});if(!t.is_admin)return e.jsx(I,{to:"/dashboard",replace:!0});a.useEffect(()=>{async function s(){try{const o=await(await N("/api/admin/commands/hierarchy")).json();i(o.categories||[])}catch{}}s()},[]),a.useEffect(()=>{async function s(){try{const o=await(await N("/api/admin/commands/history?limit=20")).json();Q(o.history||[])}catch{}}s()},[g?.status]),a.useEffect(()=>{if(!c.trim()){p([]),f(!1);return}f(!0);const s=setTimeout(async()=>{try{const o=await(await N(`/api/admin/commands/search?q=${encodeURIComponent(c)}`)).json();p(o.results||[])}catch{}finally{f(!1)}},300);return()=>clearTimeout(s)},[c]);const R=a.useCallback(async s=>{try{const o=await(await N("/api/admin/commands/execute",{method:"POST",body:JSON.stringify({cmd:s})})).json();if(o.executionId){j({id:o.executionId,command:s,status:"running"}),y("");const E=localStorage.getItem("musclemap_token"),u=new EventSource(`/api/admin/commands/stream/${o.executionId}?token=${E}`);A.current=u,u.onmessage=ee=>{try{const x=JSON.parse(ee.data);x.type==="output"?y(l=>l+x.chunk):x.type==="complete"?(j(l=>l?{...l,status:x.status}:null),u.close()):x.type==="timeout"?(j(l=>l?{...l,status:"timeout"}:null),u.close()):x.type==="cancelled"?(j(l=>l?{...l,status:"cancelled"}:null),u.close()):x.type==="history"&&(y(x.output||""),j(l=>l?{...l,status:x.status}:null),u.close())}catch{}},u.onerror=()=>{u.close()}}}catch{}},[]),Z=a.useCallback(async()=>{if(g)try{await N(`/api/admin/commands/cancel/${g.id}`,{method:"POST"})}catch{}},[g]),J=a.useCallback(()=>{A.current&&A.current.close(),j(null),y("")},[]),X=a.useCallback(s=>{K(d=>{const o=new Set(d);return o.has(s)?o.delete(s):o.add(s),o})},[]),Y=h.reduce((s,d)=>s+d.subcategories.reduce((o,E)=>o+E.commands.length,0),0);return e.jsxs(e.Fragment,{children:[e.jsx(le,{title:"Command Center | Empire",description:"Execute and manage server commands"}),e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900",children:[e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-3 rounded-xl bg-gradient-to-br from-cyan-500/20 to-purple-500/20 border border-cyan-500/20",children:e.jsx(C,{className:"w-6 h-6 text-cyan-400"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Command Center"}),e.jsxs("p",{className:"text-sm text-gray-400",children:[Y," pre-approved commands organized by category"]})]})]})}),e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(F,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500"}),e.jsx("input",{type:"text",value:c,onChange:s=>S(s.target.value),placeholder:"Search commands...",className:"w-full pl-10 pr-4 py-3 rounded-xl bg-white/5 border border-white/10 text-white placeholder-gray-500 focus:outline-none focus:border-cyan-500/50 transition-colors"}),v&&e.jsx(H,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500 animate-spin"})]}),e.jsxs("button",{onClick:()=>U(!k),className:`
                flex items-center gap-2 px-4 py-3 rounded-xl border transition-colors
                ${k?"bg-cyan-500/20 border-cyan-500/30 text-cyan-400":"bg-white/5 border-white/10 text-gray-400 hover:border-white/20"}
              `,children:[e.jsx(de,{className:"w-5 h-5"}),e.jsx("span",{className:"hidden sm:inline",children:"History"})]})]}),c&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-white mb-3",children:["Search Results (",r.length,")"]}),r.length===0?e.jsxs("p",{className:"text-gray-500 text-sm",children:['No commands found matching "',c,'"']}):e.jsxs("div",{className:"grid gap-2",children:[r.slice(0,20).map(s=>e.jsx(V,{command:s,onExecute:R,disabled:g?.status==="running"},s.cmd)),r.length>20&&e.jsxs("p",{className:"text-sm text-gray-500 text-center py-2",children:["Showing first 20 of ",r.length," results"]})]})]}),e.jsx(T,{children:k&&e.jsx(b.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-6 overflow-hidden",children:e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-3",children:"Recent Executions"}),$.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"No execution history"}):e.jsx("div",{className:"space-y-2 max-h-64 overflow-auto",children:$.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-white/5 hover:bg-white/10 transition-colors cursor-pointer",onClick:()=>{j({id:s.id,command:s.command,status:s.status}),y(s.output||"")},children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx(B,{status:s.status}),e.jsx("code",{className:"text-xs text-gray-400 font-mono truncate",children:s.command})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[s.durationMs&&e.jsxs("span",{children:[(s.durationMs/1e3).toFixed(1),"s"]}),e.jsx("span",{children:new Date(s.startedAt).toLocaleTimeString()})]})]},s.id))})]})})}),!c&&e.jsx("div",{className:"space-y-4",children:h.map(s=>e.jsx(Ue,{category:s,onExecute:R,disabled:g?.status==="running",expandedSubcategories:q,toggleSubcategory:X},s.name))})]}),e.jsx(Ze,{execution:g,output:W,onCancel:Z,onClose:J})]})]})}export{Ds as default};
