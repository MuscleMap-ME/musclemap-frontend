import{r as a,j as s}from"./react-vendor-By4WaTeA.js";import{C as L,a as N,u as q,g as A,E as H,b as T,H as _,d as U,O as V,p as g}from"./three-vendor-BoD47aQL.js";import{c as k}from"./recharts-vendor-BBD0wQvA.js";import{a as S}from"./registry-DTXeZqpU.js";import{a as F}from"./MuscleViewer-Ci818sV2.js";import"./leaflet-vendor-BAre9uld.js";import"./reactflow-vendor-DlchWpwj.js";import"./index-CdPX2pcT.js";import"./apollo-vendor-CCbilRAb.js";const O={front:{position:[0,0,3],target:[0,0,0]},back:{position:[0,0,-3],target:[0,0,0]},left:{position:[-3,0,0],target:[0,0,0]},right:{position:[3,0,0],target:[0,0,0]},isometric:{position:[2,1.5,2.5],target:[0,0,0]}},R={chest:["pectoralis major","pectoralis minor"],abs:["rectus abdominis","abdomin"],obliques:["oblique","external oblique","internal oblique"],front_delts:["deltoid","anterior deltoid"],upper_back:["rhomboid","trapezius"],lats:["latissimus"],lower_back:["erector","quadratus lumborum"],rear_delts:["posterior deltoid"],traps:["trapezius"],biceps:["biceps"],triceps:["triceps"],forearms:["brachioradialis","flexor","extensor","pronator"],side_delts:["lateral deltoid","middle deltoid"],quads:["quadriceps","rectus femoris","vastus"],hip_flexors:["iliopsoas","psoas","iliacus"],adductors:["adductor"],glutes:["gluteus","gluteal"],hamstrings:["hamstring","biceps femoris","semitendinosus","semimembranosus"],calves:["gastrocnemius","soleus","calf"]};function I(o){if(o<=0)return new g(.5,.3,.3);if(o<.25){const r=o*4;return new g(.2,.2+r*.5,.8)}else if(o<.5){const r=(o-.25)*4;return new g(r,.7,.8-r*.8)}else if(o<.75){const r=(o-.5)*4;return new g(1,.7-r*.3,0)}else{const r=(o-.75)*4;return new g(1,.4-r*.4,0)}}function M(o,r){const i=R[r];if(!i)return!1;const c=o.toLowerCase();return i.some(l=>c.includes(l.toLowerCase()))}function D({filePath:o,muscles:r,autoRotate:i,interactive:c,showLabels:l,onMeshClick:j,onMeshHover:h}){const x=a.useRef(null),w=a.useRef(new Map),m=a.useRef(new Map),[u,b]=a.useState(null),{scene:f}=q(o),p=a.useMemo(()=>{const e={};return r.forEach(({id:t,intensity:n,isPrimary:d})=>{const E=d!==!1?n:n*.5;e[t]=Math.max(e[t]||0,E)}),e},[r]);a.useEffect(()=>{f&&(w.current.clear(),m.current.clear(),f.traverse(e=>{if(e instanceof A&&e.name&&(w.current.set(e.name,e),e.material instanceof H)){const t=e.material.clone();t.transparent=!0,t.roughness=.6,t.metalness=.1,e.material=t,m.current.set(e.name,t)}}))},[f]),a.useEffect(()=>{m.current.forEach((e,t)=>{let n=0;Object.entries(p).forEach(([E,P])=>{M(t,E)&&P>n&&(n=P)});const d=I(n);e.color.copy(d),n>.3?(e.emissive.copy(d),e.emissiveIntensity=n*.3):(e.emissive.setHex(0),e.emissiveIntensity=0),e.opacity=n>0?.85+n*.15:.7,e.needsUpdate=!0})},[p]),a.useEffect(()=>{if(!u)return;const e=m.current.get(u);return e&&(e.emissive.setHex(4491519),e.emissiveIntensity=.4,e.needsUpdate=!0),()=>{if(e){let t=0;if(Object.entries(p).forEach(([n,d])=>{M(u,n)&&(t=Math.max(t,d))}),t>.3){const n=I(t);e.emissive.copy(n),e.emissiveIntensity=t*.3}else e.emissive.setHex(0),e.emissiveIntensity=0;e.needsUpdate=!0}}},[u,p]),T((e,t)=>{i&&x.current&&(x.current.rotation.y+=t*.15)});const v=a.useCallback(e=>{if(!c)return;e.stopPropagation();const t=e.object;t.name&&(b(t.name),h?.(t.name),document.body.style.cursor="pointer")},[c,h]),y=a.useCallback(()=>{c&&(b(null),h?.(null),document.body.style.cursor="auto")},[c,h]),C=a.useCallback(e=>{if(!c)return;e.stopPropagation();const t=e.object;t.name&&Object.keys(R).forEach(n=>{M(t.name,n)&&j?.(n)})},[c,j]);return s.jsxs("group",{ref:x,children:[s.jsx("primitive",{object:f,scale:.01,position:[0,-1,0],onPointerOver:v,onPointerOut:y,onClick:C}),l&&u&&s.jsx(_,{position:[0,1.5,0],center:!0,children:s.jsx("div",{className:"px-2 py-1 bg-black/80 text-white text-xs rounded whitespace-nowrap",children:u.replace(/\.[lr]$/,"").replace(/_/g," ")})})]})}function z({view:o,interactive:r}){const{camera:i}=U(),c=a.useRef(null);return a.useEffect(()=>{const l=O[o];l&&(i.position.set(...l.position),i.lookAt(...l.target))},[o,i]),s.jsx(V,{ref:c,enabled:r,enablePan:!1,minDistance:1.5,maxDistance:6,minPolarAngle:Math.PI*.1,maxPolarAngle:Math.PI*.9})}function G(){return s.jsx(_,{center:!0,children:s.jsx(F,{mode:"inline"})})}function ee({muscles:o,mode:r="card",interactive:i=!0,showLabels:c=!0,autoRotate:l=!1,initialView:j="front",colorScheme:h="heatmap",lod:x,onMuscleClick:w,onMuscleHover:m,className:u,style:b}){const[f,p]=a.useState(j),v=S.getAsset("male_muscles"),y=v?S.getFilePath(v,x):null;if(!y)return s.jsx("div",{className:k("flex items-center justify-center bg-[var(--void-deep,#0a0f1a)]",u),style:b,children:s.jsx("p",{className:"text-[var(--text-tertiary,#94a3b8)] text-sm",children:"Model not available"})});const C={compact:{width:120,height:160},card:{width:200,height:280},fullscreen:{width:"100%",height:"100%",minHeight:400},inline:{width:80,height:100}};return s.jsxs("div",{className:k("relative rounded-xl overflow-hidden","bg-gradient-to-b from-[var(--void-deep,#0a0f1a)] to-[var(--void-deeper,#050810)]",u),style:{...C[r],...b},children:[s.jsxs(L,{camera:{position:O[f].position,fov:45},dpr:[1,2],gl:{antialias:!0,alpha:!0,powerPreference:"high-performance"},onCreated:({gl:e})=>{e.setClearColor(0,0)},children:[s.jsx("ambientLight",{intensity:.4}),s.jsx("directionalLight",{position:[5,5,5],intensity:.7}),s.jsx("directionalLight",{position:[-5,5,-5],intensity:.3}),s.jsx("pointLight",{position:[0,10,0],intensity:.2,color:"#4488ff"}),s.jsxs(a.Suspense,{fallback:s.jsx(G,{}),children:[s.jsx(D,{filePath:y,muscles:o,autoRotate:l,interactive:i,showLabels:c,onMeshClick:w,onMeshHover:m}),s.jsx(N,{position:[0,-1.5,0],opacity:.3,scale:8,blur:2,color:"#000020"})]}),s.jsx(z,{view:f,interactive:i})]}),(r==="card"||r==="fullscreen")&&i&&s.jsx("div",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 flex gap-1",children:["front","back","left","right"].map(e=>s.jsx("button",{onClick:()=>p(e),className:k("px-2 py-1 text-xs rounded transition-colors",f===e?"bg-[var(--electric-blue,#0066ff)] text-white":"bg-white/10 text-white/70 hover:bg-white/20"),children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]})}export{ee as MuscleViewer3D,ee as default};
