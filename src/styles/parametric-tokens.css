/**
 * MuscleMap Parametric Design Token System
 * Inspired by Donald Knuth's Metafont - parametric design from first principles
 *
 * The Troika: Maximum Flexibility, Maximum User Choice, Maximum Performance
 *
 * This system works like Metafont:
 * - Define a few BASE PARAMETERS
 * - COMPUTE all other values from these parameters
 * - Users adjust parameters â†’ entire design adapts automatically
 */

/* ==========================================================================
   LAYER 1: BASE PARAMETERS (User-Adjustable)
   These are the "knobs" users can turn to customize their experience
   ========================================================================== */

:root {
  /* Typography Scale Parameters */
  --param-base-size: 16; /* Base font size in pixels (no unit) */
  --param-scale-ratio: 1.25; /* Type scale ratio (Minor Third) */
  --param-line-height: 1.5; /* Base line height multiplier */
  --param-paragraph-spacing: 1.5; /* Paragraph spacing in em */

  /* Density Parameters */
  --param-density: 1; /* 0.8 = compact, 1 = normal, 1.2 = comfortable */
  --param-base-spacing: 4; /* Base spacing unit in pixels (no unit) */

  /* Color Parameters (HSL for parametric manipulation) */
  --param-hue-primary: 220; /* Primary color hue (0-360) */
  --param-saturation: 100; /* Base saturation (0-100) */
  --param-lightness: 50; /* Base lightness (0-100) */

  /* Motion Parameters */
  --param-motion-scale: 1; /* 0 = no motion, 1 = normal, 2 = enhanced */
  --param-duration-base: 200; /* Base animation duration in ms (no unit) */

  /* Contrast Parameters */
  --param-contrast: 1; /* 1 = normal, 1.5 = high contrast */

  /* ==========================================================================
     LAYER 2: COMPUTED TOKENS (Derived from parameters)
     These are calculated from the base parameters
     ========================================================================== */

  /* --- Type Scale (calc-based parametric scale) --- */
  --type-base: calc(var(--param-base-size) * 1px);
  --type-xs: calc(var(--type-base) / var(--param-scale-ratio) / var(--param-scale-ratio));
  --type-sm: calc(var(--type-base) / var(--param-scale-ratio));
  --type-md: var(--type-base);
  --type-lg: calc(var(--type-base) * var(--param-scale-ratio));
  --type-xl: calc(var(--type-base) * var(--param-scale-ratio) * var(--param-scale-ratio));
  --type-2xl: calc(var(--type-base) * var(--param-scale-ratio) * var(--param-scale-ratio) * var(--param-scale-ratio));
  --type-3xl: calc(var(--type-base) * var(--param-scale-ratio) * var(--param-scale-ratio) * var(--param-scale-ratio) * var(--param-scale-ratio));
  --type-4xl: calc(var(--type-base) * var(--param-scale-ratio) * var(--param-scale-ratio) * var(--param-scale-ratio) * var(--param-scale-ratio) * var(--param-scale-ratio));

  /* --- Line Heights (Knuth-inspired optical adjustments) --- */
  --line-height-tight: calc(var(--param-line-height) - 0.25);
  --line-height-normal: var(--param-line-height);
  --line-height-relaxed: calc(var(--param-line-height) + 0.25);
  --line-height-loose: calc(var(--param-line-height) + 0.5);

  /* --- Spacing Scale (Box-and-Glue inspired) --- */
  --space-unit: calc(var(--param-base-spacing) * var(--param-density) * 1px);
  --space-0: 0;
  --space-px: 1px;
  --space-0-5: calc(var(--space-unit) * 0.5);
  --space-1: var(--space-unit);
  --space-1-5: calc(var(--space-unit) * 1.5);
  --space-2: calc(var(--space-unit) * 2);
  --space-2-5: calc(var(--space-unit) * 2.5);
  --space-3: calc(var(--space-unit) * 3);
  --space-3-5: calc(var(--space-unit) * 3.5);
  --space-4: calc(var(--space-unit) * 4);
  --space-5: calc(var(--space-unit) * 5);
  --space-6: calc(var(--space-unit) * 6);
  --space-7: calc(var(--space-unit) * 7);
  --space-8: calc(var(--space-unit) * 8);
  --space-9: calc(var(--space-unit) * 9);
  --space-10: calc(var(--space-unit) * 10);
  --space-11: calc(var(--space-unit) * 11);
  --space-12: calc(var(--space-unit) * 12);
  --space-14: calc(var(--space-unit) * 14);
  --space-16: calc(var(--space-unit) * 16);
  --space-20: calc(var(--space-unit) * 20);
  --space-24: calc(var(--space-unit) * 24);
  --space-28: calc(var(--space-unit) * 28);
  --space-32: calc(var(--space-unit) * 32);
  --space-36: calc(var(--space-unit) * 36);
  --space-40: calc(var(--space-unit) * 40);
  --space-44: calc(var(--space-unit) * 44);
  --space-48: calc(var(--space-unit) * 48);
  --space-52: calc(var(--space-unit) * 52);
  --space-56: calc(var(--space-unit) * 56);
  --space-60: calc(var(--space-unit) * 60);
  --space-64: calc(var(--space-unit) * 64);
  --space-72: calc(var(--space-unit) * 72);
  --space-80: calc(var(--space-unit) * 80);
  --space-96: calc(var(--space-unit) * 96);

  /* --- Glue (Flexible spacing for Box-and-Glue layout) --- */
  --glue-min: calc(var(--space-unit) * 0.5);
  --glue-ideal: var(--space-unit);
  --glue-max: calc(var(--space-unit) * 2);

  /* --- Colors (HSL-based parametric colors) --- */
  --color-primary: hsl(
    var(--param-hue-primary),
    calc(var(--param-saturation) * 1%),
    calc(var(--param-lightness) * 1%)
  );
  --color-primary-light: hsl(
    var(--param-hue-primary),
    calc(var(--param-saturation) * 0.8 * 1%),
    calc((var(--param-lightness) + 20) * 1%)
  );
  --color-primary-dark: hsl(
    var(--param-hue-primary),
    calc(var(--param-saturation) * 1%),
    calc((var(--param-lightness) - 15) * 1%)
  );

  /* Contrast-adjusted text colors */
  --color-text: hsl(0, 0%, calc((100 - 10 * var(--param-contrast)) * 1%));
  --color-text-muted: hsl(0, 0%, calc((100 - 40 * var(--param-contrast)) * 1%));
  --color-text-subtle: hsl(0, 0%, calc((100 - 60 * var(--param-contrast)) * 1%));

  /* Background shades */
  --color-bg: hsl(var(--param-hue-primary), 10%, 5%);
  --color-bg-elevated: hsl(var(--param-hue-primary), 10%, 8%);
  --color-bg-overlay: hsl(var(--param-hue-primary), 10%, 12%);

  /* Surface colors with glassmorphism */
  --color-surface: hsla(var(--param-hue-primary), 20%, 15%, 0.8);
  --color-surface-hover: hsla(var(--param-hue-primary), 20%, 20%, 0.85);
  --color-surface-active: hsla(var(--param-hue-primary), 20%, 25%, 0.9);

  /* Border colors */
  --color-border: hsla(var(--param-hue-primary), 30%, 50%, 0.2);
  --color-border-strong: hsla(var(--param-hue-primary), 30%, 50%, 0.4);

  /* --- Motion Tokens (Parametric animations) --- */
  --duration-instant: calc(var(--param-duration-base) * 0.5 * var(--param-motion-scale) * 1ms);
  --duration-fast: calc(var(--param-duration-base) * var(--param-motion-scale) * 1ms);
  --duration-normal: calc(var(--param-duration-base) * 1.5 * var(--param-motion-scale) * 1ms);
  --duration-slow: calc(var(--param-duration-base) * 2.5 * var(--param-motion-scale) * 1ms);
  --duration-slower: calc(var(--param-duration-base) * 4 * var(--param-motion-scale) * 1ms);

  /* Easing functions */
  --ease-default: cubic-bezier(0.4, 0, 0.2, 1);
  --ease-in: cubic-bezier(0.4, 0, 1, 1);
  --ease-out: cubic-bezier(0, 0, 0.2, 1);
  --ease-in-out: cubic-bezier(0.4, 0, 0.2, 1);
  --ease-bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);
  --ease-spring: cubic-bezier(0.175, 0.885, 0.32, 1.275);

  /* --- Border Radius (Parametric) --- */
  --radius-sm: calc(var(--space-unit) * 0.5);
  --radius-md: var(--space-unit);
  --radius-lg: calc(var(--space-unit) * 1.5);
  --radius-xl: calc(var(--space-unit) * 2);
  --radius-2xl: calc(var(--space-unit) * 3);
  --radius-3xl: calc(var(--space-unit) * 4);
  --radius-full: 9999px;

  /* --- Shadows (Depth system) --- */
  --shadow-sm: 0 1px 2px 0 hsla(0, 0%, 0%, 0.05);
  --shadow-md: 0 4px 6px -1px hsla(0, 0%, 0%, 0.1), 0 2px 4px -1px hsla(0, 0%, 0%, 0.06);
  --shadow-lg: 0 10px 15px -3px hsla(0, 0%, 0%, 0.1), 0 4px 6px -2px hsla(0, 0%, 0%, 0.05);
  --shadow-xl: 0 20px 25px -5px hsla(0, 0%, 0%, 0.1), 0 10px 10px -5px hsla(0, 0%, 0%, 0.04);
  --shadow-2xl: 0 25px 50px -12px hsla(0, 0%, 0%, 0.25);
  --shadow-inner: inset 0 2px 4px 0 hsla(0, 0%, 0%, 0.06);

  /* Glow effects (for neon/glass aesthetic) */
  --glow-sm: 0 0 10px hsla(var(--param-hue-primary), 100%, 50%, 0.3);
  --glow-md: 0 0 20px hsla(var(--param-hue-primary), 100%, 50%, 0.4);
  --glow-lg: 0 0 40px hsla(var(--param-hue-primary), 100%, 50%, 0.5);

  /* --- Z-Index Scale --- */
  --z-below: -1;
  --z-base: 0;
  --z-raised: 10;
  --z-dropdown: 1000;
  --z-sticky: 1100;
  --z-fixed: 1200;
  --z-modal-backdrop: 1300;
  --z-modal: 1400;
  --z-popover: 1500;
  --z-tooltip: 1600;
  --z-toast: 1700;
  --z-max: 9999;

  /* ==========================================================================
     LAYER 3: SEMANTIC TOKENS (Role-based)
     These map computed tokens to semantic meanings
     ========================================================================== */

  /* Text hierarchy */
  --text-hero: var(--type-4xl);
  --text-title: var(--type-3xl);
  --text-heading: var(--type-2xl);
  --text-subheading: var(--type-xl);
  --text-body: var(--type-md);
  --text-caption: var(--type-sm);
  --text-micro: var(--type-xs);

  /* Interactive states */
  --interactive-hover-scale: 1.02;
  --interactive-active-scale: 0.98;
  --interactive-focus-ring: 0 0 0 2px var(--color-bg), 0 0 0 4px var(--color-primary);

  /* Component-specific tokens */
  --card-padding: var(--space-4);
  --card-radius: var(--radius-lg);
  --card-shadow: var(--shadow-lg);

  --button-padding-x: var(--space-4);
  --button-padding-y: var(--space-2);
  --button-radius: var(--radius-md);

  --input-padding-x: var(--space-3);
  --input-padding-y: var(--space-2);
  --input-radius: var(--radius-md);
  --input-border: 1px solid var(--color-border);

  /* Layout tokens */
  --container-max: 1280px;
  --container-padding: var(--space-4);
  --section-spacing: var(--space-16);
  --component-gap: var(--space-4);

  /* ==========================================================================
     RENDERING TIER INDICATORS (Set by JS)
     ========================================================================== */

  --rendering-tier: 'full'; /* 'full' | 'reduced' | 'minimal' | 'text-only' */
  --supports-blur: 1; /* 0 or 1 */
  --supports-animations: 1; /* 0 or 1 */
  --supports-3d: 1; /* 0 or 1 */
}

/* ==========================================================================
   DENSITY PRESETS
   ========================================================================== */

[data-density='compact'] {
  --param-density: 0.8;
  --param-base-size: 14;
}

[data-density='normal'] {
  --param-density: 1;
  --param-base-size: 16;
}

[data-density='comfortable'] {
  --param-density: 1.2;
  --param-base-size: 18;
}

/* ==========================================================================
   MOTION PRESETS
   ========================================================================== */

[data-motion='none'] {
  --param-motion-scale: 0;
}

[data-motion='reduced'] {
  --param-motion-scale: 0.3;
}

[data-motion='normal'] {
  --param-motion-scale: 1;
}

[data-motion='enhanced'] {
  --param-motion-scale: 1.5;
}

/* System preference for reduced motion */
@media (prefers-reduced-motion: reduce) {
  :root:not([data-motion]) {
    --param-motion-scale: 0;
  }
}

/* ==========================================================================
   CONTRAST PRESETS
   ========================================================================== */

[data-contrast='normal'] {
  --param-contrast: 1;
}

[data-contrast='high'] {
  --param-contrast: 1.5;
}

/* System preference for high contrast */
@media (prefers-contrast: more) {
  :root:not([data-contrast]) {
    --param-contrast: 1.5;
  }
}

/* ==========================================================================
   RENDERING TIER FALLBACKS
   ========================================================================== */

/* Reduced tier: No blur effects */
[data-rendering-tier='reduced'] {
  --supports-blur: 0;
  --supports-animations: 0;
  --color-surface: hsla(var(--param-hue-primary), 20%, 15%, 0.95);
}

/* Minimal tier: Flat design, no effects */
[data-rendering-tier='minimal'] {
  --supports-blur: 0;
  --supports-animations: 0;
  --supports-3d: 0;
  --shadow-sm: none;
  --shadow-md: none;
  --shadow-lg: none;
  --shadow-xl: none;
  --shadow-2xl: none;
  --glow-sm: none;
  --glow-md: none;
  --glow-lg: none;
  --color-surface: hsl(var(--param-hue-primary), 20%, 15%);
}

/* Text-only tier: Pure semantic HTML */
[data-rendering-tier='text-only'] {
  --supports-blur: 0;
  --supports-animations: 0;
  --supports-3d: 0;
}

/* ==========================================================================
   DATA-SAVE MODE
   ========================================================================== */

@media (prefers-reduced-data: reduce) {
  :root {
    --supports-3d: 0;
    --supports-blur: 0;
  }
}

/* ==========================================================================
   WRITING DIRECTION TOKENS (for i18n)
   ========================================================================== */

:root {
  --direction: ltr;
  --direction-coefficient: 1;
}

[dir='rtl'] {
  --direction: rtl;
  --direction-coefficient: -1;
}
