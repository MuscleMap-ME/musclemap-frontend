import{r as n,j as e,L as Oe}from"./react-vendor-D1NxaRNd.js";import{c as y}from"./recharts-vendor-BziRPEEi.js";import{K as We,m as v,A as N}from"./index-IJRH5ohh.js";import{a as Fe}from"./sanitize-CfVRSXz9.js";import{f as He,a as M}from"./date-vendor-C_JWt2cu.js";import"./leaflet-vendor-DZbo3Ov0.js";import"./d3-vendor-mcDw60ct.js";import"./apollo-vendor-BMQ75Ycx.js";import"./reactflow-vendor-Dz2P_-Qa.js";const i={Back:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 19l-7-7 7-7"})}),Send:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})}),Plus:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 4v16m8-8H4"})}),Search:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),More:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})}),Archive:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})}),Star:({filled:s})=>e.jsx("svg",{className:"w-5 h-5",fill:s?"currentColor":"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})}),Block:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"})}),User:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),Users:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),Edit:()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),Pin:({filled:s})=>e.jsx("svg",{className:"w-4 h-4",fill:s?"currentColor":"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"})}),Forward:()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M13 7l5 5m0 0l-5 5m5-5H6"})}),Reply:()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})}),Delete:()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),Check:()=>e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),Clock:()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),Template:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"})}),Timer:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),Settings:()=>e.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),Emoji:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),X:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M6 18L18 6M6 6l12 12"})}),Unarchive:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4l3 3m0 0l3-3m-3 3V8"})})},Je=[{id:"inbox",label:"Inbox"},{id:"starred",label:"Starred"},{id:"archived",label:"Archived"}],Xe=["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ”¥","ðŸ‘","ðŸŽ‰"],Ne=[{value:0,label:"Off"},{value:3600,label:"1 hour"},{value:86400,label:"24 hours"},{value:604800,label:"7 days"},{value:2592e3,label:"30 days"}];function Ve({users:s}){if(!s||s.length===0)return null;const l=s.map(u=>u.username).slice(0,3),r=l.length===1?`${l[0]} is typing...`:l.length===2?`${l[0]} and ${l[1]} are typing...`:`${l[0]} and ${l.length-1} others are typing...`;return e.jsxs(v.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"flex items-center gap-2 px-4 py-2 text-sm text-gray-400",children:[e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(v.div,{animate:{scale:[1,1.2,1]},transition:{repeat:1/0,duration:.6},className:"w-2 h-2 bg-violet-500 rounded-full"}),e.jsx(v.div,{animate:{scale:[1,1.2,1]},transition:{repeat:1/0,duration:.6,delay:.2},className:"w-2 h-2 bg-violet-500 rounded-full"}),e.jsx(v.div,{animate:{scale:[1,1.2,1]},transition:{repeat:1/0,duration:.6,delay:.4},className:"w-2 h-2 bg-violet-500 rounded-full"})]}),e.jsx("span",{children:r})]})}function ye({status:s,size:l="sm"}){const r=l==="sm"?"w-2.5 h-2.5":"w-3 h-3",u={online:"bg-green-500",away:"bg-yellow-500",offline:"bg-gray-500"};return e.jsx("span",{className:y(r,"rounded-full ring-2 ring-[#0a0a0f]",u[s])})}function Qe({status:s}){return s==="sending"?e.jsx(i.Clock,{}):s==="sent"?e.jsx(i.Check,{}):s==="delivered"?e.jsxs("span",{className:"flex -space-x-1",children:[e.jsx(i.Check,{}),e.jsx(i.Check,{})]}):s==="read"?e.jsxs("span",{className:"flex -space-x-1 text-violet-400",children:[e.jsx(i.Check,{}),e.jsx(i.Check,{})]}):null}function Ye({onSelect:s,onClose:l}){return e.jsx(v.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"absolute bottom-full mb-2 left-0 bg-[#1a1a24] border border-white/10 rounded-xl p-2 flex gap-1 shadow-xl z-50",children:Xe.map(r=>e.jsx("button",{onClick:()=>{s(r),l()},className:"w-8 h-8 flex items-center justify-center hover:bg-white/10 rounded-lg text-lg transition-colors",children:r},r))})}function qe({message:s,isOwnMessage:l,onReply:r,onEdit:u,onDelete:j,onPin:a,onForward:c,onReact:x,isPinned:m}){const[w,f]=n.useState(!1),[h,b]=n.useState(!1);return e.jsxs("div",{className:y("absolute top-0 flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",l?"right-full mr-2":"left-full ml-2"),children:[e.jsx(N,{children:h&&e.jsx(Ye,{onSelect:x,onClose:()=>b(!1)})}),e.jsx("button",{onClick:()=>b(!h),className:"p-1.5 rounded-lg bg-white/5 hover:bg-white/10 text-gray-400 hover:text-white transition-colors",title:"React",children:e.jsx(i.Emoji,{})}),e.jsx("button",{onClick:r,className:"p-1.5 rounded-lg bg-white/5 hover:bg-white/10 text-gray-400 hover:text-white transition-colors",title:"Reply",children:e.jsx(i.Reply,{})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>f(!w),className:"p-1.5 rounded-lg bg-white/5 hover:bg-white/10 text-gray-400 hover:text-white transition-colors",children:e.jsx(i.More,{})}),e.jsx(N,{children:w&&e.jsxs(v.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:y("absolute top-full mt-1 w-40 bg-[#1a1a24] border border-white/10 rounded-xl shadow-xl z-50 overflow-hidden",l?"right-0":"left-0"),children:[e.jsxs("button",{onClick:()=>{a(),f(!1)},className:"w-full px-3 py-2 text-left text-sm hover:bg-white/5 flex items-center gap-2",children:[e.jsx(i.Pin,{filled:m}),m?"Unpin":"Pin"]}),e.jsxs("button",{onClick:()=>{c(),f(!1)},className:"w-full px-3 py-2 text-left text-sm hover:bg-white/5 flex items-center gap-2",children:[e.jsx(i.Forward,{}),"Forward"]}),l&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{u(),f(!1)},className:"w-full px-3 py-2 text-left text-sm hover:bg-white/5 flex items-center gap-2",children:[e.jsx(i.Edit,{}),"Edit"]}),e.jsxs("button",{onClick:()=>{j(),f(!1)},className:"w-full px-3 py-2 text-left text-sm hover:bg-white/5 flex items-center gap-2 text-red-400",children:[e.jsx(i.Delete,{}),"Delete"]})]})]})})]})]})}function Ge({message:s,isOwnMessage:l,onReply:r,onEdit:u,onDelete:j,onPin:a,onForward:c,onReact:x,pinnedMessages:m,formatTime:w}){const f=m.includes(s.id);return e.jsx(v.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:y("flex group relative",l?"justify-end":"justify-start"),children:e.jsxs("div",{className:"relative",children:[f&&e.jsx("div",{className:y("absolute -top-2 text-violet-400",l?"right-2":"left-2"),children:e.jsx(i.Pin,{filled:!0})}),s.reply_to&&e.jsxs("div",{className:y("text-xs text-gray-500 mb-1 pl-2 border-l-2 border-gray-600 ml-2",l?"text-right mr-2":""),children:[e.jsxs("span",{className:"font-medium",children:[s.reply_to.sender_name,":"]})," ",s.reply_to.content.substring(0,50),"..."]}),e.jsxs("div",{className:y("max-w-[75%] p-3 rounded-2xl",l?"bg-violet-600 rounded-br-md":"bg-white/10 rounded-bl-md",f&&"ring-2 ring-violet-400/50"),children:[!l&&e.jsx("div",{className:"text-xs text-violet-400 mb-1",children:s.sender_name}),e.jsx("p",{className:"text-sm whitespace-pre-wrap break-words",children:s.content}),s.reactions&&s.reactions.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:s.reactions.map(h=>e.jsxs("button",{onClick:()=>x(s.id,h.emoji),className:y("px-2 py-0.5 rounded-full text-xs flex items-center gap-1",h.userReacted?"bg-violet-500/30 border border-violet-500/50":"bg-white/10 hover:bg-white/20"),children:[e.jsx("span",{children:h.emoji}),e.jsx("span",{children:h.count})]},h.emoji))}),e.jsxs("div",{className:"flex items-center justify-end gap-1.5 mt-1",children:[s.edited_at&&e.jsx("span",{className:"text-xs text-white/40",children:"edited"}),e.jsx("span",{className:"text-xs text-white/50",children:w(s.created_at)}),l&&e.jsx("span",{className:"text-white/50",children:e.jsx(Qe,{status:s.status||"sent"})})]})]}),e.jsx(qe,{message:s,isOwnMessage:l,onReply:()=>r(s),onEdit:()=>u(s),onDelete:()=>j(s.id),onPin:()=>a(s.id),onForward:()=>c(s),onReact:h=>x(s.id,h),isPinned:f})]})})}function Ke({isOpen:s,onClose:l,token:r,conversationId:u,onSelectMessage:j}){const[a,c]=n.useState(""),[x,m]=n.useState([]),[w,f]=n.useState(!1),h=n.useCallback(async()=>{if(!(a.length<2)){f(!0);try{const b=new URLSearchParams({query:a});u&&b.set("conversationId",u);const R=await(await fetch(`/api/messaging/search?${b}`,{headers:{Authorization:`Bearer ${r}`}})).json();m(R.data||[])}catch{}finally{f(!1)}}},[a,u,r]);return n.useEffect(()=>{const b=setTimeout(h,300);return()=>clearTimeout(b)},[h]),s?e.jsx(v.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-start justify-center z-50 p-4 pt-20",onClick:l,children:e.jsxs(v.div,{initial:{y:-20,opacity:0},animate:{y:0,opacity:1},exit:{y:-20,opacity:0},onClick:b=>b.stopPropagation(),className:"bg-[#12121a] border border-white/10 rounded-2xl w-full max-w-lg overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-white/10",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(i.Search,{}),e.jsx("input",{type:"text",value:a,onChange:b=>c(b.target.value),placeholder:"Search messages...",className:"flex-1 bg-transparent focus:outline-none",autoFocus:!0}),e.jsx("button",{onClick:l,className:"p-1 hover:bg-white/10 rounded",children:e.jsx(i.X,{})})]})}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:w?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"Searching..."}):x.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:a.length<2?"Type to search...":"No results found"}):x.map(b=>e.jsxs("button",{onClick:()=>{j(b.id),l()},className:"w-full p-4 text-left hover:bg-white/5 border-b border-white/5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-violet-400",children:b.senderName}),e.jsx("span",{className:"text-xs text-gray-500",children:M(new Date(b.createdAt),"MMM d, yyyy")})]}),e.jsx("p",{className:"text-sm text-gray-300 line-clamp-2",children:b.content})]},b.id))})]})}):null}function Ze({isOpen:s,onClose:l,token:r,onUseTemplate:u}){const[j,a]=n.useState([]),[c,x]=n.useState({name:"",content:"",shortcut:""}),[m,w]=n.useState(!1);n.useEffect(()=>{s&&fetch("/api/messaging/templates",{headers:{Authorization:`Bearer ${r}`}}).then(h=>h.json()).then(h=>a(h.data||[])).catch(()=>{})},[s,r]);const f=async()=>{try{const b=await(await fetch("/api/messaging/templates",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(c)})).json();b.data&&(a([...j,b.data]),x({name:"",content:"",shortcut:""}),w(!1))}catch{}};return s?e.jsx(v.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:l,children:e.jsxs(v.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:h=>h.stopPropagation(),className:"bg-[#12121a] border border-white/10 rounded-2xl w-full max-w-md overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-white/10 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Message Templates"}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-white/5 rounded-xl",children:e.jsx(i.X,{})})]}),e.jsx("div",{className:"p-4 max-h-96 overflow-y-auto",children:m?e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"text",value:c.name,onChange:h=>x({...c,name:h.target.value}),placeholder:"Template name",className:"w-full px-3 py-2 bg-white/5 border border-white/10 rounded-xl focus:outline-none focus:border-white/20"}),e.jsx("textarea",{value:c.content,onChange:h=>x({...c,content:h.target.value}),placeholder:"Template content...",rows:3,className:"w-full px-3 py-2 bg-white/5 border border-white/10 rounded-xl focus:outline-none focus:border-white/20 resize-none"}),e.jsx("input",{type:"text",value:c.shortcut,onChange:h=>x({...c,shortcut:h.target.value}),placeholder:"Shortcut (e.g., /hello)",className:"w-full px-3 py-2 bg-white/5 border border-white/10 rounded-xl focus:outline-none focus:border-white/20"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>w(!1),className:"flex-1 py-2 bg-white/5 hover:bg-white/10 rounded-xl",children:"Cancel"}),e.jsx("button",{onClick:f,disabled:!c.name||!c.content,className:"flex-1 py-2 bg-violet-600 hover:bg-violet-700 disabled:opacity-50 rounded-xl",children:"Save"})]})]}):e.jsxs(e.Fragment,{children:[j.length===0?e.jsxs("div",{className:"text-center text-gray-500 py-8",children:[e.jsx(i.Template,{}),e.jsx("p",{className:"mt-2",children:"No templates yet"})]}):e.jsx("div",{className:"space-y-2",children:j.map(h=>e.jsxs("button",{onClick:()=>{u(h.content),l()},className:"w-full p-3 text-left bg-white/5 hover:bg-white/10 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"font-medium",children:h.name}),h.shortcut&&e.jsx("span",{className:"text-xs text-violet-400 bg-violet-500/20 px-2 py-0.5 rounded",children:h.shortcut})]}),e.jsx("p",{className:"text-sm text-gray-400 line-clamp-2",children:h.content})]},h.id))}),e.jsxs("button",{onClick:()=>w(!0),className:"w-full mt-4 py-2 border border-dashed border-white/20 hover:border-white/40 rounded-xl text-gray-400 hover:text-white flex items-center justify-center gap-2",children:[e.jsx(i.Plus,{}),"Create Template"]})]})})]})}):null}function et({isOpen:s,onClose:l,token:r}){const[u,j]=n.useState([]);n.useEffect(()=>{s&&fetch("/api/messaging/scheduled",{headers:{Authorization:`Bearer ${r}`}}).then(c=>c.json()).then(c=>j(c.data||[])).catch(()=>{})},[s,r]);const a=async c=>{try{await fetch(`/api/messaging/scheduled/${c}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`}}),j(u.filter(x=>x.id!==c))}catch{}};return s?e.jsx(v.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:l,children:e.jsxs(v.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:c=>c.stopPropagation(),className:"bg-[#12121a] border border-white/10 rounded-2xl w-full max-w-md overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-white/10 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Scheduled Messages"}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-white/5 rounded-xl",children:e.jsx(i.X,{})})]}),e.jsx("div",{className:"p-4 max-h-96 overflow-y-auto",children:u.length===0?e.jsxs("div",{className:"text-center text-gray-500 py-8",children:[e.jsx(i.Clock,{}),e.jsx("p",{className:"mt-2",children:"No scheduled messages"})]}):e.jsx("div",{className:"space-y-3",children:u.map(c=>e.jsxs("div",{className:"p-3 bg-white/5 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs text-violet-400",children:M(new Date(c.scheduledFor),"MMM d, yyyy h:mm a")}),e.jsx("button",{onClick:()=>a(c.id),className:"text-xs text-red-400 hover:text-red-300",children:"Cancel"})]}),e.jsx("p",{className:"text-sm line-clamp-2",children:c.content})]},c.id))})})]})}):null}function tt({isOpen:s,onClose:l,conversation:r,token:u,onUpdate:j}){const[a,c]=n.useState(r.disappearing_ttl||0),x=async()=>{try{await fetch(`/api/messaging/conversations/${r.id}/disappearing`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`},body:JSON.stringify({ttl:a})}),j({disappearing_ttl:a}),l()}catch{}};return s?e.jsx(v.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:l,children:e.jsxs(v.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:m=>m.stopPropagation(),className:"bg-[#12121a] border border-white/10 rounded-2xl w-full max-w-md overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-white/10 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Conversation Settings"}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-white/5 rounded-xl",children:e.jsx(i.X,{})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Disappearing Messages"}),e.jsx("select",{value:a,onChange:m=>c(Number(m.target.value)),className:"w-full px-3 py-2 bg-white/5 border border-white/10 rounded-xl focus:outline-none focus:border-white/20",children:Ne.map(m=>e.jsx("option",{value:m.value,children:m.label},m.value))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Messages will automatically delete after this time period"})]}),e.jsx("button",{onClick:x,className:"w-full py-2 bg-violet-600 hover:bg-violet-700 rounded-xl",children:"Save Settings"})]})]})}):null}function st({isOpen:s,onClose:l,message:r,token:u,conversations:j}){const[a,c]=n.useState([]),[x,m]=n.useState(""),w=async()=>{if(!(!r||a.length===0))try{await fetch(`/api/messaging/messages/${r.id}/forward`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`},body:JSON.stringify({toConversationIds:a,addComment:x||void 0})}),l(),c([]),m("")}catch{}};return!s||!r?null:e.jsx(v.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:l,children:e.jsxs(v.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:f=>f.stopPropagation(),className:"bg-[#12121a] border border-white/10 rounded-2xl w-full max-w-md overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-white/10 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Forward Message"}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-white/5 rounded-xl",children:e.jsx(i.X,{})})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"p-3 bg-white/5 rounded-xl mb-4",children:e.jsx("p",{className:"text-sm text-gray-300 line-clamp-3",children:r.content})}),e.jsx("input",{type:"text",value:x,onChange:f=>m(f.target.value),placeholder:"Add a comment (optional)...",className:"w-full px-3 py-2 bg-white/5 border border-white/10 rounded-xl focus:outline-none focus:border-white/20 mb-4"}),e.jsx("p",{className:"text-sm text-gray-400 mb-2",children:"Select conversations:"}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-2",children:j.map(f=>e.jsxs("label",{className:y("flex items-center gap-3 p-2 rounded-xl cursor-pointer",a.includes(f.id)?"bg-violet-500/20":"hover:bg-white/5"),children:[e.jsx("input",{type:"checkbox",checked:a.includes(f.id),onChange:h=>{h.target.checked?c([...a,f.id]):c(a.filter(b=>b!==f.id))},className:"rounded border-white/20"}),e.jsx("span",{children:f.display_name||f.name})]},f.id))}),e.jsxs("button",{onClick:w,disabled:a.length===0,className:"w-full mt-4 py-2 bg-violet-600 hover:bg-violet-700 disabled:opacity-50 rounded-xl",children:["Forward to ",a.length," conversation",a.length!==1?"s":""]})]})]})})}function at({isOpen:s,onClose:l,onSchedule:r}){const[u,j]=n.useState(""),[a,c]=n.useState(""),x=()=>{if(!u||!a)return;const m=new Date(`${u}T${a}`);m>new Date&&(r(m),l())};return s?e.jsx(v.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:l,children:e.jsxs(v.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:m=>m.stopPropagation(),className:"bg-[#12121a] border border-white/10 rounded-2xl w-full max-w-sm overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-white/10 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Schedule Message"}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-white/5 rounded-xl",children:e.jsx(i.X,{})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Date"}),e.jsx("input",{type:"date",value:u,onChange:m=>j(m.target.value),min:M(new Date,"yyyy-MM-dd"),className:"w-full px-3 py-2 bg-white/5 border border-white/10 rounded-xl focus:outline-none focus:border-white/20"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Time"}),e.jsx("input",{type:"time",value:a,onChange:m=>c(m.target.value),className:"w-full px-3 py-2 bg-white/5 border border-white/10 rounded-xl focus:outline-none focus:border-white/20"})]}),e.jsx("button",{onClick:x,disabled:!u||!a,className:"w-full py-2 bg-violet-600 hover:bg-violet-700 disabled:opacity-50 rounded-xl",children:"Schedule"})]})]})}):null}function nt({isOpen:s,onClose:l,conversationId:r,token:u,onJumpToMessage:j}){const[a,c]=n.useState([]);return n.useEffect(()=>{s&&fetch(`/api/messaging/conversations/${r}/pinned`,{headers:{Authorization:`Bearer ${u}`}}).then(x=>x.json()).then(x=>c(x.data||[])).catch(()=>{})},[s,r,u]),s?e.jsxs(v.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},className:"absolute right-0 top-0 bottom-0 w-72 bg-[#12121a] border-l border-white/10 z-40",children:[e.jsxs("div",{className:"p-4 border-b border-white/10 flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium",children:"Pinned Messages"}),e.jsx("button",{onClick:l,className:"p-1 hover:bg-white/5 rounded",children:e.jsx(i.X,{})})]}),e.jsx("div",{className:"p-4 space-y-3 overflow-y-auto max-h-[calc(100%-60px)]",children:a.length===0?e.jsx("p",{className:"text-center text-gray-500 py-8",children:"No pinned messages"}):a.map(x=>e.jsxs("button",{onClick:()=>{j(x.id),l()},className:"w-full p-3 text-left bg-white/5 hover:bg-white/10 rounded-xl",children:[e.jsx("p",{className:"text-sm line-clamp-2",children:x.content}),e.jsx("span",{className:"text-xs text-gray-500 mt-1 block",children:M(new Date(x.created_at),"MMM d, h:mm a")})]},x.id))})]}):null}function mt(){const{token:s,user:l}=We(),r=l?.id,[u,j]=n.useState([]),[a,c]=n.useState(null),[x,m]=n.useState([]),[w,f]=n.useState(""),[h,b]=n.useState(!0),[P,R]=n.useState("inbox"),[ke,L]=n.useState(!1),[D,Ce]=n.useState(""),[Z,Se]=n.useState(""),[ee,te]=n.useState([]),[se,z]=n.useState(!1),[O,B]=n.useState(!1),[ae,S]=n.useState(""),[ne,ie]=n.useState([]),[C,E]=n.useState(null),[_,W]=n.useState(null),[F,H]=n.useState([]),[Me,Te]=n.useState({}),[re,J]=n.useState(!1),[le,oe]=n.useState(!1),[ce,de]=n.useState(!1),[he,xe]=n.useState(!1),[ue,me]=n.useState(!1),[pe,X]=n.useState(!1),[V,fe]=n.useState(null),ge=n.useRef(null),Q=n.useRef(null),$=n.useRef(null),Le=n.useRef(null),U=n.useCallback(async()=>{if(!(!s||!r))try{const p=((await(await fetch(`/api/messaging/conversations?tab=${P}`,{headers:{Authorization:`Bearer ${s}`}})).json()).data||[]).map(g=>{const d=g.participants?.find(k=>k.userId!==r);return{id:g.id,type:g.type,name:g.name,display_name:g.name||d?.displayName||d?.username||"Unknown",last_message:g.lastMessage?.content,last_activity_at:g.lastMessageAt||g.createdAt,unread_count:g.unreadCount||0,participants:g.participants,starred:g.starred,archived:g.archivedAt!==null,disappearing_ttl:g.disappearingTtl,typing_users:g.typingUsers||[]}});j(p)}catch{}finally{b(!1)}},[s,P,r]),Y=n.useCallback(async t=>{if(!(!s||!r))try{const g=((await(await fetch(`/api/messaging/conversations/${t}/messages`,{headers:{Authorization:`Bearer ${s}`}})).json()).data||[]).map(d=>({id:d.id,content:d.content,sender_id:d.sender?.id===r?"me":d.sender?.id,sender_name:d.sender?.id===r?"You":d.sender?.displayName||d.sender?.username||"Unknown",created_at:d.createdAt,edited_at:d.editedAt,edit_count:d.editCount,reactions:d.reactions,pinned_at:d.pinnedAt,reply_to:d.replyTo,status:d.readAt?"read":d.deliveredAt?"delivered":"sent"}));m(g),H(g.filter(d=>d.pinned_at).map(d=>d.id)),fetch(`/api/messaging/conversations/${t}/read`,{method:"POST",headers:{Authorization:`Bearer ${s}`}}).catch(()=>{}),fetch(`/api/messaging/conversations/${t}/typing`,{headers:{Authorization:`Bearer ${s}`}}).then(d=>d.json()).then(d=>ie(d.data||[])).catch(()=>{})}catch{}},[s,r]),je=n.useCallback(async t=>{if(!(!s||t.length===0))try{const p=await(await fetch("/api/messaging/presence/bulk",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({userIds:t})})).json(),g={};(p.data||[]).forEach(d=>{g[d.userId]=d.status}),Te(d=>({...d,...g}))}catch{}},[s]);n.useEffect(()=>{U()},[U]),n.useEffect(()=>{if(a){Y(a.id);const t=a.participants?.filter(o=>o.userId!==r).map(o=>o.userId)||[];t.length>0&&je(t)}},[a,Y,je,r]),n.useEffect(()=>{ge.current?.scrollIntoView({behavior:"smooth"})},[x]),n.useEffect(()=>{if(!a||!s)return;const t=setInterval(()=>{fetch(`/api/messaging/conversations/${a.id}/typing`,{headers:{Authorization:`Bearer ${s}`}}).then(o=>o.json()).then(o=>ie(o.data||[])).catch(()=>{})},3e3);return()=>clearInterval(t)},[a,s]);const q=n.useCallback(async t=>{if(!(!a||!s))try{await fetch(`/api/messaging/conversations/${a.id}/typing`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({isTyping:t})})}catch{}},[a,s]),ze=t=>{f(t.target.value),q(!0),$.current&&clearTimeout($.current),$.current=setTimeout(()=>{q(!1)},2e3)},be=async(t,o)=>{if(t.preventDefault(),!w.trim()||!a)return;const p=Fe(w);S(""),q(!1),$.current&&clearTimeout($.current);try{const g={content:p};if(C&&(g.replyToId=C.id),o){const T=await(await fetch("/api/messaging/scheduled",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({conversationId:a.id,content:p,scheduledFor:o.toISOString()})})).json();if(T.error){S(T.error.message);return}f(""),E(null);return}const k=await(await fetch(`/api/messaging/conversations/${a.id}/messages`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(g)})).json();if(k.error){S(k.error.message||"Failed to send message"),setTimeout(()=>S(""),5e3);return}if(k.data){const A=k.data;m(T=>[...T,{id:A.id,content:A.content,sender_id:"me",sender_name:"You",created_at:A.createdAt,status:"sent",reply_to:C?{id:C.id,content:C.content,sender_name:C.sender_name}:void 0}]),f(""),E(null),j(T=>T.map(K=>K.id===a.id?{...K,last_message:p,last_activity_at:A.createdAt}:K))}}catch{S("Failed to send message"),setTimeout(()=>S(""),5e3)}},Be=async(t,o)=>{try{(await(await fetch(`/api/messaging/messages/${t}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({content:o})})).json()).data&&m(d=>d.map(k=>k.id===t?{...k,content:o,edited_at:new Date().toISOString()}:k)),W(null)}catch{}},$e=async t=>{try{await fetch(`/api/messaging/messages/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}}),m(o=>o.filter(p=>p.id!==t))}catch{}},Ae=async t=>{const o=F.includes(t);try{await fetch(`/api/messaging/messages/${t}/pin`,{method:o?"DELETE":"POST",headers:{Authorization:`Bearer ${s}`}}),H(o?p=>p.filter(g=>g!==t):p=>[...p,t])}catch{}},Pe=async(t,o)=>{try{x.find(d=>d.id===t)?.reactions?.find(d=>d.emoji===o)?.userReacted?await fetch(`/api/messaging/messages/${t}/reactions/${encodeURIComponent(o)}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}}):await fetch(`/api/messaging/messages/${t}/reactions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({emoji:o})}),a&&Y(a.id)}catch{}},Ee=async()=>{if(!a)return;const t=a.starred;try{await fetch(`/api/messaging/conversations/${a.id}/star`,{method:t?"DELETE":"POST",headers:{Authorization:`Bearer ${s}`}}),c(o=>o?{...o,starred:!t}:null),j(o=>o.map(p=>p.id===a.id?{...p,starred:!t}:p))}catch{}},_e=async()=>{if(!a)return;const t=a.archived;try{await fetch(`/api/messaging/conversations/${a.id}/archive`,{method:t?"DELETE":"POST",headers:{Authorization:`Bearer ${s}`}}),c(null),U()}catch{}},Ue=async t=>{if(t.length<2)return te([]);try{const p=await(await fetch(`/api/users/search?q=${encodeURIComponent(t)}`,{headers:{Authorization:`Bearer ${s}`}})).json();te(p.users||[])}catch{}},Ie=async t=>{try{const p=await(await fetch("/api/messaging/conversations",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({type:"direct",participantIds:[t]})})).json();if(p.error){S(p.error.message||"Cannot start conversation"),setTimeout(()=>S(""),3e3);return}p.data?.id&&(L(!1),U(),c({id:p.data.id,...p.data}))}catch{}},I=n.useCallback(()=>!a||a.type==="group"?null:a.participants?.find(o=>o.userId!==r)?.userId,[a,r]),ve=n.useCallback(async()=>{const t=I();if(!t||!s){B(!1);return}try{const p=await(await fetch(`/api/messaging/block/${t}`,{headers:{Authorization:`Bearer ${s}`}})).json();B(p.data?.isBlocked||!1)}catch{B(!1)}},[I,s]);n.useEffect(()=>{a&&ve()},[a,ve]);const Re=async()=>{const t=I();if(t)try{await fetch(`/api/messaging/block/${t}`,{method:"POST",headers:{Authorization:`Bearer ${s}`}}),B(!0),z(!1)}catch{}},De=async()=>{const t=I();if(t)try{await fetch(`/api/messaging/block/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}}),B(!1),z(!1)}catch{}};n.useEffect(()=>{const t=o=>{Q.current&&!Q.current.contains(o.target)&&z(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const we=t=>{const o=new Date(t),g=new Date().getTime()-o.getTime();return g<864e5?M(o,"HH:mm"):g<6048e5?M(o,"EEE"):M(o,"MMM d")},G=t=>Me[t]||"offline";return e.jsxs("div",{className:"min-h-screen bg-[#0a0a0f] text-white flex",children:[e.jsxs("div",{className:y("w-full md:w-80 lg:w-96 border-r border-white/5 flex flex-col",a?"hidden md:flex":"flex"),children:[e.jsxs("div",{className:"p-4 border-b border-white/5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Oe,{to:"/dashboard",className:"p-2 -ml-2 rounded-xl hover:bg-white/5",children:e.jsx(i.Back,{})}),e.jsx("h1",{className:"text-xl font-semibold",children:"Messages"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>J(!0),className:"p-2 rounded-xl bg-white/5 hover:bg-white/10 transition-all",title:"Search messages",children:e.jsx(i.Search,{})}),e.jsx("button",{onClick:()=>de(!0),className:"p-2 rounded-xl bg-white/5 hover:bg-white/10 transition-all",title:"Scheduled messages",children:e.jsx(i.Clock,{})}),e.jsx("button",{onClick:()=>L(!0),className:"p-2 rounded-xl bg-white/5 hover:bg-white/10 transition-all",title:"New message",children:e.jsx(i.Plus,{})})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:e.jsx(i.Search,{})}),e.jsx("input",{type:"text",placeholder:"Search conversations...",value:D,onChange:t=>Ce(t.target.value),className:"w-full pl-10 pr-4 py-2.5 bg-white/5 border border-white/10 rounded-xl focus:outline-none focus:border-white/20 text-sm"})]}),e.jsx("div",{className:"flex gap-1 mt-4 p-1 bg-white/5 rounded-xl",children:Je.map(t=>e.jsx("button",{onClick:()=>R(t.id),className:y("flex-1 py-2 text-sm font-medium rounded-lg transition-all",P===t.id?"bg-white/10 text-white":"text-gray-400 hover:text-white"),children:t.label},t.id))})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:h?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"Loading..."}):u.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-white/5 flex items-center justify-center",children:e.jsx(i.User,{})}),e.jsx("p",{className:"text-gray-400",children:"No conversations yet"}),e.jsx("button",{onClick:()=>L(!0),className:"mt-4 px-4 py-2 bg-violet-600 rounded-xl text-sm font-medium hover:bg-violet-700 transition-all",children:"Start a conversation"})]}):u.filter(t=>!D||(t.display_name||t.name||"").toLowerCase().includes(D.toLowerCase())).map(t=>{const o=t.participants?.find(g=>g.userId!==r),p=o?G(o.userId):"offline";return e.jsx(v.div,{initial:{opacity:0},animate:{opacity:1},onClick:()=>c(t),className:y("p-4 border-b border-white/5 cursor-pointer transition-all",a?.id===t.id?"bg-white/5":"hover:bg-white/5"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:y("w-12 h-12 rounded-full flex items-center justify-center",t.type==="group"?"bg-violet-500/20":"bg-white/10"),children:t.type==="group"?e.jsx(i.Users,{}):e.jsx(i.User,{})}),t.type==="direct"&&e.jsx("span",{className:"absolute -bottom-0.5 -right-0.5",children:e.jsx(ye,{status:p})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium truncate",children:t.display_name||t.name||"Unknown"}),t.starred&&e.jsx(i.Star,{filled:!0})]}),e.jsx("span",{className:"text-xs text-gray-500",children:t.last_activity_at&&we(t.last_activity_at)})]}),e.jsx("div",{className:"flex items-center gap-2",children:t.typing_users&&t.typing_users.length>0?e.jsx("span",{className:"text-sm text-violet-400 italic",children:"typing..."}):e.jsx("p",{className:"text-sm text-gray-400 truncate",children:t.last_message||"No messages yet"})})]}),t.unread_count>0&&e.jsx("span",{className:"w-5 h-5 rounded-full bg-violet-500 text-xs font-bold flex items-center justify-center",children:t.unread_count})]})},t.id)})})]}),e.jsx("div",{className:y("flex-1 flex flex-col relative",a?"flex":"hidden md:flex"),children:a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 border-b border-white/5 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>c(null),className:"md:hidden p-2 -ml-2 rounded-xl hover:bg-white/5",children:e.jsx(i.Back,{})}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:y("w-10 h-10 rounded-full flex items-center justify-center",a.type==="group"?"bg-violet-500/20":"bg-white/10"),children:a.type==="group"?e.jsx(i.Users,{}):e.jsx(i.User,{})}),a.type==="direct"&&e.jsx("span",{className:"absolute -bottom-0.5 -right-0.5",children:e.jsx(ye,{status:G(a.participants?.find(t=>t.userId!==r)?.userId||""),size:"md"})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-medium",children:a.display_name||a.name}),e.jsx("span",{className:"text-xs text-gray-500",children:a.type==="group"?`${a.participants?.length||0} members`:G(a.participants?.find(t=>t.userId!==r)?.userId||"")==="online"?"Online":a.participants?.find(t=>t.userId!==r)?.lastActiveAt?`Last seen ${He(new Date(a.participants.find(t=>t.userId!==r).lastActiveAt))} ago`:"Offline"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>J(!0),className:"p-2 rounded-xl hover:bg-white/5",title:"Search in conversation",children:e.jsx(i.Search,{})}),e.jsx("button",{onClick:()=>me(!0),className:"p-2 rounded-xl hover:bg-white/5",title:"Pinned messages",children:e.jsx(i.Pin,{filled:F.length>0})}),e.jsx("button",{onClick:Ee,className:y("p-2 rounded-xl hover:bg-white/5",a.starred&&"text-yellow-400"),title:a.starred?"Unstar":"Star",children:e.jsx(i.Star,{filled:a.starred})}),e.jsx("button",{onClick:_e,className:"p-2 rounded-xl hover:bg-white/5",title:a.archived?"Unarchive":"Archive",children:a.archived?e.jsx(i.Unarchive,{}):e.jsx(i.Archive,{})}),e.jsxs("div",{className:"relative",ref:Q,children:[e.jsx("button",{onClick:()=>z(!se),className:"p-2 rounded-xl hover:bg-white/5",children:e.jsx(i.More,{})}),se&&e.jsxs("div",{className:"absolute right-0 top-full mt-1 w-48 bg-[#1a1a24] border border-white/10 rounded-xl shadow-xl z-50 overflow-hidden",children:[e.jsxs("button",{onClick:()=>{xe(!0),z(!1)},className:"w-full px-4 py-3 text-left text-sm hover:bg-white/5 flex items-center gap-3",children:[e.jsx(i.Settings,{}),"Settings"]}),a.type==="direct"&&e.jsxs("button",{onClick:O?De:Re,className:"w-full px-4 py-3 text-left text-sm hover:bg-white/5 flex items-center gap-3 text-red-400 hover:text-red-300",children:[e.jsx(i.Block,{}),O?"Unblock User":"Block User"]})]})]})]})]}),O&&e.jsx("div",{className:"px-4 py-2 bg-red-500/10 border-b border-red-500/20 text-red-400 text-sm text-center",children:"You have blocked this user. They cannot send you messages."}),a.disappearing_ttl&&a.disappearing_ttl>0&&e.jsxs("div",{className:"px-4 py-2 bg-violet-500/10 border-b border-violet-500/20 text-violet-400 text-sm text-center flex items-center justify-center gap-2",children:[e.jsx(i.Timer,{}),"Disappearing messages: ",Ne.find(t=>t.value===a.disappearing_ttl)?.label||"On"]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[x.map(t=>e.jsx(Ge,{message:t,isOwnMessage:t.sender_id==="me",onReply:E,onEdit:W,onDelete:$e,onPin:Ae,onForward:fe,onReact:Pe,pinnedMessages:F,formatTime:we},t.id)),e.jsx("div",{ref:ge})]}),e.jsx(N,{children:ne.length>0&&e.jsx(Ve,{users:ne})}),C&&e.jsxs("div",{className:"px-4 py-2 bg-white/5 border-t border-white/10 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i.Reply,{}),e.jsxs("div",{children:[e.jsxs("span",{className:"text-xs text-violet-400",children:["Replying to ",C.sender_name]}),e.jsx("p",{className:"text-sm text-gray-400 truncate max-w-xs",children:C.content})]})]}),e.jsx("button",{onClick:()=>E(null),className:"p-1 hover:bg-white/10 rounded",children:e.jsx(i.X,{})})]}),_&&e.jsxs("div",{className:"px-4 py-2 bg-yellow-500/10 border-t border-yellow-500/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs text-yellow-400",children:"Editing message"}),e.jsx("button",{onClick:()=>W(null),className:"p-1 hover:bg-white/10 rounded",children:e.jsx(i.X,{})})]}),e.jsx("form",{onSubmit:t=>{t.preventDefault(),Be(_.id,w)},children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",defaultValue:_.content,onChange:t=>f(t.target.value),className:"flex-1 px-3 py-2 bg-white/5 border border-white/10 rounded-xl focus:outline-none focus:border-white/20",autoFocus:!0}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-yellow-600 hover:bg-yellow-700 rounded-xl",children:"Save"})]})})]}),!_&&e.jsxs("form",{onSubmit:be,className:"p-4 border-t border-white/5",children:[ae&&e.jsx("div",{className:"mb-3 px-4 py-2 bg-red-500/10 border border-red-500/30 rounded-xl text-red-400 text-sm",children:ae}),e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsx("button",{type:"button",onClick:()=>oe(!0),className:"p-3 bg-white/5 hover:bg-white/10 rounded-xl",title:"Templates",children:e.jsx(i.Template,{})}),e.jsx("div",{className:"flex-1",children:e.jsx("input",{ref:Le,type:"text",value:w,onChange:ze,placeholder:"Type a message...",className:"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl focus:outline-none focus:border-white/20"})}),e.jsx("button",{type:"button",onClick:()=>X(!0),disabled:!w.trim(),className:"p-3 bg-white/5 hover:bg-white/10 disabled:opacity-50 rounded-xl",title:"Schedule",children:e.jsx(i.Clock,{})}),e.jsx("button",{type:"submit",disabled:!w.trim(),className:"px-5 py-3 bg-violet-600 hover:bg-violet-700 disabled:opacity-50 disabled:cursor-not-allowed rounded-xl transition-all",children:e.jsx(i.Send,{})})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"0.1 credits per recipient"})]}),e.jsx(N,{children:ue&&a&&e.jsx(nt,{isOpen:ue,onClose:()=>me(!1),conversationId:a.id,token:s,onJumpToMessage:t=>{document.getElementById(`msg-${t}`)?.scrollIntoView({behavior:"smooth",block:"center"})}})})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 rounded-full bg-white/5 flex items-center justify-center",children:e.jsx(i.User,{})}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Select a conversation"}),e.jsx("p",{className:"text-gray-400",children:"Choose from your existing conversations or start a new one"})]})})}),e.jsx(N,{children:ke&&e.jsx(v.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:()=>L(!1),children:e.jsxs(v.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:t=>t.stopPropagation(),className:"bg-[#12121a] border border-white/10 rounded-2xl w-full max-w-md overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-white/10 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"New Message"}),e.jsx("button",{onClick:()=>L(!1),className:"p-2 rounded-xl hover:bg-white/5",children:e.jsx(i.X,{})})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("input",{type:"text",value:Z,onChange:t=>{Se(t.target.value),Ue(t.target.value)},placeholder:"Search for users...",className:"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl focus:outline-none focus:border-white/20"}),e.jsxs("div",{className:"mt-4 max-h-64 overflow-y-auto",children:[ee.map(t=>e.jsxs("div",{onClick:()=>Ie(t.id),className:"flex items-center gap-3 p-3 rounded-xl hover:bg-white/5 cursor-pointer",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-white/10 flex items-center justify-center",children:e.jsx(i.User,{})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.username}),e.jsx("div",{className:"text-sm text-gray-500",children:t.city||"MuscleMap User"})]})]},t.id)),Z.length>=2&&ee.length===0&&e.jsx("p",{className:"text-center text-gray-500 py-8",children:"No users found"})]})]})]})})}),e.jsx(N,{children:re&&e.jsx(Ke,{isOpen:re,onClose:()=>J(!1),token:s,conversationId:a?.id,onSelectMessage:t=>{document.getElementById(`msg-${t}`)?.scrollIntoView({behavior:"smooth",block:"center"})}})}),e.jsx(N,{children:le&&e.jsx(Ze,{isOpen:le,onClose:()=>oe(!1),token:s,onUseTemplate:t=>f(t)})}),e.jsx(N,{children:ce&&e.jsx(et,{isOpen:ce,onClose:()=>de(!1),token:s})}),e.jsx(N,{children:he&&a&&e.jsx(tt,{isOpen:he,onClose:()=>xe(!1),conversation:a,token:s,onUpdate:t=>{c(o=>o?{...o,...t}:null)}})}),e.jsx(N,{children:pe&&e.jsx(at,{isOpen:pe,onClose:()=>X(!1),onSchedule:t=>{be({preventDefault:()=>{}},t),X(!1)}})}),e.jsx(N,{children:V&&e.jsx(st,{isOpen:!!V,onClose:()=>fe(null),message:V,token:s,conversations:u})})]})}export{mt as default};
