const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-syYysO6E.js","assets/react-vendor-D1NxaRNd.js","assets/illustrations-CFkZtwGd.js","assets/index-DJ0LhdQR.js","assets/leaflet-vendor-CIGW-MKW.css","assets/reactflow-vendor-B5DZHykP.css","assets/index-5BN-nJww.css"])))=>i.map(i=>d[i]);
import{e as pe,J as Qe,K as et,R as st,N as tt,O as at,Q as rt,V as lt,Y as nt,$ as it,a0 as ot,a1 as ct,a2 as dt,a3 as xt,a4 as ut,j as Cs,q as mt,a5 as ht,P as we,m as Q,E as $e,A as xe,l as Ze,Z as Ms,a6 as Fe,a7 as Es,D as Ke,X as be,a8 as Xe,a9 as Ts,h as ge,aa as Te,ab as ns,G as gt,ac as qe,H as pt,_ as bt}from"./index-DJ0LhdQR.js";import{r as t,j as e,a as ft,d as yt,L as vt}from"./react-vendor-D1NxaRNd.js";import{T as Rs}from"./TipCard-DKUeB1PX.js";import{h as jt}from"./illustrations-CFkZtwGd.js";import{M as is}from"./MuscleViewer-CNpcoGPU.js";import{M as wt}from"./MuscleActivationBadge-C7R_1knN.js";import"./GlassSurface-BMiMerMg.js";import"./GlassButton-CNn_sKZF.js";import{FloatingRestTimer as Nt}from"./FloatingRestTimer-C3nNgymo.js";import{u as os,b as cs,c as de,g as Is}from"./apollo-vendor-BMQ75Ycx.js";import{C as We}from"./circle-alert-BDMVjEqk.js";import{M as Re}from"./minus-DUcXDZIx.js";import{L as Ne}from"./loader-circle-Dm6TL8p5.js";import{A as ds}from"./award-DCmwOF96.js";import{R as es}from"./refresh-cw-BuR83iHz.js";import{I as ss}from"./info-Co_rzwuq.js";import{C as Oe}from"./chevron-down-BQH1RCoa.js";import{T as _s}from"./timer-CVj6vWtg.js";import{C as Ps}from"./check-Bxmb3H1Y.js";import{C as As}from"./chevron-right-DRXK63_G.js";import{T as $s}from"./trash-2-nzNu3WUs.js";import{R as Je}from"./rotate-ccw-DxC1DxXM.js";import{C as St}from"./copy-7AXoryVF.js";import{P as xs}from"./pause-tkksyJD6.js";import{V as kt,a as Ct}from"./volume-x-jlFRLAGu.js";import{F as us}from"./flag-DRRYulpL.js";import{T as Fs}from"./trending-down-DLMry3ri.js";import{P as Mt}from"./pen-bBohloib.js";import{C as Et}from"./chevron-up-BvSFURNh.js";import{S as Tt}from"./save-ry9NC4By.js";import"./reactflow-vendor-Dz2P_-Qa.js";import"./d3-vendor-mcDw60ct.js";import"./recharts-vendor-BziRPEEi.js";import"./leaflet-vendor-DZbo3Ov0.js";import"./use-drag-controls-BrwB4jTf.js";import"./minimize-2-CGyL7oZ3.js";import"./skip-forward-wHPsqGmS.js";const Rt=[["path",{d:"M22 14v-4",key:"14q9d5"}],["path",{d:"M6 14v-4",key:"14a6bd"}],["rect",{x:"2",y:"6",width:"16",height:"12",rx:"2",key:"13zb55"}]],It=pe("battery-low",Rt);const _t=[["path",{d:"M10 14v-4",key:"suye4c"}],["path",{d:"M22 14v-4",key:"14q9d5"}],["path",{d:"M6 14v-4",key:"14a6bd"}],["rect",{x:"2",y:"6",width:"16",height:"12",rx:"2",key:"13zb55"}]],Pt=pe("battery-medium",_t);const At=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]],$t=pe("chart-line",At);const Ft=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M16 16s-1.5-2-4-2-4 2-4 2",key:"epbg0q"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]],Wt=pe("frown",Ft);const Lt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"8",x2:"16",y1:"15",y2:"15",key:"1xb1d9"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]],Ot=pe("meh",Lt);const Dt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]],ms=pe("smile",Dt);const Bt=[["path",{d:"M21 9a2.4 2.4 0 0 0-.706-1.706l-3.588-3.588A2.4 2.4 0 0 0 15 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2z",key:"1dfntj"}],["path",{d:"M15 3v5a1 1 0 0 0 1 1h5",key:"6s6qgf"}]],hs=pe("sticky-note",Bt);const Ut=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],Gt=pe("tag",Ut),qt="musclemap-sessions",Vt=1,Le="active_session";let Ie=null;function zt(){return Ie||(Ie=new Promise((a,n)=>{const o=indexedDB.open(qt,Vt);o.onerror=()=>{n(o.error)},o.onsuccess=()=>{a(o.result)},o.onupgradeneeded=u=>{const w=u.target.result;w.objectStoreNames.contains(Le)||w.createObjectStore(Le,{keyPath:"id"})}}),Ie)}async function Ht(){try{const o=(await zt()).transaction(Le,"readwrite").objectStore(Le);await new Promise((u,w)=>{const x=o.delete("current");x.onsuccess=()=>u(),x.onerror=()=>w(x.error)})}catch{}}let ne=null;const Yt=5e3,Qt=3e4;let Ve=0;async function Kt(a,n=!1){if(!localStorage.getItem("token"))return;const u=Date.now();if(n||u-Ve>Qt){ne&&(clearTimeout(ne),ne=null);try{await Qe.post("/sessions",gs(a)),Ve=u}catch{}return}ne&&clearTimeout(ne),ne=setTimeout(async()=>{try{await Qe.post("/sessions",gs(a)),Ve=Date.now()}catch{}ne=null},Yt)}async function Jt(a,n){if(localStorage.getItem("token"))try{await Qe.delete("/sessions/active",{data:{reason:a,workoutId:n}})}catch{}}function gs(a){return{sessionId:a.sessionId,startedAt:a.startTime,pausedAt:a.pausedAt,totalPausedTime:a.totalPausedTime,workoutPlan:a.workoutPlan||{exercises:a.exercises},currentExerciseIndex:a.currentExerciseIndex,currentSetIndex:a.currentSetIndex,sets:a.sets,totalVolume:a.totalVolume,totalReps:a.totalReps,estimatedCalories:a.estimatedCalories,musclesWorked:a.musclesWorked,sessionPRs:a.sessionPRs,restTimer:a.restTimer,exerciseGroups:a.exerciseGroups,activeGroup:a.activeGroup,activeGroupExerciseIndex:a.activeGroupExerciseIndex,activeGroupRound:a.activeGroupRound,groupSets:a.groupSets,clientVersion:a.clientVersion}}async function ps(a="completed",n){ne&&(clearTimeout(ne),ne=null),await Ht(),await Jt(a,n)}function De(){const a=t.useRef(null),n=t.useRef(null),o=t.useRef(null),{data:u,loading:w,refetch:x,error:_}=os(et,{fetchPolicy:"network-only",notifyOnNetworkStatusChange:!0,errorPolicy:"all"}),{data:S,loading:f,refetch:y}=os(st,{fetchPolicy:"network-only",errorPolicy:"all"}),[I,{data:b,loading:j}]=cs(tt,{errorPolicy:"all"}),[M,{loading:R}]=cs(at,{errorPolicy:"all"}),[l,{loading:m}]=de(rt),[c,{loading:k}]=de(lt),[A,{loading:q}]=de(nt),[p,{loading:L}]=de(it),[d,{loading:v}]=de(ot),[O,{loading:K}]=de(ct),[U,{loading:D}]=de(dt),[J,{loading:H}]=de(xt),[G,{loading:Z}]=de(ut),h=t.useMemo(()=>u?.activeWorkoutSession||null,[u]),i=t.useMemo(()=>(S?.recoverableSessions||[]).map(E=>({...E,exerciseCount:E.musclesWorked?.length||0,setCount:E.setsLogged,lastActivityAt:E.archivedAt})),[S]),$=t.useMemo(()=>{const T={};if(b?.exerciseHistory)for(const E of b.exerciseHistory)T[E.exerciseId]=E;return T},[b]),Y=!!h,se=!!h?.pausedAt,ae=t.useCallback(async(T,E)=>{try{const{data:F,errors:ee}=await l({variables:{input:T?{workoutPlan:T,clientId:E}:void 0}});return ee?.length?{success:!1,error:ee[0]?.message||"Failed to start session"}:F?.startWorkoutSession?.session?(await x(),{success:!0,sessionId:F.startWorkoutSession.session.id}):{success:!1,error:"Failed to start session"}}catch(F){return{success:!1,error:F instanceof Error?F.message:"Unknown error"}}},[l,x]),re=t.useCallback(async T=>{try{const{data:E,errors:F}=await c({variables:{input:T}});if(F?.length)return{success:!1,error:F[0]?.message||"Failed to log set"};if(E?.logSet){const ee=E.logSet,te=ee.prsAchieved||[];for(const Ue of te)a.current&&a.current(Ue);return await x(),{success:!0,set:ee.setLogged,prs:te}}return{success:!1,error:"Failed to log set"}}catch(E){return{success:!1,error:E instanceof Error?E.message:"Unknown error"}}},[c,x]),ie=t.useCallback(async(T,E)=>{try{const{data:F,errors:ee}=await A({variables:{input:{setId:T,...E}}});return ee?.length?{success:!1,error:ee[0]?.message||"Failed to update set"}:F?.updateSet?(await x(),{success:!0,set:F.updateSet}):{success:!1,error:"Failed to update set"}}catch(F){return{success:!1,error:F instanceof Error?F.message:"Unknown error"}}},[A,x]),V=t.useCallback(async T=>{try{const{data:E,errors:F}=await p({variables:{setId:T}});return F?.length?{success:!1,error:F[0]?.message||"Failed to delete set"}:E?.deleteSet!==void 0?(await x(),{success:!0}):{success:!1,error:"Failed to delete set"}}catch(E){return{success:!1,error:E instanceof Error?E.message:"Unknown error"}}},[p,x]),oe=t.useCallback(async()=>{if(!h)return{success:!1,error:"No active session"};try{const{data:T,errors:E}=await d({variables:{sessionId:h.id}});return E?.length?{success:!1,error:E[0]?.message||"Failed to pause session"}:T?.pauseWorkoutSession?(await x(),{success:!0}):{success:!1,error:"Failed to pause session"}}catch(T){return{success:!1,error:T instanceof Error?T.message:"Unknown error"}}},[h,d,x]),ue=t.useCallback(async()=>{if(!h)return{success:!1,error:"No active session"};try{const{data:T,errors:E}=await O({variables:{sessionId:h.id}});return E?.length?{success:!1,error:E[0]?.message||"Failed to resume session"}:T?.resumeWorkoutSession?(await x(),{success:!0}):{success:!1,error:"Failed to resume session"}}catch(T){return{success:!1,error:T instanceof Error?T.message:"Unknown error"}}},[h,O,x]),N=t.useCallback(async(T,E)=>{if(!h)return{success:!1,error:"No active session"};try{const{data:F,errors:ee}=await U({variables:{input:{sessionId:h.id,notes:T,isPublic:E}}});if(ee?.length)return{success:!1,error:ee[0]?.message||"Failed to complete session"};const te=F?.completeWorkoutSession;return te?(te.levelUp&&n.current&&n.current(Math.floor(te.xpEarned/1e3)+1),o.current&&o.current(te),await x(),{success:!0,result:te}):{success:!1,error:"Failed to complete session"}}catch(F){return{success:!1,error:F instanceof Error?F.message:"Unknown error"}}},[h,U,x]),B=t.useCallback(async T=>{if(!h)return{success:!1,error:"No active session"};try{const{data:E,errors:F}=await J({variables:{sessionId:h.id,reason:T}});return F?.length?{success:!1,error:F[0]?.message||"Failed to abandon session"}:E?.abandonWorkoutSession!==void 0?(await x(),{success:!0}):{success:!1,error:"Failed to abandon session"}}catch(E){return{success:!1,error:E instanceof Error?E.message:"Unknown error"}}},[h,J,x]),X=t.useCallback(async T=>{try{const{data:E,errors:F}=await G({variables:{archivedSessionId:T}});return F?.length?{success:!1,error:F[0]?.message||"Failed to recover session"}:E?.recoverWorkoutSession?(await x(),await y(),{success:!0,session:E.recoverWorkoutSession}):{success:!1,error:"Failed to recover session"}}catch(E){return{success:!1,error:E instanceof Error?E.message:"Unknown error"}}},[G,x,y]),me=t.useCallback(async T=>{T.length!==0&&await I({variables:{exerciseIds:T}})},[I]),Be=t.useCallback(async(T,E,F)=>{try{const{data:ee}=await M({variables:{exerciseId:T,equipment:E,maxResults:F||5}});return ee?.exerciseSubstitutions||[]}catch{return[]}},[M]),fe=t.useCallback(T=>{T.onPRAchieved&&(a.current=T.onPRAchieved),T.onLevelUp&&(n.current=T.onLevelUp),T.onWorkoutComplete&&(o.current=T.onWorkoutComplete)},[]),ve=t.useMemo(()=>{if(!h)return 0;const T=new Date(h.startedAt).getTime(),F=Date.now()-T;return Math.floor((F-h.totalPausedTime*1e3)/1e3)},[h]),Se=t.useMemo(()=>{if(!h?.sets||h.sets.length===0)return[];const T=h.sets[h.sets.length-1];return T?h.sets.filter(E=>E.exerciseId===T.exerciseId):[]},[h]),ke=t.useCallback(T=>h?.sets?h.sets.filter(E=>E.exerciseId===T):[],[h]),Ce=h?.sets?.length||0;return{activeSession:h,isSessionActive:Y,isPaused:se,recoverableSessions:i,exerciseHistory:$,sessionDuration:ve,currentExerciseSets:Se,getSetsForExercise:ke,totalSets:Ce,errors:{activeSession:_},loading:{activeSession:w,recoverableSessions:f,exerciseHistory:j,substitutions:R,startingSession:m,loggingSet:k,updatingSet:q,deletingSet:L,pausingSession:v,resumingSession:K,completingSession:D,abandoningSession:H,recoveringSession:Z},startSession:ae,logSet:re,updateSet:ie,deleteSet:V,pauseSession:oe,resumeSession:ue,completeSession:N,abandonSession:B,recoverSession:X,loadExerciseHistory:me,findSubstitutes:Be,registerCallbacks:fe,refetchActiveSession:x,refetchRecoverableSessions:y}}function Zt({exerciseId:a,delay:n=2e3}){const[o,u]=t.useState(null),[w,x]=t.useState(!1),[_,S]=t.useState(!1);return t.useEffect(()=>{if(!a)return;u(null),x(!1),S(!1),(async()=>{try{const y=await Cs(`/tips/exercise/${a}`);y?.data&&(u(y.data),setTimeout(()=>x(!0),n))}catch{}})()},[a,n]),!o||!w||_?null:e.jsx("div",{className:"animate-fadeIn",children:e.jsx(Rs,{tip:o,onDismiss:()=>S(!0),compact:!0})})}const Xt={first_workout:"ðŸŽ‰",workouts_10:"ðŸ”¥",workouts_50:"âš¡",workouts_100:"ðŸ†",streak_7:"ðŸ“…",streak_30:"ðŸ—“ï¸",exercises_100:"ðŸ’¯",reps_1000:"ðŸŽ¯",reps_10000:"ðŸš€",hours_10:"â±ï¸"};function ea({milestone:a,onContinue:n}){if(!a)return null;const o=Xt[a.id]||"ðŸ…";return e.jsxs("div",{className:"bg-gradient-to-b from-yellow-500/20 via-amber-500/10 to-transparent rounded-2xl p-6 border border-yellow-500/30 text-center",children:[e.jsxs("div",{className:"relative inline-block mb-4",children:[e.jsx("div",{className:"text-6xl animate-bounce",children:o}),e.jsx("div",{className:"absolute -top-2 -right-2 w-8 h-8 bg-yellow-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-black",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]}),e.jsx("h3",{className:"text-xl font-bold text-yellow-400 mb-1",children:"Milestone Achieved!"}),e.jsx("p",{className:"text-2xl font-bold text-white mb-2",children:a.name}),a.description&&e.jsx("p",{className:"text-gray-300 text-sm mb-4",children:a.description}),n&&e.jsx("button",{onClick:n,className:"mt-4 px-6 py-2 bg-yellow-500 hover:bg-yellow-400 text-black font-medium rounded-lg transition-colors",children:"Awesome!"})]})}function sa({workout:a,onClose:n}){const[o,u]=t.useState(null),[w,x]=t.useState(null),[_,S]=t.useState(!0),[f,y]=t.useState(!0);t.useEffect(()=>{(async()=>{try{const j=await Cs("/tips/completion",{method:"POST",body:{goals:a?.goals||[]}});u(j?.data?.tip),x(j?.data?.milestone)}catch{}finally{S(!1)}})()},[a?.goals]);const I=[{icon:"â±ï¸",value:a?.duration||"-",label:"minutes",color:"text-blue-400"},{icon:"ðŸ‹ï¸",value:a?.exerciseCount||a?.exercises?.length||"-",label:"exercises",color:"text-yellow-400"},{icon:"ðŸ”¥",value:a?.totalSets||"-",label:"sets",color:"text-orange-400"},{icon:"ðŸ’ª",value:a?.totalTU?Math.round(a.totalTU):"-",label:"TU earned",color:"text-purple-400"}];return e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-gray-900 rounded-2xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"relative pt-8 pb-4 px-6 text-center overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute top-0 left-1/4 w-2 h-2 bg-yellow-400 rounded-full animate-ping",style:{animationDelay:"0s"}}),e.jsx("div",{className:"absolute top-4 right-1/4 w-2 h-2 bg-purple-400 rounded-full animate-ping",style:{animationDelay:"0.2s"}}),e.jsx("div",{className:"absolute top-2 left-1/2 w-2 h-2 bg-pink-400 rounded-full animate-ping",style:{animationDelay:"0.4s"}})]}),e.jsx("div",{className:"text-6xl mb-3",children:"ðŸŽ‰"}),e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Workout Complete!"}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Great job staying consistent"})]}),e.jsx("div",{className:"px-6 pb-4",children:e.jsx("div",{className:"grid grid-cols-4 gap-2",children:I.map((b,j)=>e.jsxs("div",{className:"bg-gray-800 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-lg mb-1",children:b.icon}),e.jsx("div",{className:`text-lg font-bold ${b.color}`,children:b.value}),e.jsx("div",{className:"text-xs text-gray-500",children:b.label})]},j))})}),w&&f&&e.jsx("div",{className:"px-6 pb-4",children:e.jsx(ea,{milestone:w,onContinue:()=>y(!1)})}),!_&&o&&(!w||!f)&&e.jsx("div",{className:"px-6 pb-4",children:e.jsx(Rs,{tip:o})}),_&&e.jsx("div",{className:"px-6 pb-4",children:e.jsx("div",{className:"bg-gray-800 rounded-xl p-4 animate-pulse",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-700 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-gray-700 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-700 rounded w-1/2"})]})]})})}),e.jsx("div",{className:"px-6 pb-6",children:e.jsx("button",{onClick:n,className:"w-full py-3 bg-purple-600 hover:bg-purple-500 text-white font-medium rounded-xl transition-colors",children:"Done"})})]})})}function ta({content:a,children:n}){const[o,u]=ft.useState(!1);return e.jsxs("div",{className:"relative inline-block",onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),onTouchStart:()=>u(!0),onTouchEnd:()=>setTimeout(()=>u(!1),2e3),children:[n,e.jsx(xe,{children:o&&e.jsxs(Q.div,{initial:{opacity:0,y:4,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:4,scale:.95},transition:{duration:.15},className:"absolute z-50 bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-2 text-xs text-gray-200 bg-gray-900 border border-gray-700 rounded-lg shadow-xl whitespace-nowrap max-w-[200px] text-center",style:{whiteSpace:"normal"},children:[a,e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-gray-900"})]})})]})}const aa={warmup:{label:"Warmup",color:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30",icon:Es,tooltip:"Light weight to prepare muscles and joints before working sets"},working:{label:"Working",color:"bg-blue-500/20 text-blue-400 border-blue-500/30",icon:Fe,tooltip:"Main sets at your target weight for building strength/muscle"},failure:{label:"Failure",color:"bg-red-500/20 text-red-400 border-red-500/30",icon:Ms,tooltip:"Pushed until you cannot complete another rep with good form"},drop:{label:"Drop",color:"bg-purple-500/20 text-purple-400 border-purple-500/30",icon:Oe,tooltip:"Reduced weight immediately after a set with no rest"},amrap:{label:"AMRAP",color:"bg-orange-500/20 text-orange-400 border-orange-500/30",icon:Ze,tooltip:"As Many Reps As Possible - max effort set"}},ra=[{value:0,label:"0 RIR",description:"Total failure"},{value:1,label:"1 RIR",description:"Could do 1 more"},{value:2,label:"2 RIR",description:"Could do 2 more"},{value:3,label:"3 RIR",description:"Could do 3 more"},{value:4,label:"4+ RIR",description:"Easy"}];function la({exerciseId:a,exerciseName:n,suggestedSets:o=3,suggestedReps:u=10,onSetLogged:w,onAllSetsComplete:x,compact:_=!1}){const{error:S}=mt(),f=ht(),[y,I]=t.useState(""),[b,j]=t.useState(u.toString()),[M,R]=t.useState("working"),[l,m]=t.useState(null),[c,k]=t.useState(null),[A,q]=t.useState(""),[p,L]=t.useState(!1),[d,v]=t.useState(null),[O,K]=t.useState([]),{logSet:U,loadExerciseHistory:D,exerciseHistory:J,getSetsForExercise:H,activeSession:G,loading:Z}=De(),h=Z.loggingSet;t.useEffect(()=>{D([a])},[a,D]);const i=J[a],$=H(a),Y=$.length+1,se=t.useMemo(()=>i?.bestWeight?Math.round(i.bestWeight*.85/5)*5:null,[i]);t.useEffect(()=>{se&&!y&&I(se.toString())},[se,y]);const ae=t.useCallback(async()=>{const N=parseFloat(y),B=parseInt(b);if(isNaN(N)||N<0){S("Please enter a valid weight (0 or greater)");return}if(!B||B<=0){S("Please enter reps greater than 0");return}if(!G){S("No active workout session. Please start a new workout from the beginning.");return}const X=await U({sessionId:G.id,exerciseId:a,setNumber:Y,reps:B,weightKg:N/2.205,rpe:l||void 0,rir:c||void 0,tag:M||void 0,notes:A.trim()||void 0});if(X?.set){if(K(X.set.muscleActivations||[]),X.set.isPRWeight||X.set.isPR1RM||X.set.isPRReps){const me=X.set.isPR1RM?"1rm":X.set.isPRWeight?"weight":"reps";v({type:me,value:Math.round(me==="1rm"?X.set.weightKg*2.205/(1.0278-.0278*B):X.set.weightKg*2.205)}),setTimeout(()=>v(null),4e3)}j(u.toString()),m(null),k(null),q(""),w?.(X.set),Y>=o&&x?.()}},[y,b,M,l,c,A,a,G,U,u,o,Y,w,x,S]),re=N=>{const B=parseFloat(y)||0;I(Math.max(0,B+N).toString())},ie=N=>{const B=parseFloat(N);N===""||N==="-"?I(""):isNaN(B)||I(Math.max(0,B).toString())},V=N=>{const B=parseInt(b)||0;j(Math.max(0,B+N).toString())},oe=t.useMemo(()=>{const N=parseFloat(y),B=parseInt(b);return N>0&&B>0&&B<=15?Math.round(N/(1.0278-.0278*B)):null},[y,b]),ue=oe&&i?.best1RM&&oe>i.best1RM;return G?_?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs text-gray-400 mb-1 block",children:"Weight (lbs)"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>re(-5),className:"p-1.5 rounded bg-gray-800 hover:bg-gray-700 text-gray-400",children:e.jsx(Re,{className:"w-4 h-4"})}),e.jsx("input",{type:"number",min:"0",value:y,onChange:N=>ie(N.target.value),placeholder:"0",className:"flex-1 bg-gray-800/50 border border-gray-700 rounded px-2 py-2 text-center text-lg font-bold focus:border-blue-500 focus:outline-none w-20"}),e.jsx("button",{onClick:()=>re(5),className:"p-1.5 rounded bg-gray-800 hover:bg-gray-700 text-gray-400",children:e.jsx(we,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs text-gray-400 mb-1 block",children:"Reps"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>V(-1),className:"p-1.5 rounded bg-gray-800 hover:bg-gray-700 text-gray-400",children:e.jsx(Re,{className:"w-4 h-4"})}),e.jsx("input",{type:"number",value:b,onChange:N=>j(N.target.value),placeholder:"0",className:"flex-1 bg-gray-800/50 border border-gray-700 rounded px-2 py-2 text-center text-lg font-bold focus:border-blue-500 focus:outline-none w-16"}),e.jsx("button",{onClick:()=>V(1),className:"p-1.5 rounded bg-gray-800 hover:bg-gray-700 text-gray-400",children:e.jsx(we,{className:"w-4 h-4"})})]})]})]}),e.jsx(Q.button,{whileTap:{scale:.98},onClick:ae,disabled:!y||!b||h,className:`w-full py-3 rounded-xl font-bold text-base transition-all flex items-center justify-center gap-2 ${y&&b&&!h?"bg-gradient-to-r from-green-600 to-green-500 hover:from-green-500 hover:to-green-400 text-white":"bg-gray-800 text-gray-500 cursor-not-allowed"}`,children:h?e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"w-4 h-4 animate-spin"}),"Logging..."]}):e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"w-4 h-4"}),"Log Set ",Y,"/",o]})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(xe,{children:d&&e.jsxs(Q.div,{initial:{opacity:0,y:-20,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-20,scale:.9},className:"bg-gradient-to-r from-yellow-500/20 to-orange-500/20 border border-yellow-500/30 rounded-lg p-4 flex items-center gap-3",children:[e.jsx(ds,{className:"w-8 h-8 text-yellow-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-yellow-400",children:"NEW PR!"}),e.jsxs("p",{className:"text-sm text-gray-300",children:[d.type==="1rm"&&`Estimated 1RM: ${d.value} lbs`,d.type==="weight"&&`Max weight: ${d.value} lbs`,d.type==="volume"&&`Set volume: ${d.value} lbs`]})]})]})}),i&&e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-3 flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[e.jsx(es,{className:"w-4 h-4"}),e.jsxs("span",{children:["Last: ",i.totalSessions," sessions"]})]}),e.jsxs("div",{className:"flex gap-4",children:[i.bestWeight&&e.jsxs("span",{className:"text-blue-400",children:["Best: ",Math.round(i.bestWeight*2.205)," lbs"]}),i.best1RM&&e.jsxs("span",{className:"text-purple-400",children:["1RM: ",Math.round(i.best1RM*2.205)," lbs"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Set Progress:"}),e.jsx("div",{className:"flex gap-1",children:Array.from({length:o}).map((N,B)=>e.jsx("div",{className:`w-8 h-2 rounded-full transition-colors ${B<$.length?"bg-green-500":B===$.length?"bg-blue-500 animate-pulse":"bg-gray-700"}`},B))}),e.jsxs("span",{className:"text-sm font-medium",children:[$.length,"/",o]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(ss,{className:"w-3 h-3"}),e.jsx("span",{children:"Tap and hold for info"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(aa).map(([N,B])=>{const X=B.icon;return e.jsx(ta,{content:B.tooltip,children:e.jsxs("button",{onClick:()=>R(N),className:`px-3 py-1.5 rounded-full text-sm font-medium border transition-all flex items-center gap-1.5 ${M===N?B.color:"bg-gray-800/50 text-gray-400 border-gray-700 hover:border-gray-600"}`,children:[e.jsx(X,{className:"w-4 h-4"}),B.label]})},N)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Weight (lbs)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>re(-5),className:"p-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-gray-400",children:e.jsx(Re,{className:"w-5 h-5"})}),e.jsx("input",{type:"number",min:"0",value:y,onChange:N=>ie(N.target.value),placeholder:"0",className:"flex-1 bg-gray-800/50 border border-gray-700 rounded-lg px-4 py-3 text-center text-2xl font-bold focus:border-blue-500 focus:outline-none"}),e.jsx("button",{onClick:()=>re(5),className:"p-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-gray-400",children:e.jsx(we,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Reps"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>V(-1),className:"p-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-gray-400",children:e.jsx(Re,{className:"w-5 h-5"})}),e.jsx("input",{type:"number",value:b,onChange:N=>j(N.target.value),placeholder:"0",className:"flex-1 bg-gray-800/50 border border-gray-700 rounded-lg px-4 py-3 text-center text-2xl font-bold focus:border-blue-500 focus:outline-none"}),e.jsx("button",{onClick:()=>V(1),className:"p-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-gray-400",children:e.jsx(we,{className:"w-5 h-5"})})]})]}),oe&&e.jsxs("div",{className:`p-3 rounded-lg border ${ue?"bg-yellow-500/10 border-yellow-500/30":"bg-gray-800/50 border-gray-700"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Estimated 1RM"}),e.jsxs("span",{className:`font-bold ${ue?"text-yellow-400":"text-white"}`,children:[oe," lbs",ue&&e.jsx("span",{className:"ml-2 text-xs",children:"NEW PR!"})]})]}),i?.best1RM&&e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Previous Best"}),e.jsxs("span",{className:"text-xs text-gray-400",children:[Math.round(i.best1RM*2.205)," lbs"]})]})]}),O.length>0&&e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-2",children:"Last Set - Muscle Activation"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:O.map(N=>e.jsxs("span",{className:"bg-purple-500/30 text-purple-200 px-2 py-0.5 rounded text-xs",children:[N.muscleName," (",Math.round(N.activation*100),"%)"]},N.muscleId))})]}),e.jsxs("button",{onClick:()=>L(!p),className:"w-full py-2 text-sm text-gray-400 hover:text-gray-300 flex items-center justify-center gap-2",children:[e.jsxs("span",{children:[p?"Hide":"Show"," Advanced Options"]}),e.jsx(Oe,{className:`w-4 h-4 transition-transform ${p?"rotate-180":""}`})]}),e.jsx(xe,{children:p&&e.jsxs(Q.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"space-y-4 overflow-hidden",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"RPE (1-10)"}),e.jsx("span",{className:"text-sm font-medium",children:l||"-"})]}),e.jsx("input",{type:"range",min:"1",max:"10",value:l||5,onChange:N=>m(parseInt(N.target.value)),className:"w-full accent-blue-500"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsx("span",{children:"Easy"}),e.jsx("span",{children:"Max Effort"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Reps in Reserve"}),e.jsx("div",{className:"flex gap-2",children:ra.map(N=>e.jsx("button",{onClick:()=>k(c===N.value?null:N.value),className:`flex-1 py-2 px-2 rounded-lg text-xs font-medium border transition-all ${c===N.value?"bg-blue-500/20 text-blue-400 border-blue-500/30":"bg-gray-800/50 text-gray-400 border-gray-700 hover:border-gray-600"}`,children:N.label},N.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Notes"}),e.jsx("input",{type:"text",value:A,onChange:N=>q(N.target.value),placeholder:"Optional notes...",className:"w-full bg-gray-800/50 border border-gray-700 rounded-lg px-4 py-2 text-sm focus:border-blue-500 focus:outline-none"})]})]})}),$.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm text-gray-400",children:"Logged Sets"}),e.jsx("div",{className:"space-y-1",children:$.map((N,B)=>e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-2 flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-400",children:["Set ",B+1]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"font-medium",children:[Math.round((N.weightKg||0)*2.205)," lbs x ",N.reps]}),e.jsxs("span",{className:"text-purple-400",children:[N.tu," TU"]}),N.isPRWeight&&e.jsx(ds,{className:"w-4 h-4 text-yellow-400"})]})]},N.id))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-400 flex items-center gap-1.5",children:[e.jsx(_s,{className:"w-4 h-4"}),"Rest Timer"]}),f.isActive&&e.jsx("button",{onClick:f.stop,className:"text-xs text-red-400 hover:text-red-300",children:"Stop"})]}),e.jsx(xe,{children:f.isActive&&e.jsx(Q.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"overflow-hidden",children:e.jsxs("div",{className:`p-4 rounded-xl border ${f.time<=10?"bg-red-500/10 border-red-500/30":f.time<=30?"bg-yellow-500/10 border-yellow-500/30":"bg-gray-800/50 border-gray-700"}`,children:[e.jsx("div",{className:"h-1.5 bg-gray-700 rounded-full overflow-hidden mb-3",children:e.jsx(Q.div,{className:`h-full ${f.time<=10?"bg-red-500":f.time<=30?"bg-yellow-500":"bg-blue-500"}`,initial:{width:"0%"},animate:{width:`${f.progress}%`},transition:{duration:.3}})}),e.jsx("div",{className:"text-center mb-3",children:e.jsx("span",{className:`text-3xl font-mono font-bold ${f.time<=10?"text-red-400":f.time<=30?"text-yellow-400":"text-white"}`,children:f.formatted})}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:()=>f.adjust(-30),className:"px-3 py-1.5 rounded-lg bg-gray-700 hover:bg-gray-600 text-gray-300 text-sm font-medium",children:"-30s"}),e.jsx("button",{onClick:()=>f.adjust(30),className:"px-3 py-1.5 rounded-lg bg-blue-500/20 hover:bg-blue-500/30 text-blue-400 text-sm font-medium",children:"+30s"})]})]})})}),!f.isActive&&e.jsx("div",{className:"flex flex-wrap gap-2",children:f.presets.slice(0,4).map(N=>e.jsxs("button",{onClick:()=>f.start(N.seconds),className:"flex-1 min-w-[60px] py-2 px-3 rounded-lg bg-gray-800/50 hover:bg-gray-700/50 border border-gray-700 hover:border-gray-600 text-gray-300 text-sm font-medium flex items-center justify-center gap-1.5 transition-all",children:[e.jsx(Ke,{className:"w-3 h-3"}),N.label]},N.seconds))})]}),e.jsx(Q.button,{whileTap:{scale:.98},onClick:ae,disabled:!y||!b||h,className:`w-full py-4 rounded-xl font-bold text-lg transition-all flex items-center justify-center gap-2 ${y&&b&&!h?"bg-gradient-to-r from-green-600 to-green-500 hover:from-green-500 hover:to-green-400 text-white":"bg-gray-800 text-gray-500 cursor-not-allowed"}`,children:h?e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"w-5 h-5 animate-spin"}),"Logging Set..."]}):e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"w-5 h-5"}),"Log Set ",Y]})})]}):e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(We,{className:"w-5 h-5 text-yellow-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-yellow-200 font-medium",children:"No Active Session"}),e.jsx("p",{className:"text-xs text-yellow-400/80 mt-1",children:'Please start a new workout to log your sets. Use the "Generate Workout" button or go back and start fresh.'})]})]})})}function na({exerciseId:a,exerciseName:n,availableEquipment:o,onSelect:u,onCancel:w}){const[x,_]=t.useState([]),[S,f]=t.useState(!0),[y,I]=t.useState(null),[b,j]=t.useState(null),{findSubstitutes:M}=De();t.useEffect(()=>{(async()=>{f(!0),I(null);const k=await M(a,o,8);k&&k.length>0?_(k):I("No alternative exercises found for your equipment."),f(!1)})()},[a,o,M]);const R=t.useCallback(c=>{j(c.exercise.id),setTimeout(()=>{u(c.exercise)},200)},[u]),l=c=>c>=.8?"text-green-400":c>=.6?"text-yellow-400":"text-orange-400",m=c=>c>=.8?"Excellent match":c>=.6?"Good match":"Partial match";return e.jsx(Q.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-end sm:items-center justify-center",onClick:w,children:e.jsxs(Q.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},exit:{y:100,opacity:0},onClick:c=>c.stopPropagation(),className:"bg-gray-900 rounded-t-3xl sm:rounded-3xl w-full max-w-lg max-h-[85vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-gray-800 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold",children:"Swap Exercise"}),e.jsxs("p",{className:"text-sm text-gray-400",children:["Find alternatives for ",n]})]}),e.jsx("button",{onClick:w,className:"p-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-gray-400",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:S?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(Ne,{className:"w-8 h-8 text-blue-400 animate-spin mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Finding similar exercises..."})]}):y?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(We,{className:"w-8 h-8 text-orange-400 mb-4"}),e.jsx("p",{className:"text-gray-400 text-center",children:y}),e.jsx("button",{onClick:w,className:"mt-4 px-4 py-2 bg-gray-800 hover:bg-gray-700 rounded-lg text-sm",children:"Keep Current Exercise"})]}):e.jsx("div",{className:"space-y-3",children:x.map(c=>e.jsx(Q.button,{whileTap:{scale:.98},onClick:()=>R(c),className:`w-full text-left p-4 rounded-xl border transition-all ${b===c.exercise.id?"bg-green-500/20 border-green-500/50":"bg-gray-800/50 border-gray-700 hover:border-gray-600"}`,children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx($e,{className:"w-4 h-4 text-blue-400"}),e.jsx("span",{className:"font-medium",children:c.exercise.name})]}),c.exercise.equipment&&c.exercise.equipment.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:c.exercise.equipment.slice(0,3).map(k=>e.jsx("span",{className:"text-xs bg-gray-700/50 text-gray-300 px-2 py-0.5 rounded",children:k},k))}),c.matchedMuscles&&c.matchedMuscles.length>0&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-400 mb-1",children:[e.jsx(Fe,{className:"w-3 h-3"}),e.jsxs("span",{children:["Targets: ",c.matchedMuscles.join(", ")]})]}),c.missingMuscles&&c.missingMuscles.length>0&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-orange-400",children:[e.jsx(We,{className:"w-3 h-3"}),e.jsxs("span",{children:["Missing: ",c.missingMuscles.join(", ")]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsxs("div",{className:`text-sm font-medium ${l(c.similarityScore)}`,children:[Math.round(c.similarityScore*100),"%"]}),e.jsx("div",{className:"text-xs text-gray-500",children:m(c.similarityScore)}),b===c.exercise.id?e.jsx(Ps,{className:"w-5 h-5 text-green-400 mt-2"}):e.jsx(As,{className:"w-5 h-5 text-gray-600 mt-2"})]})]})},c.exercise.id))})}),!S&&!y&&e.jsx("div",{className:"p-4 border-t border-gray-800",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(es,{className:"w-3 h-3"}),e.jsx("span",{children:"Alternatives sorted by muscle similarity"})]})})]})})}function ia({sessions:a,onRecover:n,onDiscard:o,onDismiss:u}){const[w,x]=t.useState(null),[_,S]=t.useState(!1),[f,y]=t.useState(!1),{recoverSession:I}=De(),b=l=>{const m=new Date(l),k=new Date().getTime()-m.getTime(),A=Math.round(k/6e4),q=Math.round(k/36e5),p=Math.round(k/864e5);return A<60?`${A} min ago`:q<24?`${q} hours ago`:`${p} days ago`},j=l=>l>=1e3?`${(l/1e3).toFixed(1)}k lbs`:`${Math.round(l)} lbs`,M=async l=>{x(l),S(!0),(await I(l)).success?n(l):(S(!1),x(null))},R=async l=>{x(l),y(!0),o(l),y(!1),x(null)};return a.length===0?null:e.jsx(Q.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs(Q.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-gray-900 rounded-2xl w-full max-w-md overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-gray-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 rounded-xl bg-orange-500/20",children:e.jsx(We,{className:"w-6 h-6 text-orange-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold",children:"Unfinished Workout"}),e.jsx("p",{className:"text-sm text-gray-400",children:a.length===1?"You have an incomplete session":`You have ${a.length} incomplete sessions`})]})]})}),e.jsx("div",{className:"p-4 max-h-[400px] overflow-y-auto space-y-3",children:a.map(l=>e.jsxs("div",{className:"bg-gray-800/50 rounded-xl p-4 border border-gray-700",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400 mb-1",children:[e.jsx(Xe,{className:"w-4 h-4"}),e.jsx("span",{children:b(l.archivedAt||l.startedAt)})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx($e,{className:"w-4 h-4 text-blue-400"}),e.jsxs("span",{className:"font-medium",children:[l.musclesWorked?.length||0," muscles"]})]}),e.jsxs("span",{className:"text-gray-400",children:[l.setsLogged||0," sets"]}),e.jsx("span",{className:"text-purple-400",children:j(l.totalVolume||0)})]})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>M(l.id),disabled:_||f,className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-green-600 hover:bg-green-500 text-white font-medium transition-colors disabled:opacity-50",children:_&&w===l.id?e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"w-4 h-4 animate-spin"}),"Resuming..."]}):e.jsxs(e.Fragment,{children:[e.jsx(es,{className:"w-4 h-4"}),"Resume"]})}),e.jsx("button",{onClick:()=>R(l.id),disabled:_||f,className:"flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg bg-gray-700 hover:bg-gray-600 text-gray-300 font-medium transition-colors disabled:opacity-50",children:f&&w===l.id?e.jsx(Ne,{className:"w-4 h-4 animate-spin"}):e.jsx($s,{className:"w-4 h-4"})})]})]},l.id))}),e.jsx("div",{className:"p-4 border-t border-gray-800",children:e.jsxs("button",{onClick:u,disabled:_||f,className:"w-full py-3 rounded-xl bg-gray-800 hover:bg-gray-700 text-gray-300 font-medium transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[e.jsx("span",{children:"Start Fresh Instead"}),e.jsx(As,{className:"w-4 h-4"})]})})]})})}Is`
  query GetRPETrends($exerciseId: ID!, $days: Int) {
    rpeTrends(exerciseId: $exerciseId, days: $days) {
      exerciseId
      exerciseName
      trends {
        date
        avgRpe
        avgRir
        setCount
        avgWeight
        maxWeight
        avgReps
      }
      summary {
        avgRpe
        totalSets
        daysWithData
        trend
      }
    }
  }
`;Is`
  query GetFatigue {
    rpeFatigue {
      fatigueScore
      classification
      indicators
      recommendation
      suggestedIntensity
      recentRpeTrend
    }
  }
`;const bs=[{weight:25,color:"#DC2626",width:42,available:4},{weight:20,color:"#2563EB",width:40,available:4},{weight:15,color:"#FBBF24",width:36,available:4},{weight:10,color:"#22C55E",width:32,available:4},{weight:5,color:"#F8F8F8",width:28,available:4},{weight:2.5,color:"#EF4444",width:18,available:4},{weight:2,color:"#3B82F6",width:16,available:4},{weight:1.25,color:"#FCD34D",width:14,available:4},{weight:1,color:"#4ADE80",width:12,available:4},{weight:.5,color:"#A3A3A3",width:10,available:4},{weight:.25,color:"#737373",width:8,available:4}],fs=[{weight:45,color:"#2563EB",width:42,available:4},{weight:35,color:"#FBBF24",width:38,available:4},{weight:25,color:"#22C55E",width:34,available:4},{weight:10,color:"#F8F8F8",width:28,available:4},{weight:5,color:"#EF4444",width:20,available:4},{weight:2.5,color:"#A3A3A3",width:14,available:4}],oa={metric:[{label:"Olympic Bar",weight:20},{label:"Women's Bar",weight:15},{label:"EZ Curl Bar",weight:10},{label:"Trap Bar",weight:25},{label:"Custom",weight:0}],imperial:[{label:"Olympic Bar",weight:45},{label:"Women's Bar",weight:35},{label:"EZ Curl Bar",weight:25},{label:"Trap Bar",weight:55},{label:"Custom",weight:0}]};function ca({targetWeight:a,isMetric:n=!0,barWeight:o,onClose:u,compact:w=!1}){const[x,_]=t.useState(n?"metric":"imperial"),[S,f]=t.useState(o||(x==="metric"?20:45)),[y,I]=t.useState(""),[b,j]=t.useState(a?.toString()||""),[M,R]=t.useState(!1),[l,m]=t.useState(x==="metric"?bs:fs),c=t.useCallback((d,v,O)=>{const K=(d-v)/2;if(K<=0)return{plates:[],remaining:0,valid:d===v};const U=[];let D=K;const J={},H=[...O].sort((G,Z)=>Z.weight-G.weight);for(const G of H){const Z=Math.floor(G.available/2),h=Math.floor(D/G.weight),i=Math.min(Z,h);if(i>0){for(let $=0;$<i;$++)U.push({weight:G.weight,color:G.color,width:G.width});J[G.weight]=i,D-=i*G.weight}}return D=Math.round(D*100)/100,{plates:U,remaining:D,valid:D===0}},[]),k=t.useMemo(()=>{const d=parseFloat(b);if(isNaN(d)||d<=0)return null;const v=y?parseFloat(y):S;return d<v?{plates:[],remaining:0,valid:!1,error:"Target is less than bar weight"}:c(d,v,l)},[b,S,y,l,c]),A=d=>{_(d),m(d==="metric"?bs:fs),f(d==="metric"?20:45),j("")},q=x==="metric"?[60,80,100,120,140,160]:[135,185,225,275,315,405],p=x==="metric"?"kg":"lbs",L=y?parseFloat(y):S;return e.jsxs("div",{className:`bg-gray-900 rounded-2xl border border-gray-800 overflow-hidden ${w?"":"max-w-md"}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-800",children:[e.jsx("h3",{className:"font-semibold text-white",children:"Plate Calculator"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>R(!M),className:`p-2 rounded-lg ${M?"bg-blue-500/20 text-blue-400":"hover:bg-gray-800 text-gray-400"}`,children:e.jsx(Ts,{className:"w-4 h-4"})}),u&&e.jsx("button",{onClick:u,className:"p-2 hover:bg-gray-800 rounded-lg text-gray-400",children:e.jsx(be,{className:"w-4 h-4"})})]})]}),e.jsx(xe,{children:M&&e.jsx(Q.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden border-b border-gray-800",children:e.jsxs("div",{className:"p-4 space-y-4 bg-gray-900/50",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Unit System"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>A("metric"),className:`flex-1 py-2 rounded-lg text-sm font-medium ${x==="metric"?"bg-blue-600 text-white":"bg-gray-800 text-gray-400"}`,children:"Metric (kg)"}),e.jsx("button",{onClick:()=>A("imperial"),className:`flex-1 py-2 rounded-lg text-sm font-medium ${x==="imperial"?"bg-blue-600 text-white":"bg-gray-800 text-gray-400"}`,children:"Imperial (lbs)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Bar Weight"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:oa[x].map(d=>e.jsxs("button",{onClick:()=>{f(d.weight),I("")},className:`px-3 py-1.5 rounded-lg text-sm ${S===d.weight&&!y?"bg-blue-600 text-white":"bg-gray-800 text-gray-400 hover:text-white"}`,children:[d.label," ",d.weight>0&&`(${d.weight})`]},d.label))}),S===0&&e.jsx("input",{type:"number",value:y,onChange:d=>I(d.target.value),placeholder:`Custom bar weight (${p})`,className:"mt-2 w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-sm"})]})]})})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 mb-1",children:["Target Weight (",p,")"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",value:b,onChange:d=>j(d.target.value),placeholder:"Enter target weight",className:"flex-1 px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-lg font-medium"}),e.jsx("button",{onClick:()=>j(""),className:"p-2 bg-gray-800 hover:bg-gray-700 rounded-lg text-gray-400",children:e.jsx(Je,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:q.map(d=>e.jsx("button",{onClick:()=>j(d.toString()),className:`px-3 py-1.5 rounded-lg text-sm font-medium ${b===d.toString()?"bg-blue-500/20 text-blue-400 border border-blue-500/50":"bg-gray-800 text-gray-400 hover:text-white"}`,children:d},d))}),k&&e.jsx("div",{className:"mt-4",children:!k.valid&&k.error?e.jsx("div",{className:"p-3 bg-red-500/10 border border-red-500/30 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-400",children:k.error})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative flex items-center justify-center py-6 bg-gray-800/50 rounded-xl overflow-hidden",children:[e.jsx("div",{className:"flex items-center",children:[...k.plates].reverse().map((d,v)=>e.jsx(Q.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:v*.05},className:"relative flex items-center justify-center rounded",style:{backgroundColor:d.color,width:d.width,height:60+d.width,marginRight:-2,zIndex:k.plates.length-v},children:e.jsx("span",{className:"absolute text-xs font-bold",style:{color:d.color==="#F8F8F8"||d.color==="#FCD34D"||d.color==="#FBBF24"?"#333":"#fff",writingMode:"vertical-rl",transform:"rotate(180deg)"},children:d.weight})},`left-${v}`))}),e.jsxs("div",{className:"w-24 h-4 bg-gray-500 rounded-full relative z-50",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 w-4 bg-gray-600 rounded-l-full"}),e.jsx("div",{className:"absolute inset-y-0 right-0 w-4 bg-gray-600 rounded-r-full"})]}),e.jsx("div",{className:"flex items-center",children:k.plates.map((d,v)=>e.jsx(Q.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:v*.05},className:"relative flex items-center justify-center rounded",style:{backgroundColor:d.color,width:d.width,height:60+d.width,marginLeft:-2,zIndex:k.plates.length-v},children:e.jsx("span",{className:"absolute text-xs font-bold",style:{color:d.color==="#F8F8F8"||d.color==="#FCD34D"||d.color==="#FBBF24"?"#333":"#fff",writingMode:"vertical-rl"},children:d.weight})},`right-${v}`))})]}),e.jsxs("div",{className:"mt-4 p-3 bg-gray-800/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Per side:"}),e.jsxs("span",{className:"text-sm font-medium",children:[((parseFloat(b)-L)/2).toFixed(1)," ",p]})]}),k.plates.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(k.plates.reduce((d,v)=>(d[v.weight]=(d[v.weight]||0)+1,d),{})).sort(([d],[v])=>parseFloat(v)-parseFloat(d)).map(([d,v])=>e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-gray-900 rounded-lg",children:[e.jsx("div",{className:"w-3 h-3 rounded",style:{backgroundColor:k.plates.find(O=>O.weight===parseFloat(d))?.color}}),e.jsxs("span",{className:"text-sm font-medium",children:[v,"Ã—",d]})]},d))}):e.jsx("p",{className:"text-sm text-gray-500",children:"Just the bar"}),!k.valid&&k.remaining>0&&e.jsxs("div",{className:"flex items-start gap-2 mt-3 p-2 bg-yellow-500/10 border border-yellow-500/30 rounded-lg",children:[e.jsx(ss,{className:"w-4 h-4 text-yellow-400 flex-shrink-0 mt-0.5"}),e.jsxs("p",{className:"text-xs text-yellow-400",children:["Cannot make exact weight. Missing ",k.remaining.toFixed(2)," ",p," per side. Showing closest possible (",(parseFloat(b)-k.remaining*2).toFixed(1)," ",p," total)."]})]})]}),e.jsx("div",{className:"mt-3 text-center",children:e.jsxs("p",{className:"text-xs text-gray-500",children:["Bar: ",L,p," + Plates: ",(parseFloat(b)-L).toFixed(1),p,"= ",e.jsxs("span",{className:"font-bold text-white",children:[b,p]})]})})]})}),!b&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:e.jsx("p",{className:"text-sm",children:"Enter a target weight to see which plates to load"})})]})]})}const ys={compound:{label:"Compound (5 sets)",sets:[{percent:0,reps:10,label:"Bar"},{percent:40,reps:8,label:"40%"},{percent:60,reps:5,label:"60%"},{percent:75,reps:3,label:"75%"},{percent:90,reps:1,label:"90%"}]},moderate:{label:"Moderate (3 sets)",sets:[{percent:50,reps:8,label:"50%"},{percent:70,reps:5,label:"70%"},{percent:85,reps:3,label:"85%"}]},quick:{label:"Quick (2 sets)",sets:[{percent:50,reps:8,label:"50%"},{percent:75,reps:5,label:"75%"}]},accessory:{label:"Accessory (1 set)",sets:[{percent:50,reps:10,label:"50%"}]}};function da({workingWeight:a,barWeight:n=45,isMetric:o=!1,onCopySet:u,onClose:w,compact:x=!1}){const[_,S]=t.useState(a?.toString()||""),[f,y]=t.useState(n.toString()),[I,b]=t.useState("compound"),[j,M]=t.useState(!1),[R,l]=t.useState(null),m=o?"kg":"lbs",c=parseFloat(f)||n,k=t.useMemo(()=>{const p=parseFloat(_);return!p||p<=c?[]:ys[I].sets.map(d=>{let v;return d.percent===0?v=c:(v=Math.round(p*(d.percent/100)/5)*5,v=Math.max(v,c)),{...d,weight:v,plates:A(v,c,o)}})},[_,I,c,o]);function A(p,L,d){const v=(p-L)/2;if(v<=0)return"Just bar";const O=d?[25,20,15,10,5,2.5,1.25]:[45,35,25,10,5,2.5],K=[];let U=v;for(const D of O){const J=Math.floor(U/D);J>0&&(K.push(`${J}Ã—${D}`),U-=J*D)}return K.length>0?K.join(" + "):"Just bar"}const q=(p,L,d)=>{u?.(p,L),l(d),setTimeout(()=>l(null),1500)};return e.jsxs("div",{className:`bg-gray-900 rounded-2xl border border-gray-800 overflow-hidden ${x?"":"max-w-md"}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Es,{className:"w-5 h-5 text-orange-400"}),e.jsx("h3",{className:"font-semibold text-white",children:"Warmup Calculator"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>M(!j),className:`p-2 rounded-lg ${j?"bg-blue-500/20 text-blue-400":"hover:bg-gray-800 text-gray-400"}`,children:e.jsx(Ts,{className:"w-4 h-4"})}),w&&e.jsx("button",{onClick:w,className:"p-2 hover:bg-gray-800 rounded-lg text-gray-400",children:e.jsx(be,{className:"w-4 h-4"})})]})]}),e.jsx(xe,{children:j&&e.jsx(Q.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden border-b border-gray-800",children:e.jsxs("div",{className:"p-4 space-y-4 bg-gray-900/50",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 mb-1",children:["Bar Weight (",m,")"]}),e.jsx("div",{className:"flex gap-2",children:(o?[20,15,10]:[45,35,25]).map(p=>e.jsx("button",{onClick:()=>y(p.toString()),className:`flex-1 py-2 rounded-lg text-sm font-medium ${parseFloat(f)===p?"bg-blue-600 text-white":"bg-gray-800 text-gray-400 hover:text-white"}`,children:p},p))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Warmup Preset"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(ys).map(([p,L])=>e.jsx("button",{onClick:()=>b(p),className:`px-3 py-1.5 rounded-lg text-sm ${I===p?"bg-blue-600 text-white":"bg-gray-800 text-gray-400 hover:text-white"}`,children:L.label},p))})]})]})})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 mb-1",children:["Working Weight (",m,")"]}),e.jsx("input",{type:"number",value:_,onChange:p=>S(p.target.value),placeholder:"Enter your working weight",className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-lg font-medium"})]}),k.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Suggested Warmup Sets"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[k.length," sets"]})]}),e.jsx("div",{className:"space-y-2",children:k.map((p,L)=>e.jsxs(Q.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:L*.05},className:"flex items-center gap-3 p-3 bg-gray-800/50 rounded-lg",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-orange-500/20 flex items-center justify-center text-orange-400 font-bold text-sm",children:L+1}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsxs("span",{className:"font-bold text-white",children:[p.weight," ",m]}),e.jsx("span",{className:"text-gray-400",children:"Ã—"}),e.jsxs("span",{className:"font-medium text-gray-300",children:[p.reps," reps"]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",p.label,")"]})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:p.plates})]}),u&&e.jsx("button",{onClick:()=>q(p.weight,p.reps,L),className:`p-2 rounded-lg transition-colors ${R===L?"bg-green-500/20 text-green-400":"hover:bg-gray-700 text-gray-400"}`,children:R===L?e.jsx(Ps,{className:"w-4 h-4"}):e.jsx(St,{className:"w-4 h-4"})})]},L))})]}):_?e.jsxs("div",{className:"text-center py-6 text-gray-500 text-sm",children:["Working weight must be greater than bar weight (",c," ",m,")"]}):e.jsx("div",{className:"text-center py-6 text-gray-500 text-sm",children:"Enter your working weight to calculate warmup sets"}),e.jsxs("div",{className:"p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg text-xs text-blue-300",children:[e.jsx("strong",{children:"Tip:"})," Warmup sets prepare your muscles and joints, and help you practice form. Rest 30-60 seconds between warmup sets."]})]})]})}function ze(a){const n=Math.floor(a/1e3),o=Math.floor(n/3600),u=Math.floor(n%3600/60),w=n%60,x=Math.floor(a%1e3/10);return o>0?`${o}:${u.toString().padStart(2,"0")}:${w.toString().padStart(2,"0")}`:`${u.toString().padStart(2,"0")}:${w.toString().padStart(2,"0")}.${x.toString().padStart(2,"0")}`}function vs(a){const n=Math.floor(a/1e3),o=Math.floor(n/60),u=n%60,w=Math.floor(a%1e3/10);return`${o}:${u.toString().padStart(2,"0")}.${w.toString().padStart(2,"0")}`}const xa=[{label:"30s",value:30},{label:"45s",value:45},{label:"1m",value:60},{label:"90s",value:90},{label:"2m",value:120},{label:"3m",value:180},{label:"5m",value:300}];function ua({onTimeRecorded:a,onClose:n,compact:o=!1,initialMode:u="stopwatch",initialCountdown:w=60}){const[x,_]=t.useState(u),[S,f]=t.useState(!1),[y,I]=t.useState(0),[b,j]=t.useState(w),[M,R]=t.useState(""),[l,m]=t.useState([]),[c,k]=t.useState(!0),[A,q]=t.useState(!1),p=t.useRef(null),L=t.useRef(0),d=t.useRef(0),v=t.useRef(null),O=t.useCallback((h=800,i=100)=>{if(c)try{v.current||(v.current=new(window.AudioContext||window.webkitAudioContext));const $=v.current,Y=$.createOscillator(),se=$.createGain();Y.connect(se),se.connect($.destination),Y.frequency.value=h,Y.type="sine",se.gain.setValueAtTime(.3,$.currentTime),se.gain.exponentialRampToValueAtTime(.01,$.currentTime+i/1e3),Y.start($.currentTime),Y.stop($.currentTime+i/1e3)}catch{}},[c]),K=t.useCallback(()=>{S?(p.current&&(clearInterval(p.current),p.current=null),f(!1)):(L.current=Date.now()-y,p.current=setInterval(()=>{const h=Date.now()-L.current;if(I(h),x==="countdown"){const i=b*1e3-h;i<=0?(clearInterval(p.current),p.current=null,f(!1),I(b*1e3),O(1e3,500),ge("heavy"),a?.(b*1e3)):i<=3e3&&i>2900?(O(600,100),ge("light")):i<=2e3&&i>1900?(O(600,100),ge("light")):i<=1e3&&i>900&&(O(600,100),ge("light"))}},10),f(!0),ge("light"))},[S,y,x,b,O,a]),U=t.useCallback(()=>{p.current&&(clearInterval(p.current),p.current=null),f(!1),I(0),m([]),d.current=0,ge("light")},[]),D=t.useCallback(()=>{const h=y-d.current,i=l.length>0?h-l[l.length-1].time:0;m($=>[...$,{number:$.length+1,time:h,delta:i}]),d.current=y,ge("medium"),O(600,50)},[y,l,O]),J=t.useCallback(()=>{p.current&&(clearInterval(p.current),p.current=null),f(!1),a?.(y),ge("medium")},[y,a]);t.useEffect(()=>()=>{p.current&&clearInterval(p.current)},[]);const H=x==="countdown"?Math.max(0,b*1e3-y):y,G=x==="countdown"&&y>=b*1e3,Z=x==="countdown"?y/(b*1e3)*100:0;return o?e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-800/50 rounded-lg",children:[e.jsx("button",{onClick:K,className:`p-2 rounded-lg ${S?"bg-red-500/20 text-red-400":"bg-green-500/20 text-green-400"}`,children:S?e.jsx(xs,{className:"w-5 h-5"}):e.jsx(Ke,{className:"w-5 h-5"})}),e.jsx("span",{className:"font-mono text-xl font-bold flex-1",children:ze(H)}),e.jsx("button",{onClick:U,className:"p-2 rounded-lg hover:bg-gray-700 text-gray-400",children:e.jsx(Je,{className:"w-5 h-5"})})]}):e.jsxs("div",{className:"bg-gray-900 rounded-2xl border border-gray-800 overflow-hidden max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[x==="stopwatch"?e.jsx(Xe,{className:"w-5 h-5 text-blue-400"}):e.jsx(_s,{className:"w-5 h-5 text-orange-400"}),e.jsx("h3",{className:"font-semibold text-white",children:x==="stopwatch"?"Stopwatch":"Countdown Timer"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>k(!c),className:`p-2 rounded-lg ${c?"text-blue-400":"text-gray-600"}`,children:c?e.jsx(kt,{className:"w-4 h-4"}):e.jsx(Ct,{className:"w-4 h-4"})}),n&&e.jsx("button",{onClick:n,className:"p-2 hover:bg-gray-800 rounded-lg text-gray-400",children:e.jsx(be,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex gap-2 p-4 border-b border-gray-800",children:[e.jsx("button",{onClick:()=>{_("stopwatch"),U()},className:`flex-1 py-2 rounded-lg text-sm font-medium ${x==="stopwatch"?"bg-blue-600 text-white":"bg-gray-800 text-gray-400"}`,children:"Stopwatch"}),e.jsx("button",{onClick:()=>{_("countdown"),U()},className:`flex-1 py-2 rounded-lg text-sm font-medium ${x==="countdown"?"bg-orange-600 text-white":"bg-gray-800 text-gray-400"}`,children:"Countdown"})]}),e.jsxs("div",{className:"p-6",children:[x==="countdown"&&e.jsxs("div",{className:"relative w-48 h-48 mx-auto mb-6",children:[e.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[e.jsx("circle",{cx:"96",cy:"96",r:"88",fill:"none",stroke:"#374151",strokeWidth:"8"}),e.jsx("circle",{cx:"96",cy:"96",r:"88",fill:"none",stroke:G||Z>90?"#EF4444":Z>75?"#F59E0B":"#3B82F6",strokeWidth:"8",strokeLinecap:"round",strokeDasharray:`${2*Math.PI*88}`,strokeDashoffset:`${2*Math.PI*88*(1-Z/100)}`,className:"transition-all duration-100"})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("span",{className:`font-mono text-4xl font-bold ${G||H<=1e4?"text-red-400":H<=3e4?"text-yellow-400":"text-white"}`,children:ze(H)}),G&&e.jsx("span",{className:"text-red-400 text-sm mt-1",children:"Time's Up!"})]})]}),x==="stopwatch"&&e.jsx("div",{className:"text-center mb-6",children:e.jsx("span",{className:"font-mono text-5xl font-bold text-white",children:ze(H)})}),x==="countdown"&&!S&&e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"flex flex-wrap justify-center gap-2 mb-3",children:xa.map(h=>e.jsx("button",{onClick:()=>{j(h.value),U()},className:`px-3 py-1.5 rounded-lg text-sm font-medium ${b===h.value?"bg-orange-600 text-white":"bg-gray-800 text-gray-400 hover:text-white"}`,children:h.label},h.value))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",value:M,onChange:h=>R(h.target.value),placeholder:"Custom (seconds)",className:"flex-1 px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-sm"}),e.jsx("button",{onClick:()=>{const h=parseInt(M);h>0&&(j(h),U())},className:"px-4 py-2 bg-gray-800 hover:bg-gray-700 rounded-lg text-sm",disabled:!M||parseInt(M)<=0,children:"Set"})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx("button",{onClick:U,className:"p-3 bg-gray-800 hover:bg-gray-700 rounded-full text-gray-400",children:e.jsx(Je,{className:"w-6 h-6"})}),e.jsx("button",{onClick:K,disabled:G,className:`p-4 rounded-full text-white ${S?"bg-red-600 hover:bg-red-700":G?"bg-gray-700 cursor-not-allowed":"bg-green-600 hover:bg-green-700"}`,children:S?e.jsx(xs,{className:"w-8 h-8"}):e.jsx(Ke,{className:"w-8 h-8 ml-1"})}),x==="stopwatch"&&S&&e.jsx("button",{onClick:D,className:"p-3 bg-blue-600 hover:bg-blue-700 rounded-full text-white",children:e.jsx(us,{className:"w-6 h-6"})}),!S&&y>0&&a&&e.jsx("button",{onClick:J,className:"p-3 bg-green-600 hover:bg-green-700 rounded-full text-white",children:e.jsx(us,{className:"w-6 h-6"})})]}),x==="stopwatch"&&l.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("button",{onClick:()=>q(!A),className:"flex items-center justify-between w-full p-3 bg-gray-800/50 rounded-lg text-sm",children:[e.jsxs("span",{className:"text-gray-400",children:["Laps (",l.length,")"]}),e.jsx(Oe,{className:`w-4 h-4 text-gray-500 transition-transform ${A?"rotate-180":""}`})]}),e.jsx(xe,{children:A&&e.jsx(Q.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsx("div",{className:"mt-2 space-y-1 max-h-40 overflow-y-auto",children:[...l].reverse().map(h=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-800/30 rounded text-sm",children:[e.jsxs("span",{className:"text-gray-500",children:["Lap ",h.number]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-mono",children:vs(h.time)}),h.delta!==0&&e.jsxs("span",{className:h.delta>0?"text-red-400":"text-green-400",children:[h.delta>0?"+":"",vs(Math.abs(h.delta))]})]})]},h.number))})})})]})]})]})}const js=[{value:"1M",label:"1 Month",days:30},{value:"3M",label:"3 Months",days:90},{value:"6M",label:"6 Months",days:180},{value:"1Y",label:"1 Year",days:365},{value:"ALL",label:"All Time",days:1/0}],Ae=[{value:"weight",label:"Max Weight",unit:"kg",description:"Heaviest weight lifted per session"},{value:"volume",label:"Total Volume",unit:"kg",description:"Weight Ã— Reps summed across all sets"},{value:"e1rm",label:"Est. 1RM",unit:"kg",description:"Estimated one-rep max (Epley formula)"},{value:"reps",label:"Total Reps",unit:"",description:"Total repetitions per session"}];function ma(a,n){return n===1?a:(n>12,a*(1+n/30))}function _e(a,n=!1){const o=new Date(a);return n?o.toLocaleDateString("en-US",{month:"short",day:"numeric"}):o.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function ws(a,n){if(n===0)return{value:0,direction:"same"};const o=(a-n)/n*100;return Math.abs(o)<.5?{value:0,direction:"same"}:{value:Math.abs(o),direction:o>0?"up":"down"}}function Ns({data:a,metric:n,height:o=200}){const u=Ae.find(j=>j.value===n);if(a.length===0)return e.jsx("div",{className:"flex items-center justify-center h-48 text-white/40",children:"No data available for this period"});const w=a.map(j=>j.value),x=Math.min(...w)*.9,_=Math.max(...w)*1.1,S=_-x||1,f=a.map((j,M)=>({x:M/(a.length-1||1)*100,y:100-(j.value-x)/S*100})),y=f.length>1?`M ${f.map(j=>`${j.x},${j.y}`).join(" L ")}`:"",I=f.length>1?`M ${f[0].x},100 L ${f.map(j=>`${j.x},${j.y}`).join(" L ")} L ${f[f.length-1].x},100 Z`:"",b=[x,(x+_)/2,_].map(j=>j>=1e3?`${(j/1e3).toFixed(1)}k`:j.toFixed(0));return e.jsxs("div",{className:"relative",style:{height:o},children:[e.jsxs("div",{className:"absolute left-0 top-0 bottom-8 w-12 flex flex-col justify-between text-xs text-white/40 pr-2",children:[e.jsxs("span",{className:"text-right",children:[b[2],u?.unit]}),e.jsxs("span",{className:"text-right",children:[b[1],u?.unit]}),e.jsxs("span",{className:"text-right",children:[b[0],u?.unit]})]}),e.jsxs("div",{className:"ml-12 h-full pr-2",children:[e.jsxs("svg",{viewBox:"0 0 100 100",preserveAspectRatio:"none",className:"w-full h-[calc(100%-2rem)]",children:[e.jsx("line",{x1:"0",y1:"0",x2:"100",y2:"0",stroke:"white",strokeOpacity:"0.1",strokeWidth:"0.5",vectorEffect:"non-scaling-stroke"}),e.jsx("line",{x1:"0",y1:"50",x2:"100",y2:"50",stroke:"white",strokeOpacity:"0.1",strokeWidth:"0.5",vectorEffect:"non-scaling-stroke"}),e.jsx("line",{x1:"0",y1:"100",x2:"100",y2:"100",stroke:"white",strokeOpacity:"0.1",strokeWidth:"0.5",vectorEffect:"non-scaling-stroke"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:`gradient-${n}`,x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"#8B5CF6",stopOpacity:"0.3"}),e.jsx("stop",{offset:"100%",stopColor:"#8B5CF6",stopOpacity:"0"})]})}),I&&e.jsx("path",{d:I,fill:`url(#gradient-${n})`}),y&&e.jsx("path",{d:y,fill:"none",stroke:"#8B5CF6",strokeWidth:"2",vectorEffect:"non-scaling-stroke",strokeLinecap:"round",strokeLinejoin:"round"}),f.map((j,M)=>e.jsx("circle",{cx:j.x,cy:j.y,r:"3",fill:"#8B5CF6",stroke:"white",strokeWidth:"1",vectorEffect:"non-scaling-stroke",className:"cursor-pointer hover:r-4 transition-all",children:e.jsx("title",{children:`${_e(a[M].date)}: ${a[M].value.toFixed(1)}${u?.unit}`})},M))]}),e.jsx("div",{className:"flex justify-between text-xs text-white/40 mt-1",children:a.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:_e(a[0].date,!0)}),a.length>2&&e.jsx("span",{children:_e(a[Math.floor(a.length/2)].date,!0)}),e.jsx("span",{children:_e(a[a.length-1].date,!0)})]})})]})]})}function Pe({label:a,value:n,unit:o,change:u,icon:w}){return e.jsxs("div",{className:"bg-white/5 rounded-xl p-4 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[w&&e.jsx(w,{className:"w-4 h-4 text-violet-400"}),e.jsx("span",{className:"text-xs text-white/60",children:a})]}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-2xl font-bold text-white",children:n}),o&&e.jsx("span",{className:"text-sm text-white/40",children:o})]}),u&&u.direction!=="same"&&e.jsxs("div",{className:`flex items-center gap-1 mt-1 text-xs ${u.direction==="up"?"text-green-400":"text-red-400"}`,children:[u.direction==="up"?e.jsx(Ze,{className:"w-3 h-3"}):e.jsx(Fs,{className:"w-3 h-3"}),e.jsxs("span",{children:[u.value.toFixed(1),"%"]})]})]})}function ha({exerciseId:a,exerciseName:n,history:o,onClose:u,compact:w=!1}){const[x,_]=t.useState("3M"),[S,f]=t.useState("weight"),[y,I]=t.useState(!1),b=t.useMemo(()=>{const l=js.find(c=>c.value===x);if(!l||l.days===1/0)return o;const m=new Date;return m.setDate(m.getDate()-l.days),o.filter(c=>new Date(c.date)>=m)},[o,x]),j=t.useMemo(()=>b.map(l=>{const m=l.sets;let c;switch(S){case"weight":c=Math.max(...m.map(k=>k.weight));break;case"volume":c=m.reduce((k,A)=>k+A.weight*A.reps,0);break;case"e1rm":c=Math.max(...m.map(k=>ma(k.weight,k.reps)));break;case"reps":c=m.reduce((k,A)=>k+A.reps,0);break;default:c=0}return{date:l.date,value:c,entry:l}}).sort((l,m)=>new Date(l.date).getTime()-new Date(m.date).getTime()),[b,S]),M=t.useMemo(()=>{if(j.length===0)return null;const l=j.map(p=>p.value),m=l[l.length-1],c=l.length>1?l[l.length-2]:m,k=l[0],A=Math.max(...l),q=l.reduce((p,L)=>p+L,0)/l.length;return{current:m,max:A,avg:q,totalWorkouts:j.length,periodChange:ws(m,k),lastChange:ws(m,c)}},[j]),R=Ae.find(l=>l.value===S);return w?e.jsxs("div",{className:"bg-black/40 backdrop-blur-xl rounded-2xl border border-white/10 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:n}),u&&e.jsx("button",{onClick:u,className:"p-1 rounded-lg hover:bg-white/10 transition-colors",children:e.jsx(be,{className:"w-5 h-5 text-white/60"})})]}),e.jsx("div",{className:"flex gap-2 mb-4 overflow-x-auto pb-1",children:Ae.map(l=>e.jsx("button",{onClick:()=>f(l.value),className:`px-3 py-1.5 rounded-lg text-xs font-medium whitespace-nowrap transition-colors ${S===l.value?"bg-violet-500 text-white":"bg-white/5 text-white/60 hover:bg-white/10"}`,children:l.label},l.value))}),e.jsx(Ns,{data:j,metric:S,height:160}),M&&e.jsxs("div",{className:"mt-4 flex items-center justify-between text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-white/60",children:"Current:"})," ",e.jsxs("span",{className:"text-white font-semibold",children:[M.current.toFixed(1),R?.unit]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white/60",children:"Peak:"})," ",e.jsxs("span",{className:"text-white font-semibold",children:[M.max.toFixed(1),R?.unit]})]})]})]}):e.jsxs("div",{className:"bg-black/40 backdrop-blur-xl rounded-2xl border border-white/10 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-violet-500/20 flex items-center justify-center",children:e.jsx(Te,{className:"w-5 h-5 text-violet-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:n}),e.jsx("p",{className:"text-sm text-white/60",children:"Progress over time"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>I(!y),className:"p-2 rounded-lg hover:bg-white/10 transition-colors",children:e.jsx(ss,{className:"w-5 h-5 text-white/60"})}),u&&e.jsx("button",{onClick:u,className:"p-2 rounded-lg hover:bg-white/10 transition-colors",children:e.jsx(be,{className:"w-5 h-5 text-white/60"})})]})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-1",children:js.map(l=>e.jsx("button",{onClick:()=>_(l.value),className:`px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition-colors ${x===l.value?"bg-violet-500 text-white":"bg-white/5 text-white/60 hover:bg-white/10"}`,children:l.label},l.value))})]}),e.jsx(xe,{children:y&&e.jsx(Q.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"border-b border-white/10 overflow-hidden",children:e.jsx("div",{className:"p-4 bg-violet-500/10",children:e.jsxs("p",{className:"text-sm text-white/80",children:[e.jsx("strong",{children:"Estimated 1RM"})," uses the Epley formula: Weight Ã— (1 + Reps/30). Most accurate for 1-10 reps."]})})})}),e.jsxs("div",{className:"p-4 border-b border-white/10",children:[e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-1",children:Ae.map(l=>e.jsxs("button",{onClick:()=>f(l.value),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition-colors ${S===l.value?"bg-white/10 text-white border border-violet-500/50":"bg-white/5 text-white/60 hover:bg-white/10 border border-transparent"}`,children:[l.value==="weight"&&e.jsx(ns,{className:"w-4 h-4"}),l.value==="volume"&&e.jsx(Te,{className:"w-4 h-4"}),l.value==="e1rm"&&e.jsx(Fe,{className:"w-4 h-4"}),l.value==="reps"&&e.jsx($t,{className:"w-4 h-4"}),l.label]},l.value))}),e.jsx("p",{className:"text-xs text-white/40 mt-2",children:R?.description})]}),e.jsx("div",{className:"p-6",children:e.jsx(Ns,{data:j,metric:S,height:240})}),M&&e.jsxs("div",{className:"p-6 border-t border-white/10",children:[e.jsx("h3",{className:"text-sm font-medium text-white/60 mb-4",children:"Summary"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Pe,{label:"Current",value:M.current.toFixed(1),unit:R?.unit,change:M.lastChange,icon:ns}),e.jsx(Pe,{label:"Peak",value:M.max.toFixed(1),unit:R?.unit,icon:Fe}),e.jsx(Pe,{label:"Average",value:M.avg.toFixed(1),unit:R?.unit,icon:Te}),e.jsx(Pe,{label:"Workouts",value:M.totalWorkouts,icon:gt})]}),M.periodChange.direction!=="same"&&e.jsx("div",{className:`mt-4 p-4 rounded-xl ${M.periodChange.direction==="up"?"bg-green-500/10":"bg-red-500/10"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[M.periodChange.direction==="up"?e.jsx(Ze,{className:"w-5 h-5 text-green-400"}):e.jsx(Fs,{className:"w-5 h-5 text-red-400"}),e.jsxs("span",{className:`text-sm font-medium ${M.periodChange.direction==="up"?"text-green-400":"text-red-400"}`,children:[M.periodChange.direction==="up"?"+":"-",M.periodChange.value.toFixed(1),"% over this period"]})]})})]}),j.length===0&&e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(Te,{className:"w-12 h-12 text-white/20 mx-auto mb-4"}),e.jsx("p",{className:"text-white/60",children:"No workout data for this period"}),e.jsx("p",{className:"text-sm text-white/40 mt-1",children:"Complete some workouts to see your progress"})]})]})}const ga=[{value:"great",label:"Great",icon:ms,color:"text-green-400"},{value:"good",label:"Good",icon:ms,color:"text-blue-400"},{value:"okay",label:"Okay",icon:Ot,color:"text-yellow-400"},{value:"bad",label:"Bad",icon:Wt,color:"text-red-400"}],pa=[{value:"high",label:"High Energy",icon:Ms,color:"text-yellow-400"},{value:"medium",label:"Normal",icon:Pt,color:"text-blue-400"},{value:"low",label:"Low Energy",icon:It,color:"text-red-400"}],ba=[{value:"good",label:"Good Sleep",icon:qe,color:"text-violet-400"},{value:"average",label:"Average",icon:qe,color:"text-blue-400"},{value:"poor",label:"Poor Sleep",icon:qe,color:"text-orange-400"}],fa=["PR Day","Deload","Testing","Recovery","First Day Back","Travel","Morning","Evening","Fasted","Post-Meal","Pre-Workout","No Caffeine","New Exercise","Form Focus","High Volume","Low Volume"];function ya({workoutId:a,initialNotes:n,onSave:o,onDelete:u,compact:w=!1,autoSave:x=!0,className:_=""}){const[S,f]=t.useState(!w),[y,I]=t.useState(!n),[b,j]=t.useState(n?.content||""),[M,R]=t.useState(n?.mood),[l,m]=t.useState(n?.energy),[c,k]=t.useState(n?.sleepQuality),[A,q]=t.useState(n?.tags||[]),[p,L]=t.useState(!1),[d,v]=t.useState(""),[O,K]=t.useState(!1),U=t.useRef(null),D=t.useRef();t.useEffect(()=>{const i=b!==(n?.content||"")||M!==n?.mood||l!==n?.energy||c!==n?.sleepQuality||JSON.stringify(A)!==JSON.stringify(n?.tags||[]);K(i)},[b,M,l,c,A,n]);const J=t.useCallback(()=>{U.current&&(U.current.style.height="auto",U.current.style.height=`${U.current.scrollHeight}px`)},[]);t.useEffect(()=>{J()},[b,J]);const H=t.useCallback(()=>{const i={id:n?.id||`note-${Date.now()}`,content:b,mood:M,energy:l,sleepQuality:c,tags:A,createdAt:n?.createdAt||new Date().toISOString(),updatedAt:new Date().toISOString()};o?.(i),K(!1),w||I(!1)},[b,M,l,c,A,n,o,w]);t.useEffect(()=>(x&&O&&(D.current&&clearTimeout(D.current),D.current=setTimeout(()=>{H()},2e3)),()=>{D.current&&clearTimeout(D.current)}),[x,O,H]);const G=t.useCallback(()=>{window.confirm("Delete this note?")&&(u?.(),j(""),R(void 0),m(void 0),k(void 0),q([]),I(!0))},[u]),Z=t.useCallback(i=>{q($=>$.includes(i)?$.filter(Y=>Y!==i):[...$,i])},[]),h=t.useCallback(()=>{d.trim()&&!A.includes(d.trim())&&(q(i=>[...i,d.trim()]),v(""))},[d,A]);return w&&!S?e.jsxs("button",{onClick:()=>f(!0),className:`flex items-center gap-2 px-3 py-2 rounded-lg bg-white/5 hover:bg-white/10 transition-colors ${_}`,children:[e.jsx(hs,{className:"w-4 h-4 text-yellow-400"}),e.jsx("span",{className:"text-sm text-white/60",children:n?.content?"View Notes":"Add Notes"}),n&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-yellow-400"}),e.jsx(Oe,{className:"w-4 h-4 text-white/40"})]}):e.jsxs(Q.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`bg-black/40 backdrop-blur-xl rounded-2xl border border-white/10 overflow-hidden ${_}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-yellow-500/20 flex items-center justify-center",children:e.jsx(hs,{className:"w-5 h-5 text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Workout Notes"}),n?.updatedAt&&e.jsxs("p",{className:"text-xs text-white/40 flex items-center gap-1",children:[e.jsx(Xe,{className:"w-3 h-3"}),"Last updated ",new Date(n.updatedAt).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[O&&x&&e.jsx("span",{className:"text-xs text-yellow-400",children:"Saving..."}),!y&&n&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>I(!0),className:"p-2 rounded-lg hover:bg-white/10 transition-colors",children:e.jsx(Mt,{className:"w-4 h-4 text-white/60"})}),e.jsx("button",{onClick:G,className:"p-2 rounded-lg hover:bg-red-500/20 transition-colors",children:e.jsx($s,{className:"w-4 h-4 text-red-400"})})]}),w&&e.jsx("button",{onClick:()=>f(!1),className:"p-2 rounded-lg hover:bg-white/10 transition-colors",children:e.jsx(Et,{className:"w-4 h-4 text-white/60"})})]})]}),e.jsxs("div",{className:"p-4 border-b border-white/10 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-white/60 mb-2 block",children:"How did you feel?"}),e.jsx("div",{className:"flex gap-2",children:ga.map(i=>{const $=i.icon;return e.jsxs("button",{onClick:()=>R(M===i.value?void 0:i.value),className:`flex items-center gap-2 px-3 py-2 rounded-lg text-sm transition-colors ${M===i.value?"bg-white/10 border border-white/20":"bg-white/5 border border-transparent hover:bg-white/10"}`,children:[e.jsx($,{className:`w-4 h-4 ${M===i.value?i.color:"text-white/40"}`}),e.jsx("span",{className:M===i.value?"text-white":"text-white/60",children:i.label})]},i.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-white/60 mb-2 block",children:"Energy level"}),e.jsx("div",{className:"flex gap-2",children:pa.map(i=>{const $=i.icon;return e.jsxs("button",{onClick:()=>m(l===i.value?void 0:i.value),className:`flex items-center gap-2 px-3 py-2 rounded-lg text-sm transition-colors ${l===i.value?"bg-white/10 border border-white/20":"bg-white/5 border border-transparent hover:bg-white/10"}`,children:[e.jsx($,{className:`w-4 h-4 ${l===i.value?i.color:"text-white/40"}`}),e.jsx("span",{className:l===i.value?"text-white":"text-white/60",children:i.label})]},i.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-white/60 mb-2 block",children:"Sleep quality"}),e.jsx("div",{className:"flex gap-2",children:ba.map(i=>{const $=i.icon;return e.jsxs("button",{onClick:()=>k(c===i.value?void 0:i.value),className:`flex items-center gap-2 px-3 py-2 rounded-lg text-sm transition-colors ${c===i.value?"bg-white/10 border border-white/20":"bg-white/5 border border-transparent hover:bg-white/10"}`,children:[e.jsx($,{className:`w-4 h-4 ${c===i.value?i.color:"text-white/40"}`}),e.jsx("span",{className:c===i.value?"text-white":"text-white/60",children:i.label})]},i.value)})})]})]}),e.jsxs("div",{className:"p-4 border-b border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-xs font-medium text-white/60",children:"Tags"}),e.jsxs("button",{onClick:()=>L(!p),className:"flex items-center gap-1 text-xs text-violet-400 hover:text-violet-300 transition-colors",children:[e.jsx(we,{className:"w-3 h-3"}),"Add Tag"]})]}),A.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:A.map(i=>e.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 rounded-full bg-violet-500/20 text-violet-300 text-xs",children:[e.jsx(Gt,{className:"w-3 h-3"}),i,e.jsx("button",{onClick:()=>Z(i),className:"ml-1 hover:text-red-400 transition-colors",children:e.jsx(be,{className:"w-3 h-3"})})]},i))}),e.jsx(xe,{children:p&&e.jsxs(Q.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:[e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:fa.filter(i=>!A.includes(i)).map(i=>e.jsx("button",{onClick:()=>Z(i),className:"px-2 py-1 rounded-full bg-white/5 hover:bg-white/10 text-white/60 text-xs transition-colors",children:i},i))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:d,onChange:i=>v(i.target.value),onKeyDown:i=>i.key==="Enter"&&h(),placeholder:"Custom tag...",className:"flex-1 px-3 py-2 rounded-lg bg-white/5 border border-white/10 text-white text-sm placeholder:text-white/40 focus:outline-none focus:border-violet-500"}),e.jsx("button",{onClick:h,disabled:!d.trim(),className:"px-3 py-2 rounded-lg bg-violet-500 text-white text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:bg-violet-600 transition-colors",children:"Add"})]})]})})]}),e.jsx("div",{className:"p-4",children:y?e.jsxs(e.Fragment,{children:[e.jsx("textarea",{ref:U,value:b,onChange:i=>j(i.target.value),placeholder:"How was your workout? Any observations, adjustments, or things to remember for next time...",className:"w-full min-h-[120px] p-3 rounded-xl bg-white/5 border border-white/10 text-white placeholder:text-white/40 focus:outline-none focus:border-violet-500 resize-none"}),!x&&e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[n&&e.jsx("button",{onClick:()=>{j(n.content||""),R(n.mood),m(n.energy),k(n.sleepQuality),q(n.tags||[]),I(!1)},className:"px-4 py-2 rounded-lg text-white/60 hover:bg-white/10 transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:H,disabled:!O,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-violet-500 text-white font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:bg-violet-600 transition-colors",children:[e.jsx(Tt,{className:"w-4 h-4"}),"Save Notes"]})]})]}):e.jsx("div",{className:"prose prose-invert prose-sm max-w-none",children:b?e.jsx("p",{className:"text-white/80 whitespace-pre-wrap",children:b}):e.jsx("p",{className:"text-white/40 italic",children:"No notes added yet"})})})]})}const va=t.lazy(()=>bt(()=>import("./index-syYysO6E.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(a=>({default:a.ExerciseIllustration}))),ja={"chest-upper":"chest","chest-mid":"chest","chest-lower":"chest",pectoralis:"chest",pec:"chest","back-upper":"upper_back","back-mid":"lats","back-lower":"lower_back",latissimus:"lats",rhomboids:"upper_back",trapezius:"traps",traps:"traps","rear-delts":"rear_delts","front-delts":"front_delts","side-delts":"side_delts",shoulders:"front_delts",deltoid:"front_delts",biceps:"biceps",triceps:"triceps",forearms:"forearms",quadriceps:"quads",quads:"quads",hamstrings:"hamstrings",glutes:"glutes",calves:"calves",abs:"abs",obliques:"obliques",core:"abs","hip-flexors":"hip_flexors",adductors:"adductors",erector:"lower_back"};function ye(a){const n=a.toLowerCase().replace(/[_\s]/g,"-");return ja[n]||n.replace(/-/g,"_")}const wa=[{value:15,label:"15 min",description:"Quick session"},{value:30,label:"30 min",description:"Standard"},{value:45,label:"45 min",description:"Extended"},{value:60,label:"60 min",description:"Full workout"}],He=[{value:"gym",label:"Gym",icon:"ðŸ‹ï¸"},{value:"home",label:"Home",icon:"ðŸ "},{value:"park",label:"Park",icon:"ðŸŒ³"},{value:"hotel",label:"Hotel",icon:"ðŸ¨"},{value:"office",label:"Office",icon:"ðŸ¢"}],Na={gym:[{value:"barbell",label:"Barbell",icon:"ðŸ‹ï¸"},{value:"dumbbells",label:"Dumbbells",icon:"ðŸ”©"},{value:"cable_machine",label:"Cable Machine",icon:"âš™ï¸"},{value:"leg_press",label:"Leg Press",icon:"ðŸ¦µ"},{value:"lat_pulldown",label:"Lat Pulldown",icon:"ðŸ“"},{value:"bench",label:"Bench",icon:"ðŸª‘"},{value:"squat_rack",label:"Squat Rack",icon:"ðŸ—ï¸"},{value:"smith_machine",label:"Smith Machine",icon:"ðŸ”§"},{value:"rowing_machine",label:"Row Machine",icon:"ðŸš£"},{value:"treadmill",label:"Treadmill",icon:"ðŸƒ"},{value:"elliptical",label:"Elliptical",icon:"â­•"},{value:"kettlebell",label:"Kettlebell",icon:"ðŸ””"}],home:[{value:"dumbbells",label:"Dumbbells",icon:"ðŸ”©"},{value:"pullup_bar",label:"Pull-up Bar",icon:"ðŸ”²"},{value:"kettlebell",label:"Kettlebell",icon:"ðŸ””"},{value:"bands",label:"Resistance Bands",icon:"âž°"},{value:"yoga_mat",label:"Yoga Mat",icon:"ðŸ§˜"},{value:"foam_roller",label:"Foam Roller",icon:"ðŸ›¼"},{value:"jump_rope",label:"Jump Rope",icon:"ðŸª¢"},{value:"stability_ball",label:"Stability Ball",icon:"âšª"}],park:[{value:"pullup_bar",label:"Pull-up Bar",icon:"ðŸ”²"},{value:"parallel_bars",label:"Parallel Bars",icon:"â¸ï¸"},{value:"bench",label:"Park Bench",icon:"ðŸª‘"},{value:"bands",label:"Resistance Bands",icon:"âž°"},{value:"jump_rope",label:"Jump Rope",icon:"ðŸª¢"},{value:"stairs",label:"Stairs",icon:"ðŸ“¶"}],hotel:[{value:"bands",label:"Resistance Bands",icon:"âž°"},{value:"dumbbells",label:"Hotel Dumbbells",icon:"ðŸ”©"},{value:"yoga_mat",label:"Yoga Mat",icon:"ðŸ§˜"},{value:"chair",label:"Chair",icon:"ðŸ’º"},{value:"treadmill",label:"Treadmill",icon:"ðŸƒ"}],office:[{value:"bands",label:"Resistance Bands",icon:"âž°"},{value:"chair",label:"Office Chair",icon:"ðŸ’º"},{value:"desk",label:"Desk",icon:"ðŸ–¥ï¸"},{value:"stairs",label:"Stairs",icon:"ðŸ“¶"}]},Sa=[{value:"dumbbells",label:"Dumbbells",icon:"ðŸ”©"},{value:"pullup_bar",label:"Pull-up Bar",icon:"ðŸ”²"},{value:"kettlebell",label:"Kettlebell",icon:"ðŸ””"},{value:"bands",label:"Resistance Bands",icon:"âž°"},{value:"barbell",label:"Barbell",icon:"ðŸ‹ï¸"}],ka=[{value:"strength",label:"Strength",icon:"ðŸ’ª"},{value:"hypertrophy",label:"Muscle Growth",icon:"ðŸ“ˆ"},{value:"endurance",label:"Endurance",icon:"ðŸƒ"},{value:"fat_loss",label:"Fat Loss",icon:"ðŸ”¥"}],Ws=[{id:"chest",name:"Chest",icon:"ðŸª¶",match:["ch_","pec","chest"]},{id:"back",name:"Back",icon:"ðŸ”§",match:["bk_","lat","romboid","trap","back"]},{id:"shoulders",name:"Shoulders",icon:"ðŸ’ª",match:["sh_","delt","shoulder"]},{id:"arms",name:"Arms",icon:"ðŸ’ª",match:["ar_","bicep","tricep","forearm"]},{id:"legs",name:"Legs",icon:"ðŸ¦µ",match:["lg_","quad","hamstring","calf","leg"]},{id:"glutes",name:"Glutes",icon:"ðŸ‘",match:["glute"]},{id:"core",name:"Core",icon:"ðŸ¤³",match:["core","ab","oblique"]}];function Ye(a){if(!a||!a.length)return null;const n=(a[0]||"").toLowerCase();for(const o of Ws)if(o.match.some(u=>n.includes(u)))return o;return null}const Ss={barbell:{c:"from-red-500 to-orange-500"},dumbbell:{c:"from-blue-500 to-purple-500"},bodyweight:{c:"from-green-500 to-teal-500"},kettlebell:{c:"from-yellow-500 to-orange-500"},machine:{c:"from-gray-500 to-gray-700"},cable:{c:"from-purple-500 to-pink-500"},default:{c:"from-gray-600 to-gray-700"}},ks=({currentExercise:a,onWeightCalculated:n})=>{const[o,u]=t.useState(!1),[w,x]=t.useState("plates"),_=[{id:"plates",label:"Plates",icon:"ðŸ”¢",description:"Calculate plates needed"},{id:"warmup",label:"Warmup",icon:"ðŸ”¥",description:"Generate warmup sets"},{id:"timer",label:"Timer",icon:"â±ï¸",description:"Stopwatch & countdown"},{id:"notes",label:"Notes",icon:"ðŸ“",description:"Session notes"},{id:"history",label:"History",icon:"ðŸ“Š",description:"Exercise progress"}];return e.jsxs("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl overflow-hidden mb-6 border border-white/5",children:[e.jsxs("button",{onClick:()=>u(!o),className:"w-full p-4 flex items-center justify-between text-left min-h-[56px] touch-action-manipulation",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-2xl",children:"ðŸ› ï¸"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-white",children:"Workout Tools"}),e.jsx("div",{className:"text-xs text-gray-400",children:"Plate calculator, warmup sets, timer & more"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-blue-400 bg-blue-400/10 px-2 py-1 rounded-full",children:"New"}),e.jsx("svg",{className:`w-5 h-5 text-gray-400 transition-transform ${o?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),o&&e.jsxs("div",{className:"p-4 pt-0",children:[e.jsx("div",{className:"flex gap-2 mb-4 overflow-x-auto pb-2 scrollbar-hide -mx-1 px-1",children:_.map(S=>e.jsxs("button",{onClick:()=>x(S.id),className:`flex items-center gap-2 px-4 py-3 rounded-xl text-sm whitespace-nowrap transition-all min-h-[48px] touch-action-manipulation ${w===S.id?"bg-blue-500 text-white shadow-lg shadow-blue-500/25":"bg-gray-700/50 text-gray-300 hover:bg-gray-700 active:scale-95"}`,title:S.description,children:[e.jsx("span",{className:"text-lg",children:S.icon}),e.jsx("span",{className:"font-medium",children:S.label})]},S.id))}),e.jsxs("div",{className:"bg-gray-900/50 rounded-xl p-4",children:[w==="plates"&&e.jsx(ca,{onWeightCalculated:n}),w==="warmup"&&e.jsx(da,{workingWeight:135}),w==="timer"&&e.jsx(ua,{}),w==="notes"&&e.jsx(ya,{workoutId:`workout-${Date.now()}`}),w==="history"&&a?.id&&e.jsx(ha,{exerciseId:a.id,exerciseName:a.name||"Exercise"}),w==="history"&&!a?.id&&e.jsxs("div",{className:"text-center text-gray-400 py-8",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ðŸ“Š"}),e.jsx("p",{children:"Select an exercise to view history"})]})]})]})]})};function cr(){const{token:a}=pt(),n=yt(),[o,u]=t.useState("select"),[w,x]=t.useState(!0),[_,S]=t.useState(30),[f,y]=t.useState("gym"),[I,b]=t.useState([]),[j,M]=t.useState(["strength"]),[R,l]=t.useState(null),[m,c]=t.useState(0),[k,A]=t.useState([]),[q,p]=t.useState(""),[L,d]=t.useState(null),[v,O]=t.useState([]),[K,U]=t.useState(!1),[D,J]=t.useState(null),[H,G]=t.useState(3),[Z,h]=t.useState(!1),[i,$]=t.useState(null),[Y,se]=t.useState(10),[ae,re]=t.useState(0),[ie,V]=t.useState(null),[oe,ue]=t.useState(null),N=t.useRef(null),B=t.useRef(null),[X,me]=t.useState(!1),[Be,fe]=t.useState(!1),[ve,Se]=t.useState([]),{activeSession:ke,isSessionActive:Ce,startSession:T,completeSession:E,recoverSession:F,abandonSession:ee,recoverableSessions:te,totalSets:Ue,registerCallbacks:ts}=De();t.useEffect(()=>{ts({onPR:s=>{V(`NEW ${s.prType.toUpperCase()} PR! ${s.exerciseName}`),setTimeout(()=>V(null),3e3)},onLevelUp:s=>{V(`LEVEL UP! You're now level ${s}!`),setTimeout(()=>V(null),4e3)}})},[ts]),t.useEffect(()=>{te&&te.length>0&&(Se(te),fe(!0))},[te]),t.useEffect(()=>{(o==="workout"||o==="manual")&&!N.current&&(N.current=`session-${Date.now()}-${Math.random().toString(36).slice(2)}`,B.current=Date.now())},[o]);const as=t.useCallback(async s=>{if(!a||!N.current||s.length===0)return;const r={sessionId:N.current,isActive:!0,startTime:B.current||Date.now(),pausedAt:null,totalPausedTime:0,exercises:s.map(C=>({id:C.id,name:C.name,primaryMuscles:C.primaryMuscles||C.primary_muscles||[],secondaryMuscles:C.secondaryMuscles||C.secondary_muscles||[]})),currentExercise:s[s.length-1]||null,currentExerciseIndex:s.length-1,currentSetIndex:0,sets:s.map((C,g)=>({id:`set-${g}`,exerciseId:C.id,exerciseName:C.name,weight:C.weight||0,reps:C.reps||0,tag:"working",timestamp:Date.now()})),totalVolume:s.reduce((C,g)=>C+(g.weight||0)*(g.reps||0)*(g.sets||1),0),totalReps:s.reduce((C,g)=>C+(g.reps||0)*(g.sets||1),0),estimatedCalories:s.length*50,musclesWorked:[...new Set(s.flatMap(C=>C.primaryMuscles||C.primary_muscles||[]))],sessionPRs:[],exerciseGroups:[],activeGroupExerciseIndex:0,activeGroupRound:1,groupSets:[],clientVersion:1};try{await Kt(r,!1)}catch{}},[a]);t.useEffect(()=>{v.length>0&&(o==="workout"||o==="manual")&&as(v)},[v,o,as]),t.useEffect(()=>{b([])},[f]);const Ls=Na[f]||Sa,le=()=>{if(!R)return[];const s=[];return R.warmup&&s.push(...R.warmup.map(r=>({...r,phase:"warmup"}))),R.exercises&&s.push(...R.exercises.map(r=>({...r,phase:"main"}))),R.cooldown&&s.push(...R.cooldown.map(r=>({...r,phase:"cooldown"}))),s},Me=t.useMemo(()=>{const s={};return v.forEach(r=>{const C=r.primaryMuscles||r.primary_muscles||[],g=r.secondaryMuscles||r.secondary_muscles||[],P=r.sets||3,W=r.reps||10,z=Math.min(1,P*W/50);C.forEach(ce=>{const he=ye(ce),je=s[he]||{intensity:0};s[he]={intensity:Math.min(1,je.intensity+z*.4),isPrimary:!0}}),g.forEach(ce=>{const he=ye(ce),je=s[he]||{intensity:0,isPrimary:!1};je.isPrimary?s[he].intensity=Math.min(1,je.intensity+z*.2):s[he]={intensity:Math.min(1,je.intensity+z*.2),isPrimary:!1}})}),Object.entries(s).map(([r,{intensity:C,isPrimary:g}])=>({id:r,intensity:C,isPrimary:g}))},[v]),Os=t.useMemo(()=>{if(!R)return[];const r=le()[m];if(!r)return[];const C=[],g=r.primaryMuscles||r.primary_muscles||[],P=r.secondaryMuscles||r.secondary_muscles||[];return g.forEach(W=>{C.push({id:ye(W),intensity:1,isPrimary:!0})}),P.forEach(W=>{C.push({id:ye(W),intensity:.5,isPrimary:!1})}),C},[R,m]);t.useEffect(()=>{o==="manual"&&k.length===0&&(U(!0),fetch("/api/exercises").then(s=>s.json()).then(s=>{const C=(s.data||s.exercises||[]).map(g=>({...g,primary_muscles:typeof g.primaryMuscles=="string"?g.primaryMuscles.split(",").map(P=>P.trim()).filter(Boolean):g.primaryMuscles||[]}));A(C),U(!1)}).catch(()=>U(!1)))},[o,k.length]);const Ds=async()=>{U(!0),ue(null);try{const s=await fetch("/api/prescription/generate",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({timeAvailable:_,location:f,equipment:I,goals:j})}),r=await s.json();if(!s.ok)throw new Error(r.error?.message||"Failed to generate workout");const C=r.data;l(C),c(0),u("workout");const g=[...C.warmup||[],...C.exercises||[],...C.cooldown||[]].filter(P=>P.id||P.exerciseId).map(P=>({exerciseId:P.id||P.exerciseId,name:P.name,plannedSets:P.sets||3,plannedReps:typeof P.reps=="number"?P.reps:10}));g.length>0&&await T(g)}catch(s){ue(s.message||"Failed to generate workout. Try different constraints.")}finally{U(!1)}},Bs=s=>{b(r=>r.includes(s)?r.filter(C=>C!==s):[...r,s])},Us=s=>{M(r=>r.includes(s)?r.length>1?r.filter(C=>C!==s):r:[...r,s])},Ee=t.useRef(!1),rs=async()=>{if(Ee.current||v.length===0)return;Ee.current=!0,h(!0);const s=[...v];try{if(Ce&&ke){const r=await E();r?(N.current&&(await ps("completed",r.workout?.id),N.current=null,B.current=null),$({tuEarned:r.tuEarned||0,xpEarned:r.xpEarned||0,characterStats:r.characterStats,exerciseCount:r.sessionSummary?.exerciseCount||s.length,totalSets:r.sessionSummary?.totalSets||Ue,exercises:s,levelUp:r.levelUp,newLevel:r.newLevel,achievements:r.achievements,sessionSummary:r.sessionSummary}),O([])):alert("Failed to complete workout. Please try again.")}else{const r=s.filter(W=>{const z=W.id&&typeof W.id=="string"&&!W.id.startsWith("activity-"),ce=!W.isActivity;return z&&ce}).map(W=>({exerciseId:W.id,sets:W.sets||3,reps:typeof W.reps=="number"?W.reps:10,weight:W.weight||void 0}));if(r.length===0){alert("No exercises to log. Complete at least one exercise (not just warmup/cooldown) to save your workout."),Ee.current=!1,h(!1);return}const C=`workout-${Date.now()}-${Math.random().toString(36).slice(2)}`,g=await fetch("/api/workouts",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+a},body:JSON.stringify({exercises:r,idempotencyKey:C,notes:`${v.length} exercises completed`})}),P=await g.json();if(g.ok&&P.data){N.current&&(await ps("completed",P.data.id),N.current=null,B.current=null);const W=s.length,z=s.reduce((ce,he)=>ce+(he.sets||0),0);$({tuEarned:P.data.totalTU,characterStats:P.data.characterStats,exerciseCount:W,totalSets:z,exercises:s}),O([])}else alert(P.error?.message||P.error||"Failed to complete workout")}}catch{alert("Error completing workout. Please try again.")}finally{Ee.current=!1,h(!1)}},Gs=k.filter(s=>{const r=!q||s.name.toLowerCase().includes(q.toLowerCase()),C=Ye(s.primary_muscles),g=!L||C&&C.id===L;return r&&g}).slice(0,24);async function qs(){if(D)try{await fetch("/api/workouts/exercise",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+a},body:JSON.stringify({exerciseId:D.id,sets:H,reps:Y,weight:ae})}),O([...v,{...D,sets:H,reps:Y,weight:ae}]),V(D.name),setTimeout(()=>V(null),2e3),J(null)}catch{}}const Vs=s=>Ss[s.type]||Ss.default,Ge=s=>{const r=Ye(s.primary_muscles||s.primaryMuscles);return r?r.icon:"ðŸ’ª"},ls=s=>{const r=Ye(s.primary_muscles||s.primaryMuscles);return r?r.name:""},zs=async s=>{const r=s.id||s.exerciseId;if(s.isActivity||!r){const g=`activity-${m}`;v.some(z=>z.id===g)||O(z=>[...z,{id:g,name:s.name||s.description||"Activity",sets:s.sets||1,reps:s.reps||1,weight:0,isActivity:!0}]),V(s.name||s.description),setTimeout(()=>V(null),2e3);const W=le();m<W.length-1&&c(m+1);return}try{await fetch("/api/workouts/exercise",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+a},body:JSON.stringify({exerciseId:r,sets:s.sets,reps:typeof s.reps=="number"?s.reps:10,weight:0})}),O([...v,{id:r,name:s.name,sets:s.sets,reps:s.reps,weight:0,primaryMuscles:s.primaryMuscles}]),V(s.name),setTimeout(()=>V(null),2e3);const g=le();m<g.length-1&&c(m+1)}catch{}},Hs=()=>e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-gray-900 via-gray-800 to-gray-900 text-white pb-24",children:[e.jsx("header",{className:"bg-gray-900/80 backdrop-blur-lg p-4 sticky top-0 z-10 border-b border-gray-700/30",children:e.jsxs("div",{className:"max-w-5xl mx-auto flex items-center justify-between",children:[e.jsxs(vt,{to:"/dashboard",className:"flex items-center gap-2 text-blue-400 hover:text-blue-300 transition-colors",children:[e.jsx("span",{children:"â†"}),e.jsx("img",{src:"/logo.png",alt:"MuscleMap",className:"w-6 h-6 rounded-md"})]}),e.jsx("h1",{className:"text-xl font-bold",children:"Start Workout"}),e.jsx("div",{})]})}),e.jsxs("main",{className:"max-w-lg mx-auto p-4 space-y-6",children:[oe&&e.jsx("div",{className:"bg-red-500/20 border border-red-500 rounded-xl p-4 text-red-200",children:oe}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-sm text-gray-400 uppercase mb-3",children:"How long do you have?"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:wa.map(s=>e.jsxs("button",{onClick:()=>S(s.value),className:`p-3 rounded-xl text-center transition-all ${_===s.value?"bg-purple-600 ring-2 ring-purple-400":"bg-gray-800 hover:bg-gray-700"}`,children:[e.jsx("div",{className:"font-bold",children:s.label}),e.jsx("div",{className:"text-xs text-gray-400",children:s.description})]},s.value))})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-sm text-gray-400 uppercase mb-3",children:"Where are you?"}),e.jsx("div",{className:"grid grid-cols-5 gap-2",children:He.map(s=>e.jsxs("button",{onClick:()=>y(s.value),className:`p-3 rounded-xl text-center transition-all ${f===s.value?"bg-purple-600 ring-2 ring-purple-400":"bg-gray-800 hover:bg-gray-700"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:s.icon}),e.jsx("div",{className:"text-xs",children:s.label})]},s.value))})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-sm text-gray-400 uppercase mb-3",children:["Available at ",He.find(s=>s.value===f)?.label||"Location"," (optional)"]}),e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-2 max-h-48 overflow-y-auto",children:Ls.map(s=>e.jsxs("button",{onClick:()=>Bs(s.value),className:`p-3 rounded-xl text-center transition-all ${I.includes(s.value)?"bg-green-600 ring-2 ring-green-400":"bg-gray-800 hover:bg-gray-700"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:s.icon}),e.jsx("div",{className:"text-xs leading-tight",children:s.label})]},s.value))}),I.length===0&&e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"No equipment selected = bodyweight exercises"}),I.length>0&&e.jsxs("p",{className:"text-xs text-green-400 mt-2",children:[I.length," item",I.length>1?"s":""," selected"]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-sm text-gray-400 uppercase mb-3",children:"Your Goal"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:ka.map(s=>e.jsxs("button",{onClick:()=>Us(s.value),className:`p-3 rounded-xl text-left transition-all ${j.includes(s.value)?"bg-blue-600 ring-2 ring-blue-400":"bg-gray-800 hover:bg-gray-700"}`,children:[e.jsx("span",{className:"text-xl mr-2",children:s.icon}),e.jsx("span",{className:"font-medium",children:s.label})]},s.value))})]}),e.jsx("button",{onClick:Ds,disabled:K,className:"w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-500 hover:to-blue-500 py-4 rounded-2xl font-bold text-lg transition-all disabled:opacity-50",children:K?"Generating...":"Generate Workout"}),e.jsx("button",{onClick:()=>u("manual"),className:"w-full bg-gray-800 hover:bg-gray-700 py-3 rounded-xl text-gray-400 text-sm",children:"Or browse all exercises manually"})]})]}),Ys=()=>{const s=le(),r=s[m],C=s.length>0?(m+1)/s.length*100:0;return e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-gray-900 via-gray-800 to-gray-900 text-white pb-24",children:[ie&&e.jsxs("div",{className:"fixed top-20 left-1/2 -translate-x-1/2 z-50 bg-green-500 px-8 py-4 rounded-2xl font-bold animate-bounce",children:["Done: ",ie]}),e.jsx("header",{className:"bg-gray-900/80 backdrop-blur-lg p-4 sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-5xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("button",{onClick:()=>{u("select"),l(null)},className:"text-blue-400",children:"â† Exit"}),e.jsx("h1",{className:"text-xl font-bold",children:"Your Workout"}),e.jsxs("div",{className:"bg-green-600 px-3 py-1 rounded-full text-sm font-bold",children:[v.length,"/",s.length]})]}),e.jsx("div",{className:"h-2 bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-green-500 to-emerald-400 transition-all duration-300",style:{width:`${C}%`}})})]})}),e.jsxs("main",{className:"max-w-lg mx-auto p-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl overflow-hidden mb-6 border border-white/5",children:[e.jsxs("button",{onClick:()=>x(!w),className:"w-full p-3 flex items-center justify-between text-left",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-2xl",children:"ðŸ”¥"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-white",children:"Muscle Activation"}),e.jsxs("div",{className:"text-xs text-gray-400",children:[Me.length," muscle groups worked"]})]})]}),e.jsx("svg",{className:`w-5 h-5 text-gray-400 transition-transform ${w?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),w&&e.jsx("div",{className:"p-4 pt-0",children:e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase mb-2",children:"Current Exercise"}),e.jsx(is,{muscles:Os,mode:"compact",interactive:!1,showLabels:!1,autoRotate:!1,className:"w-full",style:{height:140}}),r&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2 justify-center",children:r.primaryMuscles?.slice(0,3).map(g=>e.jsx("span",{className:"bg-purple-500/30 text-purple-200 px-2 py-0.5 rounded text-xs",children:g},g))})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase mb-2",children:"Workout Total"}),e.jsx(is,{muscles:Me,mode:"compact",interactive:!1,showLabels:!1,autoRotate:!1,className:"w-full",style:{height:140}}),Me.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2 justify-center",children:Me.slice(0,3).map(g=>e.jsx("span",{className:"bg-green-500/30 text-green-200 px-2 py-0.5 rounded text-xs",children:g.id.replace(/_/g," ")},g.id))})]})]})})]}),e.jsx(ks,{currentExercise:r,onWeightCalculated:g=>{}}),e.jsxs("div",{className:"bg-gray-800 rounded-2xl p-4 mb-6",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-400 mb-2",children:[e.jsxs("span",{children:[R?.actualDuration||_," min"]}),e.jsxs("span",{children:[He.find(g=>g.value===f)?.icon," ",f]}),e.jsxs("span",{children:[s.length," exercises"]})]}),R?.muscleCoverage&&e.jsx("div",{className:"flex flex-wrap gap-1",children:Object.keys(R.muscleCoverage).slice(0,6).map(g=>e.jsx("span",{className:"bg-gray-700 px-2 py-1 rounded text-xs",children:g},g))})]}),r&&e.jsxs("div",{className:"bg-gradient-to-br from-purple-600 to-blue-600 rounded-3xl overflow-hidden mb-6 shadow-2xl",children:[r.id&&jt(r.id)&&e.jsx("div",{className:"h-40 bg-black/20",children:e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-white/5 to-white/10 animate-pulse"}),children:e.jsx(va,{exerciseId:r.id,exerciseName:r.name,primaryMuscles:r.primaryMuscles,size:"md",showMuscleLabels:!1,interactive:!1,className:"w-full h-full"})})}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide opacity-70 mb-2",children:r.phase==="warmup"?"Warm-up":r.phase==="cooldown"?"Cool-down":`Exercise ${m+1-(R?.warmup?.length||0)}`}),e.jsx("h2",{className:"text-2xl font-bold mb-4",children:r.name}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-white/20 rounded-xl p-3 text-center",children:[e.jsx("div",{className:"text-3xl font-bold",children:r.sets}),e.jsx("div",{className:"text-xs opacity-80",children:"Sets"})]}),e.jsxs("div",{className:"bg-white/20 rounded-xl p-3 text-center",children:[e.jsx("div",{className:"text-3xl font-bold",children:r.reps}),e.jsx("div",{className:"text-xs opacity-80",children:"Reps"})]}),e.jsxs("div",{className:"bg-white/20 rounded-xl p-3 text-center",children:[e.jsxs("div",{className:"text-3xl font-bold",children:[r.restSeconds,"s"]}),e.jsx("div",{className:"text-xs opacity-80",children:"Rest"})]})]}),r.notes&&e.jsx("p",{className:"text-sm opacity-80 mb-4",children:r.notes}),e.jsx("div",{className:"flex gap-2 text-xs opacity-70 flex-wrap",children:r.primaryMuscles?.map(g=>e.jsx("span",{className:"bg-white/10 px-2 py-1 rounded",children:g},g))})]})]}),r&&e.jsx("div",{className:"mb-6",children:e.jsx(Zt,{exerciseId:r.exerciseId,delay:1500})}),r&&r.id&&!r.isActivity&&e.jsxs("div",{className:"mb-6 bg-gray-800/50 rounded-2xl p-4 border border-gray-700/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-300",children:"Log Your Sets"}),e.jsx("button",{onClick:()=>me(!0),className:"text-xs text-blue-400 hover:text-blue-300",children:"Swap Exercise"})]}),e.jsx(la,{exerciseId:r.id,exerciseName:r.name,suggestedSets:r.sets||3,suggestedReps:typeof r.reps=="number"?r.reps:10,onSetLogged:g=>{O(P=>P.find(z=>z.id===r.id)?P.map(z=>z.id===r.id?{...z,sets:(z.sets||0)+1,tu:(z.tu||0)+(g.tu||0)}:z):[...P,{id:r.id,name:r.name,sets:1,reps:g.reps,weight:Math.round((g.weightKg||0)*2.205),tu:g.tu||0,primaryMuscles:r.primaryMuscles}])},onAllSetsComplete:()=>{const g=le();m<g.length-1&&c(m+1),V(`${r.name} completed!`),setTimeout(()=>V(null),2e3)},compact:!1})]}),r&&(r.isActivity||!r.id)&&e.jsxs("div",{className:"flex gap-3 mb-6",children:[e.jsx("button",{onClick:()=>m>0&&c(m-1),disabled:m===0,className:"flex-1 bg-gray-700 hover:bg-gray-600 disabled:opacity-50 py-4 rounded-xl font-bold",children:"Previous"}),e.jsx("button",{onClick:()=>zs(r),className:"flex-[2] bg-green-600 hover:bg-green-500 py-4 rounded-xl font-bold text-lg",children:"Done"}),e.jsx("button",{onClick:()=>m<s.length-1&&c(m+1),disabled:m===s.length-1,className:"flex-1 bg-gray-700 hover:bg-gray-600 disabled:opacity-50 py-4 rounded-xl font-bold",children:"Skip"})]}),r&&r.id&&!r.isActivity&&e.jsxs("div",{className:"flex gap-3 mb-6",children:[e.jsx("button",{onClick:()=>m>0&&c(m-1),disabled:m===0,className:"flex-1 bg-gray-700 hover:bg-gray-600 disabled:opacity-50 py-3 rounded-xl font-medium",children:"Previous"}),e.jsx("button",{onClick:()=>{v.some(W=>W.id===r.id)||O(W=>[...W,{id:r.id,name:r.name,sets:r.sets||3,reps:typeof r.reps=="number"?r.reps:10,weight:0,primaryMuscles:r.primaryMuscles}]),V(`${r.name} completed!`),setTimeout(()=>V(null),2e3);const P=le();m<P.length-1&&c(m+1)},className:"flex-[2] bg-green-600 hover:bg-green-500 py-3 rounded-xl font-bold",children:"Done"}),e.jsx("button",{onClick:()=>{const g=le();m<g.length-1&&c(m+1)},disabled:m===s.length-1,className:"flex-1 bg-gray-700 hover:bg-gray-600 disabled:opacity-50 py-3 rounded-xl font-medium",children:"Skip"})]}),v.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm text-gray-400 uppercase mb-3",children:"Completed"}),e.jsx("div",{className:"space-y-2",children:v.map((g,P)=>e.jsxs("div",{className:"bg-gray-800 rounded-xl p-3 flex items-center gap-3",children:[e.jsx("div",{className:"bg-green-600 w-8 h-8 rounded-full flex items-center justify-center text-sm",children:"âœ“"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:g.name}),e.jsxs("div",{className:"text-xs text-gray-400",children:[g.sets," x ",g.reps]})]})]},P))})]}),v.length>0&&e.jsx("button",{onClick:rs,disabled:Z,className:"w-full bg-gradient-to-r from-green-600 to-emerald-500 hover:from-green-500 hover:to-emerald-400 py-4 rounded-2xl font-bold text-lg transition-all",children:Z?"Completing...":`Complete Workout (${v.length} exercises)`}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-sm text-gray-400 uppercase mb-3",children:"All Exercises"}),e.jsx("div",{className:"space-y-2",children:s.map((g,P)=>{const W=v.some(ce=>ce.name===g.name),z=P===m;return e.jsxs("button",{onClick:()=>c(P),className:`w-full text-left rounded-xl p-3 flex items-center gap-3 transition-all ${z?"bg-purple-600":W?"bg-gray-800 opacity-60":"bg-gray-800 hover:bg-gray-700"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm ${W?"bg-green-600":z?"bg-white/20":"bg-gray-700"}`,children:W?"âœ“":P+1}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:g.name}),e.jsxs("div",{className:"text-xs text-gray-400",children:[g.sets," x ",g.reps," | ",g.phase]})]})]},P)})})]})]})]})},Qs=()=>e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-gray-900 via-gray-800 to-gray-900 text-white pb-24",children:[ie&&e.jsxs("div",{className:"fixed top-20 left-1/2 -translate-x-1/2 z-50 bg-green-500 px-8 py-4 rounded-2xl font-bold animate-bounce",children:[ie,"!"]}),D&&e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-end justify-center",onClick:()=>J(null),children:e.jsxs("div",{className:"bg-gray-800 rounded-t-3xl p-6 w-full max-w-lg",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("span",{className:"text-5xl",children:Ge(D)}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:D.name}),e.jsx("p",{className:"text-gray-400",children:ls(D)})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Sets"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-2",children:[e.jsx("button",{onClick:()=>G(Math.max(1,H-1)),className:"bg-gray-700 w-10 h-10 rounded-full text-xl",children:"-"}),e.jsx("span",{className:"text-3xl font-bold w-12 text-center",children:H}),e.jsx("button",{onClick:()=>G(H+1),className:"bg-gray-700 w-10 h-10 rounded-full text-xl",children:"+"})]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Reps"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-2",children:[e.jsx("button",{onClick:()=>se(Math.max(1,Y-1)),className:"bg-gray-700 w-10 h-10 rounded-full text-xl",children:"-"}),e.jsx("span",{className:"text-3xl font-bold w-12 text-center",children:Y}),e.jsx("button",{onClick:()=>se(Y+1),className:"bg-gray-700 w-10 h-10 rounded-full text-xl",children:"+"})]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"lbs"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-2",children:[e.jsx("button",{onClick:()=>re(Math.max(0,ae-5)),className:"bg-gray-700 w-10 h-10 rounded-full text-xl",children:"-"}),e.jsx("span",{className:"text-3xl font-bold w-12 text-center",children:ae}),e.jsx("button",{onClick:()=>re(ae+5),className:"bg-gray-700 w-10 h-10 rounded-full text-xl",children:"+"})]})]})]}),e.jsx("button",{onClick:qs,className:"w-full bg-green-600 hover:bg-green-700 py-4 rounded-2xl font-bold text-lg",children:"Log Exercise"})]})}),e.jsx("header",{className:"bg-gray-900/80 backdrop-blur-lg p-4 sticky top-0 z-10 border-b border-gray-700/30",children:e.jsxs("div",{className:"max-w-5xl mx-auto flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>u("select"),className:"flex items-center gap-2 text-blue-400 hover:text-blue-300 transition-colors",children:[e.jsx("span",{children:"â†"}),e.jsx("img",{src:"/logo.png",alt:"MuscleMap",className:"w-6 h-6 rounded-md"})]}),e.jsx("h1",{className:"text-xl font-bold",children:"Browse Exercises"}),e.jsxs("div",{className:"bg-green-600 px-3 py-1 rounded-full text-sm font-bold",children:[v.length," logged"]})]})}),e.jsxs("main",{className:"max-w-5xl mx-auto p-4",children:[e.jsx(ks,{currentExercise:D,onWeightCalculated:s=>re(s)}),v.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-sm text-gray-400 mb-2 uppercase",children:"Today's Workout"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:v.map((s,r)=>e.jsxs("div",{className:"bg-gray-800 rounded-xl p-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:Ge(s)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-sm truncate",children:s.name}),e.jsxs("div",{className:"text-xs text-gray-400",children:[s.sets,"x",s.reps," ",s.weight>0?`${s.weight}lb`:""]})]})]},r))}),e.jsx("button",{onClick:rs,disabled:Z,className:"w-full bg-green-600 hover:bg-green-500 py-4 rounded-2xl font-bold text-lg mt-4 transition-all",children:Z?"Completing...":"Complete Workout"})]}),e.jsx("input",{type:"text",placeholder:"Search exercises...",value:q,onChange:s=>p(s.target.value),className:"w-full bg-gray-800 rounded-2xl p-4 mb-4 text-lg"}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-4 mb-4",children:[e.jsx("button",{onClick:()=>d(null),className:`px-4 py-2 rounded-full text-sm font-bold whitespace-nowrap ${L?"bg-gray-700":"bg-purple-600"}`,children:"All"}),Ws.map(s=>e.jsxs("button",{onClick:()=>d(s.id),className:`px-4 py-2 rounded-full text-sm font-bold whitespace-nowrap ${L===s.id?"bg-purple-600":"bg-gray-700"}`,children:[s.icon," ",s.name]},s.id))]}),K?e.jsx("div",{className:"text-center py-12 text-gray-400",children:"Loading exercises..."}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:Gs.map(s=>{const r=[...(s.primary_muscles||[]).map(C=>({id:ye(C),intensity:1,isPrimary:!0})),...(s.secondary_muscles||[]).slice(0,2).map(C=>({id:ye(C),intensity:.5,isPrimary:!1}))];return e.jsxs("button",{onClick:()=>J(s),className:`bg-gradient-to-br ${Vs(s).c} rounded-2xl p-3 text-left hover:scale-105 active:scale-95 transition-all shadow-lg relative`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("div",{className:"text-3xl",children:Ge(s)}),r.length>0&&e.jsx(wt,{muscles:r,size:"xs",className:"opacity-90"})]}),e.jsx("div",{className:"font-bold text-sm truncate mt-1",children:s.name}),e.jsx("div",{className:"text-xs opacity-80",children:ls(s)})]},s.id)})})]})]}),Ks=()=>i&&e.jsx(sa,{workout:{duration:_,exerciseCount:i.exerciseCount||0,totalSets:i.totalSets||0,totalTU:i.tuEarned||0,exercises:i.exercises||[],goals:j},onClose:()=>{$(null),u("select"),l(null),O([]),n("/dashboard")}}),Js=async s=>{await F(s)&&ke&&(u("workout"),fe(!1))},Zs=async s=>{await ee(s),Se(r=>r.filter(C=>C.id!==s)),ve.length<=1&&fe(!1)},Xs=s=>{const C=le()[m];if(R&&C){const g=P=>P.map(W=>W.id===C.id||W.exerciseId===C.exerciseId?{...W,id:s.id,exerciseId:s.id,name:s.name,primaryMuscles:s.primaryMuscles}:W);l({...R,warmup:R.warmup?g(R.warmup):void 0,exercises:R.exercises?g(R.exercises):void 0,cooldown:R.cooldown?g(R.cooldown):void 0})}me(!1),V(`Switched to ${s.name}`),setTimeout(()=>V(null),2e3)};return e.jsxs(e.Fragment,{children:[Ks(),o==="select"&&Hs(),o==="workout"&&Ys(),o==="manual"&&Qs(),(o==="workout"||o==="manual")&&Ce&&e.jsx(Nt,{}),X&&m>=0&&e.jsx(na,{exerciseId:le()[m]?.id||"",exerciseName:le()[m]?.name||"",availableEquipment:I,onSelect:Xs,onCancel:()=>me(!1)}),Be&&ve.length>0&&e.jsx(ia,{sessions:ve,onRecover:Js,onDiscard:Zs,onDismiss:()=>fe(!1)})]})}export{cr as default};
