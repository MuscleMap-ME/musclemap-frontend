import{r as a,j as e}from"./react-vendor-D1NxaRNd.js";import{c as N}from"./recharts-vendor-BziRPEEi.js";import{aU as w,m as o,A as S}from"./index-HEJJGvd8.js";import{f as D}from"./date-vendor-C_JWt2cu.js";import"./leaflet-vendor-DZbo3Ov0.js";import"./d3-vendor-mcDw60ct.js";import"./apollo-vendor-D9c7jRvS.js";import"./reactflow-vendor-Dz2P_-Qa.js";const H={spring:t=>t?{duration:0}:{type:"spring",stiffness:300,damping:25},bounce:t=>t?{duration:0}:{type:"spring",stiffness:400,damping:10},smooth:t=>t?{duration:0}:{duration:.3,ease:[.4,0,.2,1]},quick:t=>t?{duration:0}:{duration:.15,ease:"easeOut"},snappy:t=>t?{duration:0}:{type:"spring",stiffness:500,damping:30},gentle:t=>t?{duration:0}:{duration:.5,ease:[.25,.1,.25,1]},elastic:t=>t?{duration:0}:{type:"spring",stiffness:200,damping:8,mass:.8}};function U(t,{staggerDelay:s=.05,delayChildren:i=.1}={}){return t?{hidden:{},visible:{}}:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:s,delayChildren:i}}}}function V(t,s="up"){if(t)return{hidden:{opacity:0},visible:{opacity:1,transition:{duration:0}}};const i={up:{y:20},down:{y:-20},left:{x:20},right:{x:-20}};return{hidden:{opacity:0,...i[s]||i.up},visible:{opacity:1,x:0,y:0,transition:{type:"spring",stiffness:300,damping:25}}}}const $={"session.start":{icon:"ðŸŸ¢",color:"text-green-400"},"session.end":{icon:"ðŸ”´",color:"text-red-400"},"workout.started":{icon:"ðŸ‹ï¸",color:"text-blue-400"},"workout.completed":{icon:"ðŸ’ª",color:"text-purple-400"},"exercise.selected":{icon:"ðŸ“‹",color:"text-gray-400"},"exercise.completed":{icon:"âœ…",color:"text-green-400"},"stage.entered":{icon:"ðŸšª",color:"text-yellow-400"},"stage.completed":{icon:"ðŸ",color:"text-emerald-400"},"level.up":{icon:"â¬†ï¸",color:"text-amber-400"},"archetype.switched":{icon:"ðŸ”„",color:"text-cyan-400"},"achievement.unlocked":{icon:"ðŸ†",color:"text-yellow-400"},"competition.joined":{icon:"ðŸŽ¯",color:"text-orange-400"},"competition.completed":{icon:"ðŸ¥‡",color:"text-yellow-400"},"high.five":{icon:"ðŸ™Œ",color:"text-yellow-400"}},Q={"session.start":"Started a session","session.end":"Ended session","workout.started":"Started a workout","workout.completed":"Completed a workout","exercise.selected":"Selected an exercise","exercise.completed":"Completed an exercise","stage.entered":"Entered a new stage","stage.completed":"Completed a stage","level.up":"Leveled up","archetype.switched":"Switched archetype","achievement.unlocked":"Unlocked an achievement","competition.joined":"Joined a competition","competition.completed":"Finished a competition","high.five":"Received a high five"},W=[{emoji:"ðŸ”¥",label:"Fire",name:"fire"},{emoji:"ðŸ’ª",label:"Flex",name:"flex"},{emoji:"ðŸ‘",label:"Applause",name:"applause"},{emoji:"âš¡",label:"Energy",name:"energy"}],A=80;function F({emoji:t,x:s,y:i,onComplete:c}){const{shouldAnimate:r}=w(),p=a.useMemo(()=>Array.from({length:8},(l,d)=>({id:d,angle:d/8*Math.PI*2,delay:d*.02})),[]);return r?e.jsxs("div",{className:"fixed pointer-events-none z-50",style:{left:s,top:i,transform:"translate(-50%, -50%)"},children:[p.map(l=>e.jsx(o.span,{className:"absolute text-2xl",initial:{opacity:1,scale:.5,x:0,y:0},animate:{opacity:[1,1,0],scale:[.5,1.2,.8],x:Math.cos(l.angle)*60,y:Math.sin(l.angle)*60-20},transition:{duration:.6,delay:l.delay,ease:"easeOut"},onAnimationComplete:l.id===0?c:void 0,children:t},l.id)),e.jsx(o.span,{className:"absolute text-4xl",initial:{opacity:1,scale:.3},animate:{opacity:[1,1,0],scale:[.3,1.5,1]},transition:{duration:.5,ease:"easeOut"},children:t})]}):null}function q({eventId:t,onHighFive:s,count:i=0,hasHighFived:c=!1}){const{shouldAnimate:r,reducedMotion:p}=w(),[l,d]=a.useState(i),[m,x]=a.useState(c),[n,h]=a.useState(!1),f=a.useRef(null),[b,k]=a.useState({x:0,y:0}),C=a.useCallback(()=>{if(m)return;const j=f.current?.getBoundingClientRect();j&&k({x:j.left+j.width/2,y:j.top+j.height/2}),d(v=>v+1),x(!0),h(!0),s?.(t)},[t,m,s]);return e.jsxs(e.Fragment,{children:[e.jsxs(o.button,{ref:f,onClick:C,disabled:m,className:N("flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm transition-colors",m?"bg-yellow-500/20 text-yellow-400 cursor-default":"bg-gray-700/50 text-gray-300 hover:bg-yellow-500/20 hover:text-yellow-400"),whileHover:!p&&!m?{scale:1.05}:void 0,whileTap:!p&&!m?{scale:.95}:void 0,"aria-label":`High five (${l})`,children:[e.jsx(o.span,{animate:n&&r?{scale:[1,1.3,1],rotate:[0,-15,15,0]}:{},transition:{duration:.4},children:"ðŸ™Œ"}),e.jsx(S,{mode:"popLayout",children:e.jsx(o.span,{initial:r?{opacity:0,y:-10}:!1,animate:{opacity:1,y:0},exit:r?{opacity:0,y:10}:void 0,className:"min-w-[1.5ch] text-center",children:l},l)})]}),e.jsx(S,{children:n&&e.jsx(F,{emoji:"ðŸ™Œ",x:b.x,y:b.y,onComplete:()=>h(!1)})})]})}function z({eventId:t,onReact:s,reactions:i={}}){const{shouldAnimate:c,reducedMotion:r}=w(),[p,l]=a.useState(null),[d,m]=a.useState(null),x=a.useCallback((n,h)=>{const f=h.currentTarget.getBoundingClientRect();m({emoji:n.emoji,x:f.left+f.width/2,y:f.top+f.height/2}),l(n.name),s?.(t,n.name),setTimeout(()=>l(null),300)},[t,s]);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center gap-1",children:W.map(n=>e.jsxs(o.button,{onClick:h=>x(n,h),className:N("p-1.5 rounded-lg transition-colors",i[n.name]>0?"bg-gray-600/50":"hover:bg-gray-700/50"),whileHover:r?void 0:{scale:1.15},whileTap:r?void 0:{scale:.9},animate:p===n.name&&c?{scale:[1,1.3,1]}:{},"aria-label":n.label,title:n.label,children:[e.jsx("span",{className:"text-lg",children:n.emoji}),i[n.name]>0&&e.jsx("span",{className:"text-xs text-gray-400 ml-0.5",children:i[n.name]})]},n.name))}),e.jsx(S,{children:d&&e.jsx(F,{emoji:d.emoji,x:d.x,y:d.y,onComplete:()=>m(null)})})]})}function J({event:t,onShare:s}){const{reducedMotion:i}=w(),[c,r]=a.useState(!1),p=a.useCallback(async()=>{r(!0);try{await s?.(t)}finally{setTimeout(()=>r(!1),500)}},[t,s]);return e.jsx(o.button,{onClick:p,disabled:c,className:"p-1.5 rounded-lg text-gray-400 hover:text-white hover:bg-gray-700/50 transition-colors",whileHover:i?void 0:{scale:1.1},whileTap:i?void 0:{scale:.9},"aria-label":"Share workout",title:"Share as card",children:e.jsxs(o.svg,{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",animate:c?{rotate:360}:{},transition:{duration:.5},children:[e.jsx("path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"}),e.jsx("polyline",{points:"16 6 12 2 8 6"}),e.jsx("line",{x1:"12",y1:"2",x2:"12",y2:"15"})]})})}function K({event:t,isNew:s=!1,onHighFive:i,onReact:c,onShare:r,onRemove:p}){const{shouldAnimate:l,reducedMotion:d}=w(),m=$[t.type]||{icon:"ðŸ“Œ",color:"text-gray-400"},x=Q[t.type]||t.type,n=D(new Date(t.ts),{addSuffix:!0}),h=a.useMemo(()=>({initial:d?{opacity:0}:s?{opacity:0,y:-30,scale:.95}:{opacity:0,y:20},animate:{opacity:1,y:0,scale:1},exit:d?{opacity:0}:{opacity:0,x:-100,scale:.9}}),[d,s]);return e.jsx(o.div,{layout:l,variants:h,initial:"initial",animate:"animate",exit:"exit",transition:d?{duration:0}:{type:"spring",stiffness:300,damping:25},className:N("glass rounded-xl p-4 transition-colors",s&&"ring-2 ring-blue-500/50"),whileHover:d?void 0:{scale:1.01},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(o.div,{className:N("text-2xl flex-shrink-0",m.color),animate:s&&l?{scale:[1,1.2,1],rotate:[0,10,-10,0]}:{},transition:{duration:.5,delay:.2},children:m.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-semibold text-white truncate",children:t.displayName||"Anonymous"}),t.geoBucket&&e.jsx(o.span,{className:"text-xs bg-gray-700/70 px-2 py-0.5 rounded-full text-gray-300",initial:l?{opacity:0,scale:.8}:!1,animate:{opacity:1,scale:1},transition:{delay:.1},children:t.geoBucket})]}),e.jsx("p",{className:"text-gray-300 text-sm mt-0.5",children:x}),t.payload?.exerciseName&&e.jsx(o.p,{className:"text-purple-400 text-sm mt-1",initial:l?{opacity:0,x:-10}:!1,animate:{opacity:1,x:0},transition:{delay:.15},children:t.payload.exerciseName}),t.payload?.totalTu&&e.jsxs(o.p,{className:"text-green-400 text-sm mt-1 font-medium",initial:l?{opacity:0,scale:.8}:!1,animate:{opacity:1,scale:1},transition:{delay:.2},children:["+",Math.round(t.payload.totalTu)," TU"]}),t.payload?.newLevel&&e.jsxs(o.p,{className:"text-yellow-400 text-sm mt-1 font-medium",initial:l?{opacity:0,y:5}:!1,animate:{opacity:1,y:0},transition:{delay:.2},children:["Level ",t.payload.newLevel,t.payload.archetypeName&&` - ${t.payload.archetypeName}`]}),e.jsxs("div",{className:"flex items-center gap-3 mt-3 flex-wrap",children:[e.jsx(q,{eventId:t.id,onHighFive:i,count:t.highFives||0,hasHighFived:t.hasHighFived}),e.jsx(z,{eventId:t.id,onReact:c,reactions:t.reactions}),t.type==="workout.completed"&&e.jsx(J,{event:t,onShare:r})]})]}),e.jsx("div",{className:"text-xs text-gray-500 flex-shrink-0",children:n})]})})}function M(){const{reducedMotion:t}=w();return e.jsx(o.div,{className:"glass rounded-xl p-4",animate:t?{opacity:.7}:{opacity:[.5,.8,.5]},transition:t?{}:{duration:1.5,repeat:1/0,ease:"easeInOut"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-700/50"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 w-32 bg-gray-700/50 rounded"}),e.jsx("div",{className:"h-3 w-48 bg-gray-700/50 rounded"}),e.jsx("div",{className:"h-3 w-24 bg-gray-700/50 rounded"})]}),e.jsx("div",{className:"h-3 w-16 bg-gray-700/50 rounded"})]})})}function G({pullDistance:t,isRefreshing:s}){const{shouldAnimate:i,reducedMotion:c}=w(),r=Math.min(t/A,1);return e.jsx(o.div,{className:"absolute left-0 right-0 flex justify-center pointer-events-none",style:{top:t-40},animate:{opacity:r},children:e.jsx(o.div,{className:"w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center shadow-lg",animate:s&&i?{rotate:360}:{rotate:r*180},transition:s?{duration:1,repeat:1/0,ease:"linear"}:c?{duration:0}:H.spring(!1),children:e.jsx("svg",{className:"w-5 h-5 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})})}function oe({events:t=[],loading:s=!1,connected:i=!1,hasMore:c=!0,onLoadMore:r,onRefresh:p,onHighFive:l,onReact:d,onShare:m}){const{shouldAnimate:x,reducedMotion:n}=w(),h=a.useRef(null),[f,b]=a.useState(new Set),[k,C]=a.useState(new Set),j=a.useRef(t),[v,E]=a.useState(0),[R,L]=a.useState(!1),B=a.useRef(0),T=a.useRef(!1);a.useEffect(()=>{const u=new Set(j.current.map(y=>y.id)),g=t.filter(y=>!u.has(y.id)).map(y=>y.id);g.length>0&&(b(new Set(g)),setTimeout(()=>b(new Set),3e3)),j.current=t},[t]);const I=a.useRef(null);a.useEffect(()=>{if(!c||s)return;const u=new IntersectionObserver(g=>{g[0].isIntersecting&&r?.()},{rootMargin:"200px"});return I.current&&u.observe(I.current),()=>u.disconnect()},[c,s,r]);const O=a.useCallback(u=>{h.current?.scrollTop===0&&(B.current=u.touches[0].clientY,T.current=!0)},[]),P=a.useCallback(u=>{if(!T.current)return;const y=u.touches[0].clientY-B.current;y>0&&(u.preventDefault(),E(Math.min(y*.5,A*1.5)))},[]),Y=a.useCallback(async()=>{if(v>=A&&!R){L(!0);try{await p?.()}finally{L(!1)}}E(0),T.current=!1},[v,R,p]),_=a.useMemo(()=>U(n,{staggerDelay:.05}),[n]);return a.useMemo(()=>V(n,"up"),[n]),s&&t.length===0?e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((u,g)=>e.jsx(M,{},g))}):e.jsxs("div",{ref:h,className:"relative space-y-3",onTouchStart:O,onTouchMove:P,onTouchEnd:Y,children:[v>0&&e.jsx(G,{pullDistance:v,isRefreshing:R}),e.jsxs(o.div,{className:"flex items-center gap-2 text-sm",initial:x?{opacity:0,y:-10}:!1,animate:{opacity:1,y:0},children:[e.jsx(o.div,{className:N("w-2 h-2 rounded-full",i?"bg-green-500":"bg-gray-500"),animate:i&&x?{scale:[1,1.2,1],opacity:[1,.7,1]}:{},transition:i?{duration:2,repeat:1/0,ease:"easeInOut"}:{}}),e.jsx("span",{className:"text-gray-400",children:i?"Live updates active":"Connecting..."})]}),t.length===0?e.jsxs(o.div,{className:"text-center py-12 text-gray-400",initial:x?{opacity:0,scale:.9}:!1,animate:{opacity:1,scale:1},transition:H.spring(n),children:[e.jsx(o.p,{className:"text-4xl mb-3",animate:x?{rotate:[0,10,-10,0]}:{},transition:{duration:2,repeat:1/0},children:"âœ¨"}),e.jsx("p",{children:"No activity yet. Be the first!"})]}):e.jsxs(o.div,{className:"space-y-2",variants:_,initial:"hidden",animate:"visible",style:{transform:v>0?`translateY(${v}px)`:void 0},children:[e.jsx(S,{mode:"popLayout",children:t.filter(u=>!k.has(u.id)).map(u=>e.jsx(K,{event:u,isNew:f.has(u.id),onHighFive:l,onReact:d,onShare:m,onRemove:g=>C(y=>new Set([...y,g]))},u.id))}),c&&e.jsx("div",{ref:I,className:"py-4",children:s&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{}),e.jsx(M,{})]})}),!c&&t.length>0&&e.jsx(o.p,{className:"text-center text-gray-500 text-sm py-4",initial:x?{opacity:0}:!1,animate:{opacity:1},children:"You have reached the end"})]})]})}export{oe as default};
