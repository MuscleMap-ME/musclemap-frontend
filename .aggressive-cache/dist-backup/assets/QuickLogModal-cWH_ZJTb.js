import{c as w,A as q,m as v,X as A,K as L,ab as F,ac as H,x as Y,P as K}from"./index-CF1yimBQ.js";import{a as R,r as s,j as e}from"./react-vendor-D847gc3Q.js";import{G as T}from"./GlassSurface-CuHevRGA.js";import{G as N}from"./GlassButton-gdlFXfDa.js";import{d as X,e as J,c as W,f as Z,g as ee}from"./nutritionStore-B059Tvvn.js";import{a as D,b as se}from"./useNutrition-BxgdFNDn.js";import{L as te}from"./loader-circle-Cl_7-Fdo.js";import{C as ae}from"./circle-check-big-C1cis7IV.js";import{C as z}from"./circle-alert-Do71_KJn.js";import{R as Q}from"./refresh-cw-CJ2h9qCb.js";import{U as $}from"./utensils-z4_WX3Pi.js";import{M as re}from"./minus-CRag533M.js";const ne=[["path",{d:"M3 5v14",key:"1nt18q"}],["path",{d:"M8 5v14",key:"1ybrkv"}],["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"M17 5v14",key:"ycjyhj"}],["path",{d:"M21 5v14",key:"nzette"}]],ce=w("barcode",ne);const le=[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v2",key:"6buw04"}],["path",{d:"M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1",key:"pwadti"}],["path",{d:"M6 2v2",key:"colzsn"}]],ie=w("coffee",le);const oe=[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]],Pe=w("droplets",oe);const de=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],xe=w("mic",de);const me=[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M7 12h10",key:"b7w52i"}]],he=w("scan-line",me);const ue=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],fe=w("sun",ue);function pe(t,c=300){const[r,h]=R.useState(t);return R.useEffect(()=>{const x=setTimeout(()=>h(t),c);return()=>clearTimeout(x)},[t,c]),r}function be({onScan:t,onError:c}){const r=s.useRef(null),h=s.useRef(null),[x,m]=s.useState(null),[u,i]=s.useState(!1),n=s.useRef(null),l=s.useRef(null);s.useEffect(()=>{"BarcodeDetector"in window&&(n.current=new window.BarcodeDetector({formats:["ean_13","ean_8","upc_a","upc_e","code_128","code_39","code_93","qr_code"]}))},[]);const f=s.useCallback(async()=>{try{const d=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}});r.current&&(r.current.srcObject=d,await r.current.play(),m(!0),i(!0))}catch{m(!1),c("Camera permission denied. Please enable camera access in your browser settings.")}},[c]),o=s.useCallback(()=>{r.current?.srcObject&&(r.current.srcObject.getTracks().forEach(g=>g.stop()),r.current.srcObject=null),l.current&&cancelAnimationFrame(l.current),i(!1)},[]),b=s.useCallback(async()=>{if(!(!u||!r.current||!n.current)){try{const d=await n.current.detect(r.current);if(d.length>0){const g=d[0];o(),t(g.rawValue);return}}catch{}l.current=requestAnimationFrame(b)}},[u,o,t]);return s.useEffect(()=>(u&&n.current&&(l.current=requestAnimationFrame(b)),()=>{l.current&&cancelAnimationFrame(l.current)}),[u,b]),s.useEffect(()=>(f(),()=>o()),[f,o]),"BarcodeDetector"in window?x===!1?e.jsxs("div",{className:"text-center p-8",children:[e.jsx(L,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("p",{className:"text-white font-medium mb-2",children:"Camera access denied"}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Please enable camera access in your browser settings to scan barcodes."}),e.jsxs(N,{variant:"primary",onClick:f,children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Try Again"]})]}):e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"relative aspect-[4/3] bg-black rounded-xl overflow-hidden",children:[e.jsx("video",{ref:r,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),u&&e.jsxs("div",{className:"absolute inset-0 flex items-center justify-center",children:[e.jsxs("div",{className:"relative w-72 h-48 border-2 border-green-400 rounded-lg",children:[e.jsx(v.div,{className:"absolute left-0 right-0 h-0.5 bg-green-400 shadow-[0_0_10px_rgba(34,197,94,0.8)]",animate:{top:["0%","100%","0%"]},transition:{duration:2,repeat:1/0,ease:"linear"}}),e.jsx("div",{className:"absolute top-0 left-0 w-6 h-6 border-t-2 border-l-2 border-green-400"}),e.jsx("div",{className:"absolute top-0 right-0 w-6 h-6 border-t-2 border-r-2 border-green-400"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-6 h-6 border-b-2 border-l-2 border-green-400"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-6 h-6 border-b-2 border-r-2 border-green-400"})]}),e.jsx("div",{className:"absolute bottom-4 left-0 right-0 text-center",children:e.jsx("p",{className:"text-white text-sm bg-black/50 px-4 py-2 rounded-full inline-block",children:"Position barcode within frame"})})]})]}),e.jsx("canvas",{ref:h,className:"hidden"})]}):e.jsxs("div",{className:"text-center p-8",children:[e.jsx(z,{className:"w-12 h-12 text-yellow-400 mx-auto mb-4"}),e.jsx("p",{className:"text-white font-medium mb-2",children:"Barcode scanning not supported"}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Your browser doesn't support native barcode scanning. Please use Chrome 83+ or Edge 83+ for this feature."}),e.jsx("p",{className:"text-xs text-gray-500",children:"You can also manually search for food items using the search bar."})]})}function ge({isOpen:t,onClose:c,onFoodFound:r}){const{searchByBarcode:h}=D(),[x,m]=s.useState("scanning"),[u,i]=s.useState(null),[n,l]=s.useState(null),[f,o]=s.useState(null);s.useEffect(()=>{t&&(m("scanning"),i(null),l(null),o(null))},[t]);const b=s.useCallback(async p=>{i(p),m("searching");try{const y=await h(p);y&&y.length>0?(l(y[0]),m("found")):(o(`No food found for barcode: ${p}`),m("error"))}catch{o("Failed to search for barcode. Please try again."),m("error")}},[h]),d=s.useCallback(p=>{o(p),m("error")},[]),g=s.useCallback(()=>{n&&(r(n),c())},[n,r,c]),j=s.useCallback(()=>{m("scanning"),i(null),l(null),o(null)},[]);return e.jsx(q,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx(v.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:c,className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50"}),e.jsx(v.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"fixed inset-x-4 top-[10%] bottom-[10%] z-50 flex items-center justify-center",children:e.jsxs(T,{depth:"solid-elevated",className:"w-full max-w-lg p-6 max-h-full overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-xl bg-gradient-to-br from-blue-500/20 to-cyan-500/20",children:e.jsx(he,{className:"w-5 h-5 text-blue-400"})}),e.jsx("h2",{className:"text-xl font-bold text-white",children:"Scan Barcode"})]}),e.jsx("button",{onClick:c,className:"p-2 rounded-full hover:bg-white/10 transition-colors",children:e.jsx(A,{className:"w-5 h-5 text-gray-400"})})]}),x==="scanning"&&e.jsx(be,{onScan:b,onError:d}),x==="searching"&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(te,{className:"w-12 h-12 text-blue-400 mx-auto mb-4 animate-spin"}),e.jsx("p",{className:"text-white font-medium mb-2",children:"Searching for product..."}),e.jsxs("p",{className:"text-sm text-gray-400",children:["Barcode: ",u]})]}),x==="found"&&n&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(ae,{className:"w-12 h-12 text-green-400 mx-auto mb-4"}),e.jsx("p",{className:"text-white font-medium",children:"Product Found!"})]}),e.jsxs("div",{className:"p-4 rounded-xl bg-white/5",children:[e.jsx("h3",{className:"text-white font-semibold mb-1",children:n.name}),n.brand&&e.jsx("p",{className:"text-sm text-gray-400 mb-3",children:n.brand}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold text-white",children:n.calories||0}),e.jsx("p",{className:"text-xs text-gray-400",children:"Cal"})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-lg font-bold text-green-400",children:[Math.round(n.proteinG||0),"g"]}),e.jsx("p",{className:"text-xs text-gray-400",children:"Protein"})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-lg font-bold text-blue-400",children:[Math.round(n.carbsG||0),"g"]}),e.jsx("p",{className:"text-xs text-gray-400",children:"Carbs"})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-lg font-bold text-yellow-400",children:[Math.round(n.fatG||0),"g"]}),e.jsx("p",{className:"text-xs text-gray-400",children:"Fat"})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-3 text-center",children:["Per ",n.servingDescription||"1 serving"]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(N,{variant:"ghost",className:"flex-1",onClick:j,children:"Scan Again"}),e.jsx(N,{variant:"primary",className:"flex-1",onClick:g,children:"Add Food"})]})]}),x==="error"&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(z,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("p",{className:"text-white font-medium mb-2",children:"Oops!"}),e.jsx("p",{className:"text-sm text-gray-400 mb-6",children:f}),e.jsxs(N,{variant:"primary",onClick:j,children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Try Again"]})]}),(x==="scanning"||x==="error")&&e.jsxs("p",{className:"text-center text-sm text-gray-500 mt-6",children:["Can't scan? ",e.jsx("button",{onClick:c,className:"text-blue-400 hover:underline",children:"Search manually"})]})]})})]})})}const je=[{id:"breakfast",label:"Breakfast",icon:ie,color:"orange"},{id:"morning_snack",label:"AM Snack",icon:F,color:"yellow"},{id:"lunch",label:"Lunch",icon:fe,color:"blue"},{id:"afternoon_snack",label:"PM Snack",icon:F,color:"green"},{id:"dinner",label:"Dinner",icon:H,color:"purple"},{id:"evening_snack",label:"Eve Snack",icon:F,color:"pink"}];function P({food:t,onSelect:c}){const r=t.name||t.quickEntryName||t.foodName||"Unknown",h=t.brand||t.foodBrand,x=t.calories||t.totalCalories||0;return e.jsxs(v.button,{onClick:()=>c(t),className:"w-full flex items-center gap-3 p-3 rounded-xl bg-white/5 hover:bg-white/10 transition-colors text-left",whileTap:{scale:.98},children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-green-500/20 to-emerald-500/20 flex items-center justify-center",children:e.jsx($,{className:"w-5 h-5 text-green-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-white font-medium truncate",children:r}),h&&e.jsx("p",{className:"text-xs text-gray-400 truncate",children:h})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-white font-semibold",children:x}),e.jsx("p",{className:"text-xs text-gray-400",children:"cal"})]})]})}function ye({servings:t,setServings:c,servingDescription:r}){return e.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-xl bg-white/5",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Servings"}),e.jsx("p",{className:"text-white",children:r||"1 serving"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>c(Math.max(.25,t-.25)),className:"w-10 h-10 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20 transition-colors",children:e.jsx(re,{className:"w-4 h-4 text-white"})}),e.jsx("span",{className:"text-xl font-bold text-white w-12 text-center",children:t}),e.jsx("button",{onClick:()=>c(t+.25),className:"w-10 h-10 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20 transition-colors",children:e.jsx(K,{className:"w-4 h-4 text-white"})})]})]})}function qe(){const t=X(),c=J(),r=W(a=>a.closeQuickLog),h=Z(),x=ee(),[m,u]=s.useState("search"),[i,n]=s.useState(null),[l,f]=s.useState(1),[o,b]=s.useState(c),[d,g]=s.useState(""),[j,p]=s.useState(!1),[y,S]=s.useState(!1),{search:_,searchResults:G}=D(),{logMeal:k}=se(),C=s.useRef(null),M=pe(d,300);s.useEffect(()=>{b(c)},[c]),s.useEffect(()=>{M.length>=2&&_(M)},[M,_]),s.useEffect(()=>{t&&C.current&&C.current.focus()},[t]),s.useEffect(()=>{t||(u("search"),n(null),f(1),g(""))},[t]);const I=s.useCallback(a=>{n(a),f(1),u("confirm")},[]),O=s.useCallback(async()=>{if(i){p(!0);try{await k({mealType:o,foodId:i.id,servings:l,loggedVia:"quick"}),r()}catch{}finally{p(!1)}}},[i,o,l,k,r]),V=s.useCallback(async a=>{p(!0);try{await k({mealType:o,quickEntryName:`Quick entry (${a} cal)`,quickEntryCalories:a,loggedVia:"quick"}),r()}catch{}finally{p(!1)}},[o,k,r]),U=s.useCallback(a=>{n(a),f(1),u("confirm"),S(!1)},[]),B=d.length>=2?G:[...h.slice(0,5),...x.slice(0,5)];return e.jsx(q,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx(v.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:r,className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50"}),e.jsx(v.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:25,stiffness:300},className:"fixed bottom-0 left-0 right-0 z-50 max-h-[90vh] overflow-hidden rounded-t-3xl",children:e.jsxs(T,{depth:"solid-elevated",className:"p-6 pb-safe",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"w-10 h-1 bg-white/20 rounded-full"})}),e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-xl bg-gradient-to-br from-green-500/20 to-emerald-500/20",children:e.jsx($,{className:"w-5 h-5 text-green-400"})}),e.jsx("h2",{className:"text-xl font-bold text-white",children:m==="search"?"Log Food":"Confirm"})]}),e.jsx("button",{onClick:r,className:"p-2 rounded-full hover:bg-white/10 transition-colors",children:e.jsx(A,{className:"w-5 h-5 text-gray-400"})})]}),m==="search"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex gap-2 mb-4 overflow-x-auto pb-2 -mx-2 px-2",children:je.map(a=>e.jsx("button",{onClick:()=>b(a.id),className:`flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium transition-colors ${o===a.id?"bg-green-500 text-white":"bg-white/5 text-gray-300 hover:bg-white/10"}`,children:a.label},a.id))}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(Y,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{ref:C,type:"text",value:d,onChange:a=>g(a.target.value),placeholder:"Search foods...",className:"w-full pl-12 pr-4 py-3 rounded-xl bg-white/5 border border-white/10 text-white placeholder-gray-500 focus:outline-none focus:border-green-500/50"})]}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs("button",{className:"flex-1 flex items-center justify-center gap-2 p-3 rounded-xl bg-white/5 hover:bg-white/10 transition-colors",children:[e.jsx(L,{className:"w-5 h-5 text-green-400"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Photo"})]}),e.jsxs("button",{onClick:()=>S(!0),className:"flex-1 flex items-center justify-center gap-2 p-3 rounded-xl bg-white/5 hover:bg-white/10 transition-colors",children:[e.jsx(ce,{className:"w-5 h-5 text-blue-400"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Scan"})]}),e.jsxs("button",{className:"flex-1 flex items-center justify-center gap-2 p-3 rounded-xl bg-white/5 hover:bg-white/10 transition-colors",children:[e.jsx(xe,{className:"w-5 h-5 text-purple-400"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Voice"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-xs text-gray-400 uppercase tracking-wide mb-2",children:"Quick Add"}),e.jsx("div",{className:"flex gap-2",children:[100,200,300,500].map(a=>e.jsxs("button",{onClick:()=>V(a),disabled:j,className:"flex-1 py-2 rounded-lg bg-white/5 hover:bg-white/10 text-sm text-gray-300 transition-colors",children:[a," cal"]},a))})]}),e.jsxs("div",{className:"max-h-64 overflow-y-auto space-y-2",children:[d.length<2&&e.jsx("p",{className:"text-xs text-gray-400 uppercase tracking-wide mb-2",children:h.length>0?"Recent & Frequent":"No recent foods"}),B.map((a,E)=>e.jsx(P,{food:a,onSelect:I},a.id||E)),d.length>=2&&B.length===0&&e.jsx("p",{className:"text-center text-gray-400 py-8",children:"No foods found. Try a different search."})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6",children:e.jsx(P,{food:i,onSelect:()=>{}})}),e.jsx("div",{className:"mb-6",children:e.jsx(ye,{servings:l,setServings:f,servingDescription:i?.servingDescription})}),e.jsx("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[{label:"Calories",value:Math.round((i?.calories||0)*l),color:"text-white"},{label:"Protein",value:`${Math.round((i?.proteinG||0)*l)}g`,color:"text-green-400"},{label:"Carbs",value:`${Math.round((i?.carbsG||0)*l)}g`,color:"text-blue-400"},{label:"Fat",value:`${Math.round((i?.fatG||0)*l)}g`,color:"text-yellow-400"}].map(a=>e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:`text-xl font-bold ${a.color}`,children:a.value}),e.jsx("p",{className:"text-xs text-gray-400",children:a.label})]},a.label))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(N,{variant:"ghost",className:"flex-1",onClick:()=>u("search"),children:"Back"}),e.jsx(N,{variant:"primary",className:"flex-1",onClick:O,disabled:j,children:j?"Logging...":"Log Food"})]})]})]})}),e.jsx(ge,{isOpen:y,onClose:()=>S(!1),onFoodFound:U})]})})}export{Pe as D,qe as Q,pe as u};
