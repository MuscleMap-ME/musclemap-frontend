import{r as l,j as e,L as I}from"./react-vendor-D1NxaRNd.js";import{G as c}from"./GlassSurface-BMiMerMg.js";import{e as V,H as U,X as L,m as b,bb as D,G as M,ai as O,A as _}from"./index-DQWAB85b.js";import{A as q}from"./arrow-left-Dcq__WnO.js";import{R as G}from"./refresh-cw-DKN_ISid.js";import{T as y}from"./triangle-alert-B_tDVAaX.js";import{F as H}from"./funnel-CifWYgeH.js";import{L as S}from"./loader-circle-DomADKko.js";import{E as A}from"./eye-B-INNpgL.js";import{C as E}from"./circle-check-big-DbeUmwgj.js";import{C as W}from"./circle-x-CzTKxUnZ.js";import{C as J}from"./check-DHU8jYOD.js";import"./leaflet-vendor-DZbo3Ov0.js";import"./recharts-vendor-BziRPEEi.js";import"./d3-vendor-mcDw60ct.js";import"./apollo-vendor-BMQ75Ycx.js";import"./reactflow-vendor-Dz2P_-Qa.js";const X=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],F=V("image",X),B=[{value:"nsfw",label:"NSFW/Inappropriate content"},{value:"wrong_exercise",label:"Wrong exercise shown"},{value:"poor_quality",label:"Poor image quality"},{value:"watermark",label:"Contains watermark/logo"},{value:"screenshot",label:"Screenshot/meme/not a photo"},{value:"duplicate",label:"Duplicate submission"},{value:"other",label:"Other reason"}],he=()=>{const{getAuthHeader:a}=U(),[j,m]=l.useState([]),[s,N]=l.useState(null),[d,i]=l.useState(!0),[h,p]=l.useState(null),[r,R]=l.useState(null),[n,P]=l.useState("pending"),[C,v]=l.useState(null),f=l.useCallback(async()=>{try{i(!0);const t=await fetch("/api/exercise-images/admin/pending",{headers:a()});if(!t.ok)throw new Error("Failed to fetch submissions");const o=await t.json();m(o.submissions||[])}catch(t){v(t instanceof Error?t.message:"Unknown error")}finally{i(!1)}},[a]),g=l.useCallback(async()=>{try{const t=await fetch("/api/exercise-images/admin/stats",{headers:a()});if(!t.ok)throw new Error("Failed to fetch stats");const o=await t.json();N(o)}catch{}},[a]);l.useEffect(()=>{f(),g()},[f,g]);const k=async(t,o,T)=>{try{p(t);const x=await fetch(`/api/exercise-images/admin/review/${t}`,{method:"POST",headers:{"Content-Type":"application/json",...a()},body:JSON.stringify({action:o,reason:T})});if(!x.ok){const w=await x.json();throw new Error(w.error||"Review failed")}m(w=>w.filter($=>$.id!==t)),R(null),g()}catch(x){v(x instanceof Error?x.message:"Review failed")}finally{p(null)}},u=j.filter(t=>n==="all"?!0:t.status===n);return e.jsx("div",{className:"min-h-screen bg-[#0a0a0f] text-white p-4 md:p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(I,{to:"/empire",className:"p-2 rounded-lg bg-white/5 hover:bg-white/10 transition-colors",children:e.jsx(q,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(F,{className:"w-6 h-6 text-violet-400"}),"Exercise Image Review"]}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Review and approve community-submitted exercise images"})]})]}),e.jsxs("button",{onClick:()=>{f(),g()},className:"flex items-center gap-2 px-4 py-2 bg-white/5 hover:bg-white/10 rounded-lg transition-colors",children:[e.jsx(G,{className:`w-4 h-4 ${d?"animate-spin":""}`}),"Refresh"]})]}),s&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-8",children:[e.jsxs(c,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-amber-400",children:s.pending}),e.jsx("div",{className:"text-sm text-gray-400",children:"Pending"})]}),e.jsxs(c,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-emerald-400",children:s.approved}),e.jsx("div",{className:"text-sm text-gray-400",children:"Approved"})]}),e.jsxs(c,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-red-400",children:s.rejected}),e.jsx("div",{className:"text-sm text-gray-400",children:"Rejected"})]}),e.jsxs(c,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-400",children:s.totalToday}),e.jsx("div",{className:"text-sm text-gray-400",children:"Today"})]}),e.jsxs(c,{className:"p-4 text-center",children:[e.jsxs("div",{className:"text-3xl font-bold text-violet-400",children:[s.avgReviewTime,"s"]}),e.jsx("div",{className:"text-sm text-gray-400",children:"Avg Review"})]})]}),e.jsx("div",{className:"flex gap-2 mb-6",children:["pending","approved","rejected","all"].map(t=>e.jsx("button",{onClick:()=>P(t),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${n===t?"bg-violet-500/20 text-violet-400 border border-violet-500/30":"bg-white/5 text-gray-400 hover:bg-white/10"}`,children:t.charAt(0).toUpperCase()+t.slice(1)},t))}),C&&e.jsxs("div",{className:"mb-6 p-4 bg-red-500/10 border border-red-500/30 rounded-lg flex items-center gap-3",children:[e.jsx(y,{className:"w-5 h-5 text-red-400"}),e.jsx("span",{className:"text-red-400",children:C}),e.jsx("button",{onClick:()=>v(null),className:"ml-auto",children:e.jsx(L,{className:"w-4 h-4 text-red-400"})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(c,{className:"p-4",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5 text-gray-400"}),"Submissions (",u.length,")"]}),d?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(S,{className:"w-8 h-8 animate-spin text-violet-400"})}):u.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-400",children:[e.jsx(F,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsxs("p",{children:["No ",n==="all"?"":n," submissions"]})]}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:u.map(t=>e.jsxs(b.button,{onClick:()=>R(t),className:`relative rounded-lg overflow-hidden border-2 transition-all ${r?.id===t.id?"border-violet-500":"border-transparent hover:border-white/20"}`,whileHover:{scale:1.02},whileTap:{scale:.98},children:[e.jsx("img",{src:t.thumbnailUrl,alt:t.exerciseName,className:"w-full aspect-square object-cover"}),e.jsx("div",{className:`absolute top-2 right-2 px-2 py-0.5 rounded text-xs font-medium ${t.status==="pending"?"bg-amber-500/80 text-white":t.status==="approved"?"bg-emerald-500/80 text-white":"bg-red-500/80 text-white"}`,children:t.status}),!t.aiValidationPassed&&e.jsx("div",{className:"absolute top-2 left-2 p-1 rounded bg-red-500/80",children:e.jsx(y,{className:"w-3 h-3 text-white"})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-2 bg-gradient-to-t from-black/80 to-transparent",children:e.jsx("p",{className:"text-xs text-white truncate",children:t.exerciseName})})]},t.id))})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(c,{className:"p-4 sticky top-4",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5 text-gray-400"}),"Review Panel"]}),r?e.jsx(z,{submission:r,onApprove:()=>k(r.id,"approve"),onReject:t=>k(r.id,"reject",t),isReviewing:h===r.id}):e.jsxs("div",{className:"text-center py-12 text-gray-400",children:[e.jsx(A,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Select a submission to review"})]})]})})]})]})})},z=({submission:a,onApprove:j,onReject:m,isReviewing:s})=>{const[N,d]=l.useState(!1),[i,h]=l.useState(""),p=()=>{i&&(m(i),d(!1),h(""))};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"rounded-lg overflow-hidden",children:e.jsx("img",{src:a.processedUrl||a.thumbnailUrl,alt:a.exerciseName,className:"w-full aspect-video object-contain bg-black/50"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white",children:a.exerciseName}),e.jsxs("p",{className:"text-sm text-gray-400",children:["Exercise ID: ",a.exerciseId]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx(D,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-300",children:a.username}),e.jsx(M,{className:"w-4 h-4 text-gray-400 ml-2"}),e.jsx("span",{className:"text-gray-400",children:new Date(a.createdAt).toLocaleDateString()})]}),e.jsxs("div",{className:"p-3 bg-white/5 rounded-lg space-y-2",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-300 flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4"}),"AI Validation"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400",children:"NSFW Score"}),e.jsxs("div",{className:`font-mono text-lg ${a.nsfwScore>.3?"text-red-400":a.nsfwScore>.15?"text-amber-400":"text-emerald-400"}`,children:[(a.nsfwScore*100).toFixed(1),"%"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400",children:"Exercise Match"}),e.jsxs("div",{className:`font-mono text-lg ${a.exerciseMatchScore>.7?"text-emerald-400":a.exerciseMatchScore>.4?"text-amber-400":"text-red-400"}`,children:[(a.exerciseMatchScore*100).toFixed(0),"%"]})]})]}),a.aiValidationNotes&&e.jsx("div",{className:"mt-2 text-xs text-gray-400 border-t border-white/10 pt-2",children:a.aiValidationNotes}),e.jsx("div",{className:`flex items-center gap-2 text-sm ${a.aiValidationPassed?"text-emerald-400":"text-amber-400"}`,children:a.aiValidationPassed?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-4 h-4"}),"AI Validation Passed"]}):e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"w-4 h-4"}),"Requires Manual Review"]})})]}),a.status!=="pending"&&e.jsxs("div",{className:`p-3 rounded-lg ${a.status==="approved"?"bg-emerald-500/10 border border-emerald-500/30":"bg-red-500/10 border border-red-500/30"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[a.status==="approved"?e.jsx(E,{className:"w-4 h-4 text-emerald-400"}):e.jsx(W,{className:"w-4 h-4 text-red-400"}),e.jsx("span",{className:a.status==="approved"?"text-emerald-400":"text-red-400",children:a.status==="approved"?"Approved":"Rejected"})]}),a.rejectionReason&&e.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:["Reason: ",a.rejectionReason]}),a.reviewedAt&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:new Date(a.reviewedAt).toLocaleString()})]}),a.status==="pending"&&e.jsx(_,{mode:"wait",children:N?e.jsxs(b.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"space-y-3",children:[e.jsxs("select",{value:i,onChange:r=>h(r.target.value),className:"w-full p-2 bg-white/5 border border-white/10 rounded-lg text-white text-sm",children:[e.jsx("option",{value:"",children:"Select rejection reason..."}),B.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>d(!1),className:"flex-1 py-2 px-4 bg-white/5 hover:bg-white/10 rounded-lg text-gray-300 text-sm transition-colors",children:"Cancel"}),e.jsx("button",{onClick:p,disabled:!i||s,className:"flex-1 py-2 px-4 bg-red-500/20 hover:bg-red-500/30 rounded-lg text-red-400 text-sm transition-colors disabled:opacity-50",children:s?e.jsx(S,{className:"w-4 h-4 animate-spin mx-auto"}):"Confirm Reject"})]})]}):e.jsxs(b.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex gap-3",children:[e.jsx("button",{onClick:j,disabled:s,className:"flex-1 py-3 px-4 bg-emerald-500/20 hover:bg-emerald-500/30 border border-emerald-500/30 rounded-lg text-emerald-400 font-medium transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:s?e.jsx(S,{className:"w-4 h-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"w-4 h-4"}),"Approve"]})}),e.jsxs("button",{onClick:()=>d(!0),disabled:s,className:"flex-1 py-3 px-4 bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 rounded-lg text-red-400 font-medium transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:[e.jsx(L,{className:"w-4 h-4"}),"Reject"]})]})})]})};export{he as default};
