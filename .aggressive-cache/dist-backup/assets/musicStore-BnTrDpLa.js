import{V as h,Y as g,$ as p,a0 as D}from"./index-CaUYL1Th.js";const u={coaching:{maxCoachVisible:!0,mascotVisible:!0,coachTipsEnabled:!0,motivationalQuotes:!0,formCuesEnabled:!0,voiceGuidanceEnabled:!1},guidanceLevel:"intermediate",dashboard:{layout:"default",showQuickActions:!0,showDailyTip:!0,showMilestones:!0,showAdventureMap:!0,showMuscleMap:!0,showNutrition:!0,showChallenges:!0,showInsights:!0,showActivity:!0,showHydration:!0,showMusicPlayer:!0,showCoachTips:!0,showXpProgress:!0,showDailyQuests:!0},notifications:{achievementsEnabled:!0,goalSuccessEnabled:!0,workoutReminders:!0,socialNotifications:!0,systemAnnouncements:!0,quietHoursEnabled:!1,quietHoursStart:"22:00",quietHoursEnd:"07:00",pushEnabled:!0,emailEnabled:!0},hydration:{enabled:!0,intervalMinutes:15,soundEnabled:!0,vibrationEnabled:!0,showDuringWorkout:!0,showOutsideWorkout:!1,dailyGoalOz:64},sounds:{masterVolume:.7,timerSoundEnabled:!0,timerSoundType:"beep",timerVibrationEnabled:!0,metronomeEnabled:!1,metronomeBpm:60,metronomeAccent:4,repCountSoundEnabled:!1,setCompleteSoundEnabled:!0,workoutCompleteSoundEnabled:!0,achievementSoundEnabled:!0,customSoundPackId:null,systemSoundPackId:"default"},workout:{defaultRestSeconds:90,autoStartTimer:!0,showFloatingTimer:!0,countdownWarningSeconds:10,warmupReminder:!0,cooldownReminder:!0,stretchReminder:!1,quickAdjustAmount:30},display:{theme:"dark",reducedMotion:!1,highContrast:!1,textSize:"normal",colorBlindMode:"none",animationsEnabled:!0},units:{weight:"lbs",distance:"mi",height:"ft_in",temperature:"f"},privacy:{publicProfile:!0,showLocation:!1,showProgress:!0,showWorkoutDetails:!0,showOnLeaderboards:!0,showAchievementsOnProfile:!0},music:{autoPlayOnWorkout:!0,bpmMatchingEnabled:!1,defaultProvider:null,defaultPlaylistId:null,fadeOnRest:!0,volumeReductionOnTips:!0,tipVolumeReduction:.5}};function P(a){return{coaching:{...u.coaching,...a.coaching},guidanceLevel:a.guidanceLevel??u.guidanceLevel,dashboard:{...u.dashboard,...a.dashboard},notifications:{...u.notifications,...a.notifications},hydration:{...u.hydration,...a.hydration},sounds:{...u.sounds,...a.sounds},workout:{...u.workout,...a.workout},display:{...u.display,...a.display},units:{...u.units,...a.units},privacy:{...u.privacy,...a.privacy},music:{...u.music,...a.music}}}function L(a,n){return{coaching:{...a.coaching,...n.coaching},guidanceLevel:n.guidanceLevel??a.guidanceLevel,dashboard:{...a.dashboard,...n.dashboard},notifications:{...a.notifications,...n.notifications},hydration:{...a.hydration,...n.hydration},sounds:{...a.sounds,...n.sounds},workout:{...a.workout,...n.workout},display:{...a.display,...n.display},units:{...a.units,...n.units},privacy:{...a.privacy,...n.privacy},music:{...a.music,...n.music}}}const $={BUG_REPORT:"bug_report",FEATURE_REQUEST:"feature_request",QUESTION:"question",GENERAL:"general"},z={bug_report:"Report a Bug",feature_request:"Suggest a Feature",question:"Ask a Question",general:"General Feedback"},H={bug_report:"Something isn't working right? Let us know.",feature_request:"Have an idea to make MuscleMap better?",question:"Need help or have a question?",general:"Share your thoughts with us."},B=[{value:"low",label:"Low",description:"Minor issue, workaround exists"},{value:"medium",label:"Medium",description:"Noticeable issue, affects experience"},{value:"high",label:"High",description:"Significant issue, blocks workflow"},{value:"critical",label:"Critical",description:"App is unusable or data is lost"}],c=h(g(p((a,n)=>({isOpen:!1,feedbackType:null,step:"select",openFeedbackModal:(e=null)=>a({isOpen:!0,feedbackType:e,step:e?"form":"select",formData:{...n().initialFormData},submitting:!1,error:null}),closeFeedbackModal:()=>a({isOpen:!1,feedbackType:null,step:"select",formData:{...n().initialFormData},submitting:!1,error:null}),setFeedbackType:e=>a({feedbackType:e,step:"form"}),setStep:e=>a({step:e}),initialFormData:{title:"",description:"",priority:"medium",stepsToReproduce:"",expectedBehavior:"",actualBehavior:"",category:"",attachments:[]},formData:{title:"",description:"",priority:"medium",stepsToReproduce:"",expectedBehavior:"",actualBehavior:"",category:"",attachments:[]},updateFormData:(e,t)=>a(r=>({formData:{...r.formData,[e]:t}})),resetFormData:()=>a(e=>({formData:{...e.initialFormData}})),submitting:!1,error:null,lastSubmittedId:null,setSubmitting:e=>a({submitting:e}),setError:e=>a({error:e}),setSubmissionSuccess:e=>a({submitting:!1,error:null,lastSubmittedId:e,step:"success"}),faqCategories:[],faqEntries:{},faqLoading:!1,faqSearchQuery:"",faqSearchResults:null,expandedFaqId:null,setFaqCategories:e=>a({faqCategories:e}),setFaqEntries:e=>a({faqEntries:e}),setFaqLoading:e=>a({faqLoading:e}),setFaqSearchQuery:e=>a({faqSearchQuery:e}),setFaqSearchResults:e=>a({faqSearchResults:e}),setExpandedFaqId:e=>a(t=>({expandedFaqId:t.expandedFaqId===e?null:e})),popularFeatures:[],popularFeaturesLoading:!1,userVotes:new Set,setPopularFeatures:e=>a({popularFeatures:e}),setPopularFeaturesLoading:e=>a({popularFeaturesLoading:e}),addUserVote:e=>a(t=>{const r=new Set(t.userVotes);return r.add(e),{userVotes:r}}),removeUserVote:e=>a(t=>{const r=new Set(t.userVotes);return r.delete(e),{userVotes:r}}),hasVoted:e=>n().userVotes.has(e),myFeedback:[],myFeedbackLoading:!1,myFeedbackCursor:null,myFeedbackHasMore:!0,setMyFeedback:(e,t=!1)=>a(r=>({myFeedback:t?[...r.myFeedback,...e]:e})),setMyFeedbackLoading:e=>a({myFeedbackLoading:e}),setMyFeedbackCursor:e=>a({myFeedbackCursor:e}),setMyFeedbackHasMore:e=>a({myFeedbackHasMore:e}),getDeviceInfo:()=>typeof window>"u"?{}:{userAgent:navigator.userAgent,screenSize:`${window.innerWidth}x${window.innerHeight}`,platform:navigator.platform,appVersion:"1.0.0"}}),{name:"musclemap-feedback",partialize:a=>({userVotes:Array.from(a.userVotes),faqCategories:a.faqCategories}),onRehydrateStorage:()=>a=>{a&&a.userVotes&&(a.userVotes=new Set(a.userVotes))}}))),j=()=>{const a=c(s=>s.isOpen),n=c(s=>s.feedbackType),e=c(s=>s.step),t=c(s=>s.openFeedbackModal),r=c(s=>s.closeFeedbackModal),i=c(s=>s.setFeedbackType),o=c(s=>s.setStep);return{isOpen:a,feedbackType:n,step:e,openFeedbackModal:t,closeFeedbackModal:r,setFeedbackType:i,setStep:o}},Q=()=>{const a=c(o=>o.formData),n=c(o=>o.updateFormData),e=c(o=>o.resetFormData),t=c(o=>o.submitting),r=c(o=>o.error),i=c(o=>o.getDeviceInfo);return{formData:a,updateFormData:n,resetFormData:e,submitting:t,error:r,getDeviceInfo:i}},Y=()=>{const a=c(l=>l.faqCategories),n=c(l=>l.faqEntries),e=c(l=>l.faqLoading),t=c(l=>l.faqSearchQuery),r=c(l=>l.faqSearchResults),i=c(l=>l.expandedFaqId),o=c(l=>l.setFaqSearchQuery),s=c(l=>l.setExpandedFaqId);return{categories:a,entries:n,loading:e,searchQuery:t,searchResults:r,expandedId:i,setSearchQuery:o,toggleExpanded:s}},f={IDLE:"idle",SYNCING:"syncing",SUCCESS:"success",ERROR:"error",CONFLICT:"conflict"},F={CLIENT_WINS:"client_wins",SERVER_WINS:"server_wins",MERGE:"merge",MANUAL:"manual"},m={WORKOUT:"workout",SET:"set",UNKNOWN:"unknown"};function w(a,n={}){return navigator.serviceWorker?.controller?new Promise(e=>{const t=new MessageChannel;t.port1.onmessage=r=>{e(r.data)},navigator.serviceWorker.controller.postMessage({type:a,payload:n},[t.port2]),setTimeout(()=>e(null),5e3)}):Promise.resolve(null)}async function x(){return w("GET_SYNC_STATUS")}async function O(){return w("GET_QUEUE_STATUS")}async function M(){return w("FORCE_SYNC")}async function A(a,n){return w("RESOLVE_CONFLICT",{id:a,resolution:n})}async function _(a){return w("CACHE_EXERCISES",{exercises:a})}async function W(){return w("GET_CACHED_EXERCISES")}h(g(p((a,n)=>({isOnline:typeof navigator<"u"?navigator.onLine:!0,lastOnlineAt:null,lastOfflineAt:null,offlineDuration:0,syncStatus:f.IDLE,lastSyncAttempt:null,lastSuccessfulSync:null,syncError:null,syncProgress:0,pendingCount:0,pendingWorkouts:0,pendingSets:0,pendingOther:0,failedCount:0,conflictCount:0,conflicts:[],defaultResolutionStrategy:F.SERVER_WINS,exerciseCacheCount:0,lastExerciseCacheUpdate:null,exerciseCacheExpiry:30*24*60*60*1e3,queueDetails:[],setOnline:()=>{const e=Date.now(),t=n().lastOfflineAt,r=t?e-t:0;a({isOnline:!0,lastOnlineAt:e,offlineDuration:r}),n().refreshSyncStatus(),n().triggerSync()},setOffline:()=>{a({isOnline:!1,lastOfflineAt:Date.now()})},setSyncStatus:e=>a({syncStatus:e}),setSyncProgress:e=>a({syncProgress:e}),setSyncError:e=>a({syncStatus:f.ERROR,syncError:e}),clearSyncError:()=>a({syncError:null,syncStatus:f.IDLE}),refreshSyncStatus:async()=>{try{const e=await x();e&&a({pendingCount:e.pending||0,failedCount:e.failed||0,conflictCount:e.conflicts||0,lastSyncAttempt:e.lastAttempt,lastSuccessfulSync:e.lastSuccess});const t=await O();t&&a({pendingCount:t.count||0,conflictCount:t.conflictCount||0,queueDetails:t.syncQueue||[],conflicts:t.conflicts||[]})}catch{}},triggerSync:async()=>{if(!n().isOnline)return!1;a({syncStatus:f.SYNCING,syncProgress:0});try{return await M(),a({syncStatus:f.SUCCESS,lastSuccessfulSync:Date.now(),syncProgress:100}),await n().refreshSyncStatus(),!0}catch(e){return a({syncStatus:f.ERROR,syncError:e.message||"Sync failed"}),!1}},incrementPending:(e=m.UNKNOWN)=>{const t={pendingCount:n().pendingCount+1};e===m.WORKOUT?t.pendingWorkouts=n().pendingWorkouts+1:e===m.SET?t.pendingSets=n().pendingSets+1:t.pendingOther=n().pendingOther+1,a(t)},decrementPending:(e=m.UNKNOWN)=>{const t={pendingCount:Math.max(0,n().pendingCount-1)};e===m.WORKOUT?t.pendingWorkouts=Math.max(0,n().pendingWorkouts-1):e===m.SET?t.pendingSets=Math.max(0,n().pendingSets-1):t.pendingOther=Math.max(0,n().pendingOther-1),a(t)},clearPending:()=>a({pendingCount:0,pendingWorkouts:0,pendingSets:0,pendingOther:0,failedCount:0,queueDetails:[]}),setConflicts:e=>a({conflicts:e,conflictCount:e.length}),addConflict:e=>{const t=[...n().conflicts,e];a({conflicts:t,conflictCount:t.length,syncStatus:f.CONFLICT})},resolveConflict:async(e,t)=>{try{await A(e,t);const r=n().conflicts.filter(i=>i.id!==e);return a({conflicts:r,conflictCount:r.length,syncStatus:r.length===0?f.IDLE:f.CONFLICT}),t!==F.MANUAL&&await n().triggerSync(),!0}catch{return!1}},resolveAllConflicts:async()=>{const{conflicts:e,defaultResolutionStrategy:t}=n();for(const r of e)await n().resolveConflict(r.id,t)},setDefaultResolutionStrategy:e=>a({defaultResolutionStrategy:e}),cacheExercises:async e=>{try{const t=await _(e);return t?.count&&a({exerciseCacheCount:t.count,lastExerciseCacheUpdate:Date.now()}),t?.count||0}catch{return 0}},refreshExerciseCacheStatus:async()=>{try{const e=await W();e?.count!==void 0&&a({exerciseCacheCount:e.count})}catch{}},isExerciseCacheStale:()=>{const{lastExerciseCacheUpdate:e,exerciseCacheExpiry:t}=n();return e?Date.now()-e>t:!0},initialize:()=>{a({isOnline:navigator.onLine}),window.addEventListener("online",()=>n().setOnline()),window.addEventListener("offline",()=>n().setOffline()),navigator.serviceWorker&&navigator.serviceWorker.addEventListener("message",e=>{const{type:t,...r}=e.data||{};switch(t){case"SYNC_SUCCESS":n().decrementPending(r.operation);break;case"SYNC_FAILED":a({failedCount:n().failedCount+1});break;case"SYNC_CONFLICT":n().addConflict({id:Date.now(),operation:r.operation,resourceId:r.resourceId,createdAt:Date.now()});break;case"QUEUE_STATUS":a({pendingCount:r.count||0,conflictCount:r.conflictCount||0,queueDetails:r.syncQueue||[],conflicts:r.conflicts||[]});break;case"SYNC_STATUS":a({pendingCount:r.pending||0,failedCount:r.failed||0,conflictCount:r.conflicts||0,lastSyncAttempt:r.lastAttempt,lastSuccessfulSync:r.lastSuccess});break;case"EXERCISES_CACHED":a({exerciseCacheCount:r.count||0,lastExerciseCacheUpdate:Date.now()});break}}),n().refreshSyncStatus(),n().refreshExerciseCacheStatus()}}),{name:"musclemap-offline",partialize:a=>({defaultResolutionStrategy:a.defaultResolutionStrategy,exerciseCacheExpiry:a.exerciseCacheExpiry})})));async function d(a,n,e){const t=localStorage.getItem("musclemap_token"),r={"Content-Type":"application/json"};t&&(r.Authorization=`Bearer ${t}`);const i=await fetch(`/api${n}`,{method:a,headers:r,body:e?JSON.stringify(e):void 0});if(!i.ok){const o=await i.json().catch(()=>({}));throw new Error(o.error?.message||"Request failed")}return i.json()}const q={loginStatus:null,loginCalendar:[],streaks:[],totalCurrentDays:0,totalLongestDays:0,dailyChallenges:[],weeklyChallenge:null,activeEvents:[],upcomingEvents:[],currentMultipliers:{credits:1,xp:1,challenges:1},recoveryScore:null,restDayActivities:[],loading:{login:!1,streaks:!1,challenges:!1,events:!1,recovery:!1},error:null,showDailyRewardModal:!1,showStreakAtRiskModal:!1,lastClaimedReward:null};h()(p((a,n)=>({...q,fetchLoginStatus:async()=>{a(e=>({loading:{...e.loading,login:!0},error:null}));try{const e=await d("GET","/daily-login/status");a({loginStatus:e,showStreakAtRiskModal:e.streakAtRisk&&e.streakFreezesOwned>0,loading:{...n().loading,login:!1}})}catch(e){a({error:e instanceof Error?e.message:"Failed to fetch login status",loading:{...n().loading,login:!1}})}},claimDailyReward:async(e=!1)=>{a(t=>({loading:{...t.loading,login:!0},error:null}));try{const t=await d("POST","/daily-login/claim",{useFreeze:e});a({lastClaimedReward:t,showDailyRewardModal:!0,loading:{...n().loading,login:!1}}),await n().fetchLoginStatus()}catch(t){a({error:t instanceof Error?t.message:"Failed to claim reward",loading:{...n().loading,login:!1}})}},purchaseStreakFreeze:async()=>{a(e=>({loading:{...e.loading,login:!0},error:null}));try{await d("POST","/daily-login/purchase-freeze"),await n().fetchLoginStatus()}catch(e){a({error:e instanceof Error?e.message:"Failed to purchase freeze",loading:{...n().loading,login:!1}})}},fetchLoginCalendar:async(e=30)=>{try{const t=await d("GET",`/daily-login/calendar?days=${e}`);a({loginCalendar:t})}catch{}},fetchAllStreaks:async()=>{a(e=>({loading:{...e.loading,streaks:!0},error:null}));try{const e=await d("GET","/streaks");a({streaks:e.streaks,totalCurrentDays:e.totalCurrentDays,totalLongestDays:e.totalLongestDays,loading:{...n().loading,streaks:!1}})}catch(e){a({error:e instanceof Error?e.message:"Failed to fetch streaks",loading:{...n().loading,streaks:!1}})}},fetchStreak:async e=>{try{return await d("GET",`/streaks/${e}`)}catch{return null}},claimStreakMilestone:async(e,t)=>{try{await d("POST",`/streaks/${e}/claim`,{milestoneDays:t}),await n().fetchAllStreaks()}catch(r){a({error:r instanceof Error?r.message:"Failed to claim milestone"})}},fetchDailyChallenges:async()=>{a(e=>({loading:{...e.loading,challenges:!0},error:null}));try{const e=await d("GET","/challenges/daily");a({dailyChallenges:e,loading:{...n().loading,challenges:!1}})}catch(e){a({error:e instanceof Error?e.message:"Failed to fetch challenges",loading:{...n().loading,challenges:!1}})}},claimChallengeReward:async e=>{try{await d("POST",`/challenges/daily/claim/${e}`),await n().fetchDailyChallenges()}catch(t){a({error:t instanceof Error?t.message:"Failed to claim challenge"})}},fetchWeeklyChallenge:async()=>{try{const e=await d("GET","/challenges/weekly");a({weeklyChallenge:e})}catch{}},claimWeeklyChallengeReward:async()=>{try{await d("POST","/challenges/weekly/claim"),await n().fetchWeeklyChallenge()}catch(e){a({error:e instanceof Error?e.message:"Failed to claim weekly challenge"})}},fetchActiveEvents:async()=>{a(e=>({loading:{...e.loading,events:!0},error:null}));try{const e=await d("GET","/events/active");a({activeEvents:e,loading:{...n().loading,events:!1}})}catch(e){a({error:e instanceof Error?e.message:"Failed to fetch events",loading:{...n().loading,events:!1}})}},fetchUpcomingEvents:async()=>{try{const e=await d("GET","/events/upcoming");a({upcomingEvents:e})}catch{}},joinEvent:async e=>{try{await d("POST",`/events/${e}/join`),await n().fetchActiveEvents()}catch(t){a({error:t instanceof Error?t.message:"Failed to join event"})}},fetchMultipliers:async()=>{try{const e=await d("GET","/events/multipliers");a({currentMultipliers:e})}catch{}},fetchRecoveryScore:async()=>{a(e=>({loading:{...e.loading,recovery:!0},error:null}));try{const e=await d("GET","/engagement/recovery/today");a({recoveryScore:e,loading:{...n().loading,recovery:!1}})}catch(e){a({error:e instanceof Error?e.message:"Failed to fetch recovery score",loading:{...n().loading,recovery:!1}})}},logRestDayActivity:async(e,t={})=>{try{await d("POST","/engagement/recovery/log-activity",{activityType:e,metadata:t}),await n().fetchRestDayActivities(),await n().fetchRecoveryScore()}catch(r){a({error:r instanceof Error?r.message:"Failed to log activity"})}},fetchRestDayActivities:async()=>{try{const e=await d("GET","/engagement/recovery/activities");a({restDayActivities:e})}catch{}},setShowDailyRewardModal:e=>a({showDailyRewardModal:e}),setShowStreakAtRiskModal:e=>a({showStreakAtRiskModal:e}),clearLastClaimedReward:()=>a({lastClaimedReward:null}),clearError:()=>a({error:null}),initializeEngagement:async()=>{const e=n();await Promise.all([e.fetchLoginStatus(),e.fetchAllStreaks(),e.fetchDailyChallenges(),e.fetchWeeklyChallenge(),e.fetchActiveEvents(),e.fetchMultipliers(),e.fetchRecoveryScore()])}}),{name:"musclemap-engagement",storage:D(()=>localStorage),partialize:a=>({loginCalendar:a.loginCalendar,currentMultipliers:a.currentMultipliers})}));const T=()=>localStorage.getItem("musclemap_token");async function y(a,n={}){const e=T(),t={"Content-Type":"application/json",...n.headers||{}};return e&&(t.Authorization=`Bearer ${e}`),fetch(a,{...n,headers:t})}h()(g(p((a,n)=>({preferences:u,activeProfileId:null,profiles:[],version:0,isLoading:!1,isSaving:!1,error:null,lastSyncAt:null,deviceId:null,loadPreferences:async()=>{if(!T()){a({isLoading:!1});return}a({isLoading:!0,error:null});try{const t=await y("/api/me/preferences");if(!t.ok)throw new Error("Failed to load preferences");const r=await t.json();if(r.success&&r.data){const i=P(r.data.preferences||{});a({preferences:i,activeProfileId:r.data.activeProfileId||null,version:r.data.version||1,isLoading:!1,lastSyncAt:new Date().toISOString()})}}catch(t){a({error:t instanceof Error?t.message:"Failed to load preferences",isLoading:!1})}},updatePreferences:async e=>{a({isSaving:!0,error:null});const t=n().preferences,r={coaching:{...t.coaching,...e.coaching},guidanceLevel:e.guidanceLevel??t.guidanceLevel,dashboard:{...t.dashboard,...e.dashboard},notifications:{...t.notifications,...e.notifications},hydration:{...t.hydration,...e.hydration},sounds:{...t.sounds,...e.sounds},workout:{...t.workout,...e.workout},display:{...t.display,...e.display},units:{...t.units,...e.units},privacy:{...t.privacy,...e.privacy},music:{...t.music,...e.music}};a({preferences:r});try{const i=await y("/api/me/preferences",{method:"PATCH",body:JSON.stringify(e)});if(!i.ok)throw new Error("Failed to save preferences");const o=await i.json();o.success&&o.data&&a({preferences:P(o.data.preferences),version:o.data.version,isSaving:!1})}catch(i){a({preferences:t,error:i instanceof Error?i.message:"Failed to save preferences",isSaving:!1})}},resetPreferences:async()=>{a({isSaving:!0,error:null});try{if(!(await y("/api/me/preferences/reset",{method:"PUT"})).ok)throw new Error("Failed to reset preferences");a({preferences:u,isSaving:!1})}catch(e){a({error:e instanceof Error?e.message:"Failed to reset preferences",isSaving:!1})}},loadProfiles:async()=>{try{const e=await y("/api/me/preferences/profiles");if(!e.ok)throw new Error("Failed to load profiles");const t=await e.json();t.success&&t.data&&a({profiles:t.data.profiles||[]})}catch(e){a({error:e instanceof Error?e.message:"Failed to load profiles"})}},createProfile:async(e,t,r)=>{try{const i=await y("/api/me/preferences/profiles",{method:"POST",body:JSON.stringify({name:e,description:t,preferencesOverride:r})});if(!i.ok)throw new Error("Failed to create profile");const o=await i.json();return o.success&&o.data?.profile?(a(s=>({profiles:[...s.profiles,o.data.profile]})),o.data.profile):null}catch(i){return a({error:i instanceof Error?i.message:"Failed to create profile"}),null}},updateProfile:async(e,t)=>{try{const r=await y(`/api/me/preferences/profiles/${e}`,{method:"PATCH",body:JSON.stringify(t)});if(!r.ok)throw new Error("Failed to update profile");const i=await r.json();i.success&&i.data?.profile&&a(o=>({profiles:o.profiles.map(s=>s.id===e?i.data.profile:s)}))}catch(r){a({error:r instanceof Error?r.message:"Failed to update profile"})}},deleteProfile:async e=>{try{if(!(await y(`/api/me/preferences/profiles/${e}`,{method:"DELETE"})).ok)throw new Error("Failed to delete profile");a(r=>({profiles:r.profiles.filter(i=>i.id!==e),activeProfileId:r.activeProfileId===e?null:r.activeProfileId}))}catch(t){a({error:t instanceof Error?t.message:"Failed to delete profile"})}},activateProfile:async e=>{try{if(!(await y(`/api/me/preferences/profiles/${e}/activate`,{method:"POST"})).ok)throw new Error("Failed to activate profile");a({activeProfileId:e})}catch(t){a({error:t instanceof Error?t.message:"Failed to activate profile"})}},deactivateProfile:async()=>{try{if(!(await y("/api/me/preferences/profiles/deactivate",{method:"POST"})).ok)throw new Error("Failed to deactivate profile");a({activeProfileId:null})}catch(e){a({error:e instanceof Error?e.message:"Failed to deactivate profile"})}},getEffectivePreferences:()=>{const{preferences:e,activeProfileId:t,profiles:r}=n();if(!t)return e;const i=r.find(o=>o.id===t);return i?L(e,i.preferencesOverride):e},setGuidanceLevel:async e=>{await n().updatePreferences({guidanceLevel:e})},toggleMaxCoach:async()=>{const e=n().preferences.coaching.maxCoachVisible;await n().updatePreferences({coaching:{...n().preferences.coaching,maxCoachVisible:!e}})},toggleMascot:async()=>{const e=n().preferences.coaching.mascotVisible;await n().updatePreferences({coaching:{...n().preferences.coaching,mascotVisible:!e}})},toggleMetronome:async()=>{const e=n().preferences.sounds.metronomeEnabled;await n().updatePreferences({sounds:{...n().preferences.sounds,metronomeEnabled:!e}})},setMetronomeBpm:async e=>{await n().updatePreferences({sounds:{...n().preferences.sounds,metronomeBpm:e}})},toggleHydrationReminders:async()=>{const e=n().preferences.hydration.enabled;await n().updatePreferences({hydration:{...n().preferences.hydration,enabled:!e}})},setHydrationInterval:async e=>{await n().updatePreferences({hydration:{...n().preferences.hydration,intervalMinutes:e}})},_setPreferences:e=>{a(t=>({preferences:{...t.preferences,...e}}))},_setProfiles:e=>a({profiles:e}),_setLoading:e=>a({isLoading:e}),_setError:e=>a({error:e})}),{name:"musclemap-preferences",partialize:a=>({preferences:a.preferences,activeProfileId:a.activeProfileId,profiles:a.profiles,version:a.version,lastSyncAt:a.lastSyncAt,deviceId:a.deviceId})})));const S=[{id:"current_path",type:"current_path",x:0,y:0,w:2,h:1,visible:!0,settings:{}},{id:"stats",type:"stats",x:2,y:0,w:1,h:2,visible:!0,settings:{}},{id:"quick_actions",type:"quick_actions",x:0,y:1,w:3,h:1,visible:!0,settings:{}},{id:"xp_progress",type:"xp_progress",x:0,y:2,w:1,h:1,visible:!0,settings:{}},{id:"daily_quests",type:"daily_quests",x:1,y:2,w:1,h:1,visible:!0,settings:{}},{id:"insights",type:"insights",x:0,y:3,w:3,h:1,visible:!0,settings:{}},{id:"daily_challenges",type:"daily_challenges",x:0,y:4,w:2,h:1,visible:!0,settings:{}},{id:"todays_workout",type:"todays_workout",x:0,y:5,w:1,h:1,visible:!0,settings:{}},{id:"weekly_progress",type:"weekly_progress",x:1,y:5,w:1,h:1,visible:!0,settings:{}},{id:"nutrition",type:"nutrition",x:0,y:6,w:2,h:1,visible:!0,settings:{}},{id:"muscle_map",type:"muscle_map",x:0,y:7,w:2,h:2,visible:!0,settings:{}},{id:"daily_tip",type:"daily_tip",x:0,y:9,w:2,h:1,visible:!0,settings:{}},{id:"milestones",type:"milestones",x:0,y:10,w:2,h:1,visible:!0,settings:{}},{id:"adventure_map",type:"adventure_map",x:0,y:11,w:2,h:2,visible:!0,settings:{}},{id:"activity",type:"activity",x:0,y:13,w:2,h:2,visible:!0,settings:{}},{id:"hydration",type:"hydration",x:2,y:2,w:1,h:1,visible:!0,settings:{}},{id:"music_player",type:"music_player",x:2,y:3,w:1,h:1,visible:!1,settings:{}},{id:"coach_tips",type:"coach_tips",x:2,y:4,w:1,h:1,visible:!0,settings:{}}],b=()=>localStorage.getItem("musclemap_token");async function k(a,n={}){const e=b(),t={"Content-Type":"application/json",...n.headers||{}};return e&&(t.Authorization=`Bearer ${e}`),fetch(a,{...n,headers:t})}h()(g(p((a,n)=>({widgets:S,columns:12,rowHeight:100,platform:"web",isEditMode:!1,availableWidgets:[],isLoading:!1,isSaving:!1,error:null,loadLayout:async()=>{if(b()){a({isLoading:!0,error:null});try{const t=await k("/api/me/dashboard/layout?platform=web");if(!t.ok)throw new Error("Failed to load layout");const r=await t.json();r.success&&r.data?.layout?a({widgets:r.data.layout.widgets||S,columns:r.data.layout.columns||12,rowHeight:r.data.layout.rowHeight||100,isLoading:!1}):a({widgets:S,isLoading:!1})}catch{a({error:"Failed to load layout",isLoading:!1})}}},saveLayout:async()=>{if(!b())return;const{widgets:t,columns:r,rowHeight:i}=n();a({isSaving:!0,error:null});try{if(!(await k("/api/me/dashboard/layout?platform=web",{method:"PUT",body:JSON.stringify({widgets:t,columns:r,rowHeight:i})})).ok)throw new Error("Failed to save layout");a({isSaving:!1})}catch{a({error:"Failed to save layout",isSaving:!1})}},loadAvailableWidgets:async()=>{try{const e=await k("/api/me/dashboard/widgets");if(!e.ok)throw new Error("Failed to load widgets");const t=await e.json();t.success&&t.data?.widgets&&a({availableWidgets:t.data.widgets})}catch{a({error:"Failed to load available widgets"})}},addWidget:e=>{const{widgets:t,availableWidgets:r}=n();if(t.some(l=>l.type===e)){a({widgets:t.map(l=>l.type===e?{...l,visible:!0}:l)});return}const i=r.find(l=>l.id===e);if(!i)return;const o=t.reduce((l,v)=>Math.max(l,v.y+v.h),0),s={id:`${e}_${Date.now()}`,type:e,x:0,y:o,w:i.defaultWidth,h:i.defaultHeight,visible:!0,settings:{}};a({widgets:[...t,s]})},removeWidget:e=>{a(t=>({widgets:t.widgets.filter(r=>r.id!==e)}))},updateWidget:(e,t)=>{a(r=>({widgets:r.widgets.map(i=>i.id===e?{...i,...t}:i)}))},moveWidget:(e,t,r)=>{a(i=>({widgets:i.widgets.map(o=>o.id===e?{...o,x:t,y:r}:o)}))},resizeWidget:(e,t,r)=>{a(i=>({widgets:i.widgets.map(o=>o.id===e?{...o,w:t,h:r}:o)}))},toggleWidgetVisibility:e=>{a(t=>({widgets:t.widgets.map(r=>r.id===e?{...r,visible:!r.visible}:r)}))},updateWidgetSettings:(e,t)=>{a(r=>({widgets:r.widgets.map(i=>i.id===e?{...i,settings:{...i.settings,...t}}:i)}))},toggleEditMode:()=>{const{isEditMode:e,saveLayout:t}=n();e&&t(),a({isEditMode:!e})},resetToDefault:async()=>{a({widgets:S}),await n().saveLayout()},setColumns:e=>a({columns:e}),setRowHeight:e=>a({rowHeight:e}),updateLayout:e=>{a(t=>({widgets:t.widgets.map(r=>{const i=e.find(o=>o.i===r.id);return i?{...r,x:i.x,y:i.y,w:i.w,h:i.h}:r})}))}}),{name:"musclemap-dashboard",partialize:a=>({widgets:a.widgets,columns:a.columns,rowHeight:a.rowHeight})})));const C=()=>localStorage.getItem("musclemap_token");async function R(a,n={}){const e=C(),t={"Content-Type":"application/json",...n.headers||{}};return e&&(t.Authorization=`Bearer ${e}`),fetch(a,{...n,headers:t})}function N(){return`hydration_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}function V(a){const n=new Date;return a.getDate()===n.getDate()&&a.getMonth()===n.getMonth()&&a.getFullYear()===n.getFullYear()}h()(g(p((a,n)=>({todayLogs:[],currentIntake:0,dailyGoal:64,remindersEnabled:!0,reminderIntervalMinutes:15,lastReminderAt:null,nextReminderAt:null,reminderTimerId:null,showDuringWorkout:!0,workoutMode:!1,soundEnabled:!0,vibrationEnabled:!0,isLoading:!1,isSyncing:!1,logWater:e=>{const t={id:N(),amount:e,timestamp:new Date};a(r=>({todayLogs:[...r.todayLogs,t],currentIntake:r.currentIntake+e})),n().syncToServer(e),n().remindersEnabled&&n().scheduleNextReminder()},undoLastLog:()=>{const{todayLogs:e}=n();if(e.length===0)return;const t=e[e.length-1];a(r=>({todayLogs:r.todayLogs.slice(0,-1),currentIntake:Math.max(0,r.currentIntake-t.amount)}))},setDailyGoal:e=>{a({dailyGoal:e})},enableReminders:()=>{a({remindersEnabled:!0}),n().scheduleNextReminder()},disableReminders:()=>{const{reminderTimerId:e}=n();e&&clearTimeout(e),a({remindersEnabled:!1,reminderTimerId:null,nextReminderAt:null})},setReminderInterval:e=>{a({reminderIntervalMinutes:e}),n().remindersEnabled&&n().scheduleNextReminder()},snoozeReminder:(e=5)=>{const t=new Date(Date.now()+e*60*1e3);a({nextReminderAt:t}),n().scheduleReminderAt(t)},dismissReminder:()=>{a({lastReminderAt:new Date}),n().remindersEnabled&&n().scheduleNextReminder()},enterWorkoutMode:()=>{a({workoutMode:!0})},exitWorkoutMode:()=>{a({workoutMode:!1})},updateSettings:e=>{a(t=>({remindersEnabled:e.enabled??t.remindersEnabled,reminderIntervalMinutes:e.intervalMinutes??t.reminderIntervalMinutes,soundEnabled:e.soundEnabled??t.soundEnabled,vibrationEnabled:e.vibrationEnabled??t.vibrationEnabled,showDuringWorkout:e.showDuringWorkout??t.showDuringWorkout,dailyGoal:e.dailyGoalOz??t.dailyGoal})),e.enabled!==!1&&n().remindersEnabled&&n().scheduleNextReminder()},loadFromServer:async()=>{if(C()){a({isLoading:!0});try{const t=await R("/api/me/hydration/today");if(!t.ok)throw new Error("Failed to load hydration");const r=await t.json();if(r.success&&r.data){const i=(r.data.logs||[]).map(s=>({id:s.id,amount:s.amount_oz,timestamp:new Date(s.logged_at)})),o=i.reduce((s,l)=>s+l.amount,0);a({todayLogs:i,currentIntake:o,isLoading:!1})}}catch{a({isLoading:!1})}}},syncToServer:async e=>{if(C()){a({isSyncing:!0});try{await R("/api/me/hydration",{method:"POST",body:JSON.stringify({amount_oz:e})})}catch{}finally{a({isSyncing:!1})}}},resetForNewDay:()=>{a({todayLogs:[],currentIntake:0,lastReminderAt:null})},scheduleNextReminder:()=>{const{reminderIntervalMinutes:e,reminderTimerId:t}=n();t&&clearTimeout(t);const r=new Date(Date.now()+e*60*1e3);a({nextReminderAt:r}),n().scheduleReminderAt(r)},scheduleReminderAt:e=>{const t=e.getTime()-Date.now();if(t<=0)return;const r=window.setTimeout(()=>{const{workoutMode:i,showDuringWorkout:o}=n();if(i&&!o){n().scheduleNextReminder();return}n().triggerReminder()},t);a({reminderTimerId:r})},triggerReminder:()=>{const{soundEnabled:e,vibrationEnabled:t}=n();if(e)try{const r=new AudioContext,i=r.createOscillator(),o=r.createGain();i.connect(o),o.connect(r.destination),i.frequency.value=800,i.type="sine",o.gain.value=.3,i.start(),i.stop(r.currentTime+.2)}catch{}t&&"vibrate"in navigator&&navigator.vibrate([200,100,200]),window.dispatchEvent(new CustomEvent("hydration-reminder",{detail:{currentIntake:n().currentIntake,dailyGoal:n().dailyGoal}})),a({lastReminderAt:new Date})}}),{name:"musclemap-hydration",partialize:a=>({todayLogs:a.todayLogs,currentIntake:a.currentIntake,dailyGoal:a.dailyGoal,remindersEnabled:a.remindersEnabled,reminderIntervalMinutes:a.reminderIntervalMinutes,soundEnabled:a.soundEnabled,vibrationEnabled:a.vibrationEnabled,showDuringWorkout:a.showDuringWorkout}),onRehydrate:a=>n=>{if(n&&n.todayLogs.length>0){const e=n.todayLogs[n.todayLogs.length-1];V(new Date(e.timestamp))||n.resetForNewDay()}n?.remindersEnabled&&setTimeout(()=>{n.scheduleNextReminder()},1e3)}})));const U=()=>localStorage.getItem("musclemap_token");async function E(a,n={}){const e=U(),t={"Content-Type":"application/json",...n.headers||{}};return e&&(t.Authorization=`Bearer ${e}`),fetch(a,{...n,headers:t})}h()(g(p((a,n)=>({connections:[],activeProvider:null,isConnecting:!1,connectionError:null,isPlaying:!1,currentTrack:null,queue:[],progress:0,progressMs:0,volume:70,isMuted:!1,shuffle:!1,repeat:"off",playlists:[],selectedPlaylistId:null,isLoadingPlaylists:!1,autoPlayOnWorkout:!0,bpmMatchingEnabled:!1,targetBpm:null,fadeOnRest:!0,isExpanded:!1,showMiniPlayer:!0,connect:async e=>{a({isConnecting:!0,connectionError:null});try{const t=await E(`/api/me/music/connect/${e}`,{method:"POST"});if(!t.ok)throw new Error("Failed to initiate connection");const r=await t.json();if(r.data?.authUrl){const s=window.screenX+(window.outerWidth-500)/2,l=window.screenY+(window.outerHeight-600)/2,v=window.open(r.data.authUrl,`${e}_auth`,`width=500,height=600,left=${s},top=${l}`),I=setInterval(async()=>{v?.closed&&(clearInterval(I),await n().refreshConnections(),a({isConnecting:!1}))},500)}}catch(t){a({isConnecting:!1,connectionError:t instanceof Error?t.message:"Connection failed"})}},disconnect:async e=>{try{await E(`/api/me/music/disconnect/${e}`,{method:"DELETE"}),a(t=>({connections:t.connections.filter(r=>r.provider!==e),activeProvider:t.activeProvider===e?null:t.activeProvider})),n().activeProvider===e&&(n().pause(),a({currentTrack:null,isPlaying:!1}))}catch{}},setActiveProvider:e=>{a({activeProvider:e}),e&&n().loadPlaylists()},refreshConnections:async()=>{try{const e=await E("/api/me/music/status");if(!e.ok)return;const t=await e.json();if(t.success&&t.data?.connections){const r=t.data.connections.map(i=>({provider:i.provider,connected:!0,connectedAt:new Date(i.connected_at),expiresAt:i.token_expires_at?new Date(i.token_expires_at):void 0}));a({connections:r}),!n().activeProvider&&r.length>0&&a({activeProvider:r[0].provider})}}catch{}},play:()=>{const{activeProvider:e}=n();e&&a({isPlaying:!0})},pause:()=>{const{activeProvider:e}=n();e&&a({isPlaying:!1})},toggle:()=>{const{isPlaying:e}=n();e?n().pause():n().play()},next:()=>{const{activeProvider:e,queue:t}=n();e&&t.length>0&&a({queue:t.slice(1)})},previous:()=>{const{activeProvider:e,progressMs:t}=n();if(e&&t>3e3){n().seek(0);return}},seek:e=>{const{activeProvider:t,currentTrack:r}=n();if(!t||!r)return;const i=e/r.durationMs*100;a({progressMs:e,progress:i})},setVolume:e=>{const{activeProvider:t}=n();a({volume:e,isMuted:e===0})},toggleMute:()=>{const{isMuted:e,volume:t}=n();e?n().setVolume(t||70):n().setVolume(0),a({isMuted:!e})},toggleShuffle:()=>{a(e=>({shuffle:!e.shuffle}))},cycleRepeat:()=>{a(e=>{const t=["off","context","track"],r=t.indexOf(e.repeat);return{repeat:t[(r+1)%t.length]}})},playTrack:e=>{const{activeProvider:t}=n();t&&a({currentTrack:e,isPlaying:!0,progressMs:0,progress:0})},addToQueue:e=>{a(t=>({queue:[...t.queue,e]}))},clearQueue:()=>{a({queue:[]})},loadPlaylists:async()=>{const{activeProvider:e}=n();if(e){a({isLoadingPlaylists:!0});try{const t=await E("/api/me/music/playlists");if(!t.ok)throw new Error("Failed to load playlists");const r=await t.json();if(r.success&&r.data?.playlists){const i=r.data.playlists.map(o=>({id:o.id,name:o.name,description:o.description,imageUrl:o.images?.[0]?.url,trackCount:o.tracks?.total||0,provider:e,uri:o.uri}));a({playlists:i,isLoadingPlaylists:!1})}}catch{a({isLoadingPlaylists:!1})}}},selectPlaylist:e=>{a({selectedPlaylistId:e})},playPlaylist:(e,t=!1)=>{const{activeProvider:r,playlists:i}=n();!r||!i.find(s=>s.id===e)||a({shuffle:t,selectedPlaylistId:e})},setAutoPlayOnWorkout:e=>{a({autoPlayOnWorkout:e})},setBpmMatching:(e,t)=>{a({bpmMatchingEnabled:e,targetBpm:t||null})},setFadeOnRest:e=>{a({fadeOnRest:e})},startWorkoutPlayback:()=>{const{autoPlayOnWorkout:e,selectedPlaylistId:t}=n();e&&t&&n().playPlaylist(t)},pauseForRest:()=>{const{fadeOnRest:e,volume:t}=n();if(e){const i=t/10;let o=0;const s=setInterval(()=>{o++;const l=Math.max(0,t-i*o);n().setVolume(l),o>=10&&(clearInterval(s),n().pause())},100)}else n().pause()},resumeAfterRest:()=>{const{fadeOnRest:e}=n(),t=70;if(n().play(),e){const i=t/10;let o=0;n().setVolume(0);const s=setInterval(()=>{o++;const l=Math.min(t,i*o);n().setVolume(l),o>=10&&clearInterval(s)},100)}},toggleExpanded:()=>{a(e=>({isExpanded:!e.isExpanded}))},setShowMiniPlayer:e=>{a({showMiniPlayer:e})},updatePlaybackState:e=>{a(e)}}),{name:"musclemap-music",partialize:a=>({activeProvider:a.activeProvider,volume:a.volume,shuffle:a.shuffle,repeat:a.repeat,autoPlayOnWorkout:a.autoPlayOnWorkout,bpmMatchingEnabled:a.bpmMatchingEnabled,targetBpm:a.targetBpm,fadeOnRest:a.fadeOnRest,showMiniPlayer:a.showMiniPlayer,selectedPlaylistId:a.selectedPlaylistId})})));export{z as F,B as P,c as a,H as b,$ as c,Q as d,Y as e,j as u};
