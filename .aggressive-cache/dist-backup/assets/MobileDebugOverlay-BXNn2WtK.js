import{r as i,j as e}from"./react-vendor-D1NxaRNd.js";import{a as E,B as j}from"./index-Bcbmw5yO.js";import{C as N}from"./circle-check-big-DCTWj1lF.js";import{C as D}from"./copy-DYi8ddIN.js";import{S as T}from"./send-B3senWi2.js";import{T as A}from"./trash-2-BuTptF3F.js";import{C as L}from"./chevron-down-CjyuzfQX.js";import{C as I}from"./circle-alert-B258O7-k.js";import"./leaflet-vendor-DZbo3Ov0.js";import"./apollo-vendor-BMQ75Ycx.js";import"./reactflow-vendor-Dz2P_-Qa.js";import"./d3-vendor-mcDw60ct.js";import"./recharts-vendor-BziRPEEi.js";let c=[],h=[];const U=()=>{h.forEach(l=>l([...c]))},p=l=>{c.some(d=>d.message===l.message&&Date.now()-d.timestamp.getTime()<1e3)||(c.unshift(l),c.length>50&&(c=c.slice(0,50)),U())},u=()=>Math.random().toString(36).substr(2,9),B=()=>{const l=window.onerror;window.onerror=(o,t,s,x,m)=>(p({id:u(),type:"error",message:String(o),stack:m?.stack,url:t||window.location.href,timestamp:new Date,details:{lineno:s,colno:x}}),l?l(o,t,s,x,m):!1),window.addEventListener("unhandledrejection",o=>{const t=o.reason?.message||String(o.reason);p({id:u(),type:"promise",message:`Unhandled Promise: ${t}`,stack:o.reason?.stack,url:window.location.href,timestamp:new Date})});const g=console.error;console.error=(...o)=>{const t=o.map(s=>typeof s=="object"?JSON.stringify(s,null,2):String(s)).join(" ");t.includes("[MobileDebug]")||p({id:u(),type:"console",message:t.slice(0,500),url:window.location.href,timestamp:new Date}),g.apply(console,o)};const d=window.fetch;window.fetch=async(...o)=>{const t=typeof o[0]=="string"?o[0]:o[0]?.url||"unknown";try{const s=await d.apply(window,o);return!s.ok&&s.status>=400&&p({id:u(),type:"network",message:`HTTP ${s.status}: ${s.statusText}`,url:t,timestamp:new Date,details:{status:s.status}}),s}catch(s){throw p({id:u(),type:"network",message:`Network Error: ${s instanceof Error?s.message:"Unknown"}`,url:t,timestamp:new Date}),s}}};function Q(){const[l,g]=i.useState(!1),[d,o]=i.useState(!1),[t,s]=i.useState([]),[x,m]=i.useState(!1),[w,f]=i.useState(!1),[k,y]=i.useState(!1),b=i.useRef(!1);i.useEffect(()=>{const r=localStorage.getItem("musclemap_debug_mode")==="true";g(r),r&&!b.current&&(b.current=!0,B())},[]),i.useEffect(()=>{if(!l)return;const r=a=>{s(a)};return h.push(r),s([...c]),()=>{h=h.filter(a=>a!==r)}},[l]);const C=i.useCallback(async()=>{const r=t.map(a=>`[${a.type.toUpperCase()}] ${a.timestamp.toLocaleTimeString()}
${a.message}${a.url?`
URL: ${a.url}`:""}${a.stack?`
Stack: ${a.stack}`:""}`).join(`

---

`);try{await navigator.clipboard.writeText(r),m(!0),setTimeout(()=>m(!1),2e3)}catch{const a=document.createElement("textarea");a.value=r,document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a),m(!0),setTimeout(()=>m(!1),2e3)}},[t]),v=i.useCallback(async()=>{if(t.length!==0){f(!0);try{const r=t.map(n=>n.message),a=t.filter(n=>n.type==="network").map(n=>`${n.url}: ${n.message}`);await E.post("/feedback",{type:"bug_report",title:`[Auto-captured] ${t.length} error(s) on ${window.location.pathname}`,description:`Automatically captured errors from mobile device.

URL: ${window.location.href}
User Agent: ${navigator.userAgent}
Screen: ${window.innerWidth}x${window.innerHeight}`,priority:t.some(n=>n.type==="error"||n.type==="promise")?"high":"medium",metadata:{consoleErrors:r,networkErrors:a,capturedAt:new Date().toISOString(),errorCount:t.length,errorDetails:t.slice(0,10).map(n=>({type:n.type,message:n.message,url:n.url,timestamp:n.timestamp}))},userAgent:navigator.userAgent,screenSize:`${window.innerWidth}x${window.innerHeight}`,platform:navigator.platform}),y(!0),setTimeout(()=>y(!1),3e3),c=[],s([])}catch{}finally{f(!1)}}},[t]),S=i.useCallback(()=>{c=[],s([])},[]);if(!l)return null;const $={error:"bg-red-500",console:"bg-orange-500",network:"bg-yellow-500",promise:"bg-purple-500"};return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>o(!d),className:`fixed bottom-4 right-4 z-[9999] p-3 rounded-full shadow-lg transition-all ${t.length>0?"bg-red-600 animate-pulse":"bg-gray-800"}`,style:{touchAction:"manipulation"},children:[e.jsx(j,{className:"w-6 h-6 text-white"}),t.length>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-white text-red-600 text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center",children:t.length>9?"9+":t.length})]}),d&&e.jsxs("div",{className:"fixed inset-x-0 bottom-0 z-[9998] bg-gray-900 border-t border-gray-700 shadow-2xl max-h-[70vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-gray-700 bg-gray-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:"w-5 h-5 text-red-400"}),e.jsx("span",{className:"font-semibold text-white",children:"Debug Console"}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",t.length," errors)"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:C,disabled:t.length===0,className:"p-2 hover:bg-gray-700 rounded disabled:opacity-50",title:"Copy all errors",children:x?e.jsx(N,{className:"w-4 h-4 text-green-400"}):e.jsx(D,{className:"w-4 h-4 text-gray-400"})}),e.jsx("button",{onClick:v,disabled:t.length===0||w,className:"p-2 hover:bg-gray-700 rounded disabled:opacity-50",title:"Send to bug tracker",children:k?e.jsx(N,{className:"w-4 h-4 text-green-400"}):e.jsx(T,{className:`w-4 h-4 text-violet-400 ${w?"animate-pulse":""}`})}),e.jsx("button",{onClick:S,disabled:t.length===0,className:"p-2 hover:bg-gray-700 rounded disabled:opacity-50",title:"Clear errors",children:e.jsx(A,{className:"w-4 h-4 text-gray-400"})}),e.jsx("button",{onClick:()=>o(!1),className:"p-2 hover:bg-gray-700 rounded",children:e.jsx(L,{className:"w-4 h-4 text-gray-400"})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-2",children:t.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(I,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No errors captured"}),e.jsx("p",{className:"text-xs mt-1",children:"Errors will appear here as they occur"})]}):t.map(r=>e.jsxs("div",{className:"p-3 bg-gray-800 rounded-lg border border-gray-700",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-xs text-white ${$[r.type]}`,children:r.type}),e.jsx("span",{className:"text-xs text-gray-500",children:r.timestamp.toLocaleTimeString()})]}),e.jsx("p",{className:"text-sm text-white mt-2 break-words",children:r.message}),r.url&&e.jsx("p",{className:"text-xs text-gray-500 mt-1 break-all",children:r.url}),r.stack&&e.jsxs("details",{className:"mt-2",children:[e.jsx("summary",{className:"text-xs text-gray-500 cursor-pointer",children:"Stack trace"}),e.jsx("pre",{className:"text-xs text-gray-400 mt-1 p-2 bg-black/30 rounded overflow-x-auto whitespace-pre-wrap",children:r.stack})]})]},r.id))}),e.jsxs("div",{className:"p-2 border-t border-gray-700 bg-gray-800 text-xs text-gray-500 text-center",children:["Tap Send to report these errors â€¢",e.jsx("button",{onClick:()=>{localStorage.removeItem("musclemap_debug_mode"),window.location.reload()},className:"text-violet-400 ml-1",children:"Disable debug mode"})]})]})]})}export{Q as default};
