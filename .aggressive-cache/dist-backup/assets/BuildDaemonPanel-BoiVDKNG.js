import{r as s,j as e}from"./react-vendor-D847gc3Q.js";import{G as c}from"./GlassSurface-CuHevRGA.js";import{W as H,a as P}from"./wifi-DLbhRO4D.js";import{L as U}from"./loader-circle-EPYVVX_f.js";import{aG as G,Z as J,X as Z,aF as B,K as _}from"./index-Xs12wJXs.js";import{R as K}from"./refresh-cw-CWyLkrRE.js";import{C as L}from"./circle-alert-B_L0GrXc.js";import{T as M}from"./terminal-DXpX6lW0.js";import{T as Q}from"./trash-2-DzGtXMQG.js";import{C as X}from"./chevron-down-C934IKMb.js";import{C as z}from"./chevron-right-BT8gxIqw.js";import{C as V}from"./circle-check-big-Dqs3Zgxz.js";import"./leaflet-vendor-DZbo3Ov0.js";import"./recharts-vendor-CxtoZpzE.js";import"./d3-vendor-mcDw60ct.js";import"./apollo-vendor-BNHFeEEc.js";import"./reactflow-vendor-CYb5nRwM.js";const T=()=>typeof window<"u"&&window.location.hostname!=="localhost"?`${window.location.origin}/api/build-daemon`:"http://localhost:9876",Y=()=>typeof window<"u"&&window.location.hostname!=="localhost"?`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/api/build-daemon/ws`:"ws://localhost:9877",R={0:{label:"INSTANT",color:"text-green-400 bg-green-500/20"},1:{label:"RESTORE",color:"text-cyan-400 bg-cyan-500/20"},2:{label:"INCREMENTAL",color:"text-yellow-400 bg-yellow-500/20"},3:{label:"FULL",color:"text-purple-400 bg-purple-500/20"}};function ge(){const[d,v]=s.useState(!1),[r,u]=s.useState(null),[E,F]=s.useState([]),[S,g]=s.useState(""),[b,A]=s.useState(""),[w,D]=s.useState("all"),[x,O]=s.useState(!0),[N,W]=s.useState(!0),[m,y]=s.useState(!1),[C,n]=s.useState(null),h=s.useRef(null),p=s.useRef(null),I=s.useRef(null),o=s.useRef(null),f=s.useCallback(async()=>{try{const t=await fetch(`${T()}/status`);if(t.ok){const i=await t.json();u(i),n(null)}else throw new Error("Daemon not responding")}catch{u(null),n("Daemon not running")}},[]),j=s.useCallback(()=>{if(h.current?.readyState!==WebSocket.OPEN)try{const t=new WebSocket(Y());t.onopen=()=>{v(!0),n(null)},t.onmessage=i=>{try{const l=JSON.parse(i.data);switch(l.type){case"connected":u(a=>a?{...a,...l.status}:null);break;case"queued":case"started":case"completed":case"failed":u(a=>a&&{...a,build:{...a.build,currentBuild:l.type==="started"?l.job:l.type==="completed"||l.type==="failed"?null:a.build.currentBuild,history:l.type==="completed"||l.type==="failed"?[l.job,...a.build.history.slice(0,9)]:a.build.history}}),(l.type==="completed"||l.type==="failed")&&y(!1),F(a=>[{timestamp:new Date().toISOString(),level:l.type==="failed"?"error":"info",msg:`Build ${l.type}: ${l.job?.id?.slice(0,8)}`,jobId:l.job?.id},...a].slice(0,1e3));break;case"output":g(a=>a+l.text);break;default:}}catch{}},t.onclose=()=>{v(!1),h.current=null,o.current||(o.current=setTimeout(()=>{o.current=null,j()},3e3))},t.onerror=i=>{n("WebSocket connection failed")},h.current=t}catch{n("Failed to connect to daemon")}},[]),k=s.useCallback(async(t=!1)=>{y(!0),g(""),n(null);try{const i=await fetch(`${T()}/build`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({force:t})});if(!i.ok)throw new Error("Failed to queue build");const l=await i.json()}catch(i){y(!1),n(`Build request failed: ${i}`)}},[]);s.useEffect(()=>{x&&p.current&&(p.current.scrollTop=p.current.scrollHeight)},[S,x]),s.useEffect(()=>{f(),j();const t=setInterval(f,5e3);return()=>{clearInterval(t),o.current&&clearTimeout(o.current),h.current?.close()}},[f,j]);const $=E.filter(t=>!(w!=="all"&&t.level!==w||b&&!t.msg.toLowerCase().includes(b.toLowerCase()))),q=t=>t<1e3?`${t}ms`:t<6e4?`${(t/1e3).toFixed(2)}s`:`${(t/6e4).toFixed(1)}m`;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${d?"bg-green-500 animate-pulse":"bg-red-500"}`}),e.jsx("h2",{className:"text-xl font-bold text-white",children:"Build Daemon"}),d?e.jsx(H,{className:"w-5 h-5 text-green-400"}):e.jsx(P,{className:"w-5 h-5 text-red-400"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>k(!1),disabled:m||!r,className:"px-3 py-1.5 bg-blue-500/20 hover:bg-blue-500/30 text-blue-300 rounded-lg flex items-center gap-2 disabled:opacity-50",children:[m?e.jsx(U,{className:"w-4 h-4 animate-spin"}):e.jsx(G,{className:"w-4 h-4"}),"Build"]}),e.jsxs("button",{onClick:()=>k(!0),disabled:m||!r,className:"px-3 py-1.5 bg-purple-500/20 hover:bg-purple-500/30 text-purple-300 rounded-lg flex items-center gap-2 disabled:opacity-50",children:[e.jsx(J,{className:"w-4 h-4"}),"Force"]}),e.jsx("button",{onClick:f,className:"p-1.5 bg-white/5 hover:bg-white/10 text-gray-400 rounded-lg",children:e.jsx(K,{className:"w-4 h-4"})})]})]}),C&&e.jsxs("div",{className:"px-4 py-3 bg-red-500/20 border border-red-500/30 rounded-lg flex items-center gap-3 text-red-300",children:[e.jsx(L,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{children:C}),e.jsx("button",{onClick:()=>n(null),className:"ml-auto",children:e.jsx(Z,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs(c,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Status"}),e.jsx("div",{className:`text-xl font-bold ${r?"text-green-400":"text-red-400"}`,children:r?"Running":"Offline"})]}),e.jsxs(c,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Queue"}),e.jsx("div",{className:"text-xl font-bold text-white",children:r?.build.queueLength??"-"})]}),e.jsxs(c,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Current Build"}),e.jsx("div",{className:"text-xl font-bold",children:r?.build.currentBuild?e.jsx("span",{className:"text-yellow-400 animate-pulse",children:r.build.currentBuild.id.slice(0,8)}):e.jsx("span",{className:"text-gray-500",children:"None"})})]}),e.jsxs(c,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Uptime"}),e.jsx("div",{className:"text-xl font-bold text-white",children:r?`${(r.uptime/60).toFixed(0)}m`:"-"})]})]}),e.jsxs(c,{className:"overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-300",children:[e.jsx(M,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Build Output"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>O(!x),className:`p-1.5 rounded ${x?"bg-blue-500/20 text-blue-300":"bg-white/5 text-gray-400"}`,children:e.jsx(B,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>g(""),className:"p-1.5 bg-white/5 hover:bg-white/10 text-gray-400 rounded",children:e.jsx(Q,{className:"w-4 h-4"})})]})]}),e.jsx("div",{ref:p,className:"h-64 overflow-auto p-4 font-mono text-xs bg-black/50 whitespace-pre-wrap",children:S||e.jsx("span",{className:"text-gray-500",children:m?"Waiting for output...":'No build output. Click "Build" to start.'})})]}),e.jsxs(c,{className:"overflow-hidden",children:[e.jsxs("button",{onClick:()=>W(!N),className:"w-full flex items-center justify-between px-4 py-3 border-b border-white/5 hover:bg-white/5",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-300",children:[e.jsx(_,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Build History"}),e.jsxs("span",{className:"text-gray-500 text-sm",children:["(",r?.build.history.length??0," builds)"]})]}),N?e.jsx(X,{className:"w-4 h-4"}):e.jsx(z,{className:"w-4 h-4"})]}),N&&e.jsx("div",{className:"divide-y divide-white/5",children:r?.build.history.length===0?e.jsx("div",{className:"px-4 py-8 text-center text-gray-500",children:"No build history yet"}):r?.build.history.map(t=>e.jsxs("div",{className:`px-4 py-3 ${t.status==="failed"?"bg-red-500/5":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[t.status==="completed"?e.jsx(V,{className:"w-4 h-4 text-green-400"}):e.jsx(L,{className:"w-4 h-4 text-red-400"}),e.jsx("span",{className:"font-mono text-sm text-gray-300",children:t.id.slice(0,8)}),t.status==="failed"?e.jsx("span",{className:"px-2 py-0.5 rounded text-xs font-medium text-red-400 bg-red-500/20",children:"FAILED"}):t.result?.tier!==void 0&&e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${R[t.result.tier]?.color}`,children:R[t.result.tier]?.label??`T${t.result.tier}`})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-400",children:[e.jsx("span",{children:t.source}),t.duration&&e.jsx("span",{className:"text-gray-500",children:q(t.duration)}),t.completedAt&&e.jsx("span",{className:"text-gray-600 text-xs",children:new Date(t.completedAt).toLocaleTimeString()})]})]}),t.status==="failed"&&t.error&&e.jsx("div",{className:"mt-2 text-xs text-red-400/80 font-mono truncate pl-7",children:t.error})]},t.id))})]}),e.jsxs(c,{className:"overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-300",children:[e.jsx(B,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Live Logs"}),d&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-400 animate-pulse"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:w,onChange:t=>D(t.target.value),className:"px-2 py-1 bg-white/5 border border-white/10 rounded text-sm text-gray-300",children:[e.jsx("option",{value:"all",children:"All Levels"}),e.jsx("option",{value:"info",children:"Info"}),e.jsx("option",{value:"success",children:"Success"}),e.jsx("option",{value:"warn",children:"Warn"}),e.jsx("option",{value:"error",children:"Error"})]}),e.jsx("input",{type:"text",value:b,onChange:t=>A(t.target.value),placeholder:"Filter...",className:"px-2 py-1 bg-white/5 border border-white/10 rounded text-sm text-gray-300 w-32"})]})]}),e.jsx("div",{ref:I,className:"h-48 overflow-auto divide-y divide-white/5",children:$.length===0?e.jsx("div",{className:"px-4 py-8 text-center text-gray-500",children:"No logs yet"}):$.map((t,i)=>e.jsxs("div",{className:`px-4 py-2 text-xs font-mono flex items-start gap-3 ${t.level==="error"?"bg-red-500/5":t.level==="warn"?"bg-yellow-500/5":t.level==="success"?"bg-green-500/5":""}`,children:[e.jsx("span",{className:"text-gray-600 flex-shrink-0",children:new Date(t.timestamp).toLocaleTimeString()}),e.jsxs("span",{className:`flex-shrink-0 w-16 uppercase ${t.level==="error"?"text-red-400":t.level==="warn"?"text-yellow-400":t.level==="success"?"text-green-400":"text-blue-400"}`,children:["[",t.level,"]"]}),e.jsx("span",{className:"text-gray-300 break-all",children:t.msg})]},i))})]})]})}export{ge as default};
