import{j as e,r as b,u as ve}from"./react-vendor-D847gc3Q.js";import{m as c,A as ae}from"./index-C9UYgovZ.js";import{R as U,e as G,c as M,g as X,L as we,f as Ne,h as ke,i as Ce,a as Me,d as Y,P as Se,j as Le}from"./adventureMapStore-CdAXpsy3.js";function $e({region:t,isActive:i=!1,children:r}){const{bounds:m,theme:x,name:h,id:d,icon:s}=t,{x:j,y:p,width:o,height:u}=m,g=20;return e.jsxs("g",{className:`region region-${d}`,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:`gradient-${d}`,x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:x.primary,stopOpacity:"0.15"}),e.jsx("stop",{offset:"50%",stopColor:x.secondary,stopOpacity:"0.08"}),e.jsx("stop",{offset:"100%",stopColor:x.primary,stopOpacity:"0.12"})]}),e.jsxs("filter",{id:`glow-${d}`,x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"8",result:"blur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"blur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsxs("filter",{id:`active-glow-${d}`,x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"15",result:"blur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"blur"}),e.jsx("feMergeNode",{in:"blur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),i&&e.jsx(c.rect,{x:j-g-5,y:p-g-5,width:o+g*2+10,height:u+g*2+10,rx:24,fill:"none",stroke:x.glow,strokeWidth:3,filter:`url(#active-glow-${d})`,initial:{opacity:0},animate:{opacity:[.3,.7,.3]},transition:{repeat:1/0,duration:2}}),e.jsx(c.rect,{x:j-g,y:p-g,width:o+g*2,height:u+g*2,rx:20,fill:`url(#gradient-${d})`,stroke:x.primary,strokeWidth:i?2:1,strokeOpacity:i?.6:.3,filter:i?`url(#glow-${d})`:void 0,initial:!1,animate:{strokeOpacity:i?.6:.3},transition:{duration:.3},style:{backdropFilter:"blur(8px)"}}),e.jsxs(c.g,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},transition:{delay:.2},children:[e.jsx("rect",{x:j+o/2-60,y:p-g-10,width:120,height:24,rx:12,fill:x.primary,fillOpacity:.9}),e.jsxs("text",{x:j+o/2,y:p-g+6,textAnchor:"middle",fill:"white",fontSize:12,fontWeight:600,fontFamily:"Inter, system-ui, sans-serif",children:[s," ",h]})]}),t.isAdminOnly&&e.jsxs(c.g,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},children:[e.jsx("rect",{x:j+o+g-50,y:p-g-10,width:50,height:20,rx:10,fill:"#fbbf24",fillOpacity:.9}),e.jsx("text",{x:j+o+g-25,y:p-g+4,textAnchor:"middle",fill:"#422006",fontSize:10,fontWeight:700,fontFamily:"Inter, system-ui, sans-serif",children:"ADMIN"})]}),r]})}const q={common:{radius:18,iconSize:14,labelOffset:28},uncommon:{radius:20,iconSize:16,labelOffset:32},rare:{radius:24,iconSize:18,labelOffset:36},epic:{radius:26,iconSize:20,labelOffset:40},legendary:{radius:30,iconSize:24,labelOffset:44}};function Oe({location:t,isSelected:i=!1,isHovered:r=!1,isVisited:m=!1,isCharacterNearby:x=!1,onClick:h,onHover:d}){const{position:s,icon:j,name:p,tier:o,region:u,requiredRole:g,isLocked:w}=t,y=q[o]||q.common,f=U[u],v=b.useCallback(()=>{!w&&h&&h()},[w,h]),C=b.useCallback(()=>{d&&d(!0)},[d]),S=b.useCallback(()=>{d&&d(!1)},[d]),A={idle:{scale:1},hover:{scale:1.1},selected:{scale:1.15},locked:{scale:1,filter:"grayscale(1)"}},I={idle:{opacity:0,scale:1},nearby:{opacity:[0,.6,0],scale:[1,1.5,1],transition:{repeat:1/0,duration:1.5}}},P=w?"locked":i?"selected":r?"hover":"idle";return e.jsxs(c.g,{className:`location-node location-${t.id}`,onClick:v,onMouseEnter:C,onMouseLeave:S,style:{cursor:w?"not-allowed":"pointer"},initial:"idle",animate:P,whileHover:w?void 0:"hover",variants:A,children:[e.jsxs("defs",{children:[e.jsxs("filter",{id:`location-glow-${t.id}`,x:"-100%",y:"-100%",width:"300%",height:"300%",children:[e.jsx("feGaussianBlur",{stdDeviation:"6",result:"blur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"blur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsxs("radialGradient",{id:`location-gradient-${t.id}`,children:[e.jsx("stop",{offset:"0%",stopColor:f?.theme.primary||"#3b82f6",stopOpacity:"0.9"}),e.jsx("stop",{offset:"100%",stopColor:f?.theme.secondary||"#1d4ed8",stopOpacity:"1"})]})]}),x&&!w&&e.jsx(c.circle,{cx:s.x,cy:s.y,r:y.radius+10,fill:"none",stroke:f?.theme.primary||"#3b82f6",strokeWidth:3,variants:I,animate:"nearby"}),i&&e.jsx(c.circle,{cx:s.x,cy:s.y,r:y.radius+6,fill:"none",stroke:"white",strokeWidth:2,strokeDasharray:"4 2",initial:{rotate:0},animate:{rotate:360},transition:{repeat:1/0,duration:10,ease:"linear"}}),e.jsx(c.circle,{cx:s.x,cy:s.y,r:y.radius+4,fill:"none",stroke:f?.theme.glow||"rgba(59, 130, 246, 0.5)",strokeWidth:r||i?3:2,filter:r||i?`url(#location-glow-${t.id})`:void 0,initial:{opacity:.3},animate:{opacity:r||i?.8:.4}}),e.jsx("circle",{cx:s.x,cy:s.y,r:y.radius,fill:"rgba(0, 0, 0, 0.6)",stroke:f?.theme.primary||"#3b82f6",strokeWidth:2}),e.jsx("circle",{cx:s.x,cy:s.y,r:y.radius-2,fill:`url(#location-gradient-${t.id})`,fillOpacity:.3}),e.jsx("text",{x:s.x,y:s.y+y.iconSize/3,textAnchor:"middle",fontSize:y.iconSize,style:{pointerEvents:"none"},children:w?"ðŸ”’":j}),m&&!w&&e.jsxs(c.g,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:500,damping:30},children:[e.jsx("circle",{cx:s.x+y.radius-4,cy:s.y-y.radius+4,r:8,fill:"#22c55e"}),e.jsx("text",{x:s.x+y.radius-4,y:s.y-y.radius+8,textAnchor:"middle",fill:"white",fontSize:10,fontWeight:"bold",children:"âœ“"})]}),g==="admin"&&e.jsxs("g",{children:[e.jsx("circle",{cx:s.x-y.radius+4,cy:s.y-y.radius+4,r:8,fill:"#fbbf24"}),e.jsx("text",{x:s.x-y.radius+4,y:s.y-y.radius+7,textAnchor:"middle",fill:"#422006",fontSize:8,fontWeight:"bold",children:"â˜…"})]}),e.jsxs(c.g,{initial:{opacity:0},animate:{opacity:r||i?1:.8},transition:{duration:.2},children:[e.jsx("rect",{x:s.x-50,y:s.y+y.labelOffset-10,width:100,height:20,rx:10,fill:"rgba(0, 0, 0, 0.75)",style:{backdropFilter:"blur(4px)"}}),e.jsx("text",{x:s.x,y:s.y+y.labelOffset+4,textAnchor:"middle",fill:"white",fontSize:11,fontWeight:500,fontFamily:"Inter, system-ui, sans-serif",style:{pointerEvents:"none"},children:p.length>14?p.substring(0,12)+"...":p})]}),r&&!w&&e.jsxs(c.g,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},children:[e.jsx("rect",{x:s.x-80,y:s.y-y.radius-50,width:160,height:40,rx:8,fill:"rgba(0, 0, 0, 0.9)",stroke:f?.theme.primary||"#3b82f6",strokeWidth:1}),e.jsx("text",{x:s.x,y:s.y-y.radius-35,textAnchor:"middle",fill:"white",fontSize:12,fontWeight:600,fontFamily:"Inter, system-ui, sans-serif",children:p}),e.jsx("text",{x:s.x,y:s.y-y.radius-20,textAnchor:"middle",fill:"#9ca3af",fontSize:10,fontFamily:"Inter, system-ui, sans-serif",children:"Press Enter or Click"})]})]})}const Ae={road:{strokeWidth:6,stroke:"rgba(120, 120, 140, 0.4)",strokeDasharray:void 0,strokeLinecap:"round"},trail:{strokeWidth:3,stroke:"rgba(100, 100, 120, 0.35)",strokeDasharray:"8 4",strokeLinecap:"round"},bridge:{strokeWidth:5,stroke:"rgba(139, 92, 246, 0.3)",strokeDasharray:"12 6",strokeLinecap:"round"},portal:{strokeWidth:2,stroke:"rgba(251, 191, 36, 0.5)",strokeDasharray:"4 8",strokeLinecap:"round"}};function Ie({path:t,isActive:i=!1,isHighlighted:r=!1}){const{from:m,to:x,waypoints:h,style:d="road"}=t,s=G(m),j=G(x),p=b.useMemo(()=>{if(!s||!j)return"";const u=[s.position,...h||[],j.position];if(u.length===2)return`M ${u[0].x} ${u[0].y} L ${u[1].x} ${u[1].y}`;let g=`M ${u[0].x} ${u[0].y}`;for(let y=1;y<u.length-1;y++){const f=u[y],v=u[y+1],C=f.x,S=f.y;g+=` Q ${C} ${S} ${(f.x+v.x)/2} ${(f.y+v.y)/2}`}const w=u[u.length-1];return g+=` L ${w.x} ${w.y}`,g},[s,j,h]);if(!s||!j||!p)return null;const o=Ae[d];return e.jsxs("g",{className:`map-path path-${t.id}`,children:[(i||r)&&e.jsx("defs",{children:e.jsxs("filter",{id:`path-glow-${t.id}`,x:"-20%",y:"-20%",width:"140%",height:"140%",children:[e.jsx("feGaussianBlur",{stdDeviation:"4",result:"blur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"blur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),e.jsx("path",{d:p,fill:"none",stroke:"rgba(0, 0, 0, 0.3)",strokeWidth:o.strokeWidth+2,strokeLinecap:o.strokeLinecap,strokeDasharray:o.strokeDasharray}),e.jsx(c.path,{d:p,fill:"none",stroke:o.stroke,strokeWidth:o.strokeWidth,strokeLinecap:o.strokeLinecap,strokeDasharray:o.strokeDasharray,initial:{pathLength:0},animate:{pathLength:1},transition:{duration:.5,ease:"easeOut"}}),r&&e.jsx(c.path,{d:p,fill:"none",stroke:"rgba(59, 130, 246, 0.6)",strokeWidth:o.strokeWidth+2,strokeLinecap:o.strokeLinecap,filter:`url(#path-glow-${t.id})`,initial:{opacity:0},animate:{opacity:[.3,.7,.3]},transition:{repeat:1/0,duration:1.5}}),i&&e.jsx(c.path,{d:p,fill:"none",stroke:"rgba(251, 191, 36, 0.8)",strokeWidth:3,strokeLinecap:"round",strokeDasharray:"10 10",filter:`url(#path-glow-${t.id})`,initial:{strokeDashoffset:0},animate:{strokeDashoffset:-20},transition:{repeat:1/0,duration:.5,ease:"linear"}}),d==="portal"&&e.jsxs(e.Fragment,{children:[e.jsx(c.circle,{cx:s.position.x,cy:s.position.y,r:15,fill:"none",stroke:"rgba(251, 191, 36, 0.5)",strokeWidth:2,initial:{scale:.8,opacity:.5},animate:{scale:[.8,1.2,.8],opacity:[.5,.8,.5]},transition:{repeat:1/0,duration:2}}),e.jsx(c.circle,{cx:j.position.x,cy:j.position.y,r:15,fill:"none",stroke:"rgba(251, 191, 36, 0.5)",strokeWidth:2,initial:{scale:.8,opacity:.5},animate:{scale:[1.2,.8,1.2],opacity:[.8,.5,.8]},transition:{repeat:1/0,duration:2}})]}),d==="bridge"&&e.jsx(e.Fragment,{children:e.jsx("circle",{cx:(s.position.x+j.position.x)/2,cy:(s.position.y+j.position.y)/2,r:4,fill:"rgba(139, 92, 246, 0.4)"})})]})}const J={1:"ðŸ¥š",2:"ðŸ£",3:"ðŸ¥",4:"ðŸ¦…",5:"ðŸ¦‹",6:"ðŸŒŸ"},De={"aura-gold":"rgba(250, 204, 21, 0.5)","aura-ember":"rgba(249, 115, 22, 0.5)","aura-frost":"rgba(34, 211, 238, 0.5)","aura-shadow":"rgba(139, 92, 246, 0.6)","aura-cosmic":"rgba(167, 139, 250, 0.5)"};function Te({position:t,state:i,companionData:r,reducedMotion:m=!1}){const{stage:x=1,equipped:h={}}=r,d=J[x]||J[1],s=h.aura?De[h.aura]:"rgba(147, 51, 234, 0.4)",j={idle:{y:[0,-4,0],transition:{repeat:1/0,duration:2,ease:"easeInOut"}},walking:{y:[0,-8,0],transition:{repeat:1/0,duration:.35,ease:"easeInOut"}},teleporting:{scale:[1,0,0,1],rotate:[0,180,360,360],opacity:[1,.5,.5,1],transition:{duration:.5,times:[0,.3,.7,1]}}},p={idle:{scale:[1,.9,1],opacity:[.3,.25,.3],transition:{repeat:1/0,duration:2,ease:"easeInOut"}},walking:{scale:[1,.7,1],opacity:[.3,.2,.3],transition:{repeat:1/0,duration:.35,ease:"easeInOut"}},teleporting:{scale:[1,0,0,1],opacity:[.3,0,0,.3],transition:{duration:.5,times:[0,.3,.7,1]}}},o=m?"idle":i;return e.jsxs(c.g,{className:"map-character",initial:{x:t.x,y:t.y},animate:{x:t.x,y:t.y},transition:{type:"spring",stiffness:300,damping:30},children:[e.jsx(c.ellipse,{cx:0,cy:25,rx:18,ry:6,fill:"rgba(0, 0, 0, 0.3)",variants:p,animate:o}),e.jsx(ae,{children:i==="teleporting"&&!m&&e.jsx(e.Fragment,{children:[...Array(8)].map((u,g)=>e.jsx(c.circle,{r:3,fill:s,initial:{x:0,y:0,opacity:1,scale:1},animate:{x:Math.cos(g*Math.PI/4)*40,y:Math.sin(g*Math.PI/4)*40-10,opacity:0,scale:0},exit:{opacity:0},transition:{duration:.4,delay:g*.03}},g))})}),e.jsx(c.circle,{cx:0,cy:0,r:28,fill:s,filter:"url(#character-glow)",initial:{opacity:.4},animate:{opacity:i==="walking"?[.3,.5,.3]:[.4,.6,.4],scale:i==="walking"?[1,1.1,1]:[1,1.05,1]},transition:{repeat:1/0,duration:i==="walking"?.35:2}}),e.jsx(c.circle,{cx:0,cy:0,r:22,fill:"none",stroke:s,strokeWidth:2,initial:{opacity:.6},animate:{opacity:[.4,.7,.4]},transition:{repeat:1/0,duration:1.5}}),e.jsxs(c.g,{variants:j,animate:o,children:[e.jsx("circle",{cx:0,cy:0,r:20,fill:"rgba(0, 0, 0, 0.7)",stroke:"rgba(255, 255, 255, 0.3)",strokeWidth:2}),e.jsx("circle",{cx:0,cy:0,r:18,fill:"url(#character-gradient)",fillOpacity:.4}),e.jsx("text",{x:0,y:8,textAnchor:"middle",fontSize:24,style:{pointerEvents:"none"},children:d}),h.wings&&x>=3&&e.jsx(c.text,{x:0,y:-18,textAnchor:"middle",fontSize:14,animate:{y:[-18,-20,-18]},transition:{repeat:1/0,duration:1},children:h.wings==="wings-dragon"?"ðŸ‰":"ðŸ¦‹"}),h.armor&&e.jsx("text",{x:0,y:26,textAnchor:"middle",fontSize:12,children:"ðŸ›¡ï¸"}),h.tools&&e.jsx("text",{x:18,y:0,textAnchor:"middle",fontSize:10,children:h.tools==="tool-slate"?"ðŸ“Š":h.tools==="tool-trophy"?"ðŸ†":"ðŸ”®"})]}),e.jsxs("g",{transform:"translate(14, -14)",children:[e.jsx("circle",{r:10,fill:"#8b5cf6",stroke:"white",strokeWidth:1.5}),e.jsx("text",{y:4,textAnchor:"middle",fill:"white",fontSize:11,fontWeight:"bold",fontFamily:"Inter, system-ui, sans-serif",children:x})]}),i==="walking"&&!m&&e.jsx(c.circle,{r:4,fill:"rgba(251, 191, 36, 0.8)",initial:{x:0,y:-35,opacity:0},animate:{y:[-35,-40,-35],opacity:[.5,1,.5]},transition:{repeat:1/0,duration:.5}}),e.jsxs("defs",{children:[e.jsxs("filter",{id:"character-glow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"6",result:"blur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"blur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsxs("radialGradient",{id:"character-gradient",children:[e.jsx("stop",{offset:"0%",stopColor:"#a855f7",stopOpacity:"0.8"}),e.jsx("stop",{offset:"100%",stopColor:"#6366f1",stopOpacity:"0.4"})]})]})]})}const We={north:{x:0,y:-1},south:{x:0,y:1},east:{x:1,y:0},west:{x:-1,y:0}},Ee={ArrowUp:"north",ArrowDown:"south",ArrowLeft:"west",ArrowRight:"east",w:"north",W:"north",s:"south",S:"south",a:"west",A:"west",d:"east",D:"east"};function Re(t={}){const{enabled:i=!0,movementSpeed:r=50,onLocationReached:m,reducedMotion:x=!1}=t,h=M(l=>l.characterPosition),d=M(l=>l.characterState),s=M(l=>l.currentRegion),j=M(l=>l.movementPath),p=M(l=>l.targetLocation),o=M(l=>l.startMovement),u=M(l=>l.advanceMovement),g=M(l=>l.cancelMovement),w=M(l=>l.teleportTo),y=M(l=>l.setSelectedLocation),f=b.useRef(null),v=b.useRef(0);b.useEffect(()=>{if(d!=="walking"||j.length===0){f.current&&(cancelAnimationFrame(f.current),f.current=null);return}const l=k=>{if(k-v.current>=r&&(v.current=k,u()&&p&&m)){const D=we.find(T=>T.id===p);D&&m(p,D.route)}d==="walking"&&(f.current=requestAnimationFrame(l))};return f.current=requestAnimationFrame(l),()=>{f.current&&cancelAnimationFrame(f.current)}},[d,j,r,u,p,m]);const C=b.useCallback(l=>{if(i){if(x){w(l);return}o(l),y(l)}},[i,x,o,w,y]),S=b.useCallback(l=>{i&&(w(l),y(l))},[i,w,y]),A=b.useCallback(l=>{if(!i||d==="walking")return;const k=X(h);if(!k)return;const $=Ne(k.id);if($.length===0)return;const D=We[l];let T=$[0],W=-1/0;for(const z of $){const Z=z.position.x-h.x,O=z.position.y-h.y,F=Z*D.x+O*D.y;F>W&&(W=F,T=z)}T&&W>0&&C(T.id)},[i,d,h,C]),I=b.useCallback(()=>{f.current&&(cancelAnimationFrame(f.current),f.current=null),g()},[g]),P=b.useCallback(l=>{if(!i)return;const k=Ee[l.key];if(k){l.preventDefault(),A(k);return}if(l.key==="Enter"){const $=X(h);$&&m&&(l.preventDefault(),m($.id,$.route));return}if(l.key==="Escape"){l.preventDefault(),I();return}},[i,h,A,I,m]),B=b.useCallback(l=>{if(!i)return;const k=X(l);k&&C(k.id)},[i,C]);return{position:h,isMoving:d==="walking",isTeleporting:d==="teleporting",currentRegion:s,moveToLocation:C,teleportToLocation:S,moveInDirection:A,cancelMovement:I,handleKeyDown:P,handleMapClick:B}}function Pe(t={}){const{onBeforeNavigate:i,onAfterNavigate:r,closeMapOnNavigate:m=!0}=t,x=ve(),h=M(o=>o.visitLocation),d=M(o=>o.closeMap),s=b.useCallback(o=>{const u=G(o);return!(!u||u.isLocked)},[]),j=b.useCallback(o=>G(o)?.route||null,[]);return{navigateToLocation:b.useCallback(o=>{const u=G(o);u&&s(o)&&(i&&i(o,u.route)===!1||(h(o),m&&d(),x(u.route),r&&r(o,u.route)))},[s,i,r,m,h,d,x]),canNavigate:s,getLocationRoute:j}}const ze=1e3,Fe=800,Q=.5,ee=2;function te(t){if(t.length<2)return 0;const i=t[1].x-t[0].x,r=t[1].y-t[0].y;return Math.sqrt(i*i+r*r)}function ie(t){return t.length===0?{x:0,y:0}:t.length===1?t[0]:{x:(t[0].x+t[1].x)/2,y:(t[0].y+t[1].y)/2}}function Ue({className:t="",initialPosition:i,onLocationEnter:r,onCharacterMove:m,showHUD:x=!0,isFullscreen:h=!1,reducedMotion:d=!1}){const s=b.useRef(null),j=b.useRef(null),[p,o]=b.useState(!1),[u,g]=b.useState(null),[w,y]=b.useState({touches:[],initialDistance:null,initialZoom:1,initialPan:{x:0,y:0},lastCenter:{x:0,y:0}}),{zoom:f,pan:v,setZoom:C,setPan:S,zoomIn:A,zoomOut:I,center:P,reset:B}=ke(),{selected:l,hovered:k,setHovered:$}=Ce(),{visited:D,hasVisited:T}=Me(),W=M(n=>n.currentRegion),{navigateToLocation:z,canNavigate:Z}=Pe({onBeforeNavigate:r?(n,a)=>(r(n,a),!0):void 0}),{position:O,isMoving:F,isTeleporting:ce,moveToLocation:de,handleKeyDown:V,handleMapClick:_}=Re({enabled:!0,reducedMotion:d,onLocationReached:(n,a)=>{z(n)}}),xe={stage:3,name:"Buddy",equipped:{aura:"aura-cosmic"}};b.useEffect(()=>{const n=a=>{document.activeElement!==j.current&&!j.current?.contains(document.activeElement)||V(a)};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[V]),b.useEffect(()=>{j.current?.focus()},[]),b.useEffect(()=>{m&&m(O)},[O,m]);const he=b.useCallback(n=>{n.button===0&&(o(!0),g({x:n.clientX-v.x,y:n.clientY-v.y}))},[v]),ue=b.useCallback(n=>{!p||!u||S({x:n.clientX-u.x,y:n.clientY-u.y})},[p,u,S]),H=b.useCallback(()=>{o(!1),g(null)},[]),fe=b.useCallback(n=>{n.preventDefault();const a=n.deltaY>0?-.1:.1;C(Math.max(Q,Math.min(ee,f+a)))},[f,C]),me=b.useCallback(n=>{const a=Array.from(n.touches).map(N=>({x:N.clientX,y:N.clientY}));if(a.length===2){const N=te(a),L=ie(a);y({touches:a,initialDistance:N,initialZoom:f,initialPan:v,lastCenter:L})}else a.length===1&&(o(!0),g({x:a[0].x-v.x,y:a[0].y-v.y}),y(N=>({...N,touches:a,lastCenter:a[0]})))},[f,v]),pe=b.useCallback(n=>{n.preventDefault();const a=Array.from(n.touches).map(N=>({x:N.clientX,y:N.clientY}));if(a.length===2&&w.initialDistance){const L=te(a)/w.initialDistance,E=Math.max(Q,Math.min(ee,w.initialZoom*L)),R=ie(a),K={x:R.x-w.lastCenter.x,y:R.y-w.lastCenter.y};C(E),S({x:w.initialPan.x+K.x,y:w.initialPan.y+K.y})}else a.length===1&&p&&u&&S({x:a[0].x-u.x,y:a[0].y-u.y})},[w,p,u,C,S]),ge=b.useCallback(n=>{if(n.touches.length===0)o(!1),g(null),y({touches:[],initialDistance:null,initialZoom:f,initialPan:v,lastCenter:{x:0,y:0}});else if(n.touches.length===1){const a={x:n.touches[0].clientX,y:n.touches[0].clientY};o(!0),g({x:a.x-v.x,y:a.y-v.y}),y({touches:[a],initialDistance:null,initialZoom:f,initialPan:v,lastCenter:a})}},[f,v]);b.useCallback(n=>{if(p)return;const a=s.current;if(!a)return;const N=n.changedTouches[0];if(!N)return;const L=a.getBoundingClientRect(),E=(N.clientX-L.left-v.x)/f,R=(N.clientY-L.top-v.y)/f;_({x:E,y:R})},[p,v,f,_]);const ye=b.useCallback(n=>{if(p)return;const a=s.current;if(!a)return;const N=a.getBoundingClientRect(),L=(n.clientX-N.left-v.x)/f,E=(n.clientY-N.top-v.y)/f;_({x:L,y:E})},[p,v,f,_]),be=b.useCallback(n=>{const a=Y().find(R=>R.id===n);if(!a)return!1;const N=O.x-a.position.x,L=O.y-a.position.y;return Math.sqrt(N*N+L*L)<40},[O]),je=Le();return e.jsxs("div",{ref:j,className:`adventure-map-canvas relative overflow-hidden bg-gradient-to-b from-[#0a0a12] to-[#14141c] touch-none ${t}`,tabIndex:0,onMouseDown:he,onMouseMove:ue,onMouseUp:H,onMouseLeave:H,onWheel:fe,onTouchStart:me,onTouchMove:pe,onTouchEnd:ge,style:{cursor:p?"grabbing":"grab"},children:[e.jsx("div",{className:"absolute inset-0 pointer-events-none",children:[...Array(50)].map((n,a)=>e.jsx(c.div,{className:"absolute w-1 h-1 bg-white/20 rounded-full",style:{left:`${Math.random()*100}%`,top:`${Math.random()*100}%`},animate:{opacity:[.1,.4,.1],scale:[.8,1.2,.8]},transition:{repeat:1/0,duration:2+Math.random()*3,delay:Math.random()*2}},a))}),e.jsxs("svg",{ref:s,viewBox:`0 0 ${ze} ${Fe}`,className:"w-full h-full",onClick:ye,style:{transform:`translate(${v.x}px, ${v.y}px) scale(${f})`,transformOrigin:"center center"},children:[e.jsx("defs",{children:e.jsxs("filter",{id:"map-glow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"10",result:"blur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"blur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),e.jsx("g",{className:"paths-layer",children:Se.map((n,a)=>e.jsx(Ie,{path:{id:`${n.from}-${n.to}`,from:n.from,to:n.to,style:n.style},isActive:F&&(n.from===l||n.to===l),isHighlighted:n.from===k||n.to===k},`${n.from}-${n.to}-${a}`))}),e.jsx("g",{className:"regions-layer",children:je.map(n=>e.jsx($e,{region:n,isActive:W===n.id,children:Y().filter(a=>a.region===n.id).map(a=>e.jsx(Oe,{location:a,isSelected:l===a.id,isHovered:k===a.id,isVisited:T(a.id),isCharacterNearby:be(a.id),onClick:()=>{Z(a.id)&&de(a.id)},onHover:N=>$(N?a.id:null)},a.id))},n.id))}),e.jsx("g",{className:"character-layer",children:e.jsx(Te,{position:O,state:F?"walking":ce?"teleporting":"idle",companionData:xe,reducedMotion:d})})]}),e.jsxs("div",{className:"absolute bottom-4 right-4 flex flex-col gap-2 z-10",children:[e.jsx("button",{onClick:()=>A(),className:"w-10 h-10 rounded-lg bg-black/60 backdrop-blur-sm border border-white/10 text-white hover:bg-white/10 transition-colors flex items-center justify-center","aria-label":"Zoom in",children:"+"}),e.jsx("button",{onClick:()=>I(),className:"w-10 h-10 rounded-lg bg-black/60 backdrop-blur-sm border border-white/10 text-white hover:bg-white/10 transition-colors flex items-center justify-center","aria-label":"Zoom out",children:"-"}),e.jsx("button",{onClick:()=>P(),className:"w-10 h-10 rounded-lg bg-black/60 backdrop-blur-sm border border-white/10 text-white hover:bg-white/10 transition-colors flex items-center justify-center text-lg","aria-label":"Center on character",children:"â—Ž"}),e.jsx("button",{onClick:()=>B(),className:"w-10 h-10 rounded-lg bg-black/60 backdrop-blur-sm border border-white/10 text-white hover:bg-white/10 transition-colors flex items-center justify-center text-sm","aria-label":"Reset view",children:"â†º"})]}),e.jsxs("div",{className:"absolute top-4 left-4 bg-black/60 backdrop-blur-sm rounded-lg border border-white/10 p-3 z-10",children:[e.jsx("div",{className:"text-white/60 text-xs mb-2 font-medium",children:"CONTROLS"}),e.jsxs("div",{className:"text-white/80 text-xs space-y-1",children:[e.jsx("div",{children:"Arrow/WASD - Move"}),e.jsx("div",{children:"Click - Go to location"}),e.jsx("div",{children:"Enter - Enter location"}),e.jsx("div",{children:"Drag - Pan map"}),e.jsx("div",{children:"Scroll - Zoom"})]})]}),e.jsx("div",{className:"absolute top-4 right-4 bg-black/60 backdrop-blur-sm rounded-lg border border-white/10 px-4 py-2 z-10",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:U[W]?.icon||"ðŸ°"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium text-sm",children:U[W]?.name||"Unknown"}),e.jsxs("div",{className:"text-white/50 text-xs",children:[D.length," / ",Y().filter(n=>!n.requiredRole).length," discovered"]})]})]})})]})}const se={1:{emoji:"ðŸ¥š",label:"Baby"},2:{emoji:"ðŸ£",label:"Adolescent"},3:{emoji:"ðŸ¥",label:"Capable"},4:{emoji:"ðŸ¦…",label:"Armored"},5:{emoji:"ðŸ¦‹",label:"Flying"},6:{emoji:"ðŸŒŸ",label:"Magnificent"}},Ge={"aura-gold":"from-yellow-400/30 to-yellow-600/10","aura-ember":"from-orange-400/30 to-orange-600/10","aura-frost":"from-cyan-400/30 to-cyan-600/10","aura-shadow":"from-purple-400/30 to-purple-900/20","aura-cosmic":"from-violet-400/30 to-violet-600/10"};function re({stage:t,name:i,equipped:r={},compact:m=!1}){const x=se[t]||se[1],h=r.aura&&Ge[r.aura]||"from-purple-500/30 to-indigo-600/10";return m?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(c.div,{className:`relative w-10 h-10 rounded-full bg-gradient-to-br ${h} flex items-center justify-center`,animate:{scale:[1,1.05,1]},transition:{repeat:1/0,duration:2},children:[e.jsx("span",{className:"text-2xl",children:x.emoji}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-5 h-5 rounded-full bg-purple-600 border border-purple-400 flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs font-bold",children:t})})]}),e.jsxs("div",{className:"hidden sm:block",children:[e.jsx("div",{className:"text-white text-sm font-medium",children:i}),e.jsx("div",{className:"text-white/50 text-xs",children:x.label})]})]}):e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(c.div,{className:`relative w-14 h-14 rounded-full bg-gradient-to-br ${h} flex items-center justify-center shadow-lg`,animate:{scale:[1,1.03,1]},transition:{repeat:1/0,duration:2},children:[e.jsx(c.div,{className:"absolute inset-0 rounded-full border-2 border-purple-400/50",animate:{opacity:[.3,.6,.3]},transition:{repeat:1/0,duration:1.5}}),e.jsx("span",{className:"text-3xl",children:x.emoji}),r.wings&&t>=3&&e.jsx("span",{className:"absolute -top-1 left-1/2 -translate-x-1/2 text-sm",children:r.wings==="wings-dragon"?"ðŸ‰":"ðŸ¦‹"}),r.armor&&e.jsx("span",{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 text-xs",children:"ðŸ›¡ï¸"}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 rounded-full bg-purple-600 border-2 border-purple-400 flex items-center justify-center shadow-md",children:e.jsx("span",{className:"text-white text-xs font-bold",children:t})})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-white font-medium text-sm",children:i}),e.jsx("span",{className:"text-purple-400 text-xs",children:x.label}),r.tools&&e.jsx("span",{className:"text-xs mt-0.5",children:r.tools==="tool-slate"?"ðŸ“Š":r.tools==="tool-trophy"?"ðŸ†":"ðŸ”®"})]})]})}const _e={strength:{abbr:"STR",color:"text-red-400"},dexterity:{abbr:"DEX",color:"text-green-400"},endurance:{abbr:"END",color:"text-blue-400"},constitution:{abbr:"CON",color:"text-yellow-400"},power:{abbr:"POW",color:"text-purple-400"},vitality:{abbr:"VIT",color:"text-pink-400"}};function oe({level:t,xp:i,xpToNextLevel:r,characterStats:m,compact:x=!1}){const h=i/r*100;return x?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-yellow-400 text-sm",children:"â­"}),e.jsxs("span",{className:"text-white font-bold",children:["Lv.",t]})]}),e.jsxs("div",{className:"flex-1 max-w-[120px]",children:[e.jsx("div",{className:"h-2 bg-white/10 rounded-full overflow-hidden",children:e.jsx(c.div,{className:"h-full bg-gradient-to-r from-purple-500 to-blue-500",initial:{width:0},animate:{width:`${h}%`},transition:{duration:.5}})}),e.jsxs("div",{className:"text-white/50 text-xs mt-0.5",children:[i.toLocaleString()," / ",r.toLocaleString()]})]})]}):e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-yellow-400",children:"â­"}),e.jsxs("span",{className:"text-white font-bold text-lg",children:["Level ",t]})]}),e.jsxs("div",{className:"w-48 mt-1",children:[e.jsx("div",{className:"h-2 bg-white/10 rounded-full overflow-hidden",children:e.jsx(c.div,{className:"h-full bg-gradient-to-r from-purple-500 via-blue-500 to-cyan-400",initial:{width:0},animate:{width:`${h}%`},transition:{duration:.5}})}),e.jsxs("div",{className:"flex justify-between text-xs text-white/50 mt-0.5",children:[e.jsxs("span",{children:[i.toLocaleString()," XP"]}),e.jsx("span",{children:r.toLocaleString()})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pl-4 border-l border-white/10",children:[Object.entries(m).slice(0,4).map(([d,s])=>{const j=_e[d];return e.jsxs("div",{className:"text-center min-w-[40px]",children:[e.jsx(c.div,{className:`text-lg font-bold ${j.color}`,initial:{scale:1},whileHover:{scale:1.1},children:s}),e.jsx("div",{className:"text-white/40 text-xs font-medium",children:j.abbr})]},d)}),e.jsxs("button",{className:"text-white/30 hover:text-white/60 transition-colors text-xs",children:["+",Object.keys(m).length-4]})]})]})}const ne={0:{name:"Broke",color:"text-gray-400",bgColor:"bg-gray-500/20",icon:""},1:{name:"Bronze",color:"text-amber-600",bgColor:"bg-amber-500/20",icon:"ðŸ¥‰"},2:{name:"Silver",color:"text-gray-300",bgColor:"bg-gray-400/20",icon:"ðŸ¥ˆ"},3:{name:"Gold",color:"text-yellow-400",bgColor:"bg-yellow-500/20",icon:"ðŸ¥‡"},4:{name:"Platinum",color:"text-cyan-300",bgColor:"bg-cyan-500/20",icon:"ðŸ’Ž"},5:{name:"Diamond",color:"text-blue-300",bgColor:"bg-blue-500/20",icon:"ðŸ’ "},6:{name:"Obsidian",color:"text-purple-300",bgColor:"bg-purple-500/20",icon:"ðŸ‘‘"}};function le({credits:t,wealthTier:i}){const r=ne[i]||ne[0],m=x=>x>=1e6?`${(x/1e6).toFixed(1)}M`:x>=1e3?`${(x/1e3).toFixed(1)}K`:x.toLocaleString();return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(c.div,{className:`flex items-center gap-2 px-4 py-2 rounded-xl ${r.bgColor} border border-white/10`,whileHover:{scale:1.02},transition:{type:"spring",stiffness:400,damping:30},children:[e.jsx(c.span,{className:"text-xl",animate:i>=3?{scale:[1,1.1,1],rotate:[0,5,-5,0]}:void 0,transition:{repeat:1/0,duration:2},children:"ðŸ’°"}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx(c.span,{className:`font-bold text-lg ${r.color}`,initial:{scale:1.2,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:300,damping:20},children:m(t)},t),e.jsx("span",{className:"text-white/40 text-xs",children:"credits"})]})]}),i>0&&e.jsxs(c.div,{className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg ${r.bgColor} border border-white/10`,initial:{opacity:0,x:-10},animate:{opacity:1,x:0},whileHover:{scale:1.05},children:[r.icon&&e.jsx(c.span,{animate:i>=4?{y:[0,-2,0],rotate:[0,10,-10,0]}:void 0,transition:{repeat:1/0,duration:1.5},children:r.icon}),e.jsx("span",{className:`text-sm font-medium ${r.color}`,children:r.name})]}),i>=5&&e.jsx(c.div,{className:"absolute inset-0 rounded-xl pointer-events-none",style:{background:`radial-gradient(circle at center, ${i===6?"rgba(168, 85, 247, 0.2)":"rgba(59, 130, 246, 0.2)"} 0%, transparent 70%)`},animate:{opacity:[.3,.6,.3]},transition:{repeat:1/0,duration:2}})]})}function Ve({stats:t,companionData:i,currentLocation:r,onMinimapClick:m,onMenuClick:x,isMobile:h=!1,isExpanded:d=!1,onToggleExpand:s}){return h?e.jsx(Be,{stats:t,companionData:i,currentLocation:r,isExpanded:d,onToggleExpand:s,onMenuClick:x}):e.jsxs(c.div,{className:"adventure-hud fixed bottom-0 left-0 right-0 h-20 z-50",initial:{y:80},animate:{y:0},transition:{type:"spring",stiffness:300,damping:30},children:[e.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-xl border-t border-white/10"}),e.jsxs("div",{className:"relative h-full max-w-7xl mx-auto px-4 flex items-center gap-6",children:[e.jsx(re,{stage:i.stage,name:i.name,equipped:i.equipped}),e.jsx("div",{className:"w-px h-12 bg-white/10"}),e.jsx(oe,{level:t.level,xp:t.xp,xpToNextLevel:t.xpToNextLevel,characterStats:t.characterStats}),e.jsx("div",{className:"flex-1"}),e.jsx(le,{credits:t.credits,wealthTier:t.wealthTier}),e.jsx("div",{className:"w-px h-12 bg-white/10"}),e.jsxs("button",{onClick:m,className:"flex items-center gap-2 px-3 py-2 rounded-lg bg-white/5 hover:bg-white/10 transition-colors",children:[e.jsx("span",{className:"text-lg",children:"ðŸ—ºï¸"}),e.jsx("span",{className:"text-white/70 text-sm",children:"Map"})]}),e.jsx("button",{onClick:x,className:"flex items-center justify-center w-10 h-10 rounded-lg bg-white/5 hover:bg-white/10 transition-colors",children:e.jsx("span",{className:"text-white/70 text-lg",children:"â‰¡"})}),r&&e.jsx(c.div,{className:"absolute -top-12 left-1/2 -translate-x-1/2 bg-black/80 backdrop-blur-sm rounded-lg px-4 py-2 border border-white/10",initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:r.icon}),e.jsx("span",{className:"text-white text-sm font-medium",children:r.name})]})})]})]})}function Be({stats:t,companionData:i,currentLocation:r,isExpanded:m,onToggleExpand:x,onMenuClick:h}){return e.jsxs(c.div,{className:"adventure-hud-mobile fixed bottom-0 left-0 right-0 z-50",initial:{y:100},animate:{y:0},children:[e.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-xl border-t border-white/10 rounded-t-2xl"}),e.jsx("button",{onClick:x,className:"absolute top-0 left-1/2 -translate-x-1/2 -translate-y-1/2 w-16 h-6 rounded-full bg-black/80 border border-white/20 flex items-center justify-center",children:e.jsx(c.span,{className:"text-white/60",animate:{rotate:m?180:0},children:"â–²"})}),e.jsx(ae,{mode:"wait",children:m?e.jsxs(c.div,{className:"relative p-4 space-y-4",initial:{height:50},animate:{height:200},exit:{height:50},children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(re,{stage:i.stage,name:i.name,equipped:i.equipped,compact:!0}),e.jsx("div",{className:"flex-1",children:e.jsx(oe,{level:t.level,xp:t.xp,xpToNextLevel:t.xpToNextLevel,characterStats:t.characterStats,compact:!0})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(le,{credits:t.credits,wealthTier:t.wealthTier}),e.jsx("div",{className:"flex gap-2",children:Object.entries(t.characterStats).slice(0,3).map(([d,s])=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-white text-sm font-bold",children:s}),e.jsx("div",{className:"text-white/50 text-xs uppercase",children:d.slice(0,3)})]},d))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"flex-1 py-2 rounded-lg bg-blue-600/20 text-blue-400 text-sm font-medium",children:"ðŸª Shop"}),e.jsx("button",{className:"flex-1 py-2 rounded-lg bg-purple-600/20 text-purple-400 text-sm font-medium",children:"ðŸ“¦ Inventory"}),e.jsx("button",{onClick:h,className:"w-12 py-2 rounded-lg bg-white/10 text-white/70",children:"â‰¡"})]})]},"expanded"):e.jsxs(c.div,{className:"relative h-[50px] px-4 flex items-center gap-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-purple-600/30 flex items-center justify-center text-lg",children:["ðŸ¥š","ðŸ£","ðŸ¥","ðŸ¦…","ðŸ¦‹","ðŸŒŸ"][i.stage-1]||"ðŸ¥š"}),e.jsxs("div",{className:"text-white text-sm font-bold",children:["Lv.",t.level]}),e.jsx("div",{className:"flex-1 h-2 bg-white/10 rounded-full overflow-hidden",children:e.jsx(c.div,{className:"h-full bg-gradient-to-r from-purple-500 to-blue-500",initial:{width:0},animate:{width:`${t.xp/t.xpToNextLevel*100}%`}})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-yellow-400",children:"ðŸ’°"}),e.jsx("span",{className:"text-white text-sm font-medium",children:t.credits>=1e3?`${(t.credits/1e3).toFixed(1)}K`:t.credits})]})]},"collapsed")})]})}export{Ue as A,re as C,Oe as L,$e as M,oe as S,Ve as a,Ie as b,Te as c,le as d,Pe as e,Re as u};
