import{r as d,j as e,L as A}from"./react-vendor-D847gc3Q.js";import{c as I,e as G,aJ as p,aF as R,J,Z as D,N as L,L as U,o as O,m as y,A as $}from"./index-w5BwH5Oi.js";import{G as l}from"./GlassSurface-CuHevRGA.js";import{G as k}from"./GlassButton-BQ-SybZr.js";import{T as C}from"./triangle-alert-xwDQNUTL.js";import{A as W}from"./arrow-left-gndCO4al.js";import{R as b}from"./refresh-cw-DHfMxovV.js";import{C as w}from"./circle-check-big-BsKOJPAS.js";import{C as E}from"./circle-x-Bwf2ACnf.js";import{C as _}from"./chevron-down-DD6tA38k.js";import{C as B}from"./chevron-right-n_hV_RfY.js";import{R as M,A as z,f as X,X as Y,Y as H,e as K,h as Z}from"./recharts-vendor-CxtoZpzE.js";import"./leaflet-vendor-DZbo3Ov0.js";import"./apollo-vendor-BNHFeEEc.js";import"./reactflow-vendor-CYb5nRwM.js";import"./d3-vendor-mcDw60ct.js";const q=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],P=I("file-exclamation-point",q);function V({score:r,grade:s,size:a=200}){const n=(a-12)/2,t=2*Math.PI*n,o=t-r/100*t,m=r>=90?"#10b981":r>=80?"#06b6d4":r>=70?"#f59e0b":r>=60?"#f97316":"#ef4444";return e.jsxs("div",{className:"relative",style:{width:a,height:a},children:[e.jsxs("svg",{width:a,height:a,className:"transform -rotate-90",children:[e.jsx("circle",{cx:a/2,cy:a/2,r:n,fill:"none",stroke:"rgba(255,255,255,0.1)",strokeWidth:12}),e.jsx(y.circle,{cx:a/2,cy:a/2,r:n,fill:"none",stroke:m,strokeWidth:12,strokeLinecap:"round",strokeDasharray:t,initial:{strokeDashoffset:t},animate:{strokeDashoffset:o},transition:{duration:1.5,ease:"easeOut"},style:{filter:`drop-shadow(0 0 12px ${m})`}})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx(y.span,{className:"text-5xl font-bold",style:{color:m},initial:{scale:0},animate:{scale:1},transition:{delay:.5,type:"spring",stiffness:200},children:s}),e.jsxs(y.span,{className:"text-2xl text-gray-400 font-medium",initial:{opacity:0},animate:{opacity:1},transition:{delay:.8},children:[r,"%"]})]})]})}function Q({name:r,icon:s,passed:a,failed:h,score:n,color:t}){const o=a+h;return e.jsxs(l,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg",style:{backgroundColor:`${t}20`},children:e.jsx(s,{className:"w-5 h-5",style:{color:t}})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold capitalize",children:r}),e.jsxs("div",{className:"text-xs text-gray-500",children:[a,"/",o," passed"]})]})]}),e.jsxs("div",{className:"text-2xl font-bold",style:{color:n>=80?"#10b981":n>=60?"#f59e0b":"#ef4444"},children:[n,"%"]})]}),e.jsx("div",{className:"h-2 bg-white/10 rounded-full overflow-hidden",children:e.jsx(y.div,{className:"h-full rounded-full",style:{backgroundColor:t},initial:{width:0},animate:{width:`${n}%`},transition:{duration:1,ease:"easeOut",delay:.3}})}),e.jsxs("div",{className:"flex items-center justify-between mt-3 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1 text-green-400",children:[e.jsx(w,{className:"w-3 h-3"}),a," passed"]}),h>0&&e.jsxs("div",{className:"flex items-center gap-1 text-red-400",children:[e.jsx(E,{className:"w-3 h-3"}),h," failed"]})]})]})}function ee({tests:r}){const[s,a]=d.useState(null);if(!r||r.length===0)return e.jsxs(l,{className:"p-6 text-center",children:[e.jsx(w,{className:"w-12 h-12 text-green-400 mx-auto mb-3"}),e.jsx("div",{className:"font-semibold text-green-400",children:"All Tests Passing!"}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"No failed tests to display"})]});const h={core:p,edge:P,security:L,performance:D},n={core:"#8b5cf6",edge:"#06b6d4",security:"#ef4444",performance:"#f59e0b"};return e.jsx("div",{className:"space-y-2",children:r.map((t,o)=>{const x=h[t.category]||p,m=n[t.category]||"#8b5cf6",g=s===o;return e.jsxs(l,{className:"p-0 overflow-hidden cursor-pointer",onClick:()=>a(g?null:o),children:[e.jsxs("div",{className:"p-4 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg flex-shrink-0",style:{backgroundColor:`${m}20`},children:e.jsx(x,{className:"w-4 h-4",style:{color:m}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:t.name}),e.jsxs("div",{className:"text-xs text-gray-500 capitalize",children:[t.category," test"]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs("div",{className:"text-xs text-gray-400",children:[t.duration?.toFixed(0)||0,"ms"]}),g?e.jsx(_,{className:"w-4 h-4 text-gray-500"}):e.jsx(B,{className:"w-4 h-4 text-gray-500"})]})]}),e.jsx($,{children:g&&e.jsx(y.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"border-t border-white/10",children:e.jsxs("div",{className:"p-4 bg-white/5",children:[t.error&&e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Error:"}),e.jsx("div",{className:"text-sm text-red-400 font-mono bg-red-500/10 p-2 rounded",children:t.error})]}),t.details&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Details:"}),e.jsx("pre",{className:"text-xs text-gray-300 font-mono bg-white/5 p-2 rounded overflow-x-auto",children:JSON.stringify(t.details,null,2)})]}),!t.error&&!t.details&&e.jsx("div",{className:"text-sm text-gray-500",children:"No additional details available"})]})})})]},o)})})}function se({data:r}){if(!r||r.length===0)return e.jsxs(l,{className:"p-6 text-center",children:[e.jsx(O,{className:"w-12 h-12 text-gray-500 mx-auto mb-3"}),e.jsx("div",{className:"text-gray-400",children:"No historical data yet"}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"Run tests multiple times to see trends"})]});const s=r.slice().reverse().map(a=>({date:new Date(a.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric"}),score:a.score,passed:a.passed,failed:a.failed}));return e.jsx("div",{className:"h-64",children:e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(z,{data:s,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorScore",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#8b5cf6",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#8b5cf6",stopOpacity:0})]})}),e.jsx(X,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.1)"}),e.jsx(Y,{dataKey:"date",stroke:"#666",fontSize:10,tickLine:!1}),e.jsx(H,{stroke:"#666",fontSize:10,domain:[0,100],tickLine:!1}),e.jsx(K,{contentStyle:{backgroundColor:"rgba(10,10,15,0.95)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"8px",boxShadow:"0 10px 40px rgba(0,0,0,0.5)"},itemStyle:{color:"#fff"},labelStyle:{color:"#888"}}),e.jsx(Z,{type:"monotone",dataKey:"score",stroke:"#8b5cf6",strokeWidth:2,fill:"url(#colorScore)",name:"Score"})]})})})}function ue(){const{user:r}=G(),[s,a]=d.useState(null),[h,n]=d.useState([]),[t,o]=d.useState(!0),[x,m]=d.useState(!1),[g,v]=d.useState(null),u=d.useCallback(()=>{try{const i=localStorage.getItem("musclemap-auth");if(i)return{Authorization:`Bearer ${JSON.parse(i)?.state?.token}`}}catch{}return{}},[]),N=d.useCallback(async()=>{try{o(!0),v(null);const[i,c]=await Promise.all([fetch("/api/admin/test-scorecard",{headers:u()}),fetch("/api/admin/test-scorecard/history?limit=20",{headers:u()})]);if(i.ok){const f=await i.json();a(f.data)}else if(i.status!==404)throw new Error("Failed to fetch scorecard");if(c.ok){const f=await c.json();n(f.data||[])}}catch(i){v(i.message)}finally{o(!1)}},[u]),S=d.useCallback(async()=>{try{m(!0),v(null);const i=await fetch("/api/monitoring/tests/run",{method:"POST",headers:{"Content-Type":"application/json",...u()},body:JSON.stringify({targetUrl:"https://musclemap.me",verbose:!1})});if(!i.ok)throw new Error("Failed to run tests");const c=await i.json(),f=(c.data?.tests||[]).map(j=>({name:j.name,category:j.category||"core",passed:j.passed,duration:j.duration||0,error:j.error,details:j.details})),T=await fetch("/api/admin/test-scorecard",{method:"POST",headers:{"Content-Type":"application/json",...u()},body:JSON.stringify({targetUrl:"https://musclemap.me",environment:"production",results:f,duration:c.summary?.duration||0})});if(T.ok){const j=await T.json();a(j.data)}await N()}catch(i){v(i.message)}finally{m(!1)}},[u,N]);if(d.useEffect(()=>{N()},[N]),!r?.is_admin&&!r?.is_owner&&!r?.roles?.includes("admin"))return e.jsx("div",{className:"min-h-screen bg-[#0a0a0f] text-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(C,{className:"w-16 h-16 text-yellow-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-400",children:"Admin access required to view test scorecard."}),e.jsx(A,{to:"/dashboard",className:"mt-4 inline-block text-violet-400 hover:underline",children:"Return to Dashboard"})]})});const F={core:{icon:p,color:"#8b5cf6"},edge:{icon:P,color:"#06b6d4"},security:{icon:L,color:"#ef4444"},performance:{icon:D,color:"#f59e0b"}};return e.jsxs("div",{className:"min-h-screen bg-[#0a0a0f] text-white",children:[e.jsx("header",{className:"border-b border-white/10 bg-[#0a0a0f]/80 backdrop-blur-xl sticky top-0 z-50",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(A,{to:"/empire",className:"p-2 rounded-lg hover:bg-white/10 transition-colors",children:e.jsx(W,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(p,{className:"w-6 h-6 text-violet-400"}),"Test Scorecard"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"API test results and health"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(k,{variant:"ghost",size:"sm",onClick:N,disabled:t,children:e.jsx(b,{className:`w-4 h-4 ${t?"animate-spin":""}`})}),e.jsx(k,{variant:"primary",size:"sm",onClick:S,disabled:x,leftIcon:x?e.jsx(b,{className:"w-4 h-4 animate-spin"}):e.jsx(R,{className:"w-4 h-4"}),children:x?"Running...":"Run Tests"})]})]})})}),e.jsxs("main",{className:"max-w-7xl mx-auto px-4 py-6 space-y-6",children:[g&&e.jsx(l,{className:"p-4 border border-red-500/30 bg-red-500/10",children:e.jsxs("div",{className:"flex items-center gap-3 text-red-400",children:[e.jsx(C,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{children:g})]})}),t&&!s?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(b,{className:"w-8 h-8 animate-spin text-violet-400"})}):s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs(l,{className:"p-6 flex flex-col items-center justify-center",children:[e.jsx(V,{score:s.score,grade:s.grade}),e.jsxs("div",{className:"mt-4 text-center",children:[e.jsx("div",{className:"text-lg font-semibold",children:"Overall Score"}),e.jsxs("div",{className:"text-sm text-gray-500",children:[s.passed,"/",s.totalTests," tests passing"]})]})]}),e.jsxs("div",{className:"lg:col-span-2 grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(l,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-gray-400",children:"Total Tests"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:s.totalTests})]}),e.jsxs(l,{className:"p-4",children:[e.jsxs("div",{className:"text-sm text-gray-400 flex items-center gap-1",children:[e.jsx(w,{className:"w-3 h-3 text-green-400"}),"Passed"]}),e.jsx("div",{className:"text-2xl font-bold text-green-400",children:s.passed})]}),e.jsxs(l,{className:"p-4",children:[e.jsxs("div",{className:"text-sm text-gray-400 flex items-center gap-1",children:[e.jsx(E,{className:"w-3 h-3 text-red-400"}),"Failed"]}),e.jsx("div",{className:"text-2xl font-bold text-red-400",children:s.failed})]}),e.jsxs(l,{className:"p-4",children:[e.jsxs("div",{className:"text-sm text-gray-400 flex items-center gap-1",children:[e.jsx(J,{className:"w-3 h-3 text-blue-400"}),"Duration"]}),e.jsxs("div",{className:"text-2xl font-bold text-blue-400",children:[(s.duration/1e3).toFixed(1),"s"]})]}),e.jsx("div",{className:"col-span-2 md:col-span-4",children:e.jsxs(l,{className:"p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Target"}),e.jsx("div",{className:"text-sm font-mono text-violet-400",children:s.targetUrl})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Environment"}),e.jsx("div",{className:"text-sm capitalize",children:s.environment})]})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Last run: ",new Date(s.createdAt).toLocaleString()]})]})})]})]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(p,{className:"w-5 h-5 text-violet-400"}),"Category Breakdown"]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-4",children:Object.entries(s.categories||{}).map(([i,c])=>{const f=F[i]||{icon:p,color:"#8b5cf6"};return e.jsx(Q,{name:i,icon:f.icon,color:f.color,passed:c.passed,failed:c.failed,score:c.score},i)})})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5 text-red-400"}),"Failed Tests (",s.failedTests?.length||0,")"]}),e.jsx(ee,{tests:s.failedTests})]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(U,{className:"w-5 h-5 text-yellow-400"}),"Recommendations"]}),e.jsx(l,{className:"p-4",children:s.recommendations?.length>0?e.jsx("ul",{className:"space-y-3",children:s.recommendations.map((i,c)=>e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-yellow-500/20 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-xs font-bold text-yellow-400",children:c+1})}),e.jsx("span",{className:"text-sm text-gray-300",children:i})]},c))}):e.jsxs("div",{className:"text-center py-6",children:[e.jsx(w,{className:"w-10 h-10 text-green-400 mx-auto mb-2"}),e.jsx("div",{className:"text-green-400 font-medium",children:"All Systems Go!"}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"No recommendations at this time"})]})})]})]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(O,{className:"w-5 h-5 text-cyan-400"}),"Score Trend"]}),e.jsx(l,{className:"p-4",children:e.jsx(se,{data:h})})]})]}):e.jsxs(l,{className:"p-12 text-center",children:[e.jsx(p,{className:"w-16 h-16 text-violet-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold mb-2",children:"No Test Results Yet"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"Run the API test suite to generate your first scorecard."}),e.jsx(k,{variant:"primary",onClick:S,disabled:x,leftIcon:x?e.jsx(b,{className:"w-4 h-4 animate-spin"}):e.jsx(R,{className:"w-4 h-4"}),children:x?"Running Tests...":"Run Test Suite"})]})]})]})}export{ue as default};
