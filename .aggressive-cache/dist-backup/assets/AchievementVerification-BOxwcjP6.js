import{l as X,u as Y,r,j as e,L as H}from"./react-vendor-D847gc3Q.js";import{c as u}from"./recharts-vendor-CxtoZpzE.js";import{G as J,m as B}from"./index-DKki0iq-.js";import"./leaflet-vendor-DZbo3Ov0.js";import"./d3-vendor-mcDw60ct.js";import"./apollo-vendor-BNHFeEEc.js";import"./reactflow-vendor-CYb5nRwM.js";const i={Back:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 19l-7-7 7-7"})}),Check:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),Upload:()=>e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),User:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),Search:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),Shield:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})}),X:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M6 18L18 6M6 6l12 12"})}),AlertCircle:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},A={bronze:{label:"Bronze",color:"from-amber-700 to-amber-900",text:"text-amber-500"},silver:{label:"Silver",color:"from-gray-400 to-gray-600",text:"text-gray-400"},gold:{label:"Gold",color:"from-amber-400 to-yellow-600",text:"text-amber-400"},platinum:{label:"Platinum",color:"from-cyan-400 to-blue-600",text:"text-cyan-400"},diamond:{label:"Diamond",color:"from-violet-400 to-purple-600",text:"text-violet-400"}};function re(){const{achievementId:c}=X(),V=Y(),{token:d}=J(),v=r.useRef(null),[l,R]=r.useState(null),[m,U]=r.useState(null),[P,D]=r.useState(!0),[f,g]=r.useState(!1),[w,n]=r.useState(null),[E,F]=r.useState(!1),[x,y]=r.useState(null),[N,k]=r.useState(null),[h,I]=r.useState(""),[p,S]=r.useState(""),[C,b]=r.useState([]),[a,L]=r.useState(null),[T,W]=r.useState(!1);r.useEffect(()=>{$()},[c]);const $=async()=>{try{const t={Authorization:`Bearer ${d}`},[s,o]=await Promise.all([fetch(`/api/achievements/definitions/${c}`,{headers:t}),fetch(`/api/achievements/${c}/can-verify`,{headers:t})]);if(!s.ok)throw new Error("Achievement not found");const j=await s.json(),_=await o.json();R(j.data),U(_.data)}catch(t){n(t.message)}finally{D(!1)}},O=t=>{const s=t.target.files?.[0];if(s){if(!s.type.startsWith("video/")){n("Please select a video file");return}if(s.size>50*1024*1024){n("Video must be less than 50MB");return}y(s),k(URL.createObjectURL(s)),n(null)}},M=r.useCallback(async t=>{if(!t||t.length<2){b([]);return}W(!0);try{const o=await(await fetch(`/api/users/search?q=${encodeURIComponent(t)}&limit=5`,{headers:{Authorization:`Bearer ${d}`}})).json();b(o.data||[])}catch{}finally{W(!1)}},[d]);r.useEffect(()=>{const t=setTimeout(()=>{M(p)},300);return()=>clearTimeout(t)},[p,M]);const G=async t=>{if(t.preventDefault(),!a){n("Please select a witness");return}g(!0),n(null);try{const s=new FormData;s.append("witness_user_id",a.id),h&&s.append("notes",h),x&&s.append("video",x);const o=await fetch(`/api/achievements/${c}/verify`,{method:"POST",headers:{Authorization:`Bearer ${d}`},body:s}),j=await o.json();if(!o.ok)throw new Error(j.error?.message||"Failed to submit verification");F(!0),setTimeout(()=>{V("/achievements/my-verifications")},2e3)}catch(s){n(s.message)}finally{g(!1)}};if(P)return e.jsx("div",{className:"min-h-screen bg-[#0a0a0f] flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 border-2 border-violet-500 border-t-transparent rounded-full animate-spin"})});if(E)return e.jsx("div",{className:"min-h-screen bg-[#0a0a0f] flex items-center justify-center",children:e.jsxs(B.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"text-center p-8",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 rounded-full bg-green-500/20 flex items-center justify-center",children:e.jsx(i.Check,{})}),e.jsx("h2",{className:"text-2xl font-semibold text-white mb-2",children:"Verification Submitted!"}),e.jsx("p",{className:"text-gray-400",children:"Your witness will be notified to confirm your achievement."})]})});const z=A[l?.tier]||A.bronze;return e.jsxs("div",{className:"min-h-screen bg-[#0a0a0f] text-white pb-8",children:[e.jsx("header",{className:"sticky top-0 z-40 bg-[#0a0a0f]/80 backdrop-blur-xl border-b border-white/5",children:e.jsx("div",{className:"max-w-2xl mx-auto px-4 h-16 flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(H,{to:"/achievements",className:"p-2 -ml-2 rounded-xl hover:bg-white/5",children:e.jsx(i.Back,{})}),e.jsx("h1",{className:"text-xl font-semibold",children:"Verify Achievement"})]})})}),e.jsxs("main",{className:"max-w-2xl mx-auto px-4 py-6",children:[l&&e.jsxs(B.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:u("rounded-2xl p-6 mb-6 bg-gradient-to-br",z.color),children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-xl bg-white/20 flex items-center justify-center text-3xl",children:e.jsx(i.Shield,{})}),e.jsxs("div",{children:[e.jsxs("span",{className:u("text-xs font-semibold uppercase tracking-wider opacity-80"),children:[z.label," Tier"]}),e.jsx("h2",{className:"text-2xl font-bold",children:l.name}),e.jsx("p",{className:"text-white/70 text-sm",children:l.description})]})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"px-3 py-1 bg-white/10 rounded-full",children:[l.points," pts"]}),e.jsx("span",{className:"px-3 py-1 bg-white/10 rounded-full capitalize",children:l.rarity})]})]}),m&&!m.canSubmit&&e.jsx("div",{className:"bg-red-500/10 border border-red-500/30 rounded-xl p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(i.AlertCircle,{}),e.jsx("p",{className:"text-red-400",children:m.reason})]})}),m?.canSubmit&&e.jsxs("form",{onSubmit:G,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Video Proof (recommended)"}),e.jsx("div",{onClick:()=>v.current?.click(),className:u("border-2 border-dashed rounded-xl p-8 text-center cursor-pointer transition-colors",x?"border-violet-500/50 bg-violet-500/10":"border-white/10 hover:border-white/20 hover:bg-white/5"),children:N?e.jsxs("div",{className:"space-y-4",children:[e.jsx("video",{src:N,className:"max-h-48 mx-auto rounded-lg",controls:!0}),e.jsx("p",{className:"text-sm text-gray-400",children:x.name}),e.jsx("button",{type:"button",onClick:t=>{t.stopPropagation(),y(null),k(null)},className:"text-red-400 text-sm hover:text-red-300",children:"Remove video"})]}):e.jsxs(e.Fragment,{children:[e.jsx(i.Upload,{}),e.jsx("p",{className:"mt-2 text-sm text-gray-400",children:"Click to upload a video (15-60 seconds)"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"MP4, MOV, or WebM up to 50MB"})]})}),e.jsx("input",{ref:v,type:"file",accept:"video/*",onChange:O,className:"hidden"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Description (optional)"}),e.jsx("textarea",{value:h,onChange:t=>I(t.target.value),placeholder:"Describe when and where you achieved this...",rows:3,maxLength:500,className:"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-violet-500/50 focus:border-violet-500/50 resize-none"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[h.length,"/500 characters"]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Select Witness ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"Choose someone who has seen you perform this feat in person. They must confirm your achievement."}),a?e.jsxs("div",{className:"flex items-center justify-between p-4 bg-violet-500/10 border border-violet-500/30 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-violet-500/20 flex items-center justify-center",children:a.avatarUrl?e.jsx("img",{src:a.avatarUrl,alt:"",className:"w-full h-full rounded-full"}):e.jsx(i.User,{})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.displayName||a.username}),e.jsxs("p",{className:"text-sm text-gray-400",children:["@",a.username]})]})]}),e.jsx("button",{type:"button",onClick:()=>L(null),className:"p-2 hover:bg-white/10 rounded-lg",children:e.jsx(i.X,{})})]}):e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:e.jsx(i.Search,{})}),e.jsx("input",{type:"text",value:p,onChange:t=>S(t.target.value),placeholder:"Search by username...",className:"w-full pl-10 pr-4 py-3 bg-white/5 border border-white/10 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-violet-500/50"}),C.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-[#1a1a2e] border border-white/10 rounded-xl overflow-hidden shadow-xl z-10",children:C.map(t=>e.jsxs("button",{type:"button",onClick:()=>{L(t),S(""),b([])},className:"w-full flex items-center gap-3 p-3 hover:bg-white/5 transition-colors",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-violet-500/20 flex items-center justify-center",children:t.avatarUrl?e.jsx("img",{src:t.avatarUrl,alt:"",className:"w-full h-full rounded-full"}):e.jsx(i.User,{})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-sm font-medium",children:t.displayName||t.username}),e.jsxs("p",{className:"text-xs text-gray-500",children:["@",t.username]})]})]},t.id))}),T&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 p-4 bg-[#1a1a2e] border border-white/10 rounded-xl text-center",children:e.jsx("div",{className:"w-5 h-5 border-2 border-violet-500 border-t-transparent rounded-full animate-spin mx-auto"})})]})]}),w&&e.jsx("div",{className:"p-4 bg-red-500/10 border border-red-500/30 rounded-xl",children:e.jsx("p",{className:"text-red-400 text-sm",children:w})}),e.jsx("button",{type:"submit",disabled:f||!a,className:u("w-full py-4 rounded-xl font-semibold text-lg transition-all",f||!a?"bg-gray-600 text-gray-400 cursor-not-allowed":"bg-gradient-to-r from-violet-600 to-purple-600 hover:from-violet-500 hover:to-purple-500"),children:f?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Submitting..."]}):"Submit for Verification"}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Your witness has 30 days to confirm. If they don't respond, you can submit again with a different witness."})]})]})]})}export{re as default};
