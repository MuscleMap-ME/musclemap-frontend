import{r as a,j as e,h as z}from"./react-vendor-D1NxaRNd.js";import{c as k,y as ne,p as V,A as _,m as A,a4 as q,b7 as ie,b5 as ce,Z as le,b0 as me,ac as de,a_ as he,aW as xe}from"./index-D_LgOQCi.js";import{S as ue}from"./SEO-DrcZOZOH.js";import{L as I}from"./loader-circle-CCc4coOu.js";import{T as E,R as pe}from"./terminal-DQsNtjVQ.js";import{H as ge}from"./history-D7ZLSGdu.js";import{C as W}from"./circle-check-big-DpVWV3CE.js";import{C as fe}from"./copy-BynGt1jV.js";import{T as K}from"./triangle-alert-agl2nJJw.js";import{C as O}from"./chevron-down-pb_2tqF_.js";import{C as G}from"./chevron-right-CAFoEmmn.js";import{S as U}from"./square-DZS8fVM8.js";import{C as D}from"./circle-x-c6ztPbQJ.js";import{S as je}from"./share-2-B7CBHPnZ.js";import{R as we}from"./refresh-cw-3d7SH3Au.js";import{F as ye}from"./file-BjGzhzeU.js";import{F as Ne,L as be,A as ve}from"./lock-mySlDRBt.js";import{S as Ce}from"./shield-alert-1hTeg-SH.js";import{G as Se}from"./gauge-BWs8r6Yu.js";import{H as ke}from"./hard-drive-4o4feSCF.js";import{M as Ae}from"./monitor-DeXkllMz.js";import{K as Te}from"./key-CnDpmyjb.js";import{A as Ee}from"./arrow-up-down-kCfUEXPR.js";import{P as $e}from"./package-Dtrx-pEg.js";import{D as He}from"./download-DeHemhrr.js";import{S as Me}from"./save-DVGY8pQZ.js";import{I as Re}from"./info-C-lmdlM0.js";import{T as _e}from"./trash-2-rVRkL8q8.js";import{S as Ie}from"./server-C83zFG6L.js";import{F as De}from"./file-text-DQugBI4e.js";import{C as Fe}from"./cpu-CK_cEDeI.js";import{L as Le}from"./layers-DnNHvUbc.js";import{D as Pe}from"./database-ZGWOezsT.js";import{G as ze}from"./git-branch-pIYqHrXj.js";import"./leaflet-vendor-DZbo3Ov0.js";import"./apollo-vendor-BMQ75Ycx.js";import"./reactflow-vendor-Dz2P_-Qa.js";import"./d3-vendor-mcDw60ct.js";import"./recharts-vendor-BziRPEEi.js";const Oe=[["path",{d:"M5 21v-6",key:"1hz6c0"}],["path",{d:"M12 21V9",key:"uvy0l4"}],["path",{d:"M19 21V3",key:"11j9sm"}]],Ge=k("chart-no-axes-column-increasing",Oe);const Be=[["path",{d:"m15 12-9.373 9.373a1 1 0 0 1-3.001-3L12 9",key:"1hayfq"}],["path",{d:"m18 15 4-4",key:"16gjal"}],["path",{d:"m21.5 11.5-1.914-1.914A2 2 0 0 1 19 8.172v-.344a2 2 0 0 0-.586-1.414l-1.657-1.657A6 6 0 0 0 12.516 3H9l1.243 1.243A6 6 0 0 1 12 8.485V10l2 2h1.172a2 2 0 0 1 1.414.586L18.5 14.5",key:"15ts47"}]],Ve=k("hammer",Be);const qe=[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]],We=k("network",qe);const Ke=[["path",{d:"M12 16h.01",key:"1drbdi"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M15.312 2a2 2 0 0 1 1.414.586l4.688 4.688A2 2 0 0 1 22 8.688v6.624a2 2 0 0 1-.586 1.414l-4.688 4.688a2 2 0 0 1-1.414.586H8.688a2 2 0 0 1-1.414-.586l-4.688-4.688A2 2 0 0 1 2 15.312V8.688a2 2 0 0 1 .586-1.414l4.688-4.688A2 2 0 0 1 8.688 2z",key:"1fd625"}]],Ue=k("octagon-alert",Ke);const Ze=[["path",{d:"M11 2v2",key:"1539x4"}],["path",{d:"M5 2v2",key:"1yf1q8"}],["path",{d:"M5 3H4a2 2 0 0 0-2 2v4a6 6 0 0 0 12 0V5a2 2 0 0 0-2-2h-1",key:"rb5t3r"}],["path",{d:"M8 15a6 6 0 0 0 12 0v-3",key:"x18d4x"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]],Je=k("stethoscope",Ze);const Qe=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]],Xe=k("wrench",Qe),B={Activity:e.jsx(xe,{className:"w-4 h-4"}),GitBranch:e.jsx(ze,{className:"w-4 h-4"}),Rocket:e.jsx(pe,{className:"w-4 h-4"}),Database:e.jsx(Pe,{className:"w-4 h-4"}),Layers:e.jsx(Le,{className:"w-4 h-4"}),Cpu:e.jsx(Fe,{className:"w-4 h-4"}),Globe:e.jsx(he,{className:"w-4 h-4"}),FileText:e.jsx(De,{className:"w-4 h-4"}),Server:e.jsx(Ie,{className:"w-4 h-4"}),Shield:e.jsx(de,{className:"w-4 h-4"}),Trash2:e.jsx(_e,{className:"w-4 h-4"}),Settings:e.jsx(me,{className:"w-4 h-4"}),AlertOctagon:e.jsx(Ue,{className:"w-4 h-4"}),Stethoscope:e.jsx(Je,{className:"w-4 h-4"}),Info:e.jsx(Re,{className:"w-4 h-4"}),Play:e.jsx(q,{className:"w-4 h-4"}),Save:e.jsx(Me,{className:"w-4 h-4"}),Download:e.jsx(He,{className:"w-4 h-4"}),Archive:e.jsx(ve,{className:"w-4 h-4"}),Package:e.jsx($e,{className:"w-4 h-4"}),Hammer:e.jsx(Ve,{className:"w-4 h-4"}),Terminal:e.jsx(E,{className:"w-4 h-4"}),BarChart:e.jsx(Ge,{className:"w-4 h-4"}),Zap:e.jsx(le,{className:"w-4 h-4"}),Wrench:e.jsx(Xe,{className:"w-4 h-4"}),ArrowUpDown:e.jsx(Ee,{className:"w-4 h-4"}),Key:e.jsx(Te,{className:"w-4 h-4"}),Monitor:e.jsx(Ae,{className:"w-4 h-4"}),HardDrive:e.jsx(ke,{className:"w-4 h-4"}),Gauge:e.jsx(Se,{className:"w-4 h-4"}),Network:e.jsx(We,{className:"w-4 h-4"}),Search:e.jsx(V,{className:"w-4 h-4"}),Heart:e.jsx(ce,{className:"w-4 h-4"}),Lock:e.jsx(be,{className:"w-4 h-4"}),ShieldAlert:e.jsx(Ce,{className:"w-4 h-4"}),Code:e.jsx(ie,{className:"w-4 h-4"}),FileCode:e.jsx(Ne,{className:"w-4 h-4"}),File:e.jsx(ye,{className:"w-4 h-4"}),XCircle:e.jsx(D,{className:"w-4 h-4"}),RefreshCw:e.jsx(we,{className:"w-4 h-4"}),Share2:e.jsx(je,{className:"w-4 h-4"})},Ye="";async function S(t,c={}){const h=localStorage.getItem("musclemap_token");return fetch(`${Ye}${t}`,{...c,headers:{...c.headers,Authorization:`Bearer ${h}`,"Content-Type":"application/json"}})}function Z({status:t}){const c={running:{color:"text-blue-400",icon:e.jsx(I,{className:"w-3 h-3 animate-spin"}),bg:"bg-blue-500/20"},success:{color:"text-green-400",icon:e.jsx(W,{className:"w-3 h-3"}),bg:"bg-green-500/20"},failed:{color:"text-red-400",icon:e.jsx(D,{className:"w-3 h-3"}),bg:"bg-red-500/20"},timeout:{color:"text-orange-400",icon:e.jsx(K,{className:"w-3 h-3"}),bg:"bg-orange-500/20"},cancelled:{color:"text-gray-400",icon:e.jsx(U,{className:"w-3 h-3"}),bg:"bg-gray-500/20"}},{color:h,icon:u,bg:m}=c[t]||c.running;return e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2 py-1 rounded-full text-xs font-medium ${h} ${m}`,children:[u,t]})}function J({command:t,onExecute:c,disabled:h}){const[u,m]=a.useState(!1),d=async()=>{await navigator.clipboard.writeText(t.cmd),m(!0),setTimeout(()=>m(!1),2e3)};return e.jsxs(A.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`
        p-3 rounded-lg border transition-all duration-200
        ${t.dangerous?"bg-red-500/5 border-red-500/20 hover:border-red-500/40":"bg-white/5 border-white/10 hover:border-white/20"}
      `,children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-300 mb-1",children:t.description}),e.jsx("code",{className:"text-xs text-cyan-400 font-mono break-all",children:t.cmd})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx("button",{onClick:d,className:"p-1.5 rounded text-gray-500 hover:text-gray-300 hover:bg-white/10 transition-colors",title:"Copy command",children:u?e.jsx(W,{className:"w-4 h-4 text-green-400"}):e.jsx(fe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>c(t.cmd),disabled:h,className:`
              p-1.5 rounded transition-colors
              ${t.dangerous?"text-red-400 hover:bg-red-500/20":"text-green-400 hover:bg-green-500/20"}
              disabled:opacity-50 disabled:cursor-not-allowed
            `,title:"Execute command",children:e.jsx(q,{className:"w-4 h-4"})})]})]}),t.dangerous&&e.jsxs("div",{className:"mt-2 flex items-center gap-1.5 text-xs text-red-400",children:[e.jsx(K,{className:"w-3 h-3"}),e.jsx("span",{children:"Dangerous operation"})]})]})}function es({category:t,onExecute:c,disabled:h,expandedSubcategories:u,toggleSubcategory:m}){const[d,$]=a.useState(!1);return e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 overflow-hidden",children:[e.jsxs("button",{onClick:()=>$(!d),className:"w-full flex items-center justify-between p-4 hover:bg-white/5 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-gradient-to-br from-cyan-500/20 to-purple-500/20",children:B[t.icon]||e.jsx(E,{className:"w-4 h-4"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"font-semibold text-white",children:t.name}),e.jsx("p",{className:"text-xs text-gray-400",children:t.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:[t.subcategories.reduce((o,g)=>o+g.commands.length,0)," commands"]}),d?e.jsx(O,{className:"w-5 h-5 text-gray-400"}):e.jsx(G,{className:"w-5 h-5 text-gray-400"})]})]}),e.jsx(_,{children:d&&e.jsx(A.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"border-t border-white/10",children:t.subcategories.map(o=>{const g=`${t.name}:${o.name}`,T=u.has(g);return e.jsxs("div",{className:"border-b border-white/5 last:border-b-0",children:[e.jsxs("button",{onClick:()=>m(g),className:"w-full flex items-center justify-between px-4 py-3 hover:bg-white/5 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 rounded bg-white/10",children:B[o.icon]||e.jsx(E,{className:"w-3 h-3"})}),e.jsx("span",{className:"text-sm text-gray-300",children:o.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:o.commands.length}),T?e.jsx(O,{className:"w-4 h-4 text-gray-500"}):e.jsx(G,{className:"w-4 h-4 text-gray-500"})]})]}),e.jsx(_,{children:T&&e.jsx(A.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.15},className:"px-4 pb-4 space-y-2",children:o.commands.map(y=>e.jsx(J,{command:{...y,category:t.name,categoryIcon:t.icon,subcategory:o.name,subcategoryIcon:o.icon},onExecute:c,disabled:h},y.cmd))})})]},o.name)})})})]})}function ss({execution:t,output:c,onCancel:h,onClose:u}){const m=a.useRef(null);return a.useEffect(()=>{m.current&&(m.current.scrollTop=m.current.scrollHeight)},[c]),t?e.jsxs(A.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"fixed inset-x-4 bottom-4 md:inset-x-auto md:right-4 md:bottom-4 md:w-[600px] bg-gray-900 rounded-xl border border-white/10 shadow-2xl overflow-hidden z-50",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-white/10 bg-white/5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Z,{status:t.status}),e.jsx("code",{className:"text-xs text-gray-400 font-mono truncate max-w-[300px]",children:t.command})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.status==="running"&&e.jsx("button",{onClick:h,className:"p-1.5 rounded text-red-400 hover:bg-red-500/20 transition-colors",title:"Cancel execution",children:e.jsx(U,{className:"w-4 h-4"})}),e.jsx("button",{onClick:u,className:"p-1.5 rounded text-gray-400 hover:bg-white/10 transition-colors",title:"Close",children:e.jsx(D,{className:"w-4 h-4"})})]})]}),e.jsx("pre",{ref:m,className:"p-4 text-xs font-mono text-gray-300 bg-black/50 h-64 overflow-auto whitespace-pre-wrap",children:c||"Waiting for output..."})]}):null}function Os(){const{user:t,loading:c,hasHydrated:h}=ne(),[u,m]=a.useState([]),[d,$]=a.useState(""),[o,g]=a.useState([]),[T,y]=a.useState(!1),[Q,X]=a.useState(new Set),[f,p]=a.useState(null),[Y,j]=a.useState(""),[F,ee]=a.useState([]),[H,se]=a.useState(!1),M=a.useRef(null),N=h&&!c&&t&&t.is_admin;a.useEffect(()=>{if(!N)return;async function s(){try{const r=await(await S("/api/admin/commands/hierarchy")).json();m(r.categories||[])}catch{}}s()},[N]),a.useEffect(()=>{if(!N)return;async function s(){try{const r=await(await S("/api/admin/commands/history?limit=20")).json();ee(r.history||[])}catch{}}s()},[N,f?.status]),a.useEffect(()=>{if(!N)return;if(!d.trim()){g([]),y(!1);return}y(!0);const s=setTimeout(async()=>{try{const r=await(await S(`/api/admin/commands/search?q=${encodeURIComponent(d)}`)).json();g(r.results||[])}catch{}finally{y(!1)}},300);return()=>clearTimeout(s)},[N,d]);const R=a.useCallback(async s=>{let l=0;const r=60,w=async()=>{if(l>=r){p(b=>b?{...b,status:"timeout"}:null);return}try{const n=await(await S(`/api/admin/commands/status/${s}`)).json();if(n.output&&j(n.output),n.status!=="running"){p(v=>v?{...v,status:n.status}:null);return}l++,setTimeout(w,500)}catch{l++,setTimeout(w,1e3)}};w()},[]),L=a.useCallback(async s=>{try{const r=await(await S("/api/admin/commands/execute",{method:"POST",body:JSON.stringify({cmd:s})})).json();if(r.executionId){p({id:r.executionId,command:s,status:"running"}),j("");const w=localStorage.getItem("musclemap_token"),b=`/api/admin/commands/stream/${r.executionId}?token=${w}`,n=new EventSource(b);M.current=n;let v=!1,C=null;C=setTimeout(()=>{v||(n.close(),R(r.executionId))},3e3),n.onopen=()=>{},n.onmessage=P=>{v=!0,C&&(clearTimeout(C),C=null);try{const x=JSON.parse(P.data);x.type==="output"?j(i=>i+x.chunk):x.type==="complete"?(p(i=>i?{...i,status:x.status}:null),n.close()):x.type==="timeout"?(p(i=>i?{...i,status:"timeout"}:null),n.close()):x.type==="cancelled"?(p(i=>i?{...i,status:"cancelled"}:null),n.close()):x.type==="history"?(j(x.output||""),p(i=>i?{...i,status:x.status}:null),n.close()):x.type==="error"&&(j(`Error: ${x.message}`),p(i=>i?{...i,status:"failed"}:null),n.close())}catch{}},n.onerror=P=>{C&&clearTimeout(C),n.close(),v||R(r.executionId)}}}catch{}},[R]),te=a.useCallback(async()=>{if(f)try{await S(`/api/admin/commands/cancel/${f.id}`,{method:"POST"})}catch{}},[f]),ae=a.useCallback(()=>{M.current&&M.current.close(),p(null),j("")},[]),re=a.useCallback(s=>{X(l=>{const r=new Set(l);return r.has(s)?r.delete(s):r.add(s),r})},[]);if(!h||c)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 flex items-center justify-center",children:e.jsx(I,{className:"w-8 h-8 animate-spin text-cyan-500"})});if(!t)return e.jsx(z,{to:"/login",replace:!0});if(!t.is_admin)return e.jsx(z,{to:"/dashboard",replace:!0});const oe=u.reduce((s,l)=>s+l.subcategories.reduce((r,w)=>r+w.commands.length,0),0);return e.jsxs(e.Fragment,{children:[e.jsx(ue,{title:"Command Center | Empire",description:"Execute and manage server commands"}),e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900",children:[e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-3 rounded-xl bg-gradient-to-br from-cyan-500/20 to-purple-500/20 border border-cyan-500/20",children:e.jsx(E,{className:"w-6 h-6 text-cyan-400"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Command Center"}),e.jsxs("p",{className:"text-sm text-gray-400",children:[oe," pre-approved commands organized by category"]})]})]})}),e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(V,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500"}),e.jsx("input",{type:"text",value:d,onChange:s=>$(s.target.value),placeholder:"Search commands...",className:"w-full pl-10 pr-4 py-3 rounded-xl bg-white/5 border border-white/10 text-white placeholder-gray-500 focus:outline-none focus:border-cyan-500/50 transition-colors"}),T&&e.jsx(I,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500 animate-spin"})]}),e.jsxs("button",{onClick:()=>se(!H),className:`
                flex items-center gap-2 px-4 py-3 rounded-xl border transition-colors
                ${H?"bg-cyan-500/20 border-cyan-500/30 text-cyan-400":"bg-white/5 border-white/10 text-gray-400 hover:border-white/20"}
              `,children:[e.jsx(ge,{className:"w-5 h-5"}),e.jsx("span",{className:"hidden sm:inline",children:"History"})]})]}),d&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-white mb-3",children:["Search Results (",o.length,")"]}),o.length===0?e.jsxs("p",{className:"text-gray-500 text-sm",children:['No commands found matching "',d,'"']}):e.jsxs("div",{className:"grid gap-2",children:[o.slice(0,20).map(s=>e.jsx(J,{command:s,onExecute:L,disabled:f?.status==="running"},s.cmd)),o.length>20&&e.jsxs("p",{className:"text-sm text-gray-500 text-center py-2",children:["Showing first 20 of ",o.length," results"]})]})]}),e.jsx(_,{children:H&&e.jsx(A.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-6 overflow-hidden",children:e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-3",children:"Recent Executions"}),F.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"No execution history"}):e.jsx("div",{className:"space-y-2 max-h-64 overflow-auto",children:F.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-white/5 hover:bg-white/10 transition-colors cursor-pointer",onClick:()=>{p({id:s.id,command:s.command,status:s.status}),j(s.output||"")},children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx(Z,{status:s.status}),e.jsx("code",{className:"text-xs text-gray-400 font-mono truncate",children:s.command})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[s.durationMs&&e.jsxs("span",{children:[(s.durationMs/1e3).toFixed(1),"s"]}),e.jsx("span",{children:new Date(s.startedAt).toLocaleTimeString()})]})]},s.id))})]})})}),!d&&e.jsx("div",{className:"space-y-4",children:u.map(s=>e.jsx(es,{category:s,onExecute:L,disabled:f?.status==="running",expandedSubcategories:Q,toggleSubcategory:re},s.name))})]}),e.jsx(ss,{execution:f,output:Y,onCancel:te,onClose:ae})]})]})}export{Os as default};
