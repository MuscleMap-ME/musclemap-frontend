import{l as O,d as W,r as o,j as e,L as k}from"./react-vendor-D1NxaRNd.js";import{y as R,u as H,m as _}from"./index-VPOrxyVC.js";import{a as F}from"./sanitize-CfVRSXz9.js";import{a as C,f as B}from"./date-vendor-C_JWt2cu.js";import"./leaflet-vendor-DZbo3Ov0.js";import"./apollo-vendor-D9c7jRvS.js";import"./reactflow-vendor-Dz2P_-Qa.js";import"./d3-vendor-mcDw60ct.js";import"./recharts-vendor-BziRPEEi.js";const l={Back:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 19l-7-7 7-7"})}),ChevronUp:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})}),Bell:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})}),BellOff:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11M6.26 6.26A5.86 5.86 0 006 8v3.159c0 .538-.214 1.055-.595 1.436L4 14h9m2 3a3 3 0 11-6 0m13-11L3 21"})}),Pin:()=>e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M16 12V4h1V2H7v2h1v8l-2 2v2h5.2v6h1.6v-6H18v-2l-2-2z"})}),Lock:()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),Check:()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),Eye:()=>e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),User:()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),Calendar:()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})},S={0:{label:"Bug",color:"bg-red-500/20 text-red-400",icon:"ðŸ›"},1:{label:"Feature",color:"bg-green-500/20 text-green-400",icon:"âœ¨"},2:{label:"Enhancement",color:"bg-blue-500/20 text-blue-400",icon:"ðŸ’¡"},3:{label:"Account",color:"bg-orange-500/20 text-orange-400",icon:"ðŸ‘¤"},4:{label:"Question",color:"bg-pink-500/20 text-pink-400",icon:"â“"},5:{label:"Other",color:"bg-gray-500/20 text-gray-400",icon:"ðŸ“"}},L={0:{label:"Open",color:"bg-green-500",textColor:"text-green-400"},1:{label:"In Progress",color:"bg-blue-500",textColor:"text-blue-400"},2:{label:"Under Review",color:"bg-purple-500",textColor:"text-purple-400"},3:{label:"Resolved",color:"bg-emerald-500",textColor:"text-emerald-400"},4:{label:"Closed",color:"bg-gray-500",textColor:"text-gray-400"},5:{label:"Won't Fix",color:"bg-red-500",textColor:"text-red-400"},6:{label:"Duplicate",color:"bg-yellow-500",textColor:"text-yellow-400"}},M={0:{label:"Low",color:"text-gray-400"},1:{label:"Medium",color:"text-blue-400"},2:{label:"High",color:"text-orange-400"},3:{label:"Critical",color:"text-red-400"}};function J({comment:a,isStaff:n,onMarkSolution:i,canMarkSolution:c}){const s=a.isStaffReply||a.authorRoles?.includes("admin")||a.authorRoles?.includes("moderator");return e.jsx(_.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`rounded-xl p-4 ${a.isSolution?"bg-green-500/10 border-2 border-green-500/50":s?"bg-purple-500/10 border border-purple-500/30":"bg-gray-800/50 border border-gray-700/50"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center flex-shrink-0",children:a.authorAvatarUrl?e.jsx("img",{src:a.authorAvatarUrl,alt:"",className:"w-10 h-10 rounded-full object-cover"}):e.jsx("span",{className:"text-lg",children:a.authorUsername?.[0]?.toUpperCase()||"?"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-2",children:[e.jsx("span",{className:"font-semibold text-white",children:a.authorDisplayName||a.authorUsername||"Unknown"}),s&&e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-purple-500/30 text-purple-300",children:"Staff"}),a.isSolution&&e.jsxs("span",{className:"text-xs px-2 py-0.5 rounded-full bg-green-500/30 text-green-300 flex items-center gap-1",children:[e.jsx(l.Check,{})," Solution"]}),e.jsx("span",{className:"text-xs text-gray-500",children:B(new Date(a.createdAt),{addSuffix:!0})}),a.editCount>0&&e.jsx("span",{className:"text-xs text-gray-600",children:"(edited)"})]}),e.jsx("div",{className:"text-gray-300 whitespace-pre-wrap break-words",children:a.content}),c&&!a.isSolution&&e.jsxs("button",{onClick:()=>i(a.id),className:"mt-3 text-xs text-gray-400 hover:text-green-400 flex items-center gap-1",children:[e.jsx(l.Check,{})," Mark as solution"]})]})]})})}function re(){const{id:a}=O(),{token:n}=R(),{user:i}=H(),c=W(),[s,x]=o.useState(null),[h,g]=o.useState([]),[U,A]=o.useState(!0),[m,f]=o.useState(""),[y,N]=o.useState(!1),[$,v]=o.useState(!1),[z,w]=o.useState(!1),j=i?.is_admin||i?.roles?.includes("admin")||i?.roles?.includes("moderator");o.useEffect(()=>{P(),I()},[a]);const P=async()=>{try{const t=n?{Authorization:`Bearer ${n}`}:{},r=await fetch(`/api/issues/${a}`,{headers:t});if(!r.ok)throw new Error("Issue not found");const b=await r.json();x(b.data)}catch{c("/issues")}finally{A(!1)}},I=async()=>{try{const r=await(await fetch(`/api/issues/${a}/comments`)).json();g(r.data||[])}catch{}},E=async()=>{if(!n){c("/login");return}v(!0);try{const r=await(await fetch(`/api/issues/${s.id}/vote`,{method:"POST",headers:{Authorization:`Bearer ${n}`}})).json();r.data&&x({...s,hasVoted:r.data.voted,voteCount:r.data.voteCount})}catch{}finally{v(!1)}},T=async()=>{if(!n){c("/login");return}w(!0);try{const r=await(await fetch(`/api/issues/${s.id}/subscribe`,{method:"POST",headers:{Authorization:`Bearer ${n}`}})).json();r.data&&x({...s,isSubscribed:r.data.subscribed,subscriberCount:r.data.subscriberCount})}catch{}finally{w(!1)}},V=async t=>{if(t.preventDefault(),!(!m.trim()||!n)){N(!0);try{const b=await(await fetch(`/api/issues/${s.id}/comments`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({content:F(m)})})).json();b.data&&(g([...h,b.data]),f(""),x({...s,commentCount:s.commentCount+1}))}catch{}finally{N(!1)}}},D=async t=>{try{await fetch(`/api/issues/${s.id}/comments/${t}/solution`,{method:"POST",headers:{Authorization:`Bearer ${n}`}}),g(h.map(r=>({...r,isSolution:r.id===t})))}catch{}};if(U)return e.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 border-2 border-purple-500 border-t-transparent rounded-full animate-spin"})});if(!s)return null;const d=S[s.type]||S[5],u=L[s.status]||L[0],p=M[s.priority]||M[1];return e.jsxs("div",{className:"min-h-screen bg-gray-900 text-white pb-24",children:[e.jsx("header",{className:"bg-gray-800 border-b border-gray-700 sticky top-0 z-20",children:e.jsx("div",{className:"max-w-5xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(k,{to:"/issues",className:"text-gray-400 hover:text-white flex items-center gap-2",children:[e.jsx(l.Back,{}),e.jsx("span",{className:"hidden sm:inline",children:"Back to Issues"})]}),e.jsxs("span",{className:"text-gray-500 text-sm",children:["#",s.issueNumber]})]})})}),e.jsx("main",{className:"max-w-5xl mx-auto px-4 py-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"bg-gray-800/50 rounded-xl p-6 border border-gray-700/50 mb-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("button",{onClick:E,disabled:$,className:`flex flex-col items-center justify-center w-16 h-20 rounded-xl transition-colors ${s.hasVoted?"bg-purple-600/30 text-purple-400":"bg-gray-700/50 text-gray-400 hover:bg-gray-700 hover:text-white"}`,children:[e.jsx(l.ChevronUp,{}),e.jsx("span",{className:"text-xl font-bold",children:s.voteCount}),e.jsx("span",{className:"text-xs",children:"votes"})]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-3",children:[s.isPinned&&e.jsx("span",{className:"text-yellow-400",title:"Pinned",children:e.jsx(l.Pin,{})}),s.isLocked&&e.jsx("span",{className:"text-gray-400",title:"Locked",children:e.jsx(l.Lock,{})}),e.jsxs("span",{className:`text-sm px-3 py-1 rounded-full ${d.color}`,children:[d.icon," ",d.label]}),e.jsx("span",{className:`text-sm px-3 py-1 rounded-full ${u.color} text-white`,children:u.label}),e.jsxs("span",{className:`text-sm ${p.color}`,children:[p.label," Priority"]})]}),e.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:s.title}),e.jsx("div",{className:"prose prose-invert max-w-none",children:e.jsx("p",{className:"text-gray-300 whitespace-pre-wrap",children:s.description})}),s.labels&&s.labels.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-4",children:s.labels.map(t=>e.jsxs("span",{className:"text-sm px-3 py-1 rounded-full",style:{backgroundColor:`${t.color}20`,color:t.color},children:[t.icon," ",t.name]},t.id))}),s.screenshotUrls&&s.screenshotUrls.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-400 mb-2",children:"Screenshots"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:s.screenshotUrls.map((t,r)=>e.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"block w-24 h-24 rounded-lg overflow-hidden border border-gray-700 hover:border-purple-500 transition-colors",children:e.jsx("img",{src:t,alt:"",className:"w-full h-full object-cover"})},r))})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-6 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(l.User,{}),s.authorDisplayName||s.authorUsername]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(l.Calendar,{}),C(new Date(s.createdAt),"MMM d, yyyy")]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(l.Eye,{}),s.viewCount," views"]})]})]})]})}),e.jsxs("div",{className:"bg-gray-800/30 rounded-xl p-6 border border-gray-700/50",children:[e.jsxs("h2",{className:"text-lg font-semibold text-white mb-4",children:["Comments (",s.commentCount,")"]}),e.jsx("div",{className:"space-y-4 mb-6",children:h.length===0?e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No comments yet. Be the first to respond!"}):h.map(t=>e.jsx(J,{comment:t,isStaff:j,canMarkSolution:j,onMarkSolution:D},t.id))}),i?s.isLocked&&!j?e.jsxs("div",{className:"bg-gray-700/30 rounded-lg p-4 text-center text-gray-400",children:[e.jsx(l.Lock,{}),e.jsx("p",{className:"mt-2",children:"This issue is locked. Only moderators can comment."})]}):e.jsxs("form",{onSubmit:V,children:[e.jsx("textarea",{value:m,onChange:t=>f(t.target.value),placeholder:"Write a comment...",rows:4,className:"w-full bg-gray-800 border border-gray-700 rounded-lg p-4 text-white placeholder-gray-500 focus:outline-none focus:border-purple-500 resize-none"}),e.jsx("div",{className:"flex justify-end mt-3",children:e.jsx("button",{type:"submit",disabled:!m.trim()||y,className:"bg-purple-600 hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed px-6 py-2 rounded-lg font-medium transition-colors",children:y?"Posting...":"Post Comment"})})]}):e.jsxs("div",{className:"bg-gray-700/30 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-gray-400 mb-3",children:"Sign in to leave a comment"}),e.jsx(k,{to:"/login",className:"inline-block bg-purple-600 hover:bg-purple-700 px-6 py-2 rounded-lg font-medium transition-colors",children:"Sign In"})]})]})]}),e.jsxs("aside",{className:"w-full lg:w-72 flex-shrink-0 space-y-4",children:[e.jsxs("div",{className:"bg-gray-800/50 rounded-xl p-4 border border-gray-700/50",children:[e.jsx("h3",{className:"font-semibold text-white mb-3",children:"Actions"}),e.jsx("div",{className:"space-y-2",children:e.jsxs("button",{onClick:T,disabled:z,className:`w-full flex items-center justify-center gap-2 px-4 py-2 rounded-lg transition-colors ${s.isSubscribed?"bg-purple-600/20 text-purple-400 border border-purple-500/30":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:[s.isSubscribed?e.jsx(l.BellOff,{}):e.jsx(l.Bell,{}),s.isSubscribed?"Unsubscribe":"Subscribe"]})}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2 text-center",children:[s.subscriberCount," subscriber",s.subscriberCount!==1?"s":""]})]}),e.jsxs("div",{className:"bg-gray-800/50 rounded-xl p-4 border border-gray-700/50",children:[e.jsx("h3",{className:"font-semibold text-white mb-3",children:"Details"}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Status"}),e.jsx("span",{className:u.textColor,children:u.label})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Priority"}),e.jsx("span",{className:p.color,children:p.label})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Type"}),e.jsxs("span",{children:[d.icon," ",d.label]})]}),s.assigneeUsername&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Assignee"}),e.jsx("span",{className:"text-white",children:s.assigneeDisplayName||s.assigneeUsername})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Created"}),e.jsx("span",{className:"text-white",children:C(new Date(s.createdAt),"MMM d, yyyy")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Updated"}),e.jsx("span",{className:"text-white",children:B(new Date(s.updatedAt),{addSuffix:!0})})]})]})]}),s.resolutionNote&&e.jsxs("div",{className:"bg-green-500/10 rounded-xl p-4 border border-green-500/30",children:[e.jsx("h3",{className:"font-semibold text-green-400 mb-2",children:"Resolution"}),e.jsx("p",{className:"text-sm text-gray-300",children:s.resolutionNote})]}),s.browserInfo&&e.jsxs("div",{className:"bg-gray-800/50 rounded-xl p-4 border border-gray-700/50",children:[e.jsx("h3",{className:"font-semibold text-white mb-3",children:"Environment"}),e.jsx("div",{className:"space-y-1 text-xs text-gray-400",children:Object.entries(s.browserInfo).map(([t,r])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:t}),e.jsx("span",{className:"text-gray-300 truncate ml-2",children:String(r)})]},t))})]})]})]})})]})}export{re as default};
