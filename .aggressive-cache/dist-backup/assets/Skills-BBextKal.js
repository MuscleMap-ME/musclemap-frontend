import{l as $,d as C,r as n,j as e,L}from"./react-vendor-D1NxaRNd.js";import{H as I}from"./index-C8OGbIE3.js";import"./leaflet-vendor-DZbo3Ov0.js";import"./apollo-vendor-BMQ75Ycx.js";import"./reactflow-vendor-Dz2P_-Qa.js";import"./d3-vendor-mcDw60ct.js";import"./recharts-vendor-BziRPEEi.js";const S=({difficulty:s})=>e.jsx("div",{className:"flex gap-0.5",children:[1,2,3,4,5].map(l=>e.jsx("span",{className:l<=s?"text-yellow-400":"text-gray-600",children:"‚òÖ"},l))}),P=({status:s})=>{const l={locked:"bg-gray-700 text-gray-400",available:"bg-blue-600 text-white",in_progress:"bg-yellow-600 text-white",achieved:"bg-green-600 text-white"},a={locked:"üîí Locked",available:"‚ú® Available",in_progress:"üî• In Progress",achieved:"üèÜ Achieved"};return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${l[s]||l.locked}`,children:a[s]||s})},M=({node:s,onClick:l})=>{const a=s.progress?.status||"locked",o=a==="locked";return e.jsxs("button",{onClick:()=>!o&&l(s),disabled:o,className:`w-full p-4 rounded-xl border-2 transition-all text-left ${o?"bg-gray-800/50 border-gray-700 opacity-60 cursor-not-allowed":a==="achieved"?"bg-gradient-to-br from-green-900/50 to-green-800/30 border-green-600 hover:border-green-500":a==="in_progress"?"bg-gradient-to-br from-yellow-900/50 to-yellow-800/30 border-yellow-600 hover:border-yellow-500":"bg-gray-800 border-gray-600 hover:border-blue-500 hover:bg-gray-700"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"font-bold text-white",children:s.name}),e.jsx(P,{status:a})]}),e.jsx("p",{className:"text-sm text-gray-400 mb-3",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(S,{difficulty:s.difficulty}),e.jsxs("span",{className:"text-xs text-gray-500",children:[s.criteriaType==="hold"&&`Hold ${s.criteriaValue}s`,s.criteriaType==="reps"&&`${s.criteriaValue} reps`,s.criteriaType==="time"&&`${s.criteriaValue}s time`,s.criteriaType==="form_check"&&"Form check"]})]}),s.progress?.bestValue!=null&&e.jsxs("div",{className:"mt-2 text-sm text-blue-400",children:["Best: ",s.progress.bestValue,s.criteriaType==="hold"||s.criteriaType==="time"?"s":" reps"]})]})},R=({skill:s,onClose:l,onLogPractice:a,onAchieve:o})=>{const[m,x]=n.useState(10),[c,u]=n.useState(""),[r,d]=n.useState(""),[h,g]=n.useState(!1),j=async()=>{g(!0),await a({skillNodeId:s.id,durationMinutes:m,valueAchieved:c?parseInt(c):void 0,notes:r||void 0}),g(!1),l()},f=async()=>{g(!0),await o({skillNodeId:s.id}),g(!1),l()},p=s.progress?.status||"available";return e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-gray-800 rounded-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:s.name}),e.jsx(P,{status:p})]}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-white text-2xl",children:"√ó"})]}),e.jsx("p",{className:"text-gray-300 mb-4",children:s.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gray-700 rounded-lg p-3",children:[e.jsx("div",{className:"text-gray-400 text-sm",children:"Difficulty"}),e.jsx(S,{difficulty:s.difficulty})]}),e.jsxs("div",{className:"bg-gray-700 rounded-lg p-3",children:[e.jsx("div",{className:"text-gray-400 text-sm",children:"Goal"}),e.jsx("div",{className:"text-white font-medium",children:s.criteriaDescription})]}),e.jsxs("div",{className:"bg-gray-700 rounded-lg p-3",children:[e.jsx("div",{className:"text-gray-400 text-sm",children:"XP Reward"}),e.jsxs("div",{className:"text-green-400 font-medium",children:["+",s.xpReward," XP"]})]}),e.jsxs("div",{className:"bg-gray-700 rounded-lg p-3",children:[e.jsx("div",{className:"text-gray-400 text-sm",children:"Credit Reward"}),e.jsxs("div",{className:"text-yellow-400 font-medium",children:["+",s.creditReward," üí∞"]})]})]}),s.tips?.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-2",children:"Tips"}),e.jsx("ul",{className:"space-y-2",children:s.tips.map((i,N)=>e.jsxs("li",{className:"flex items-start gap-2 text-gray-300",children:[e.jsx("span",{className:"text-green-400",children:"‚úì"}),i]},N))})]}),p!=="achieved"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"border-t border-gray-700 pt-4 mt-4",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Log Practice"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Duration (minutes)"}),e.jsx("input",{type:"number",value:m,onChange:i=>x(parseInt(i.target.value)||0),className:"w-full bg-gray-700 rounded-lg px-4 py-2 text-white",min:"1"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-400 mb-1",children:["Value achieved (",s.criteriaType==="hold"||s.criteriaType==="time"?"seconds":"reps",")"]}),e.jsx("input",{type:"number",value:c,onChange:i=>u(i.target.value),className:"w-full bg-gray-700 rounded-lg px-4 py-2 text-white",placeholder:"Optional"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Notes"}),e.jsx("textarea",{value:r,onChange:i=>d(i.target.value),className:"w-full bg-gray-700 rounded-lg px-4 py-2 text-white resize-none",rows:2,placeholder:"How did it go?"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:j,disabled:h||m<1,className:"flex-1 bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-lg disabled:opacity-50",children:h?"Saving...":"Log Practice"}),c&&parseInt(c)>=(s.criteriaValue||0)&&e.jsx("button",{onClick:f,disabled:h,className:"flex-1 bg-green-600 hover:bg-green-500 text-white font-bold py-3 rounded-lg disabled:opacity-50",children:"üèÜ Mark Achieved!"})]})]})]})}),p==="achieved"&&e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"text-6xl mb-4",children:"üèÜ"}),e.jsx("div",{className:"text-green-400 font-bold text-lg",children:"Skill Mastered!"}),s.progress?.achievedAt&&e.jsxs("div",{className:"text-gray-400 text-sm mt-2",children:["Achieved on ",new Date(s.progress.achievedAt).toLocaleDateString()]})]})]})})})},E=({tree:s,progress:l,onLogPractice:a,onAchieve:o})=>{const[m,x]=n.useState(null),c={};l.forEach(r=>{c[r.tier]||(c[r.tier]=[]),c[r.tier].push(r)});const u={1:"Foundation",2:"Intermediate",3:"Advanced",4:"Expert",5:"Master"};return e.jsxs("div",{children:[e.jsx("div",{className:`rounded-xl p-4 mb-6 bg-gradient-to-r ${s.color||"from-purple-500 to-pink-500"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-4xl",children:s.icon}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:s.name}),e.jsx("p",{className:"text-white/80",children:s.description})]})]})}),Object.keys(c).sort((r,d)=>parseInt(r)-parseInt(d)).map(r=>e.jsxs("div",{className:"mb-8",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-300 mb-4 flex items-center gap-2",children:[e.jsxs("span",{className:"bg-gray-700 px-3 py-1 rounded-full text-sm",children:["Tier ",r]}),u[r]]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:c[r].sort((d,h)=>d.position-h.position).map(d=>e.jsx(M,{node:d,onClick:x},d.id))})]},r)),m&&e.jsx(R,{skill:m,onClose:()=>x(null),onLogPractice:a,onAchieve:o})]})},k=({summary:s})=>{if(!s)return null;const l=s.totalSkills>0?Math.round(s.achievedSkills/s.totalSkills*100):0;return e.jsxs("div",{className:"bg-gradient-to-br from-purple-900/50 to-blue-900/50 rounded-xl p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Your Progress"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-400",children:s.achievedSkills}),e.jsx("div",{className:"text-gray-400 text-sm",children:"Mastered"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-yellow-400",children:s.inProgressSkills}),e.jsx("div",{className:"text-gray-400 text-sm",children:"In Progress"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-400",children:s.availableSkills}),e.jsx("div",{className:"text-gray-400 text-sm",children:"Available"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-3xl font-bold text-purple-400",children:[Math.floor((s.totalPracticeMinutes??0)/60),"h"]}),e.jsx("div",{className:"text-gray-400 text-sm",children:"Practice Time"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-400 mb-1",children:[e.jsx("span",{children:"Overall Progress"}),e.jsxs("span",{children:[l,"%"]})]}),e.jsx("div",{className:"h-2 bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-green-500 to-emerald-400 transition-all",style:{width:`${l}%`}})})]})]})};function H(){const{treeId:s}=$(),l=C(),{token:a}=I(),[o,m]=n.useState([]),[x,c]=n.useState(null),[u,r]=n.useState([]),[d,h]=n.useState(null),[g,j]=n.useState(!0),[f,p]=n.useState(null),i={Authorization:`Bearer ${a}`};n.useEffect(()=>{fetch("/api/skills/trees").then(t=>t.json()).then(t=>{m(t.trees||[])}).catch(t=>p(t.message)).finally(()=>j(!1))},[]),n.useEffect(()=>{a&&fetch("/api/skills/progress",{headers:i}).then(t=>t.json()).then(h).catch(()=>{})},[a]),n.useEffect(()=>{if(!s){c(null),r([]);return}j(!0),Promise.all([fetch(`/api/skills/trees/${s}`).then(t=>t.json()),a?fetch(`/api/skills/trees/${s}/progress`,{headers:i}).then(t=>t.json()):Promise.resolve({nodes:[]})]).then(([t,b])=>{c(t.tree),r(b.nodes||[])}).catch(t=>p(t.message)).finally(()=>j(!1))},[s,a]);const N=async t=>{if(!a){alert("Please log in to track your progress");return}try{if((await(await fetch("/api/skills/practice",{method:"POST",headers:{...i,"Content-Type":"application/json"},body:JSON.stringify(t)})).json()).practiceLog){const y=await(await fetch(`/api/skills/trees/${s}/progress`,{headers:i})).json();r(y.nodes||[]);const w=await fetch("/api/skills/progress",{headers:i});h(await w.json())}}catch{alert("Failed to log practice")}},T=async t=>{if(!a){alert("Please log in to track your progress");return}try{const v=await(await fetch("/api/skills/achieve",{method:"POST",headers:{...i,"Content-Type":"application/json"},body:JSON.stringify(t)})).json();if(v.success){alert(`üèÜ Skill achieved! +${v.creditsAwarded} credits, +${v.xpAwarded} XP`);const y=await(await fetch(`/api/skills/trees/${s}/progress`,{headers:i})).json();r(y.nodes||[]);const w=await fetch("/api/skills/progress",{headers:i});h(await w.json())}else alert(v.error||"Failed to achieve skill")}catch{alert("Failed to achieve skill")}};return g&&!o.length?e.jsx("div",{className:"min-h-screen bg-gray-900 text-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"üèãÔ∏è"}),e.jsx("div",{children:"Loading skills..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-900 text-white pb-24",children:[e.jsx("header",{className:"bg-gray-800 p-4 sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-6xl mx-auto flex items-center justify-between",children:[e.jsxs(L,{to:s?"/skills":"/dashboard",className:"text-blue-400",children:["‚Üê ",s?"All Trees":"Back"]}),e.jsx("h1",{className:"text-xl font-bold",children:x?x.name:"Skill Trees"}),e.jsx("div",{className:"w-16"})]})}),e.jsxs("main",{className:"max-w-6xl mx-auto p-4",children:[f&&e.jsx("div",{className:"bg-red-900/50 border border-red-600 rounded-lg p-4 mb-4",children:f}),s?e.jsxs(e.Fragment,{children:[a&&e.jsx(k,{summary:d}),x&&e.jsx(E,{tree:x,progress:u,onLogPractice:N,onAchieve:T})]}):e.jsxs(e.Fragment,{children:[a&&e.jsx(k,{summary:d}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Skill Trees"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"Master bodyweight skills from beginner to elite. Track your progress, log practice sessions, and earn rewards as you unlock new abilities."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o.map(t=>e.jsxs("button",{onClick:()=>l(`/skills/${t.id}`),className:`p-6 rounded-xl text-left transition-all hover:scale-[1.02] bg-gradient-to-br ${t.color||"from-purple-500 to-pink-500"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("span",{className:"text-4xl",children:t.icon}),e.jsx("h3",{className:"text-xl font-bold text-white",children:t.name})]}),e.jsx("p",{className:"text-white/80 text-sm",children:t.description})]},t.id))}),e.jsxs("div",{className:"mt-12 bg-gray-800 rounded-xl p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"How It Works"}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl mb-2",children:"üìö"}),e.jsx("h4",{className:"font-bold text-white mb-1",children:"Choose a Path"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Select a skill tree to focus on. Each tree has progressive skills from foundation to master level."})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl mb-2",children:"üéØ"}),e.jsx("h4",{className:"font-bold text-white mb-1",children:"Practice & Progress"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Log your practice sessions and track your best attempts. Unlock new skills by completing prerequisites."})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl mb-2",children:"üèÜ"}),e.jsx("h4",{className:"font-bold text-white mb-1",children:"Earn Rewards"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Get XP and credits for mastering skills. Compete on leaderboards and show off your achievements."})]})]})]})]})]})]})}export{H as default};
