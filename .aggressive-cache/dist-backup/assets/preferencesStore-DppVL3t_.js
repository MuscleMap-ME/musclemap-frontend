import{an as h,ao as p,ap as m}from"./index-Bcbmw5yO.js";const a={coaching:{maxCoachVisible:!0,mascotVisible:!0,coachTipsEnabled:!0,motivationalQuotes:!0,formCuesEnabled:!0,voiceGuidanceEnabled:!1},guidanceLevel:"intermediate",dashboard:{layout:"default",showQuickActions:!0,showDailyTip:!0,showMilestones:!0,showAdventureMap:!0,showMuscleMap:!0,showNutrition:!0,showChallenges:!0,showInsights:!0,showActivity:!0,showHydration:!0,showMusicPlayer:!0,showCoachTips:!0,showXpProgress:!0,showDailyQuests:!0},notifications:{achievementsEnabled:!0,goalSuccessEnabled:!0,workoutReminders:!0,socialNotifications:!0,systemAnnouncements:!0,quietHoursEnabled:!1,quietHoursStart:"22:00",quietHoursEnd:"07:00",pushEnabled:!0,emailEnabled:!0},hydration:{enabled:!0,intervalMinutes:15,soundEnabled:!0,vibrationEnabled:!0,showDuringWorkout:!0,showOutsideWorkout:!1,dailyGoalOz:64},sounds:{masterVolume:.7,timerSoundEnabled:!0,timerSoundType:"beep",timerVibrationEnabled:!0,metronomeEnabled:!1,metronomeBpm:60,metronomeAccent:4,repCountSoundEnabled:!1,setCompleteSoundEnabled:!0,workoutCompleteSoundEnabled:!0,achievementSoundEnabled:!0,customSoundPackId:null,systemSoundPackId:"default"},workout:{defaultRestSeconds:90,autoStartTimer:!0,showFloatingTimer:!0,countdownWarningSeconds:10,warmupReminder:!0,cooldownReminder:!0,stretchReminder:!1,quickAdjustAmount:30},display:{theme:"dark",reducedMotion:!1,highContrast:!1,textSize:"normal",colorBlindMode:"none",animationsEnabled:!0},units:{weight:"lbs",distance:"mi",height:"ft_in",temperature:"f"},privacy:{publicProfile:!0,showLocation:!1,showProgress:!0,showWorkoutDetails:!0,showOnLeaderboards:!0,showAchievementsOnProfile:!0},music:{autoPlayOnWorkout:!0,bpmMatchingEnabled:!1,defaultProvider:null,defaultPlaylistId:null,fadeOnRest:!0,volumeReductionOnTips:!0,tipVolumeReduction:.5}};function u(r){return{coaching:{...a.coaching,...r.coaching},guidanceLevel:r.guidanceLevel??a.guidanceLevel,dashboard:{...a.dashboard,...r.dashboard},notifications:{...a.notifications,...r.notifications},hydration:{...a.hydration,...r.hydration},sounds:{...a.sounds,...r.sounds},workout:{...a.workout,...r.workout},display:{...a.display,...r.display},units:{...a.units,...r.units},privacy:{...a.privacy,...r.privacy},music:{...a.music,...r.music}}}function y(r,o){return{coaching:{...r.coaching,...o.coaching},guidanceLevel:o.guidanceLevel??r.guidanceLevel,dashboard:{...r.dashboard,...o.dashboard},notifications:{...r.notifications,...o.notifications},hydration:{...r.hydration,...o.hydration},sounds:{...r.sounds,...o.sounds},workout:{...r.workout,...o.workout},display:{...r.display,...o.display},units:{...r.units,...o.units},privacy:{...r.privacy,...o.privacy},music:{...r.music,...o.music}}}const f=()=>localStorage.getItem("musclemap_token");async function c(r,o={}){const e=f(),t={"Content-Type":"application/json",...o.headers||{}};return e&&(t.Authorization=`Bearer ${e}`),fetch(r,{...o,headers:t})}const l=h()(p(m((r,o)=>({preferences:a,activeProfileId:null,profiles:[],version:0,isLoading:!1,isSaving:!1,error:null,lastSyncAt:null,deviceId:null,loadPreferences:async()=>{if(!f()){r({isLoading:!1});return}r({isLoading:!0,error:null});try{const t=await c("/api/me/preferences");if(!t.ok)throw new Error("Failed to load preferences");const i=await t.json();if(i.success&&i.data){const n=u(i.data.preferences||{});r({preferences:n,activeProfileId:i.data.activeProfileId||null,version:i.data.version||1,isLoading:!1,lastSyncAt:new Date().toISOString()})}}catch(t){r({error:t instanceof Error?t.message:"Failed to load preferences",isLoading:!1})}},updatePreferences:async e=>{r({isSaving:!0,error:null});const t=o().preferences,i={coaching:{...t.coaching,...e.coaching},guidanceLevel:e.guidanceLevel??t.guidanceLevel,dashboard:{...t.dashboard,...e.dashboard},notifications:{...t.notifications,...e.notifications},hydration:{...t.hydration,...e.hydration},sounds:{...t.sounds,...e.sounds},workout:{...t.workout,...e.workout},display:{...t.display,...e.display},units:{...t.units,...e.units},privacy:{...t.privacy,...e.privacy},music:{...t.music,...e.music}};r({preferences:i});try{const n=await c("/api/me/preferences",{method:"PATCH",body:JSON.stringify(e)});if(!n.ok)throw new Error("Failed to save preferences");const s=await n.json();s.success&&s.data&&r({preferences:u(s.data.preferences),version:s.data.version,isSaving:!1})}catch(n){r({preferences:t,error:n instanceof Error?n.message:"Failed to save preferences",isSaving:!1})}},resetPreferences:async()=>{r({isSaving:!0,error:null});try{if(!(await c("/api/me/preferences/reset",{method:"PUT"})).ok)throw new Error("Failed to reset preferences");r({preferences:a,isSaving:!1})}catch(e){r({error:e instanceof Error?e.message:"Failed to reset preferences",isSaving:!1})}},loadProfiles:async()=>{try{const e=await c("/api/me/preferences/profiles");if(!e.ok)throw new Error("Failed to load profiles");const t=await e.json();t.success&&t.data&&r({profiles:t.data.profiles||[]})}catch(e){r({error:e instanceof Error?e.message:"Failed to load profiles"})}},createProfile:async(e,t,i)=>{try{const n=await c("/api/me/preferences/profiles",{method:"POST",body:JSON.stringify({name:e,description:t,preferencesOverride:i})});if(!n.ok)throw new Error("Failed to create profile");const s=await n.json();return s.success&&s.data?.profile?(r(d=>({profiles:[...d.profiles,s.data.profile]})),s.data.profile):null}catch(n){return r({error:n instanceof Error?n.message:"Failed to create profile"}),null}},updateProfile:async(e,t)=>{try{const i=await c(`/api/me/preferences/profiles/${e}`,{method:"PATCH",body:JSON.stringify(t)});if(!i.ok)throw new Error("Failed to update profile");const n=await i.json();n.success&&n.data?.profile&&r(s=>({profiles:s.profiles.map(d=>d.id===e?n.data.profile:d)}))}catch(i){r({error:i instanceof Error?i.message:"Failed to update profile"})}},deleteProfile:async e=>{try{if(!(await c(`/api/me/preferences/profiles/${e}`,{method:"DELETE"})).ok)throw new Error("Failed to delete profile");r(i=>({profiles:i.profiles.filter(n=>n.id!==e),activeProfileId:i.activeProfileId===e?null:i.activeProfileId}))}catch(t){r({error:t instanceof Error?t.message:"Failed to delete profile"})}},activateProfile:async e=>{try{if(!(await c(`/api/me/preferences/profiles/${e}/activate`,{method:"POST"})).ok)throw new Error("Failed to activate profile");r({activeProfileId:e})}catch(t){r({error:t instanceof Error?t.message:"Failed to activate profile"})}},deactivateProfile:async()=>{try{if(!(await c("/api/me/preferences/profiles/deactivate",{method:"POST"})).ok)throw new Error("Failed to deactivate profile");r({activeProfileId:null})}catch(e){r({error:e instanceof Error?e.message:"Failed to deactivate profile"})}},getEffectivePreferences:()=>{const{preferences:e,activeProfileId:t,profiles:i}=o();if(!t)return e;const n=i.find(s=>s.id===t);return n?y(e,n.preferencesOverride):e},setGuidanceLevel:async e=>{await o().updatePreferences({guidanceLevel:e})},toggleMaxCoach:async()=>{const e=o().preferences.coaching.maxCoachVisible;await o().updatePreferences({coaching:{...o().preferences.coaching,maxCoachVisible:!e}})},toggleMascot:async()=>{const e=o().preferences.coaching.mascotVisible;await o().updatePreferences({coaching:{...o().preferences.coaching,mascotVisible:!e}})},toggleMetronome:async()=>{const e=o().preferences.sounds.metronomeEnabled;await o().updatePreferences({sounds:{...o().preferences.sounds,metronomeEnabled:!e}})},setMetronomeBpm:async e=>{await o().updatePreferences({sounds:{...o().preferences.sounds,metronomeBpm:e}})},toggleHydrationReminders:async()=>{const e=o().preferences.hydration.enabled;await o().updatePreferences({hydration:{...o().preferences.hydration,enabled:!e}})},setHydrationInterval:async e=>{await o().updatePreferences({hydration:{...o().preferences.hydration,intervalMinutes:e}})},_setPreferences:e=>{r(t=>({preferences:{...t.preferences,...e}}))},_setProfiles:e=>r({profiles:e}),_setLoading:e=>r({isLoading:e}),_setError:e=>r({error:e})}),{name:"musclemap-preferences",partialize:r=>({preferences:r.preferences,activeProfileId:r.activeProfileId,profiles:r.profiles,version:r.version,lastSyncAt:r.lastSyncAt,deviceId:r.deviceId})}))),g=()=>{const r=l(e=>e.preferences.units),o=l(e=>e.updatePreferences);return{...r,setWeightUnit:e=>o({units:{...r,weight:e}}),setDistanceUnit:e=>o({units:{...r,distance:e}}),setHeightUnit:e=>o({units:{...r,height:e}}),setTemperatureUnit:e=>o({units:{...r,temperature:e}}),setMetric:()=>o({units:{weight:"kg",distance:"km",height:"cm",temperature:"c"}}),setImperial:()=>o({units:{weight:"lbs",distance:"mi",height:"ft_in",temperature:"f"}}),isMetric:r.weight==="kg"&&r.height==="cm",isImperial:r.weight==="lbs"&&r.height==="ft_in",lengthUnit:r.height==="cm"?"cm":"in"}};export{g as u};
