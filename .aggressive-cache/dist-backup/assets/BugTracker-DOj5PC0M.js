import{d as se,r as s,j as e}from"./react-vendor-D1NxaRNd.js";import{i as re,b as ae,a as u,B as v,ba as le,Z as oe,a8 as ie}from"./index-DMo71FHX.js";import{G as a}from"./GlassSurface-BMiMerMg.js";import{L as w}from"./loader-circle-DwvpjhR_.js";import{S as ne}from"./send-DizSsZJ5.js";import{C as ce}from"./chevron-down-Cui-E_Zg.js";import{C as de}from"./chevron-right-BC1VSzgZ.js";import{W as me}from"./wifi-off-BpMHNzvp.js";import{C as xe}from"./circle-check-big-Csod5jFR.js";import{T as ue}from"./triangle-alert-DXNthorc.js";import{R as he}from"./refresh-cw-BWkjF4vB.js";import{M as pe}from"./monitor-C7DUMcSx.js";import{F as ge}from"./file-text-BWh8C1rf.js";import{C as be}from"./circle-alert-DR8qu-aX.js";import"./leaflet-vendor-DZbo3Ov0.js";import"./apollo-vendor-BMQ75Ycx.js";import"./reactflow-vendor-Dz2P_-Qa.js";import"./d3-vendor-mcDw60ct.js";import"./recharts-vendor-BziRPEEi.js";const fe=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],je=re("smartphone",fe);function Le(){const{user:m}=ae(),h=se(),[n,y]=s.useState(""),[p,N]=s.useState("functionality"),[k,S]=s.useState("medium"),[C,E]=s.useState(""),[B,T]=s.useState(""),[R,A]=s.useState(""),[g,D]=s.useState(""),[P,_]=s.useState(""),[$,W]=s.useState(""),[F,z]=s.useState(!1),[Z,L]=s.useState(!1),[O,U]=s.useState(""),[I,J]=s.useState([]),[i,K]=s.useState(null),[M,G]=s.useState(!0),[c,b]=s.useState("open"),[x,H]=s.useState(null),[f,Q]=s.useState(!0);s.useEffect(()=>{m&&!m.is_admin&&h("/dashboard")},[m,h]),s.useEffect(()=>{E(window.location.origin+window.location.pathname)},[]);const l=s.useCallback(async()=>{try{const t=c==="all"?"all":c==="open"?"open":"resolved",r=await u.get(`/admin/bugs?status=${t}&limit=50`);J(r.data.items||[])}catch{}},[c]),d=s.useCallback(async()=>{try{const t=await u.get("/admin/bugs/stats");K(t.data)}catch{}},[]);s.useEffect(()=>{(async()=>{G(!0),await Promise.all([l(),d()]),G(!1)})()},[l,d]),s.useEffect(()=>{l()},[c,l]);const X=async t=>{if(t.preventDefault(),!!n.trim()){z(!0),U("");try{const r=P.split(`
`).map(j=>j.trim()).filter(Boolean),o=$.split(`
`).map(j=>j.trim()).filter(Boolean),te={type:"bug_report",title:n.trim(),description:g.trim()||n.trim(),priority:k,stepsToReproduce:B.trim()||void 0,expectedBehavior:R.trim()||void 0,actualBehavior:g.trim()||void 0,category:p,metadata:{bugType:p,pageUrl:C,consoleErrors:r,networkErrors:o,reportedVia:"empire_bug_tracker",userAgent:navigator.userAgent,screenSize:`${window.innerWidth}x${window.innerHeight}`,platform:navigator.platform},userAgent:navigator.userAgent,screenSize:`${window.innerWidth}x${window.innerHeight}`,platform:navigator.platform};await u.post("/feedback",te),y(""),T(""),A(""),D(""),_(""),W(""),N("functionality"),S("medium"),L(!0),await Promise.all([l(),d()]),setTimeout(()=>L(!1),3e3)}catch(r){const o=r instanceof Error?r.message:"Failed to submit bug report";U(o)}finally{z(!1)}}},q=async(t,r)=>{try{await u.patch(`/admin/bugs/${t}`,{status:r}),await Promise.all([l(),d()]),x?.id===t&&H(o=>o?{...o,status:r}:null)}catch{}},V={critical:"bg-red-500 text-white",high:"bg-orange-500 text-white",medium:"bg-yellow-500 text-black",low:"bg-blue-500 text-white"},Y={open:"bg-blue-500/20 text-blue-400",in_progress:"bg-yellow-500/20 text-yellow-400",confirmed:"bg-orange-500/20 text-orange-400",resolved:"bg-green-500/20 text-green-400",closed:"bg-gray-500/20 text-gray-400",wont_fix:"bg-red-500/20 text-red-400"},ee=[{value:"visual",label:"Visual/CSS",icon:e.jsx(pe,{className:"w-4 h-4"}),description:"Layout, styling, spacing issues"},{value:"functionality",label:"Broken Feature",icon:e.jsx(oe,{className:"w-4 h-4"}),description:"Button/form/feature not working"},{value:"data",label:"Data Issue",icon:e.jsx(ge,{className:"w-4 h-4"}),description:"Wrong or missing data displayed"},{value:"error",label:"Error Message",icon:e.jsx(be,{className:"w-4 h-4"}),description:"Console or API error"},{value:"performance",label:"Performance",icon:e.jsx(ie,{className:"w-4 h-4"}),description:"Slow, freezing, unresponsive"}];return m?.is_admin?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-gray-900 via-gray-800 to-gray-900 p-4 md:p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-white flex items-center gap-3",children:[e.jsx(v,{className:"w-8 h-8 text-red-400"}),"Bug Tracker"]}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Report and track bugs efficiently"})]}),e.jsx("button",{onClick:()=>h("/empire"),className:"px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg text-sm transition-colors",children:"← Back to Empire"})]}),i&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-8",children:[e.jsxs(a,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-gray-400",children:"Total Bugs"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:i.totals.total})]}),e.jsxs(a,{className:"p-4 cursor-pointer hover:bg-white/5",onClick:()=>b("open"),children:[e.jsx("div",{className:"text-sm text-gray-400",children:"Open"}),e.jsx("div",{className:"text-2xl font-bold text-orange-400",children:i.totals.open})]}),e.jsxs(a,{className:"p-4 cursor-pointer hover:bg-white/5",onClick:()=>b("resolved"),children:[e.jsx("div",{className:"text-sm text-gray-400",children:"Resolved"}),e.jsx("div",{className:"text-2xl font-bold text-green-400",children:i.totals.resolved})]}),e.jsxs(a,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-gray-400",children:"Today"}),e.jsx("div",{className:"text-2xl font-bold text-violet-400",children:i.totals.today})]}),e.jsxs(a,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-gray-400",children:"This Week"}),e.jsx("div",{className:"text-2xl font-bold text-blue-400",children:i.totals.thisWeek})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsxs(a,{className:"p-6",children:[e.jsxs("button",{onClick:()=>Q(!f),className:"w-full flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(ne,{className:"w-5 h-5 text-violet-400"}),"Report New Bug"]}),f?e.jsx(ce,{className:"w-5 h-5 text-gray-400"}):e.jsx(de,{className:"w-5 h-5 text-gray-400"})]}),f&&e.jsxs("form",{onSubmit:X,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:["Bug Title ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{type:"text",value:n,onChange:t=>y(t.target.value),placeholder:"Short description of the bug",className:"w-full px-4 py-2 bg-black/30 border border-white/10 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-violet-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Bug Type"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:ee.map(t=>e.jsxs("button",{type:"button",onClick:()=>N(t.value),className:`p-3 rounded-lg border transition-all text-left ${p===t.value?"border-violet-500 bg-violet-500/20":"border-white/10 bg-black/20 hover:border-white/30"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.icon,e.jsx("span",{className:"text-sm font-medium",children:t.label})]}),e.jsx("p",{className:"text-xs text-gray-400",children:t.description})]},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Priority"}),e.jsx("div",{className:"flex gap-2",children:["low","medium","high","critical"].map(t=>e.jsx("button",{type:"button",onClick:()=>S(t),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${k===t?V[t]:"bg-white/10 text-gray-400 hover:bg-white/20"}`,children:t.charAt(0).toUpperCase()+t.slice(1)},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Page URL"}),e.jsx("input",{type:"text",value:C,onChange:t=>E(t.target.value),placeholder:"https://musclemap.me/...",className:"w-full px-4 py-2 bg-black/30 border border-white/10 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-violet-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Steps to Reproduce"}),e.jsx("textarea",{value:B,onChange:t=>T(t.target.value),placeholder:`1. Go to [page]
2. Click [element]
3. See [problem]`,rows:3,className:"w-full px-4 py-2 bg-black/30 border border-white/10 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-violet-500 resize-none"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Expected"}),e.jsx("textarea",{value:R,onChange:t=>A(t.target.value),placeholder:"What should happen",rows:2,className:"w-full px-4 py-2 bg-black/30 border border-white/10 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-violet-500 resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Actual"}),e.jsx("textarea",{value:g,onChange:t=>D(t.target.value),placeholder:"What actually happens",rows:2,className:"w-full px-4 py-2 bg-black/30 border border-white/10 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-violet-500 resize-none"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-1 flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4 text-red-400"}),"Console Errors (paste from DevTools)"]}),e.jsx("textarea",{value:P,onChange:t=>_(t.target.value),placeholder:"Paste any red error messages from the browser console here...",rows:3,className:"w-full px-4 py-2 bg-black/30 border border-white/10 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-violet-500 resize-none font-mono text-sm"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-1 flex items-center gap-2",children:[e.jsx(me,{className:"w-4 h-4 text-orange-400"}),"Network Errors (failed API calls)"]}),e.jsx("textarea",{value:$,onChange:t=>W(t.target.value),placeholder:"Any failed network requests (red in Network tab)...",rows:2,className:"w-full px-4 py-2 bg-black/30 border border-white/10 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-violet-500 resize-none font-mono text-sm"})]}),O&&e.jsx("div",{className:"p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-400 text-sm",children:O}),Z&&e.jsxs("div",{className:"p-3 bg-green-500/20 border border-green-500/30 rounded-lg text-green-400 text-sm flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4"}),"Bug report submitted successfully!"]}),e.jsx("button",{type:"submit",disabled:F||!n.trim(),className:"w-full py-3 bg-violet-600 hover:bg-violet-500 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg font-medium transition-colors flex items-center justify-center gap-2",children:F?e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"w-4 h-4 animate-spin"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"w-4 h-4"}),"Submit Bug Report"]})})]})]}),e.jsxs(a,{className:"p-6 mt-4",children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2 mb-4",children:[e.jsx(je,{className:"w-5 h-5 text-blue-400"}),"iOS Safari Debug Helper"]}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Cannot access DevTools on iOS? Enable the debug overlay to capture errors:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>{localStorage.setItem("musclemap_debug_mode","true"),window.location.reload()},className:"w-full py-2 bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 rounded-lg text-sm transition-colors",children:"Enable Debug Overlay"}),e.jsx("button",{onClick:()=>{localStorage.removeItem("musclemap_debug_mode"),window.location.reload()},className:"w-full py-2 bg-white/10 text-gray-400 hover:bg-white/20 rounded-lg text-sm transition-colors",children:"Disable Debug Overlay"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-3",children:"When enabled, a floating bug icon will appear. Tap it to see captured errors."})]})]}),e.jsx("div",{children:e.jsxs(a,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(ue,{className:"w-5 h-5 text-orange-400"}),"Bug Reports"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:c,onChange:t=>b(t.target.value),className:"px-3 py-1 bg-black/30 border border-white/10 rounded-lg text-sm text-white focus:outline-none focus:border-violet-500",children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"resolved",children:"Resolved"})]}),e.jsx("button",{onClick:()=>{l(),d()},className:"p-2 hover:bg-white/10 rounded-lg transition-colors",children:e.jsx(he,{className:`w-4 h-4 ${M?"animate-spin":""}`})})]})]}),M?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(w,{className:"w-8 h-8 animate-spin text-violet-500"})}):I.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-400",children:[e.jsx(v,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No bugs found"}),e.jsx("p",{className:"text-sm mt-1",children:"Report one using the form"})]}):e.jsx("div",{className:"space-y-2 max-h-[600px] overflow-y-auto",children:I.map(t=>e.jsxs("div",{onClick:()=>H(x?.id===t.id?null:t),className:`p-3 rounded-lg cursor-pointer transition-all ${x?.id===t.id?"bg-violet-500/20 border border-violet-500/50":"bg-white/5 hover:bg-white/10 border border-transparent"}`,children:[e.jsx("div",{className:"flex items-start justify-between gap-3",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${V[t.priority]}`,children:t.priority}),e.jsx("span",{className:"font-medium text-sm truncate",children:t.title})]}),t.pageUrl&&e.jsx("div",{className:"text-xs text-gray-500 truncate",children:t.pageUrl}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs text-gray-400",children:[e.jsx("span",{className:`px-2 py-0.5 rounded ${Y[t.status]}`,children:t.status.replace("_"," ")}),e.jsx("span",{children:"•"}),e.jsx("span",{children:new Date(t.createdAt).toLocaleDateString()})]})]})}),x?.id===t.id&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/10 space-y-3",children:[t.description&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-medium text-gray-400 mb-1",children:"Description"}),e.jsx("p",{className:"text-sm text-gray-300",children:t.description})]}),t.stepsToReproduce&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-medium text-gray-400 mb-1",children:"Steps to Reproduce"}),e.jsx("p",{className:"text-sm text-gray-300 whitespace-pre-wrap",children:t.stepsToReproduce})]}),t.consoleErrors&&t.consoleErrors.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-medium text-gray-400 mb-1",children:"Console Errors"}),e.jsx("pre",{className:"text-xs text-red-400 bg-black/30 p-2 rounded overflow-x-auto",children:t.consoleErrors.join(`
`)})]}),t.resolution&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-medium text-gray-400 mb-1",children:"Resolution"}),e.jsx("p",{className:"text-sm text-green-400",children:t.resolution.notes})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[t.status!=="resolved"&&t.status!=="closed"&&e.jsx("button",{onClick:r=>{r.stopPropagation(),q(t.id,"resolved")},className:"px-3 py-1 bg-green-500/20 text-green-400 hover:bg-green-500/30 rounded text-xs",children:"Mark Resolved"}),t.status==="open"&&e.jsx("button",{onClick:r=>{r.stopPropagation(),q(t.id,"in_progress")},className:"px-3 py-1 bg-yellow-500/20 text-yellow-400 hover:bg-yellow-500/30 rounded text-xs",children:"In Progress"})]})]})]},t.id))})]})})]})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(w,{className:"w-8 h-8 animate-spin text-violet-500"})})}export{Le as default};
