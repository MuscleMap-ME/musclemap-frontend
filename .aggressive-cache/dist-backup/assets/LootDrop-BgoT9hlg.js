import{r as u,j as t}from"./react-vendor-D1NxaRNd.js";import{P as h,c as V}from"./recharts-vendor-BziRPEEi.js";import{az as A,m as p,A as _,aA as fe}from"./index-Bcbmw5yO.js";import"./leaflet-vendor-DZbo3Ov0.js";import"./d3-vendor-mcDw60ct.js";import"./apollo-vendor-BMQ75Ycx.js";import"./reactflow-vendor-Dz2P_-Qa.js";const Y={common:{primary:"#9ca3af",glow:"rgba(156, 163, 175, 0.5)",border:"rgba(156, 163, 175, 0.3)",background:"rgba(156, 163, 175, 0.1)",gradient:"linear-gradient(135deg, #9ca3af 0%, #6b7280 100%)"},rare:{primary:"#3b82f6",glow:"rgba(59, 130, 246, 0.5)",border:"rgba(59, 130, 246, 0.4)",background:"rgba(59, 130, 246, 0.15)",gradient:"linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%)"},epic:{primary:"#a855f7",glow:"rgba(168, 85, 247, 0.5)",border:"rgba(168, 85, 247, 0.4)",background:"rgba(168, 85, 247, 0.15)",gradient:"linear-gradient(135deg, #c084fc 0%, #a855f7 100%)"},legendary:{primary:"#f59e0b",glow:"rgba(245, 158, 11, 0.6)",border:"rgba(245, 158, 11, 0.5)",background:"rgba(245, 158, 11, 0.2)",gradient:"linear-gradient(135deg, #fbbf24 0%, #f59e0b 50%, #d97706 100%)"}},he={common:60,rare:25,epic:12,legendary:3},P={common:1,rare:2,epic:3,legendary:4},pe={XP_BONUS:{id:"xp_bonus",name:"XP Boost",description:"+{amount} bonus XP",icon:"â­",rarity:"common",amounts:[25,50,100,250],category:"progression"},CREDITS:{id:"credits",name:"Credits",description:"{amount} credits",icon:"ðŸ’Ž",rarity:"common",amounts:[5,10,25,50],category:"economy"},STREAK_SHIELD:{id:"streak_shield",name:"Streak Shield",description:"Protects your streak for 1 day",icon:"ðŸ›¡ï¸",rarity:"rare",category:"protection"},DOUBLE_XP:{id:"double_xp",name:"Double XP (24h)",description:"Earn 2x XP for 24 hours",icon:"ðŸ”¥",rarity:"epic",category:"boost",duration:86400},RARE_TITLE:{id:"rare_title",name:"Rare Title",description:'Unlock "{title}" title',icon:"ðŸ‘‘",rarity:"legendary",titles:["Iron Legend","Muscle Master","The Unstoppable","Power Surge","Beast Mode"],category:"cosmetic"},AVATAR_FRAME:{id:"avatar_frame",name:"Avatar Frame",description:"New profile frame",icon:"ðŸ–¼ï¸",rarity:"rare",frames:["gold_ring","fire_aura","electric_pulse","diamond_edge"],category:"cosmetic"},MYSTERY_BOX:{id:"mystery_box",name:"Mystery Box",description:"Contains a random reward",icon:"ðŸ“¦",rarity:"rare",category:"special"},MUSCLE_GLOW:{id:"muscle_glow",name:"Muscle Glow Effect",description:"Special glow for {muscle} visualization",icon:"âœ¨",rarity:"epic",muscles:["chest","back","shoulders","arms","legs","core"],category:"cosmetic"},WORKOUT_BOOST:{id:"workout_boost",name:"Workout Boost",description:"+{amount}% credit earnings for next workout",icon:"ðŸ’ª",rarity:"common",amounts:[10,25,50],category:"boost"},LEADERBOARD_BADGE:{id:"leaderboard_badge",name:"Leaderboard Badge",description:"Display a special badge on leaderboards",icon:"ðŸ…",rarity:"epic",badges:["fire_starter","iron_will","elite_athlete"],category:"cosmetic"},PREMIUM_EXERCISE:{id:"premium_exercise",name:"Premium Exercise Unlock",description:"Unlock a premium exercise variation",icon:"ðŸŽ¯",rarity:"legendary",category:"content"},REST_TIMER_SKIN:{id:"rest_timer_skin",name:"Rest Timer Skin",description:"New visual style for rest timer",icon:"â±ï¸",rarity:"rare",skins:["neon_pulse","liquid_metal","aurora","ember"],category:"cosmetic"}},ye={common:["XP_BONUS","CREDITS","WORKOUT_BOOST"],rare:["STREAK_SHIELD","AVATAR_FRAME","MYSTERY_BOX","REST_TIMER_SKIN"],epic:["DOUBLE_XP","MUSCLE_GLOW","LEADERBOARD_BADGE"],legendary:["RARE_TITLE","PREMIUM_EXERCISE"]},G={BRONZE:{id:"bronze",name:"Bronze Chest",description:"Basic workout reward",minItems:1,maxItems:2,guaranteedRarity:"common",color:"#cd7f32",glowColor:"rgba(205, 127, 50, 0.5)"},SILVER:{id:"silver",name:"Silver Chest",description:"Quality workout reward",minItems:2,maxItems:3,guaranteedRarity:"rare",color:"#c0c0c0",glowColor:"rgba(192, 192, 192, 0.5)"},GOLD:{id:"gold",name:"Gold Chest",description:"Excellent workout reward",minItems:2,maxItems:4,guaranteedRarity:"epic",color:"#ffd700",glowColor:"rgba(255, 215, 0, 0.6)"},DIAMOND:{id:"diamond",name:"Diamond Chest",description:"Ultimate workout reward",minItems:3,maxItems:5,guaranteedRarity:"legendary",color:"#b9f2ff",glowColor:"rgba(185, 242, 255, 0.7)"}},X={chestShake:{frequency:150,duration:.1,type:"sine"},chestOpen:{frequency:440,duration:.5,type:"sine",ramp:!0}};function U(r={}){const{workoutQuality:a=50,currentStreak:e=0,minRarity:o=null}=r,i={...he};a>=80?(i.rare+=10,i.epic+=5,i.legendary+=2):a>=60&&(i.rare+=5,i.epic+=2),e>=30?(i.epic+=8,i.legendary+=4):e>=14?(i.epic+=4,i.legendary+=2):e>=7&&(i.rare+=5,i.epic+=2);let m=ge(i);o&&P[m]<P[o]&&(m=o);const s=ye[m],l=s[Math.floor(Math.random()*s.length)],f=pe[l];return xe(f)}function ge(r){const a=Object.values(r).reduce((o,i)=>o+i,0);let e=Math.random()*a;for(const[o,i]of Object.entries(r))if(e-=i,e<=0)return o;return"common"}function xe(r){const a={id:`${r.id}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,typeId:r.id,name:r.name,icon:r.icon,rarity:r.rarity,category:r.category,description:r.description,timestamp:Date.now()};if(r.amounts){const e=r.amounts[Math.floor(Math.random()*r.amounts.length)];a.amount=e,a.description=r.description.replace("{amount}",e)}if(r.titles){const e=r.titles[Math.floor(Math.random()*r.titles.length)];a.title=e,a.description=r.description.replace("{title}",e)}if(r.frames){const e=r.frames[Math.floor(Math.random()*r.frames.length)];a.frame=e}if(r.muscles){const e=r.muscles[Math.floor(Math.random()*r.muscles.length)];a.muscle=e,a.description=r.description.replace("{muscle}",e)}if(r.badges){const e=r.badges[Math.floor(Math.random()*r.badges.length)];a.badge=e}if(r.skins){const e=r.skins[Math.floor(Math.random()*r.skins.length)];a.skin=e}return r.duration&&(a.duration=r.duration),a}function W(r={}){const{workoutQuality:a=50,currentStreak:e=0,chestType:o="BRONZE"}=r,i=G[o]||G.BRONZE,m=Math.floor(Math.random()*(i.maxItems-i.minItems+1))+i.minItems,s=[];s.push(U({workoutQuality:a,currentStreak:e,minRarity:i.guaranteedRarity}));for(let f=1;f<m;f++)s.push(U({workoutQuality:a,currentStreak:e}));s.sort((f,n)=>P[n.rarity]-P[f.rarity]);const l=s[0]?.rarity||"common";return{id:`drop_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,chest:i,items:s,rarity:l,timestamp:Date.now(),workoutQuality:a,currentStreak:e}}function be(r={}){const{totalSets:a=0,totalVolume:e=0,duration:o=0,streak:i=0}=r;let m=0;return m+=Math.min(a*2,40),m+=Math.min(e/500,20),m+=Math.min(o/2,20),i>=30?m+=15:i>=14?m+=10:i>=7&&(m+=5),m+=Math.random()*10,m>=80?"DIAMOND":m>=60?"GOLD":m>=40?"SILVER":"BRONZE"}const I={HIDDEN:"hidden",SHOWING:"showing",CHEST_CLOSED:"chest_closed",CHEST_OPENING:"chest_opening",CHEST_OPEN:"chest_open",REVEALING:"revealing",ALL_REVEALED:"all_revealed",CLAIMING:"claiming",CLAIMED:"claimed"};function Ee(){const[r,a]=u.useState(!1),[e,o]=u.useState(null),[i,m]=u.useState([]),[s,l]=u.useState(-1),[f,n]=u.useState(I.HIDDEN),[b,C]=u.useState([]),y=u.useRef(null),v=u.useRef(null),c=u.useRef(null),d=u.useMemo(()=>f===I.REVEALING||f===I.CHEST_OPENING,[f]),E=u.useMemo(()=>e&&i.length>=e.items.length,[e,i]),g=u.useMemo(()=>e&&s>=0?e.items[s]:null,[e,s]),M=u.useMemo(()=>e?.rarity||"common",[e]),O=u.useCallback((S={})=>{const{totalSets:N=0,totalVolume:L=0,duration:T=0,streak:D=0}=S;let k=0;k+=Math.min(N*3,30),k+=Math.min(L/200,30),k+=Math.min(T,30),k+=Math.min(D,10),k=Math.min(Math.round(k),100);const ue=be(S),H=W({workoutQuality:k,currentStreak:D,chestType:ue});return C(me=>[...me,H]),H},[]),x=u.useCallback((S="rare")=>{const L=W({workoutQuality:75,currentStreak:7,chestType:{common:"BRONZE",rare:"SILVER",epic:"GOLD",legendary:"DIAMOND"}[S]||"SILVER"});return C(T=>[...T,L]),L},[]),R=u.useCallback((S,N={})=>{const{onClaim:L,onClose:T}=N;y.current=L,v.current=T,o(S),m([]),l(-1),n(I.CHEST_CLOSED),a(!0),C(D=>D.filter(k=>k.id!==S.id))},[]),$=u.useCallback(()=>{b.length>0&&R(b[0])},[b,R]),B=u.useCallback(()=>{c.current&&(clearTimeout(c.current),c.current=null),a(!1),n(I.HIDDEN),v.current?.(),setTimeout(()=>{o(null),m([]),l(-1)},300)},[]),ie=u.useCallback(()=>{f===I.CHEST_CLOSED&&(n(I.CHEST_OPENING),c.current=setTimeout(()=>{n(I.CHEST_OPEN),c.current=setTimeout(()=>{n(I.REVEALING),l(0)},500)},1e3))},[f]),ne=u.useCallback(()=>{if(!e)return;const S=s+1;S<e.items.length?(s>=0&&!i.includes(e.items[s])&&m(N=>[...N,e.items[s]]),l(S)):(s>=0&&s<e.items.length&&m(N=>[...N,e.items[s]]),n(I.ALL_REVEALED),l(-1))},[e,s,i]),oe=u.useCallback(()=>{e&&(m([...e.items]),l(-1),n(I.ALL_REVEALED))},[e]),se=u.useCallback(()=>{if(!e||s<0)return;const S=e.items[s];i.find(L=>L.id===S.id)||m(L=>[...L,S]);const N=s+1;N<e.items.length?c.current=setTimeout(()=>{l(N)},800):(n(I.ALL_REVEALED),l(-1))},[e,s,i]),ce=u.useCallback(()=>{!e||i.length===0||(n(I.CLAIMING),y.current?.(i),c.current=setTimeout(()=>{n(I.CLAIMED),setTimeout(()=>{B()},500)},600))},[e,i,B]),le=u.useCallback(()=>{e&&(m([...e.items]),l(-1),n(I.ALL_REVEALED))},[e]),de=u.useCallback(()=>{C([])},[]);return{isOpen:r,currentLootDrop:e,revealedItems:i,currentItemIndex:s,currentItem:g,dropState:f,dropRarity:M,pendingLoot:b,isRevealing:d,allRevealed:E,hasPending:b.length>0,pendingCount:b.length,generateLoot:O,generateGuaranteedLoot:x,showLootDrop:R,showNextPending:$,closeLootDrop:B,openChest:ie,revealNext:ne,revealAll:oe,completeCurrentReveal:se,claimAll:ce,skipToClaim:le,clearPending:de,LOOT_DROP_STATES:I}}let q=null;function Me(){if(typeof window>"u")return null;if(!q)try{const r=window.AudioContext||window.webkitAudioContext;r&&(q=new r)}catch{return null}return q}function z(r){const a=Me();if(a){a.state==="suspended"&&a.resume();try{const e=a.createOscillator(),o=a.createGain();e.connect(o),o.connect(a.destination),e.type=r.type||"sine",e.frequency.setValueAtTime(r.frequency,a.currentTime),r.ramp&&e.frequency.exponentialRampToValueAtTime(r.frequency*2,a.currentTime+r.duration),o.gain.setValueAtTime(.15,a.currentTime),o.gain.exponentialRampToValueAtTime(.001,a.currentTime+r.duration),e.start(a.currentTime),e.stop(a.currentTime+r.duration)}catch{}}}function K({color:r,delay:a,duration:e,size:o,angle:i}){if(A())return null;const s=80+Math.random()*40,l=Math.cos(i)*s*.3,f=Math.sin(i)*s*.3,n=Math.cos(i)*s,b=Math.sin(i)*s;return t.jsx(p.div,{className:"absolute rounded-full",style:{width:o,height:o,backgroundColor:r,boxShadow:`0 0 ${o*2}px ${r}`,left:"50%",top:"50%"},initial:{x:l-o/2,y:f-o/2,opacity:0,scale:.5},animate:{x:[l-o/2,n-o/2],y:[f-o/2,b-o/2],opacity:[0,1,0],scale:[.5,1,.3]},transition:{duration:e,delay:a,ease:"easeOut",repeat:1/0,repeatDelay:Math.random()*2}})}K.propTypes={color:h.string.isRequired,delay:h.number.isRequired,duration:h.number.isRequired,size:h.number.isRequired,angle:h.number.isRequired};const w={CLOSED:"closed",SHAKING:"shaking",OPENING:"opening",OPEN:"open"},ve={hidden:{scale:0,opacity:0,rotateY:-180},visible:{scale:1,opacity:1,rotateY:0,transition:{type:"spring",stiffness:200,damping:15,duration:.6}},exit:{scale:.5,opacity:0,y:-50,transition:{duration:.3}}},Re={shake:{rotate:[0,-3,3,-3,3,-2,2,-1,1,0],scale:[1,1.02,1,1.02,1,1.01,1,1.01,1,1],transition:{duration:.8,ease:"easeInOut"}}},we={closed:{rotateX:0,y:0},opening:{rotateX:-120,y:-15,transition:{type:"spring",stiffness:100,damping:10,duration:.8}},open:{rotateX:-120,y:-15}},Ce={idle:{opacity:.5,scale:1},pulse:{opacity:[.5,1,.5],scale:[1,1.1,1],transition:{duration:2,repeat:1/0,ease:"easeInOut"}},burst:{opacity:[.5,1,0],scale:[1,3,5],transition:{duration:.8,ease:"easeOut"}}};function F({state:r=w.CLOSED,rarity:a="common",chestType:e="BRONZE",onOpen:o,onShakeComplete:i,onOpenComplete:m,enableSound:s=!0,className:l=""}){const f=A(),[n,b]=u.useState(r),[C,y]=u.useState(!1),v=u.useRef(null),c=u.useMemo(()=>{const x=G[e]||G.BRONZE,R=Y[a]||Y.common;return{chestMain:x.color,chestGlow:x.glowColor,rarityGlow:R.glow,rarityPrimary:R.primary}},[a,e]),d=u.useMemo(()=>f?[]:Array.from({length:12}).map((x,R)=>({id:R,angle:R/12*Math.PI*2,delay:Math.random()*2,duration:2+Math.random()*2,size:3+Math.random()*4})),[f]);u.useEffect(()=>{b(r)},[r]),u.useEffect(()=>(n===w.SHAKING&&(s&&z(X.chestShake),v.current=setTimeout(()=>{i?.()},800)),n===w.OPENING&&s&&z(X.chestOpen),()=>{v.current&&clearTimeout(v.current)}),[n,s,i]);const E=u.useCallback(()=>{n===w.CLOSED&&(b(w.SHAKING),setTimeout(()=>{b(w.OPENING),o?.(),setTimeout(()=>{b(w.OPEN),m?.()},800)},800))},[n,o,m]),g=n===w.SHAKING,M=n===w.OPENING,O=n===w.OPEN;return t.jsxs(p.div,{className:`relative select-none ${l}`,variants:ve,initial:"hidden",animate:"visible",exit:"exit",children:[t.jsx(p.div,{className:"absolute inset-0 rounded-full",style:{background:`radial-gradient(circle, ${c.rarityGlow} 0%, transparent 70%)`,filter:"blur(20px)",transform:"translateY(20%)"},variants:Ce,animate:M?"burst":"pulse"}),t.jsx("div",{className:"absolute inset-0 pointer-events-none",children:d.map(x=>t.jsx(K,{color:c.rarityPrimary,delay:x.delay,duration:x.duration,size:x.size,angle:x.angle},x.id))}),t.jsxs(p.div,{className:"relative cursor-pointer",onClick:E,onMouseEnter:()=>y(!0),onMouseLeave:()=>y(!1),animate:g?"shake":void 0,variants:Re,whileHover:n===w.CLOSED&&!f?{scale:1.05}:void 0,whileTap:n===w.CLOSED?{scale:.98}:void 0,style:{perspective:500},children:[t.jsxs("svg",{viewBox:"0 0 200 160",className:"w-48 h-40 md:w-64 md:h-52",style:{filter:`drop-shadow(0 10px 30px ${c.chestGlow})`},children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:`chest-gradient-${a}`,x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:c.chestMain,stopOpacity:"1"}),t.jsx("stop",{offset:"50%",stopColor:c.chestMain,stopOpacity:"0.8"}),t.jsx("stop",{offset:"100%",stopColor:c.chestMain,stopOpacity:"0.6"})]}),t.jsxs("linearGradient",{id:`highlight-${a}`,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"rgba(255,255,255,0.4)"}),t.jsx("stop",{offset:"100%",stopColor:"rgba(255,255,255,0)"})]}),t.jsxs("linearGradient",{id:`metal-${a}`,x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:c.rarityPrimary}),t.jsx("stop",{offset:"50%",stopColor:c.rarityPrimary,stopOpacity:"0.8"}),t.jsx("stop",{offset:"100%",stopColor:c.rarityPrimary,stopOpacity:"0.6"})]}),t.jsxs("filter",{id:`inner-glow-${a}`,children:[t.jsx("feGaussianBlur",{in:"SourceAlpha",stdDeviation:"3",result:"blur"}),t.jsx("feOffset",{in:"blur",dx:"0",dy:"0",result:"offsetBlur"}),t.jsx("feFlood",{floodColor:c.rarityPrimary,floodOpacity:"0.5"}),t.jsx("feComposite",{in2:"offsetBlur",operator:"in"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),t.jsxs("g",{className:"chest-body",children:[t.jsx("rect",{x:"20",y:"80",width:"160",height:"70",rx:"8",fill:`url(#chest-gradient-${a})`,stroke:"rgba(255,255,255,0.2)",strokeWidth:"2"}),t.jsx("rect",{x:"25",y:"85",width:"150",height:"30",rx:"4",fill:`url(#highlight-${a})`,opacity:"0.3"}),t.jsx("rect",{x:"15",y:"90",width:"170",height:"8",rx:"2",fill:`url(#metal-${a})`}),t.jsx("rect",{x:"15",y:"130",width:"170",height:"8",rx:"2",fill:`url(#metal-${a})`}),[30,170].map(x=>[95,135].map(R=>t.jsx("circle",{cx:x,cy:R,r:"4",fill:c.rarityPrimary,stroke:"rgba(255,255,255,0.3)",strokeWidth:"1"},`${x}-${R}`))),t.jsx("rect",{x:"90",y:"75",width:"20",height:"30",rx:"3",fill:`url(#metal-${a})`,stroke:"rgba(255,255,255,0.3)",strokeWidth:"1"}),t.jsx("circle",{cx:"100",cy:"90",r:"5",fill:"rgba(0,0,0,0.5)",stroke:c.rarityPrimary,strokeWidth:"1"})]}),t.jsxs(p.g,{className:"chest-lid",style:{originX:"50%",originY:"100%",transformOrigin:"100px 80px"},variants:we,animate:M||O?"opening":"closed",children:[t.jsx("path",{d:"M 20 80 L 20 50 Q 20 30 40 25 L 160 25 Q 180 30 180 50 L 180 80 Z",fill:`url(#chest-gradient-${a})`,stroke:"rgba(255,255,255,0.2)",strokeWidth:"2"}),t.jsx("path",{d:"M 30 75 L 30 52 Q 30 38 45 34 L 155 34 Q 170 38 170 52 L 170 75 Z",fill:`url(#highlight-${a})`,opacity:"0.2"}),t.jsx("rect",{x:"15",y:"55",width:"170",height:"8",rx:"2",fill:`url(#metal-${a})`}),[30,170].map(x=>t.jsx("circle",{cx:x,cy:"59",r:"4",fill:c.rarityPrimary,stroke:"rgba(255,255,255,0.3)",strokeWidth:"1"},`lid-${x}`))]}),t.jsx(_,{children:(M||O)&&t.jsx(p.rect,{x:"25",y:"85",width:"150",height:"60",rx:"4",fill:c.rarityGlow,filter:`url(#inner-glow-${a})`,initial:{opacity:0},animate:{opacity:[0,1,.7]},exit:{opacity:0},transition:{duration:.5}})})]}),t.jsx(_,{children:n===w.CLOSED&&t.jsx(p.div,{className:"absolute -bottom-8 left-1/2 transform -translate-x-1/2 whitespace-nowrap",initial:{opacity:0,y:-10},animate:{opacity:C?1:.7,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},children:t.jsx("span",{className:"text-sm text-[var(--text-secondary)] font-medium",children:"Tap to open"})})}),t.jsx(_,{children:(M||O)&&!f&&t.jsx(p.div,{className:"absolute inset-0 pointer-events-none overflow-hidden",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:Array.from({length:8}).map((x,R)=>{const $=R/8*Math.PI*2-Math.PI/2;return t.jsx(p.div,{className:"absolute left-1/2 top-1/2 w-1 h-24 origin-bottom",style:{background:`linear-gradient(to top, ${c.rarityPrimary}, transparent)`,transform:`rotate(${$}rad) translateY(-60px)`,opacity:.6},initial:{scaleY:0,opacity:0},animate:{scaleY:[0,1,.8],opacity:[0,.8,.4]},transition:{duration:1,delay:R*.05,ease:"easeOut"}},R)})})})]})]})}F.propTypes={state:h.oneOf(Object.values(w)),rarity:h.oneOf(["common","rare","epic","legendary"]),chestType:h.oneOf(["BRONZE","SILVER","GOLD","DIAMOND"]),onOpen:h.func,onShakeComplete:h.func,onOpenComplete:h.func,enableSound:h.bool,className:h.string};const j={common:{primary:"#9ca3af",glow:"rgba(156, 163, 175, 0.5)",gradient:"linear-gradient(135deg, #9ca3af 0%, #6b7280 100%)",particleColors:["#9ca3af","#d1d5db","#e5e7eb"],glowIntensity:1},uncommon:{primary:"#22c55e",glow:"rgba(34, 197, 94, 0.5)",gradient:"linear-gradient(135deg, #4ade80 0%, #22c55e 100%)",particleColors:["#22c55e","#4ade80","#86efac"],glowIntensity:1.2},rare:{primary:"#3b82f6",glow:"rgba(59, 130, 246, 0.5)",gradient:"linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%)",particleColors:["#3b82f6","#60a5fa","#93c5fd"],glowIntensity:1.5},epic:{primary:"#a855f7",glow:"rgba(168, 85, 247, 0.5)",gradient:"linear-gradient(135deg, #c084fc 0%, #a855f7 100%)",particleColors:["#a855f7","#c084fc","#d8b4fe"],glowIntensity:2},legendary:{primary:"#f59e0b",glow:"rgba(245, 158, 11, 0.6)",gradient:"linear-gradient(135deg, #fbbf24 0%, #f59e0b 50%, #d97706 100%)",particleColors:["#f59e0b","#fbbf24","#fcd34d","#ffffff"],glowIntensity:3,extraParticles:!0}};function Z({rarity:r,isActive:a}){const e=u.useRef(null),o=u.useRef([]),i=u.useRef(null),m=A(),s=j[r]?.particleColors||j.common.particleColors,l=r==="legendary";return u.useEffect(()=>{if(!a||m)return;const f=e.current;if(!f)return;const n=f.getContext("2d"),b=f.getBoundingClientRect();f.width=b.width,f.height=b.height;const C=f.width/2,y=f.height/2,v=l?40:24;for(let d=0;d<v;d++){const E=d/v*Math.PI*2,g=Math.random()*4+2,M=30+Math.random()*20;o.current.push({x:C+Math.cos(E)*M*.3,y:y+Math.sin(E)*M*.3,vx:Math.cos(E)*g*(l?1.5:1),vy:Math.sin(E)*g*(l?1.5:1),size:Math.random()*4+2,color:s[Math.floor(Math.random()*s.length)],opacity:1,decay:Math.random()*.015+.008,type:Math.random()>.6?"star":"circle",rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.15})}if(l)for(let d=0;d<20;d++){const E=Math.random()*Math.PI*2,g=Math.random()*60+40;o.current.push({x:C+Math.cos(E)*g,y:y+Math.sin(E)*g,vx:(Math.random()-.5)*2,vy:(Math.random()-.5)*2-1,size:Math.random()*3+1,color:"#ffffff",opacity:Math.random()*.5+.5,decay:Math.random()*.02+.01,type:"sparkle",rotation:0,rotationSpeed:0,twinkle:Math.random()*Math.PI*2})}const c=()=>{n.clearRect(0,0,f.width,f.height),o.current=o.current.filter(d=>{if(d.x+=d.vx,d.y+=d.vy,d.vy+=.05,d.vx*=.99,d.vy*=.99,d.opacity-=d.decay,d.rotation+=d.rotationSpeed,d.twinkle!==void 0&&(d.twinkle+=.2,d.opacity=Math.sin(d.twinkle)*.5+.5,d.opacity-=d.decay*10),d.opacity<=0)return!1;if(n.save(),n.translate(d.x,d.y),n.rotate(d.rotation),n.globalAlpha=d.opacity,n.fillStyle=d.color,d.type==="star"){n.beginPath();for(let E=0;E<5;E++){const g=E*Math.PI*2/5-Math.PI/2,M=d.size,O=d.size*.4;E===0?n.moveTo(Math.cos(g)*M,Math.sin(g)*M):n.lineTo(Math.cos(g)*M,Math.sin(g)*M);const x=g+Math.PI/5;n.lineTo(Math.cos(x)*O,Math.sin(x)*O)}n.closePath(),n.fill()}else if(d.type==="sparkle"){n.beginPath();const E=4;for(let g=0;g<E*2;g++){const M=g%2===0?d.size:d.size*.3,O=g*Math.PI/E,x=Math.cos(O)*M,R=Math.sin(O)*M;g===0?n.moveTo(x,R):n.lineTo(x,R)}n.closePath(),n.fill()}else n.beginPath(),n.arc(0,0,d.size/2,0,Math.PI*2),n.fill();return n.restore(),!0}),o.current.length>0&&(i.current=requestAnimationFrame(c))};return c(),()=>{i.current&&cancelAnimationFrame(i.current),o.current=[]}},[a,s,l,m]),m?null:t.jsx("canvas",{ref:e,className:"absolute inset-0 pointer-events-none"})}Z.propTypes={rarity:h.string.isRequired,isActive:h.bool.isRequired};function Q({rarity:r}){const a=A(),e=j[r]||j.common;return a?null:t.jsxs(t.Fragment,{children:[t.jsx(p.div,{className:"absolute inset-0 rounded-full",style:{background:`radial-gradient(circle, ${e.glow} 0%, transparent 70%)`,filter:`blur(${e.glowIntensity*10}px)`},initial:{opacity:0,scale:.5},animate:{opacity:[0,1,.7],scale:[.5,1.2,1]},transition:{duration:.6,ease:"easeOut"}}),t.jsx(p.div,{className:"absolute inset-[-20px] rounded-full border-2",style:{borderColor:e.primary,boxShadow:`0 0 ${e.glowIntensity*15}px ${e.glow}`},initial:{scale:.5,opacity:0},animate:{scale:[.8,1.2,1],opacity:[0,1,.5]},transition:{duration:.8,ease:"easeOut"}}),r==="legendary"&&t.jsxs(t.Fragment,{children:[t.jsx(p.div,{className:"absolute inset-[-40px] rounded-full border",style:{borderColor:e.primary,boxShadow:`0 0 20px ${e.glow}`},initial:{scale:.5,opacity:0},animate:{scale:[.8,1.3,1.1],opacity:[0,.8,.3]},transition:{duration:1,delay:.2,ease:"easeOut"}}),t.jsx(p.div,{className:"absolute inset-[-60px] rounded-full border",style:{borderColor:e.primary,boxShadow:`0 0 30px ${e.glow}`},initial:{scale:.5,opacity:0},animate:{scale:[.8,1.4,1.2],opacity:[0,.6,.2]},transition:{duration:1.2,delay:.4,ease:"easeOut"}})]})]})}Q.propTypes={rarity:h.string.isRequired};function J({rarity:r}){const a=j[r]||j.common,e=r.charAt(0).toUpperCase()+r.slice(1);return t.jsx(p.span,{className:"px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider",style:{background:a.gradient,color:r==="common"?"#1f2937":"#ffffff",boxShadow:`0 0 10px ${a.glow}`},initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3},children:e})}J.propTypes={rarity:h.string.isRequired};function ee({item:r,onRevealComplete:a,autoAdvanceDelay:e=2e3,className:o=""}){const i=A(),m=u.useRef(null),{name:s,icon:l,rarity:f,description:n}=r,b=j[f]||j.common;u.useEffect(()=>{if(e>0)return m.current=setTimeout(()=>{a?.()},e),()=>{m.current&&clearTimeout(m.current)}},[e,a]);const C=u.useCallback(()=>{m.current&&clearTimeout(m.current),a?.()},[a]);return t.jsxs(p.div,{className:V("relative flex flex-col items-center gap-6 p-8 cursor-pointer",o),onClick:C,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,scale:.8,y:-50},transition:{duration:.3},children:[t.jsx(Z,{rarity:f,isActive:!0}),t.jsxs(p.div,{className:"relative w-32 h-32 flex items-center justify-center",initial:{scale:0,rotateY:-180},animate:{scale:1,rotateY:0},transition:{type:"spring",stiffness:200,damping:15},children:[t.jsx(Q,{rarity:f}),t.jsx(p.div,{className:"absolute inset-0 rounded-2xl",style:{background:b.gradient,opacity:.2},animate:i?void 0:{opacity:[.15,.25,.15]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}}),t.jsx(p.span,{className:"relative z-10 text-6xl",style:{filter:`drop-shadow(0 0 ${b.glowIntensity*8}px ${b.glow})`},initial:{scale:0,rotate:-30},animate:{scale:1,rotate:0,y:i?0:[0,-5,0]},transition:{scale:{type:"spring",stiffness:300,damping:15,delay:.1},y:{duration:2,repeat:1/0,ease:"easeInOut"}},children:l})]}),t.jsxs(p.div,{className:"text-center",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:[t.jsx(J,{rarity:f}),t.jsx(p.h3,{className:"text-2xl font-bold text-[var(--text-primary)] mt-3",style:{textShadow:`0 0 20px ${b.glow}`},initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.4},children:s}),t.jsx(p.p,{className:"text-[var(--text-secondary)] mt-2 max-w-xs",initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},children:n})]}),t.jsx(p.span,{className:"text-xs text-[var(--text-quaternary)] mt-4",initial:{opacity:0},animate:{opacity:1},transition:{delay:1},children:"Tap to continue"})]})}ee.propTypes={item:h.shape({id:h.string.isRequired,name:h.string.isRequired,icon:h.string.isRequired,rarity:h.oneOf(["common","uncommon","rare","epic","legendary"]).isRequired,description:h.string.isRequired}).isRequired,onRevealComplete:h.func,autoAdvanceDelay:h.number,className:h.string};const Ie={hidden:{opacity:0},visible:{opacity:1,transition:{duration:.3}},exit:{opacity:0,transition:{duration:.3}}},Oe={hidden:{opacity:0,scale:.9,y:20},visible:{opacity:1,scale:1,y:0,transition:{type:"spring",stiffness:200,damping:20}},exit:{opacity:0,scale:.9,y:-20,transition:{duration:.2}}};function te({isActive:r,colors:a}){const e=u.useRef(null),o=u.useRef([]),i=u.useRef(null),m=A();return u.useEffect(()=>{if(!r||m)return;const s=e.current;if(!s)return;const l=s.getContext("2d"),f=s.getBoundingClientRect();s.width=f.width,s.height=f.height;const n=s.width/2,b=s.height/2;for(let y=0;y<60;y++){const v=Math.random()*Math.PI*2,c=Math.random()*8+4;o.current.push({x:n,y:b,vx:Math.cos(v)*c,vy:Math.sin(v)*c,size:Math.random()*6+3,color:a[Math.floor(Math.random()*a.length)],opacity:1,decay:Math.random()*.02+.01,rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.2})}const C=()=>{l.clearRect(0,0,s.width,s.height),o.current=o.current.filter(y=>{if(y.x+=y.vx,y.y+=y.vy,y.vy+=.15,y.vx*=.98,y.vy*=.98,y.opacity-=y.decay,y.rotation+=y.rotationSpeed,y.opacity<=0)return!1;l.save(),l.translate(y.x,y.y),l.rotate(y.rotation),l.globalAlpha=y.opacity,l.fillStyle=y.color,l.beginPath();for(let v=0;v<5;v++){const c=v*Math.PI*2/5-Math.PI/2,d=y.size,E=y.size*.4;v===0?l.moveTo(Math.cos(c)*d,Math.sin(c)*d):l.lineTo(Math.cos(c)*d,Math.sin(c)*d);const g=c+Math.PI/5;l.lineTo(Math.cos(g)*E,Math.sin(g)*E)}return l.closePath(),l.fill(),l.restore(),!0}),o.current.length>0&&(i.current=requestAnimationFrame(C))};return C(),()=>{i.current&&cancelAnimationFrame(i.current),o.current=[]}},[r,a,m]),m?null:t.jsx("canvas",{ref:e,className:"absolute inset-0 pointer-events-none z-20"})}te.propTypes={isActive:h.bool.isRequired,colors:h.arrayOf(h.string).isRequired};function ae({onClick:r,disabled:a,itemCount:e}){const o=A();return t.jsxs(p.button,{className:V("relative px-8 py-4 rounded-2xl","font-bold text-lg text-white","bg-gradient-to-r from-[var(--brand-blue-500)] via-[var(--brand-pulse-500)] to-[var(--brand-blue-500)]","border border-white/20","shadow-xl shadow-[var(--brand-blue-500)]/30","disabled:opacity-50 disabled:cursor-not-allowed","hover:shadow-2xl hover:shadow-[var(--brand-blue-500)]/40","transition-all duration-300"),onClick:r,disabled:a,whileHover:!a&&!o?{scale:1.05,y:-2}:void 0,whileTap:a?void 0:{scale:.95},initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{type:"spring",stiffness:200,damping:20,delay:.3},children:[!o&&t.jsx(p.div,{className:"absolute inset-0 rounded-2xl overflow-hidden",initial:!1,children:t.jsx(p.div,{className:"absolute inset-0",style:{background:"linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.2) 50%, transparent 100%)"},animate:{x:["-100%","200%"]},transition:{duration:1.5,repeat:1/0,repeatDelay:1}})}),t.jsxs("span",{className:"relative z-10 flex items-center gap-3",children:[t.jsx("span",{children:"ðŸŽ"}),"Claim ",e," ",e===1?"Item":"Items"]})]})}ae.propTypes={onClick:h.func.isRequired,disabled:h.bool,itemCount:h.number.isRequired};function re({items:r}){return t.jsx("div",{className:"flex flex-wrap justify-center gap-3 max-w-md",children:r.map((a,e)=>t.jsxs(p.div,{className:"flex items-center gap-2 px-3 py-2 rounded-lg bg-[var(--glass-white-10)] border border-[var(--border-subtle)]",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:e*.1},children:[t.jsx("span",{className:"text-xl",children:a.icon}),t.jsx("span",{className:"text-sm font-medium text-[var(--text-primary)]",children:a.name})]},a.id))})}re.propTypes={items:h.arrayOf(h.shape({id:h.string.isRequired,icon:h.string.isRequired,name:h.string.isRequired})).isRequired};function Se({className:r=""}){const a=A(),{fireConfetti:e}=fe(),{isOpen:o,currentLootDrop:i,revealedItems:m,currentItem:s,dropState:l,dropRarity:f,allRevealed:n,completeCurrentReveal:b,claimAll:C,closeLootDrop:y,skipToClaim:v,LOOT_DROP_STATES:c}=Ee(),d=u.useCallback(()=>{switch(l){case c.CHEST_CLOSED:return w.CLOSED;case c.CHEST_OPENING:return w.OPENING;case c.CHEST_OPEN:case c.REVEALING:case c.ALL_REVEALED:case c.CLAIMING:case c.CLAIMED:return w.OPEN;default:return w.CLOSED}},[l,c]),E=u.useCallback(()=>{a||e({preset:"achievement",origin:{x:.5,y:.4}})},[e,a]),g=u.useCallback(()=>{a||e({preset:"levelup",origin:{x:.5,y:.5}}),C()},[C,e,a]),M={common:["#9ca3af","#6b7280","#d1d5db"],rare:["#3b82f6","#60a5fa","#93c5fd"],epic:["#a855f7","#c084fc","#d8b4fe"],legendary:["#f59e0b","#fbbf24","#fcd34d","#ffffff"]};return u.useEffect(()=>{const O=x=>{x.key==="Escape"&&o&&(n?g():v())};return window.addEventListener("keydown",O),()=>window.removeEventListener("keydown",O)},[o,n,g,v]),!o||!i?null:t.jsx(_,{children:t.jsxs(p.div,{className:V("fixed inset-0 z-50 flex flex-col items-center justify-center",r),variants:Ie,initial:"hidden",animate:"visible",exit:"exit",children:[t.jsx(p.div,{className:"absolute inset-0 bg-black/80 backdrop-blur-md",onClick:()=>{n&&g()}}),t.jsx(p.div,{className:"absolute inset-0",style:{background:`radial-gradient(circle at 50% 40%, ${M[f]?.[0]||M.common[0]}20 0%, transparent 50%)`},initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},transition:{duration:.5}}),t.jsx(te,{isActive:l===c.CHEST_OPENING,colors:M[f]||M.common}),t.jsxs(p.div,{className:"relative z-10 flex flex-col items-center gap-8",variants:Oe,initial:"hidden",animate:"visible",exit:"exit",children:[l===c.CHEST_CLOSED&&t.jsx(p.h2,{className:"text-2xl font-bold text-[var(--text-primary)]",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{delay:.2},children:i.chest.name}),l!==c.ALL_REVEALED&&l!==c.CLAIMING&&l!==c.CLAIMED&&t.jsx(F,{state:d(),rarity:f,chestType:i.chest.id.toUpperCase(),onOpen:E,onOpenComplete:()=>{},enableSound:!a}),t.jsx(_,{mode:"wait",children:s&&l===c.REVEALING&&t.jsx(ee,{item:s,onRevealComplete:b},s.id)}),n&&l===c.ALL_REVEALED&&t.jsxs(p.div,{className:"flex flex-col items-center gap-6",initial:{opacity:0},animate:{opacity:1},children:[t.jsx("h2",{className:"text-2xl font-bold text-[var(--text-primary)]",children:"Your Loot"}),t.jsx(re,{items:m}),t.jsx(ae,{onClick:g,itemCount:m.length})]}),!n&&l===c.REVEALING&&t.jsx(p.button,{className:"text-sm text-[var(--text-tertiary)] hover:text-[var(--text-secondary)] transition-colors",onClick:v,initial:{opacity:0},animate:{opacity:1},transition:{delay:1},children:"Skip"}),t.jsx(p.button,{className:"absolute top-4 right-4 p-2 rounded-full bg-[var(--glass-white-10)] hover:bg-[var(--glass-white-20)] text-[var(--text-secondary)] hover:text-[var(--text-primary)] transition-colors",onClick:y,initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},children:t.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:t.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]})]})})}Se.propTypes={className:h.string};export{Se as LootDrop,Se as default};
