import{r as s,j as e}from"./react-vendor-D847gc3Q.js";import{G as c}from"./GlassSurface-DZwHl8aR.js";import{W as q,a as _}from"./wifi-5cN78XVI.js";import{L as M}from"./loader-circle-61W_4598.js";import{aF as J,Z as G,X as U,aE as R,J as Z}from"./index-DXxw33y3.js";import{R as Q}from"./refresh-cw-BXp7t2ED.js";import{C as B}from"./circle-alert-DrnS8gB_.js";import{T as X}from"./terminal-BpE8hhIJ.js";import{T as z}from"./trash-2-KBUZHYb1.js";import{C as K}from"./chevron-down-BSDJRnM9.js";import{C as V}from"./chevron-right-B-gUuGbN.js";import{C as Y}from"./circle-check-big-DeWI5Sn7.js";import"./leaflet-vendor-DZbo3Ov0.js";import"./recharts-vendor-d8oTApeF.js";import"./d3-vendor-DkU_Wy0v.js";import"./apollo-vendor-BNHFeEEc.js";import"./reactflow-vendor-5ig9bY2l.js";const E=9876,ee=9877,v="localhost",L={0:{label:"INSTANT",color:"text-green-400 bg-green-500/20"},1:{label:"RESTORE",color:"text-cyan-400 bg-cyan-500/20"},2:{label:"INCREMENTAL",color:"text-yellow-400 bg-yellow-500/20"},3:{label:"FULL",color:"text-purple-400 bg-purple-500/20"}};function be(){const[f,S]=s.useState(!1),[a,d]=s.useState(null),[O,D]=s.useState([]),[C,g]=s.useState(""),[b,F]=s.useState(""),[N,A]=s.useState("all"),[u,W]=s.useState(!0),[j,I]=s.useState(!0),[x,y]=s.useState(!1),[k,n]=s.useState(null),m=s.useRef(null),h=s.useRef(null),P=s.useRef(null),o=s.useRef(null),p=s.useCallback(async()=>{try{const t=await fetch(`http://${v}:${E}/status`);if(t.ok){const i=await t.json();d(i),n(null)}else throw new Error("Daemon not responding")}catch{d(null),n("Daemon not running")}},[]),w=s.useCallback(()=>{if(m.current?.readyState!==WebSocket.OPEN)try{const t=new WebSocket(`ws://${v}:${ee}`);t.onopen=()=>{S(!0),n(null)},t.onmessage=i=>{try{const l=JSON.parse(i.data);switch(l.type){case"connected":d(r=>r?{...r,...l.status}:null);break;case"queued":case"started":case"completed":case"failed":d(r=>r&&{...r,build:{...r.build,currentBuild:l.type==="started"?l.job:l.type==="completed"||l.type==="failed"?null:r.build.currentBuild,history:l.type==="completed"||l.type==="failed"?[l.job,...r.build.history.slice(0,9)]:r.build.history}}),(l.type==="completed"||l.type==="failed")&&y(!1),D(r=>[{timestamp:new Date().toISOString(),level:l.type==="failed"?"error":"info",msg:`Build ${l.type}: ${l.job?.id?.slice(0,8)}`,jobId:l.job?.id},...r].slice(0,1e3));break;case"output":g(r=>r+l.text);break;default:}}catch{}},t.onclose=()=>{S(!1),m.current=null,o.current||(o.current=setTimeout(()=>{o.current=null,w()},3e3))},t.onerror=i=>{n("WebSocket connection failed")},m.current=t}catch{n("Failed to connect to daemon")}},[]),T=s.useCallback(async(t=!1)=>{y(!0),g(""),n(null);try{const i=await fetch(`http://${v}:${E}/build`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({force:t})});if(!i.ok)throw new Error("Failed to queue build");const l=await i.json()}catch(i){y(!1),n(`Build request failed: ${i}`)}},[]);s.useEffect(()=>{u&&h.current&&(h.current.scrollTop=h.current.scrollHeight)},[C,u]),s.useEffect(()=>{p(),w();const t=setInterval(p,5e3);return()=>{clearInterval(t),o.current&&clearTimeout(o.current),m.current?.close()}},[p,w]);const $=O.filter(t=>!(N!=="all"&&t.level!==N||b&&!t.msg.toLowerCase().includes(b.toLowerCase()))),H=t=>t<1e3?`${t}ms`:t<6e4?`${(t/1e3).toFixed(2)}s`:`${(t/6e4).toFixed(1)}m`;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${f?"bg-green-500 animate-pulse":"bg-red-500"}`}),e.jsx("h2",{className:"text-xl font-bold text-white",children:"Build Daemon"}),f?e.jsx(q,{className:"w-5 h-5 text-green-400"}):e.jsx(_,{className:"w-5 h-5 text-red-400"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>T(!1),disabled:x||!a,className:"px-3 py-1.5 bg-blue-500/20 hover:bg-blue-500/30 text-blue-300 rounded-lg flex items-center gap-2 disabled:opacity-50",children:[x?e.jsx(M,{className:"w-4 h-4 animate-spin"}):e.jsx(J,{className:"w-4 h-4"}),"Build"]}),e.jsxs("button",{onClick:()=>T(!0),disabled:x||!a,className:"px-3 py-1.5 bg-purple-500/20 hover:bg-purple-500/30 text-purple-300 rounded-lg flex items-center gap-2 disabled:opacity-50",children:[e.jsx(G,{className:"w-4 h-4"}),"Force"]}),e.jsx("button",{onClick:p,className:"p-1.5 bg-white/5 hover:bg-white/10 text-gray-400 rounded-lg",children:e.jsx(Q,{className:"w-4 h-4"})})]})]}),k&&e.jsxs("div",{className:"px-4 py-3 bg-red-500/20 border border-red-500/30 rounded-lg flex items-center gap-3 text-red-300",children:[e.jsx(B,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{children:k}),e.jsx("button",{onClick:()=>n(null),className:"ml-auto",children:e.jsx(U,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs(c,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Status"}),e.jsx("div",{className:`text-xl font-bold ${a?"text-green-400":"text-red-400"}`,children:a?"Running":"Offline"})]}),e.jsxs(c,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Queue"}),e.jsx("div",{className:"text-xl font-bold text-white",children:a?.build.queueLength??"-"})]}),e.jsxs(c,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Current Build"}),e.jsx("div",{className:"text-xl font-bold",children:a?.build.currentBuild?e.jsx("span",{className:"text-yellow-400 animate-pulse",children:a.build.currentBuild.id.slice(0,8)}):e.jsx("span",{className:"text-gray-500",children:"None"})})]}),e.jsxs(c,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Uptime"}),e.jsx("div",{className:"text-xl font-bold text-white",children:a?`${(a.uptime/60).toFixed(0)}m`:"-"})]})]}),e.jsxs(c,{className:"overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-300",children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Build Output"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>W(!u),className:`p-1.5 rounded ${u?"bg-blue-500/20 text-blue-300":"bg-white/5 text-gray-400"}`,children:e.jsx(R,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>g(""),className:"p-1.5 bg-white/5 hover:bg-white/10 text-gray-400 rounded",children:e.jsx(z,{className:"w-4 h-4"})})]})]}),e.jsx("div",{ref:h,className:"h-64 overflow-auto p-4 font-mono text-xs bg-black/50 whitespace-pre-wrap",children:C||e.jsx("span",{className:"text-gray-500",children:x?"Waiting for output...":'No build output. Click "Build" to start.'})})]}),e.jsxs(c,{className:"overflow-hidden",children:[e.jsxs("button",{onClick:()=>I(!j),className:"w-full flex items-center justify-between px-4 py-3 border-b border-white/5 hover:bg-white/5",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-300",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Build History"}),e.jsxs("span",{className:"text-gray-500 text-sm",children:["(",a?.build.history.length??0," builds)"]})]}),j?e.jsx(K,{className:"w-4 h-4"}):e.jsx(V,{className:"w-4 h-4"})]}),j&&e.jsx("div",{className:"divide-y divide-white/5",children:a?.build.history.length===0?e.jsx("div",{className:"px-4 py-8 text-center text-gray-500",children:"No build history yet"}):a?.build.history.map(t=>e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[t.status==="completed"?e.jsx(Y,{className:"w-4 h-4 text-green-400"}):e.jsx(B,{className:"w-4 h-4 text-red-400"}),e.jsx("span",{className:"font-mono text-sm text-gray-300",children:t.id.slice(0,8)}),t.result?.tier!==void 0&&e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${L[t.result.tier]?.color}`,children:L[t.result.tier]?.label??`T${t.result.tier}`})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-400",children:[e.jsx("span",{children:t.source}),t.duration&&e.jsx("span",{className:"text-gray-500",children:H(t.duration)}),t.completedAt&&e.jsx("span",{className:"text-gray-600 text-xs",children:new Date(t.completedAt).toLocaleTimeString()})]})]},t.id))})]}),e.jsxs(c,{className:"overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-300",children:[e.jsx(R,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Live Logs"}),f&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-400 animate-pulse"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:N,onChange:t=>A(t.target.value),className:"px-2 py-1 bg-white/5 border border-white/10 rounded text-sm text-gray-300",children:[e.jsx("option",{value:"all",children:"All Levels"}),e.jsx("option",{value:"info",children:"Info"}),e.jsx("option",{value:"success",children:"Success"}),e.jsx("option",{value:"warn",children:"Warn"}),e.jsx("option",{value:"error",children:"Error"})]}),e.jsx("input",{type:"text",value:b,onChange:t=>F(t.target.value),placeholder:"Filter...",className:"px-2 py-1 bg-white/5 border border-white/10 rounded text-sm text-gray-300 w-32"})]})]}),e.jsx("div",{ref:P,className:"h-48 overflow-auto divide-y divide-white/5",children:$.length===0?e.jsx("div",{className:"px-4 py-8 text-center text-gray-500",children:"No logs yet"}):$.map((t,i)=>e.jsxs("div",{className:`px-4 py-2 text-xs font-mono flex items-start gap-3 ${t.level==="error"?"bg-red-500/5":t.level==="warn"?"bg-yellow-500/5":t.level==="success"?"bg-green-500/5":""}`,children:[e.jsx("span",{className:"text-gray-600 flex-shrink-0",children:new Date(t.timestamp).toLocaleTimeString()}),e.jsxs("span",{className:`flex-shrink-0 w-16 uppercase ${t.level==="error"?"text-red-400":t.level==="warn"?"text-yellow-400":t.level==="success"?"text-green-400":"text-blue-400"}`,children:["[",t.level,"]"]}),e.jsx("span",{className:"text-gray-300 break-all",children:t.msg})]},i))})]})]})}export{be as default};
