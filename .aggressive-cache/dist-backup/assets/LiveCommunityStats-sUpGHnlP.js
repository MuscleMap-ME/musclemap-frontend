import{r as t,j as e}from"./react-vendor-D1NxaRNd.js";import{m as l,A as L}from"./index-ChmNk_hk.js";import"./leaflet-vendor-DZbo3Ov0.js";import"./apollo-vendor-BMQ75Ycx.js";import"./reactflow-vendor-Dz2P_-Qa.js";import"./d3-vendor-mcDw60ct.js";import"./recharts-vendor-BziRPEEi.js";const A=5,R=3e3,M=6e4;function T(){const[d,r]=t.useState(null),[g,u]=t.useState([]),[j,c]=t.useState(null),[x,m]=t.useState(!0),[b,h]=t.useState(!1),[w,W]=t.useState(null),p=t.useRef(null),N=t.useRef(0),o=t.useRef(null),y=t.useRef(null),a=t.useRef(null),E=t.useCallback(i=>i&&(i.display||i.value?.toString())||"â€”",[]),f=t.useCallback(async()=>{try{const i=await fetch("/api/community/stats/public");if(!i.ok)throw new Error("Failed to fetch stats");const s=(await i.json()).data;r({activeNow:s.activeNow,activeWorkouts:s.activeWorkouts,totalUsers:s.totalUsers,totalWorkouts:s.totalWorkouts}),u(s.recentActivity||[]),c(s.milestone),W(null)}catch(i){W(i.message)}finally{m(!1)}},[]),k=t.useCallback(()=>{o.current||(f(),o.current=setInterval(f,M))},[f]),S=t.useCallback(()=>{if(p.current?.readyState===WebSocket.OPEN)return;a.current&&(clearInterval(a.current),a.current=null);const C=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/api/community/ws/public`;try{const s=new WebSocket(C);p.current=s,s.onopen=()=>{h(!0),N.current=0,o.current&&(clearInterval(o.current),o.current=null)},s.onmessage=I=>{try{const v=JSON.parse(I.data);if(v.type==="snapshot"||v.type==="update"){const n=v.data;r({activeNow:n.activeNow,activeWorkouts:n.activeWorkouts,totalUsers:n.totalUsers,totalWorkouts:n.totalWorkouts}),n.recentActivity&&u(n.recentActivity),n.milestone!==void 0&&c(n.milestone),m(!1)}else v.type==="activity"&&u(n=>[v.data,...n].slice(0,20))}catch{}},s.onclose=()=>{h(!1),p.current=null,a.current&&(clearInterval(a.current),a.current=null),N.current<A?(N.current++,y.current=setTimeout(S,R)):k()},s.onerror=()=>{},a.current=setInterval(()=>{s.readyState===WebSocket.OPEN&&s.send(JSON.stringify({type:"ping"}))},3e4)}catch{k()}},[k]);return t.useEffect(()=>(f(),S(),()=>{y.current&&(clearTimeout(y.current),y.current=null),a.current&&(clearInterval(a.current),a.current=null),p.current&&(p.current.close(),p.current=null),o.current&&(clearInterval(o.current),o.current=null)}),[f,S]),{stats:d,activity:g,milestone:j,loading:x,connected:b,error:w,formatStat:E,refresh:f}}const z=4e3;function F(){const{stats:d,activity:r,milestone:g,loading:u,connected:j,formatStat:c}=T(),[x,m]=t.useState(0);if(t.useEffect(()=>{if(!r||r.length===0){m(0);return}x>=r.length&&m(0)},[r,x]),t.useEffect(()=>{if(!r||r.length<=1)return;const h=setInterval(()=>{m(w=>(w+1)%r.length)},z);return()=>clearInterval(h)},[r]),u)return e.jsx("section",{className:"py-12 px-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"text-center mb-8",children:e.jsx("div",{className:"h-8 w-48 bg-white/10 rounded-lg mx-auto animate-pulse"})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[1,2,3,4].map(h=>e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 p-6 animate-pulse",children:[e.jsx("div",{className:"h-4 w-16 bg-white/10 rounded mb-3"}),e.jsx("div",{className:"h-8 w-12 bg-white/10 rounded mb-2"}),e.jsx("div",{className:"h-3 w-20 bg-white/10 rounded"})]},h))})]})});const b=r?.[x];return e.jsx("section",{className:"py-12 px-6 border-t border-white/5",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center mb-8",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx("h2",{className:"text-2xl md:text-3xl font-bold",children:e.jsx("span",{style:{background:"linear-gradient(90deg, #10b981 0%, #06b6d4 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Join the Community"})}),j&&e.jsxs(l.div,{initial:{scale:0},animate:{scale:1},className:"flex items-center gap-1.5",children:[e.jsxs("span",{className:"relative flex h-2.5 w-2.5",children:[e.jsx("span",{className:"absolute inline-flex h-full w-full animate-ping rounded-full bg-green-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex h-2.5 w-2.5 rounded-full bg-green-500"})]}),e.jsx("span",{className:"text-xs text-green-400 font-medium",children:"LIVE"})]})]}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Real-time stats from athletes around the world"})]}),e.jsx(L,{children:g?.reached&&e.jsx(l.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"mb-6 rounded-xl border border-yellow-500/30 bg-gradient-to-r from-yellow-500/10 via-orange-500/10 to-yellow-500/10 p-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:"ðŸŽ‰"}),e.jsxs("span",{className:"text-yellow-300 font-bold",children:["We just hit ",g.value.toLocaleString()," workouts!"]}),e.jsx("span",{className:"text-2xl",children:"ðŸŽ‰"})]})})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-sm p-5 hover:border-cyan-500/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-cyan-500/20 flex items-center justify-center",children:e.jsxs("svg",{className:"w-4 h-4 text-cyan-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})}),e.jsx("span",{className:"text-xs text-gray-400 font-medium uppercase tracking-wide",children:"Browsing"})]}),e.jsx("div",{className:"text-3xl font-bold text-white mb-1",children:c(d?.activeNow)}),e.jsx("div",{className:"text-xs text-gray-500",children:"people online now"})]}),e.jsxs(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-sm p-5 hover:border-green-500/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-green-500/20 flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})})}),e.jsx("span",{className:"text-xs text-gray-400 font-medium uppercase tracking-wide",children:"Active"})]}),e.jsx("div",{className:"text-3xl font-bold text-white mb-1",children:c(d?.activeWorkouts)}),e.jsx("div",{className:"text-xs text-gray-500",children:"working out now"})]}),e.jsxs(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-sm p-5 hover:border-purple-500/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-purple-500/20 flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-purple-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})}),e.jsx("span",{className:"text-xs text-gray-400 font-medium uppercase tracking-wide",children:"Athletes"})]}),e.jsx("div",{className:"text-3xl font-bold text-white mb-1",children:c(d?.totalUsers)}),e.jsx("div",{className:"text-xs text-gray-500",children:"have joined"})]}),e.jsxs(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-sm p-5 hover:border-orange-500/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-orange-500/20 flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-orange-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("span",{className:"text-xs text-gray-400 font-medium uppercase tracking-wide",children:"Workouts"})]}),e.jsx("div",{className:"text-3xl font-bold text-white mb-1",children:c(d?.totalWorkouts)}),e.jsx("div",{className:"text-xs text-gray-500",children:"completed"})]})]}),e.jsx(L,{mode:"wait",children:b&&e.jsx(l.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsxs("span",{className:"relative flex h-2 w-2",children:[e.jsx("span",{className:"absolute inline-flex h-full w-full animate-ping rounded-full bg-blue-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex h-2 w-2 rounded-full bg-blue-500"})]}),e.jsx("span",{className:"text-gray-300 text-sm",children:b.message})]})},x)}),(!r||r.length===0)&&!u&&e.jsx(l.div,{initial:{opacity:0},animate:{opacity:1},className:"rounded-xl border border-white/10 bg-white/5 backdrop-blur-sm p-4",children:e.jsx("div",{className:"flex items-center justify-center gap-3",children:e.jsx("span",{className:"text-gray-400 text-sm",children:"Be the first to log a workout today!"})})})]})})}export{F as default};
