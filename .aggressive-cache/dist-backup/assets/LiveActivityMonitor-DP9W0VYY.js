import{r as a,j as e,a as X,L as ee}from"./react-vendor-D1NxaRNd.js";import{c as te,b9 as _,a_ as B,a3 as q,a0 as U,Z as K,aV as F,j as Q,b3 as se,a2 as ae,ba as le,ab as ne}from"./index-VPOrxyVC.js";import{Z as re,a as oe}from"./zoom-out-DlXk7gYf.js";import{L as ce}from"./layers-SI-WXB0X.js";import{B as ie}from"./building-2-B_NILbYH.js";import{C as Z}from"./chevron-right-D9GRWKkh.js";import{F as de}from"./funnel-qHq7oM9R.js";import{C as xe}from"./chevron-down-Xs3EVs9W.js";import{A as he}from"./arrow-left-BALoXPjp.js";import{W as me,a as ue}from"./wifi-Dp46OUyf.js";import{R as fe}from"./refresh-cw-CkLQQkM5.js";import"./leaflet-vendor-DZbo3Ov0.js";import"./apollo-vendor-D9c7jRvS.js";import"./reactflow-vendor-Dz2P_-Qa.js";import"./d3-vendor-mcDw60ct.js";import"./recharts-vendor-BziRPEEi.js";const be=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]],pe=te("house",be),we=5,ge=3e3,ve=3e4,je={"5m":5,"15m":15,"1h":60,"24h":1440};function Ne(l={}){const{timeWindow:c="1h",autoConnect:w=!0}=l,[r,x]=a.useState(null),[n,f]=a.useState([]),[h,o]=a.useState([]),[s,L]=a.useState([]),[R,k]=a.useState(!0),[y,i]=a.useState(!1),[v,S]=a.useState(null),C=a.useRef(null),A=a.useRef(0),T=a.useRef(null),P=a.useRef(null),E=a.useRef(null),D=a.useCallback(async()=>{try{const d=await fetch(`/api/live/stats?window=${c}`);if(!d.ok)throw new Error("Failed to fetch live stats");const j=await d.json();x(j.data),S(null)}catch(d){S(d.message)}finally{k(!1)}},[c]),g=a.useCallback(async()=>{try{const d=await fetch(`/api/live/map?window=${c}`);if(!d.ok)throw new Error("Failed to fetch map data");const j=await d.json();f(j.data||[])}catch{}},[c]),t=a.useCallback(async()=>{try{const d=await fetch("/api/live/feed?limit=50");if(!d.ok)throw new Error("Failed to fetch feed");const j=await d.json();o(j.data||[])}catch{}},[]),b=a.useCallback(async()=>{try{const d=await fetch(`/api/live/trending?window=${c}&limit=10`);if(!d.ok)throw new Error("Failed to fetch trending");const j=await d.json();L(j.data||[])}catch{}},[c]),u=a.useCallback(async()=>{k(!0),await Promise.all([D(),g(),t(),b()]),k(!1)},[D,g,t,b]),m=a.useCallback(()=>{T.current||(u(),T.current=setInterval(u,ve))},[u]),p=a.useCallback(()=>{if(C.current?.readyState===WebSocket.OPEN)return;E.current&&(clearInterval(E.current),E.current=null);const j=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/api/live/stream`;try{const $=new WebSocket(j);C.current=$,$.onopen=()=>{i(!0),A.current=0,T.current&&(clearInterval(T.current),T.current=null)},$.onmessage=z=>{try{const W=JSON.parse(z.data);W.type&&(o(I=>[W,...I].slice(0,100)),x(I=>I&&{...I,total:(I.total||0)+1}))}catch{}},$.onclose=()=>{i(!1),C.current=null,E.current&&(clearInterval(E.current),E.current=null),A.current<we?(A.current++,P.current=setTimeout(p,ge)):m()},$.onerror=()=>{},E.current=setInterval(()=>{$.readyState===WebSocket.OPEN&&$.send(JSON.stringify({type:"ping"}))},3e4)}catch{m()}},[m]);a.useEffect(()=>(u(),w&&p(),()=>{P.current&&(clearTimeout(P.current),P.current=null),E.current&&(clearInterval(E.current),E.current=null),C.current&&(C.current.close(),C.current=null),T.current&&(clearInterval(T.current),T.current=null)}),[u,p,w]),a.useEffect(()=>{D(),g(),b()},[c,D,g,b]);const N=a.useCallback(d=>{const j=new Date,$=new Date(d),z=j-$,W=Math.floor(z/1e3),I=Math.floor(W/60),V=Math.floor(I/60);return W<60?"Just now":I<60?`${I}m ago`:V<24?`${V}h ago`:$.toLocaleDateString()},[]),M=a.useMemo(()=>r?.byMuscle?Object.entries(r.byMuscle).map(([d,j])=>({muscle:d,count:j})).sort((d,j)=>j.count-d.count):[],[r?.byMuscle]),O=a.useMemo(()=>r?.byCountry?Object.entries(r.byCountry).map(([d,j])=>({country:d,count:j})).sort((d,j)=>j.count-d.count):[],[r?.byCountry]);return{stats:r,mapData:n,feed:h,trending:s,activityByMuscle:M,activityByCountry:O,loading:R,connected:y,error:v,timeWindow:c,refresh:u,refreshStats:D,refreshMap:g,refreshFeed:t,refreshTrending:b,formatRelativeTime:N,timeWindows:je}}const ye={US:{lat:39.8,lng:-98.5,name:"United States"},GB:{lat:54,lng:-2,name:"United Kingdom"},CA:{lat:56.1,lng:-106.3,name:"Canada"},AU:{lat:-25.3,lng:133.8,name:"Australia"},DE:{lat:51.2,lng:10.4,name:"Germany"},JP:{lat:36.2,lng:138.3,name:"Japan"},BR:{lat:-14.2,lng:-51.9,name:"Brazil"},FR:{lat:46.2,lng:2.2,name:"France"},IN:{lat:20.6,lng:79,name:"India"},MX:{lat:23.6,lng:-102.5,name:"Mexico"}};function ke({mapData:l=[],onRegionClick:c,className:w=""}){const r=a.useRef(null),[x,n]=a.useState(1),[f,h]=a.useState({x:0,y:0}),[o,s]=a.useState(null),[L,R]=a.useState(!1),[k,y]=a.useState({x:0,y:0}),i=a.useMemo(()=>{const g=[],t={};for(const b of l){const u=b.country||"Unknown";t[u]||(t[u]={count:0,cities:new Set}),t[u].count+=b.count,b.city&&t[u].cities.add(b.city)}for(const[b,u]of Object.entries(t)){const m=ye[b];m&&g.push({id:b,lat:m.lat,lng:m.lng,count:u.count,name:m.name,cities:Array.from(u.cities)})}return g},[l]),v=(g,t,b,u)=>{const m=(t+180)/360*b*x+f.x,p=(90-g)/180*u*x+f.y;return{x:m,y:p}};a.useEffect(()=>{const g=r.current;if(!g)return;const t=g.getContext("2d"),b=g.width,u=g.height;t.fillStyle="#0a0a0f",t.fillRect(0,0,b,u),t.strokeStyle="rgba(255, 255, 255, 0.05)",t.lineWidth=1;for(let m=-80;m<=80;m+=20){const{y:p}=v(m,0,b,u);p>=0&&p<=u&&(t.beginPath(),t.moveTo(0,p),t.lineTo(b,p),t.stroke())}for(let m=-180;m<=180;m+=30){const{x:p}=v(0,m,b,u);p>=0&&p<=b&&(t.beginPath(),t.moveTo(p,0),t.lineTo(p,u),t.stroke())}for(const m of i){const{x:p,y:N}=v(m.lat,m.lng,b,u);if(p<-50||p>b+50||N<-50||N>u+50)continue;const M=Math.min(30,Math.max(10,Math.log10(m.count+1)*15)),O=t.createRadialGradient(p,N,0,p,N,M*2);O.addColorStop(0,"rgba(59, 130, 246, 0.4)"),O.addColorStop(1,"rgba(59, 130, 246, 0)"),t.fillStyle=O,t.beginPath(),t.arc(p,N,M*2,0,Math.PI*2),t.fill();const d=o?.id===m.id;t.fillStyle=d?"#60a5fa":"#3b82f6",t.beginPath(),t.arc(p,N,M,0,Math.PI*2),t.fill(),(M>=15||d)&&(t.fillStyle="#ffffff",t.font=`bold ${Math.max(10,M*.6)}px Inter`,t.textAlign="center",t.textBaseline="middle",t.fillText(m.count.toString(),p,N))}if(o){const{x:m,y:p}=v(o.lat,o.lng,b,u),N=Math.min(m+20,b-150),M=Math.max(p-40,10);t.fillStyle="rgba(0, 0, 0, 0.9)",t.strokeStyle="rgba(59, 130, 246, 0.5)",t.lineWidth=1,t.beginPath(),t.roundRect(N,M,140,50,8),t.fill(),t.stroke(),t.fillStyle="#ffffff",t.font="bold 12px Inter",t.textAlign="left",t.fillText(o.name,N+10,M+18),t.fillStyle="#a1a1aa",t.font="11px Inter",t.fillText(`${o.count} workouts`,N+10,M+35)}},[i,x,f,o]);const S=g=>{const t=r.current;if(!t)return;const b=t.getBoundingClientRect(),u=g.clientX-b.left,m=g.clientY-b.top;if(L){h({x:f.x+(u-k.x),y:f.y+(m-k.y)}),y({x:u,y:m});return}let p=null;for(const N of i){const{x:M,y:O}=v(N.lat,N.lng,t.width,t.height),d=Math.min(30,Math.max(10,Math.log10(N.count+1)*15));if(Math.sqrt((u-M)**2+(m-O)**2)<=d){p=N;break}}s(p)},C=g=>{const t=r.current.getBoundingClientRect();R(!0),y({x:g.clientX-t.left,y:g.clientY-t.top})},A=()=>{R(!1)},T=()=>{o&&c&&c(o)},P=()=>{n(g=>Math.min(g*1.5,5))},E=()=>{n(g=>Math.max(g/1.5,.5))},D=()=>{n(1),h({x:0,y:0})};return e.jsxs("div",{className:`relative bg-black/20 rounded-xl overflow-hidden ${w}`,children:[e.jsx("div",{className:"absolute top-4 left-4 z-10 flex items-center gap-2",children:e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-black/60 backdrop-blur-sm rounded-full border border-white/10",children:[e.jsx(_,{className:"w-4 h-4 text-blue-400"}),e.jsxs("span",{className:"text-xs text-white/70",children:[i.length," regions active"]})]})}),e.jsxs("div",{className:"absolute top-4 right-4 z-10 flex flex-col gap-2",children:[e.jsx("button",{onClick:P,className:"p-2 bg-black/60 backdrop-blur-sm rounded-lg border border-white/10 text-white/70 hover:text-white hover:bg-black/80 transition-colors",children:e.jsx(re,{className:"w-4 h-4"})}),e.jsx("button",{onClick:E,className:"p-2 bg-black/60 backdrop-blur-sm rounded-lg border border-white/10 text-white/70 hover:text-white hover:bg-black/80 transition-colors",children:e.jsx(oe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:D,className:"p-2 bg-black/60 backdrop-blur-sm rounded-lg border border-white/10 text-white/70 hover:text-white hover:bg-black/80 transition-colors",children:e.jsx(ce,{className:"w-4 h-4"})})]}),e.jsx("canvas",{ref:r,width:800,height:400,className:"w-full h-auto cursor-grab",style:{cursor:L?"grabbing":o?"pointer":"grab"},onMouseMove:S,onMouseDown:C,onMouseUp:A,onMouseLeave:A,onClick:T}),i.length===0&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(_,{className:"w-12 h-12 text-white/20 mx-auto mb-4"}),e.jsx("p",{className:"text-white/50 text-sm",children:"No activity data available"}),e.jsx("p",{className:"text-white/30 text-xs mt-1",children:"Workouts will appear here in real-time"})]})}),e.jsx("div",{className:"absolute bottom-4 left-4 px-3 py-2 bg-black/60 backdrop-blur-sm rounded-lg border border-white/10",children:e.jsx("p",{className:"text-xs text-white/50",children:"Marker size = workout count (anonymous data only)"})})]})}const H={global:B,country:_,region:ie,city:pe},Se={global:"Global",country:"Country",region:"Region",city:"City"};function Ce({timeWindow:l="1h",onLevelChange:c,className:w=""}){const[r,x]=a.useState([{level:"global",code:null,name:"Global"}]),[n,f]=a.useState([]),[h,o]=a.useState(!1),s=r[r.length-1],L=a.useCallback(async()=>{o(!0);try{let i=`/api/live/hierarchy/${s.level}?window=${l}`;s.code&&(i+=`&parent=${encodeURIComponent(s.code)}`);const v=await fetch(i);if(!v.ok)throw new Error("Failed to fetch hierarchy");const S=await v.json();f(S.data||[])}catch{f([])}finally{o(!1)}},[s,l]);a.useEffect(()=>{L()},[L]);const R=i=>{const v=s.level==="global"?"country":s.level==="country"?"region":"city";if(v==="city")return;const S={level:v,code:i.code,name:i.name};x([...r,S]),c?.(S,[...r,S])},k=i=>{const v=r.slice(0,i+1);x(v),c?.(v[v.length-1],v)},y=H[s.level];return e.jsxs("div",{className:`bg-black/20 rounded-xl border border-white/5 ${w}`,children:[e.jsx("div",{className:"flex items-center gap-2 px-4 py-3 border-b border-white/5 overflow-x-auto",children:r.map((i,v)=>{const S=H[i.level],C=v===r.length-1;return e.jsxs(X.Fragment,{children:[v>0&&e.jsx(Z,{className:"w-4 h-4 text-white/30 flex-shrink-0"}),e.jsxs("button",{onClick:()=>k(v),disabled:C,className:`flex items-center gap-1.5 px-2 py-1 rounded-md transition-colors flex-shrink-0 ${C?"bg-blue-500/20 text-blue-400 cursor-default":"text-white/60 hover:text-white hover:bg-white/10"}`,children:[e.jsx(S,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:i.name})]})]},`${i.level}-${i.code||"root"}`)})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm font-medium text-white/70 flex items-center gap-2",children:[e.jsx(y,{className:"w-4 h-4"}),Se[s.level]," breakdown"]}),h&&e.jsx("div",{className:"w-4 h-4 border-2 border-blue-500/30 border-t-blue-500 rounded-full animate-spin"})]}),n.length===0?e.jsx("p",{className:"text-sm text-white/40 text-center py-4",children:h?"Loading...":"No activity data for this region"}):e.jsx("div",{className:"space-y-2 max-h-[300px] overflow-y-auto",children:n.map(i=>e.jsxs("button",{onClick:()=>R(i),disabled:s.level==="region",className:`w-full flex items-center justify-between px-3 py-2 rounded-lg transition-colors ${s.level==="region"?"bg-white/5 cursor-default":"bg-white/5 hover:bg-white/10 cursor-pointer"}`,children:[e.jsx("span",{className:"text-sm text-white/80",children:i.name||i.code}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-blue-400",children:i.count}),s.level!=="region"&&e.jsx(Z,{className:"w-4 h-4 text-white/30"})]})]},i.code))})]})]})}const Me=[{value:"5m",label:"5 min"},{value:"15m",label:"15 min"},{value:"1h",label:"1 hour"},{value:"24h",label:"24 hours"}],Ee=[{value:"all",label:"All muscles"},{value:"chest",label:"Chest"},{value:"back",label:"Back"},{value:"shoulders",label:"Shoulders"},{value:"arms",label:"Arms"},{value:"core",label:"Core"},{value:"legs",label:"Legs"}],Le=[{value:"all",label:"All activity"},{value:"workout.completed",label:"Workouts"},{value:"exercise.completed",label:"Exercises"},{value:"achievement.earned",label:"Achievements"}];function Te({timeWindow:l="1h",muscleGroup:c="all",eventType:w="all",onTimeWindowChange:r,onMuscleGroupChange:x,onEventTypeChange:n,className:f=""}){const[h,o]=a.useState(!1);return e.jsxs("div",{className:`bg-black/20 rounded-xl border border-white/5 ${f}`,children:[e.jsxs("button",{onClick:()=>o(!h),className:"w-full flex items-center justify-between px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-blue-400"}),e.jsx("span",{className:"text-sm font-medium text-white/80",children:"Filters"})]}),e.jsx(xe,{className:`w-4 h-4 text-white/50 transition-transform ${h?"rotate-180":""}`})]}),e.jsxs("div",{className:"px-4 pb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(q,{className:"w-4 h-4 text-white/50"}),e.jsx("span",{className:"text-xs text-white/50",children:"Time window"})]}),e.jsx("div",{className:"flex gap-2",children:Me.map(s=>e.jsx("button",{onClick:()=>r?.(s.value),className:`px-3 py-1.5 text-xs rounded-lg transition-colors ${l===s.value?"bg-blue-500 text-white":"bg-white/5 text-white/60 hover:bg-white/10 hover:text-white"}`,children:s.label},s.value))})]}),h&&e.jsxs("div",{className:"px-4 pb-4 space-y-4 border-t border-white/5 pt-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(U,{className:"w-4 h-4 text-white/50"}),e.jsx("span",{className:"text-xs text-white/50",children:"Muscle group"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Ee.map(s=>e.jsx("button",{onClick:()=>x?.(s.value),className:`px-3 py-1.5 text-xs rounded-lg transition-colors ${c===s.value?"bg-violet-500 text-white":"bg-white/5 text-white/60 hover:bg-white/10 hover:text-white"}`,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(K,{className:"w-4 h-4 text-white/50"}),e.jsx("span",{className:"text-xs text-white/50",children:"Activity type"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Le.map(s=>e.jsx("button",{onClick:()=>n?.(s.value),className:`px-3 py-1.5 text-xs rounded-lg transition-colors ${w===s.value?"bg-emerald-500 text-white":"bg-white/5 text-white/60 hover:bg-white/10 hover:text-white"}`,children:s.label},s.value))})]})]})]})}function G({icon:l,label:c,value:w,subValue:r,color:x="blue"}){const n={blue:"from-blue-500/20 to-blue-600/10 border-blue-500/20 text-blue-400",violet:"from-violet-500/20 to-violet-600/10 border-violet-500/20 text-violet-400",emerald:"from-emerald-500/20 to-emerald-600/10 border-emerald-500/20 text-emerald-400",amber:"from-amber-500/20 to-amber-600/10 border-amber-500/20 text-amber-400"};return e.jsx("div",{className:`relative overflow-hidden rounded-xl bg-gradient-to-br ${n[x]} border p-4`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/50 mb-1",children:c}),e.jsx("p",{className:"text-2xl font-bold text-white",children:w}),r&&e.jsx("p",{className:"text-xs text-white/40 mt-1",children:r})]}),e.jsx(l,{className:`w-8 h-8 opacity-50 ${n[x].split(" ").pop()}`})]})})}function $e({stats:l,activityByMuscle:c=[],timeWindow:w="1h",connected:r=!1,className:x=""}){const n={"5m":"last 5 minutes","15m":"last 15 minutes","1h":"last hour","24h":"last 24 hours"},f=c[0];return e.jsxs("div",{className:`space-y-4 ${x}`,children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-black/20 rounded-lg border border-white/5",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${r?"bg-emerald-400 animate-pulse":"bg-white/30"}`}),e.jsx("span",{className:"text-xs text-white/60",children:r?"Live updates active":"Polling mode"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(G,{icon:F,label:"Total Activity",value:l?.total?.toLocaleString()||"0",subValue:n[w],color:"blue"}),e.jsx(G,{icon:B,label:"Active Regions",value:Object.keys(l?.byCountry||{}).length,subValue:"countries",color:"violet"}),e.jsx(G,{icon:U,label:"Muscle Groups",value:Object.keys(l?.byMuscle||{}).length,subValue:f?`Top: ${f.muscle}`:"",color:"emerald"}),e.jsx(G,{icon:K,label:"Workouts",value:l?.byType?.["workout.completed"]?.toLocaleString()||"0",subValue:n[w],color:"amber"})]}),c.length>0&&e.jsxs("div",{className:"bg-black/20 rounded-xl border border-white/5 p-4",children:[e.jsxs("h3",{className:"text-sm font-medium text-white/70 mb-3 flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),"Activity by Muscle"]}),e.jsx("div",{className:"space-y-2",children:c.slice(0,5).map(h=>{const o=c[0]?.count||1,s=h.count/o*100;return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-white/70 capitalize",children:h.muscle}),e.jsx("span",{className:"text-white/50",children:h.count})]}),e.jsx("div",{className:"h-1.5 bg-white/5 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 to-violet-500 rounded-full transition-all duration-500",style:{width:`${s}%`}})})]},h.muscle)})})]}),e.jsx("div",{className:"px-3 py-2 bg-emerald-500/10 rounded-lg border border-emerald-500/20",children:e.jsx("p",{className:"text-xs text-emerald-400/80",children:"All data is anonymous and aggregated. Individual user activity is never displayed."})})]})}const J={"workout.completed":{icon:U,color:"blue",label:"Workout completed"},"exercise.completed":{icon:F,color:"violet",label:"Exercise completed"},"achievement.earned":{icon:se,color:"amber",label:"Achievement earned"}};function Ie(l){const c=new Date,w=new Date(l),r=c-w,x=Math.floor(r/1e3),n=Math.floor(x/60),f=Math.floor(n/60);return x<10?"Just now":x<60?`${x}s ago`:n<60?`${n}m ago`:f<24?`${f}h ago`:w.toLocaleDateString()}function Re({event:l,isNew:c=!1}){const w=J[l.type]||J["workout.completed"],r=w.icon,x={blue:"bg-blue-500/20 text-blue-400 border-blue-500/30",violet:"bg-violet-500/20 text-violet-400 border-violet-500/30",amber:"bg-amber-500/20 text-amber-400 border-amber-500/30"},n=l.city&&l.country?`${l.city}, ${l.country}`:l.country||null;return e.jsxs("div",{className:`flex items-start gap-3 p-3 rounded-lg transition-all duration-300 ${c?"bg-white/10 animate-pulse":"bg-white/5"}`,children:[e.jsx("div",{className:`p-2 rounded-lg ${x[w.color]} border`,children:e.jsx(r,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-white/80",children:l.muscleGroup?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"capitalize",children:l.muscleGroup})," workout"]}):w.label}),n&&e.jsxs("p",{className:"text-xs text-white/40 flex items-center gap-1 mt-1",children:[e.jsx(_,{className:"w-3 h-3"}),n]})]}),e.jsxs("span",{className:"text-xs text-white/30 flex items-center gap-1 flex-shrink-0",children:[e.jsx(q,{className:"w-3 h-3"}),Ie(l.timestamp)]})]})}function Ae({feed:l=[],className:c=""}){const w=a.useRef(null),[r,x]=a.useState(new Set),n=a.useRef([]);a.useEffect(()=>{const h=new Set(n.current.map(s=>s.id)),o=l.filter(s=>!h.has(s.id)).map(s=>s.id);o.length>0&&(x(new Set(o)),setTimeout(()=>{x(new Set)},2e3)),n.current=l},[l]);const f=X.useMemo(()=>{const h=[];let o=null;for(const s of l){const L=new Date(s.timestamp),k=Math.floor((new Date-L)/6e4);let y;k<1?y="Just now":k<5?y="A few minutes ago":k<15?y="In the last 15 minutes":k<60?y="In the last hour":y="Earlier",(!o||o.label!==y)&&(o={label:y,events:[]},h.push(o)),o.events.push(s)}return h},[l]);return e.jsxs("div",{className:`bg-black/20 rounded-xl border border-white/5 ${c}`,children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4 text-blue-400"}),e.jsx("span",{className:"text-sm font-medium text-white/80",children:"Live Activity"})]}),e.jsxs("span",{className:"text-xs text-white/40",children:[l.length," events"]})]}),e.jsx("div",{ref:w,className:"p-4 max-h-[500px] overflow-y-auto space-y-4",children:f.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(F,{className:"w-8 h-8 text-white/20 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-white/40",children:"No recent activity"}),e.jsx("p",{className:"text-xs text-white/30 mt-1",children:"Events will appear here in real-time"})]}):f.map((h,o)=>e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs text-white/40 mb-2 sticky top-0 bg-[#0a0a0f] py-1",children:h.label}),e.jsx("div",{className:"space-y-2",children:h.events.map(s=>e.jsx(Re,{event:s,isNew:r.has(s.id)},s.id))})]},h.label))}),e.jsx("div",{className:"px-4 py-2 border-t border-white/5 bg-black/10",children:e.jsx("p",{className:"text-xs text-white/30 text-center",children:"Anonymous activity only - no personal data displayed"})})]})}const Y={chest:"from-red-500 to-orange-500",back:"from-blue-500 to-cyan-500",shoulders:"from-amber-500 to-yellow-500",arms:"from-violet-500 to-purple-500",core:"from-emerald-500 to-green-500",legs:"from-pink-500 to-rose-500",default:"from-gray-500 to-slate-500"};function De({trending:l=[],timeWindow:c="1h",className:w=""}){const r={"5m":"5 min","15m":"15 min","1h":"1 hour","24h":"24 hours"},x=l[0]?.count||1;return e.jsxs("div",{className:`bg-black/20 rounded-xl border border-white/5 ${w}`,children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4 text-amber-400"}),e.jsx("span",{className:"text-sm font-medium text-white/80",children:"Trending Now"})]}),e.jsxs("span",{className:"text-xs text-white/40",children:["Last ",r[c]]})]}),e.jsx("div",{className:"p-4",children:l.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ae,{className:"w-8 h-8 text-white/20 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-white/40",children:"No trending exercises"}),e.jsx("p",{className:"text-xs text-white/30 mt-1",children:"Data will appear as workouts are logged"})]}):e.jsx("div",{className:"space-y-3",children:l.map((n,f)=>{const h=Y[n.muscleGroup]||Y.default,o=n.count/x*100,s=f<3;return e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`absolute -left-1 top-1/2 -translate-y-1/2 w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${s?"bg-amber-500 text-black":"bg-white/10 text-white/50"}`,children:f+1}),e.jsxs("div",{className:"ml-8 relative overflow-hidden rounded-lg bg-white/5 p-3",children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-r ${h} opacity-10`,style:{width:`${o}%`}}),e.jsxs("div",{className:"relative flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4 text-white/50"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-white/80 font-medium",children:n.exerciseName||n.exerciseId}),n.muscleGroup&&e.jsx("p",{className:"text-xs text-white/40 capitalize",children:n.muscleGroup})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-sm font-bold text-white/80",children:n.count}),s&&e.jsx(le,{className:"w-4 h-4 text-emerald-400"})]})]})]})]},n.exerciseId)})})}),e.jsx("div",{className:"px-4 py-2 border-t border-white/5 bg-black/10",children:e.jsxs("p",{className:"text-xs text-white/30 text-center",children:["Based on ",l.reduce((n,f)=>n+f.count,0)," anonymous workout logs"]})})]})}function Ke(){const[l,c]=a.useState("1h"),[w,r]=a.useState("all"),[x,n]=a.useState("all"),[f,h]=a.useState(null),{stats:o,mapData:s,feed:L,trending:R,activityByMuscle:k,loading:y,connected:i,refresh:v}=Ne({timeWindow:l}),S=a.useCallback(A=>{h(A)},[]),C=a.useCallback((A,T)=>{},[]);return e.jsxs("div",{className:"min-h-screen bg-[#0a0a0f]",children:[e.jsx("header",{className:"sticky top-0 z-40 bg-[#0a0a0f]/90 backdrop-blur-sm border-b border-white/5",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(ee,{to:"/community",className:"p-2 rounded-lg bg-white/5 text-white/60 hover:text-white hover:bg-white/10 transition-colors",children:e.jsx(he,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5 text-blue-400"}),"Live Activity"]}),e.jsx("p",{className:"text-sm text-white/50",children:"Real-time anonymous workout activity"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-full ${i?"bg-emerald-500/20 text-emerald-400":"bg-white/10 text-white/50"}`,children:[i?e.jsx(me,{className:"w-4 h-4"}):e.jsx(ue,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:i?"Live":"Offline"})]}),e.jsx("button",{onClick:v,disabled:y,className:"p-2 rounded-lg bg-white/5 text-white/60 hover:text-white hover:bg-white/10 transition-colors disabled:opacity-50",children:e.jsx(fe,{className:`w-5 h-5 ${y?"animate-spin":""}`})})]})]})})}),e.jsxs("main",{className:"max-w-7xl mx-auto px-4 py-6",children:[e.jsxs("div",{className:"mb-6 flex items-center gap-3 px-4 py-3 bg-emerald-500/10 border border-emerald-500/20 rounded-xl",children:[e.jsx(ne,{className:"w-5 h-5 text-emerald-400 flex-shrink-0"}),e.jsxs("p",{className:"text-sm text-emerald-400/80",children:[e.jsx("strong",{children:"Privacy Protected:"})," All data shown is anonymous and aggregated. Users who opt out of activity tracking are never included in this data."]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[e.jsxs("div",{className:"lg:col-span-3 space-y-4",children:[e.jsx(Te,{timeWindow:l,muscleGroup:w,eventType:x,onTimeWindowChange:c,onMuscleGroupChange:r,onEventTypeChange:n}),e.jsx(Ce,{timeWindow:l,onLevelChange:C}),e.jsx(De,{trending:R,timeWindow:l})]}),e.jsxs("div",{className:"lg:col-span-6 space-y-4",children:[e.jsxs("div",{className:"bg-black/20 rounded-xl border border-white/5 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4 text-blue-400"}),e.jsx("span",{className:"text-sm font-medium text-white/80",children:"Activity Map"})]}),f&&e.jsx("button",{onClick:()=>h(null),className:"text-xs text-white/50 hover:text-white",children:"Clear selection"})]}),e.jsx(ke,{mapData:s,onRegionClick:S,className:"aspect-[2/1]"})]}),e.jsx($e,{stats:o,activityByMuscle:k,timeWindow:l,connected:i})]}),e.jsx("div",{className:"lg:col-span-3",children:e.jsx(Ae,{feed:L})})]}),e.jsx("div",{className:"mt-8 text-center",children:e.jsxs("p",{className:"text-xs text-white/30",children:["Data refreshes automatically every 30 seconds when not connected via WebSocket.",e.jsx("br",{}),"Events older than 24 hours are automatically removed."]})})]})]})}export{Ke as default};
