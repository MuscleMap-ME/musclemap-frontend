import{r as p,j as e,L as T}from"./react-vendor-D1NxaRNd.js";import{k as z,e as oe,ad as B,Z as ie,aa as ne}from"./index-DJKXoZu6.js";import{G as o}from"./GlassSurface-BMiMerMg.js";import{T as E}from"./triangle-alert-BrJqSv9k.js";import{G as de}from"./gauge-Bi9mhCam.js";import{R as F}from"./refresh-cw-CWujyU-k.js";import{T as H}from"./timer-8pIu4Nao.js";import{R as N,A as me,f as L,X as P,Y as D,e as w,h as G,L as xe,i as he,b as ue,d as pe,C as K,B as fe,g as je}from"./recharts-vendor-BziRPEEi.js";import{M as O}from"./memory-stick-ByQlJ4kx.js";import{D as be}from"./database-C4bVKJwC.js";import{C as ge}from"./circle-check-big-Dimeuew7.js";import{C as ve}from"./circle-x-HBTKP3_O.js";import"./leaflet-vendor-DZbo3Ov0.js";import"./apollo-vendor-BMQ75Ycx.js";import"./reactflow-vendor-Dz2P_-Qa.js";import"./d3-vendor-mcDw60ct.js";const ye=[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]],_e=z("arrow-down-right",ye);const Ne=[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]],we=z("arrow-up-right",Ne);function ke(c){const s={},i=c.split(`
`);for(const l of i){if(l.startsWith("#")||!l.trim())continue;const r=l.match(/^(\w+)(?:\{([^}]*)\})?\s+(.+)$/);if(r){const[,a,m,x]=r,h=parseFloat(x);if(s[a]||(s[a]=[]),m){const d={};m.split(",").forEach(g=>{const[j,S]=g.split("=");d[j]=S?.replace(/"/g,"")}),s[a].push({labels:d,value:h})}else s[a].push({value:h})}}return s}function v({value:c,max:s,label:i,unit:l="",color:r="#8b5cf6",size:a=120}){const m=Math.min(c/s*100,100),x=12,h=(a-x)/2,d=2*Math.PI*h,g=d-m/100*d;return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"relative",style:{width:a,height:a},children:[e.jsxs("svg",{width:a,height:a,className:"transform -rotate-90",children:[e.jsx("circle",{cx:a/2,cy:a/2,r:h,fill:"none",stroke:"rgba(255,255,255,0.1)",strokeWidth:x}),e.jsx("circle",{cx:a/2,cy:a/2,r:h,fill:"none",stroke:r,strokeWidth:x,strokeLinecap:"round",strokeDasharray:d,strokeDashoffset:g,className:"transition-all duration-1000 ease-out",style:{filter:`drop-shadow(0 0 8px ${r})`}})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("span",{className:"text-2xl font-bold",children:typeof c=="number"?c.toLocaleString():c}),l&&e.jsx("span",{className:"text-xs text-gray-400",children:l})]})]}),e.jsx("span",{className:"text-sm text-gray-400 mt-2",children:i})]})}function k({status:c,label:s,sublabel:i}){const l={healthy:{bg:"bg-green-500",glow:"shadow-green-500/50"},degraded:{bg:"bg-yellow-500",glow:"shadow-yellow-500/50"},unhealthy:{bg:"bg-red-500",glow:"shadow-red-500/50"},connected:{bg:"bg-green-500",glow:"shadow-green-500/50"},disconnected:{bg:"bg-red-500",glow:"shadow-red-500/50"}},{bg:r,glow:a}=l[c]||l.healthy;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${r} ${a} shadow-lg`}),c==="healthy"||c==="connected"?e.jsx("div",{className:`absolute inset-0 w-3 h-3 rounded-full ${r} animate-ping opacity-75`}):null]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium capitalize",children:s}),i&&e.jsx("div",{className:"text-xs text-gray-500",children:i})]})]})}function f({title:c,value:s,unit:i,icon:l,trend:r,trendValue:a,color:m="#8b5cf6"}){return e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:c}),e.jsxs("div",{className:"text-2xl font-bold",style:{color:m},children:[typeof s=="number"?s.toLocaleString():s,i&&e.jsx("span",{className:"text-sm text-gray-400 ml-1",children:i})]}),r&&e.jsxs("div",{className:`flex items-center gap-1 text-xs mt-1 ${r==="up"?"text-green-400":r==="down"?"text-red-400":"text-gray-400"}`,children:[r==="up"?e.jsx(we,{className:"w-3 h-3"}):e.jsx(_e,{className:"w-3 h-3"}),a]})]}),l&&e.jsx("div",{className:"p-2 rounded-lg bg-white/5",style:{color:m},children:e.jsx(l,{className:"w-5 h-5"})})]})})}const C=["#8b5cf6","#06b6d4","#10b981","#f59e0b","#ef4444"];function Oe(){const{user:c}=oe(),[s,i]=p.useState(null),[l,r]=p.useState(!0),[a,m]=p.useState(null),[x,h]=p.useState([]),[d,g]=p.useState(!0),j=p.useCallback(async()=>{try{const t=await fetch("/metrics");if(t.ok){const u=await t.text(),n=ke(u);i(n),m(new Date),h(_=>{const ce={time:new Date().toLocaleTimeString(),requests:n.musclemap_http_requests_total?.[0]?.value||0,errors:n.musclemap_http_errors_total?.[0]?.value||0,p50:n.musclemap_http_request_duration_ms?.find(q=>q.labels?.quantile==="0.5")?.value||0,p99:n.musclemap_http_request_duration_ms?.find(q=>q.labels?.quantile==="0.99")?.value||0,heapUsed:(n.musclemap_memory_heap_used_bytes?.[0]?.value||0)/1024/1024,eventLoop:n.musclemap_event_loop_lag_ms?.[0]?.value||0};return[..._,ce].slice(-30)})}}catch{}finally{r(!1)}},[]);if(p.useEffect(()=>{j()},[j]),p.useEffect(()=>{if(!d)return;const t=setInterval(j,1e4);return()=>clearInterval(t)},[d,j]),!c?.is_admin)return e.jsx("div",{className:"min-h-screen bg-[#0a0a0f] text-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(E,{className:"w-16 h-16 text-yellow-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-400",children:"Admin access required"}),e.jsx(T,{to:"/dashboard",className:"mt-4 inline-block text-violet-400 hover:underline",children:"Return to Dashboard"})]})});const S=s?.musclemap_uptime_seconds?.[0]?.value||0,y=s?.musclemap_http_requests_total?.[0]?.value||0,A=s?.musclemap_http_errors_total?.[0]?.value||0,R=y>0?(A/y*100).toFixed(2):0,$=s?.musclemap_db_connections_total?.[0]?.value||0,I=s?.musclemap_db_connections_idle?.[0]?.value||0,W=s?.musclemap_db_connections_waiting?.[0]?.value||0,X=s?.musclemap_db_healthy?.[0]?.value===1,U=s?.musclemap_redis_connected?.[0]?.value===1,V=s?.musclemap_graphql_cache_hits_total?.[0]?.value||0,Y=s?.musclemap_graphql_cache_misses_total?.[0]?.value||0,Z=s?.musclemap_graphql_cache_hit_rate?.[0]?.value||0,Q=s?.musclemap_memory_heap_used_bytes?.[0]?.value||0,J=s?.musclemap_memory_heap_total_bytes?.[0]?.value||0,ee=s?.musclemap_memory_rss_bytes?.[0]?.value||0,b=s?.musclemap_event_loop_lag_ms?.[0]?.value||0,se=s?.musclemap_http_request_duration_ms?.find(t=>t.labels?.quantile==="0.5")?.value||0,te=s?.musclemap_http_request_duration_ms?.find(t=>t.labels?.quantile==="0.9")?.value||0,ae=s?.musclemap_http_request_duration_ms?.find(t=>t.labels?.quantile==="0.95")?.value||0,le=s?.musclemap_http_request_duration_ms?.find(t=>t.labels?.quantile==="0.99")?.value||0,M=(s?.musclemap_http_requests_by_status||[]).map(t=>({name:t.labels?.status||"unknown",value:t.value})),re=t=>{const u=Math.floor(t/86400),n=Math.floor(t%86400/3600),_=Math.floor(t%3600/60);return u>0?`${u}d ${n}h`:n>0?`${n}h ${_}m`:`${_}m`};return e.jsxs("div",{className:"min-h-screen bg-[#0a0a0f] text-white",children:[e.jsx("header",{className:"border-b border-white/10 bg-[#0a0a0f]/80 backdrop-blur-xl sticky top-0 z-50",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(T,{to:"/admin-control",className:"text-gray-400 hover:text-white",children:"← Admin"}),e.jsxs("h1",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(de,{className:"w-6 h-6 text-violet-400"}),"System Metrics"]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[a&&e.jsxs("span",{className:"text-xs text-gray-500",children:["Updated: ",a.toLocaleTimeString()]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:d,onChange:t=>g(t.target.checked),className:"rounded bg-white/10 border-white/20"}),"Auto-refresh"]}),e.jsx("button",{onClick:j,disabled:l,className:"p-2 rounded-lg hover:bg-white/10 transition-colors",children:e.jsx(F,{className:`w-5 h-5 ${l?"animate-spin":""}`})})]})]})})}),e.jsx("main",{className:"max-w-7xl mx-auto px-4 py-6 space-y-6",children:l&&!s?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(F,{className:"w-8 h-8 animate-spin text-violet-400"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(o,{className:"p-4",children:e.jsx(k,{status:X?"healthy":"unhealthy",label:"PostgreSQL",sublabel:`${$} connections`})}),e.jsx(o,{className:"p-4",children:e.jsx(k,{status:U?"connected":"disconnected",label:"Redis",sublabel:U?"Connected":"Disconnected"})}),e.jsx(o,{className:"p-4",children:e.jsx(k,{status:b<50?"healthy":b<100?"degraded":"unhealthy",label:"Event Loop",sublabel:`${b.toFixed(2)}ms lag`})}),e.jsx(o,{className:"p-4",children:e.jsx(k,{status:parseFloat(R)<1?"healthy":parseFloat(R)<5?"degraded":"unhealthy",label:"Error Rate",sublabel:`${R}%`})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsx(o,{className:"p-6 flex justify-center",children:e.jsx(v,{value:re(S),max:1,label:"Uptime",color:"#10b981",size:100})}),e.jsx(o,{className:"p-6 flex justify-center",children:e.jsx(v,{value:y,max:1e4,label:"Total Requests",color:"#8b5cf6",size:100})}),e.jsx(o,{className:"p-6 flex justify-center",children:e.jsx(v,{value:$,max:20,label:"DB Connections",color:"#06b6d4",size:100})}),e.jsx(o,{className:"p-6 flex justify-center",children:e.jsx(v,{value:(Z*100).toFixed(0),max:100,label:"Cache Hit Rate",unit:"%",color:"#f59e0b",size:100})}),e.jsx(o,{className:"p-6 flex justify-center",children:e.jsx(v,{value:Math.round(Q/1024/1024),max:Math.round(J/1024/1024),label:"Heap Used",unit:"MB",color:"#ef4444",size:100})})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(o,{className:"p-4",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5 text-violet-400"}),"Request Latency (ms)"]}),e.jsx("div",{className:"h-64",children:e.jsx(N,{width:"100%",height:"100%",children:e.jsxs(me,{data:x,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"colorP50",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#8b5cf6",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#8b5cf6",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"colorP99",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#ef4444",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#ef4444",stopOpacity:0})]})]}),e.jsx(L,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.1)"}),e.jsx(P,{dataKey:"time",stroke:"#666",fontSize:10}),e.jsx(D,{stroke:"#666",fontSize:10}),e.jsx(w,{contentStyle:{backgroundColor:"rgba(10,10,15,0.9)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"8px"}}),e.jsx(G,{type:"monotone",dataKey:"p50",stroke:"#8b5cf6",fill:"url(#colorP50)",name:"P50"}),e.jsx(G,{type:"monotone",dataKey:"p99",stroke:"#ef4444",fill:"url(#colorP99)",name:"P99"})]})})})]}),e.jsxs(o,{className:"p-4",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(O,{className:"w-5 h-5 text-cyan-400"}),"Memory Usage (MB)"]}),e.jsx("div",{className:"h-64",children:e.jsx(N,{width:"100%",height:"100%",children:e.jsxs(xe,{data:x,children:[e.jsx(L,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.1)"}),e.jsx(P,{dataKey:"time",stroke:"#666",fontSize:10}),e.jsx(D,{stroke:"#666",fontSize:10}),e.jsx(w,{contentStyle:{backgroundColor:"rgba(10,10,15,0.9)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"8px"}}),e.jsx(he,{type:"monotone",dataKey:"heapUsed",stroke:"#06b6d4",strokeWidth:2,dot:!1,name:"Heap Used"})]})})})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(o,{className:"p-4",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5 text-green-400"}),"Response Status Distribution"]}),e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsx("div",{className:"h-48 w-48",children:e.jsx(N,{width:"100%",height:"100%",children:e.jsxs(ue,{children:[e.jsx(pe,{data:M,cx:"50%",cy:"50%",innerRadius:40,outerRadius:70,paddingAngle:2,dataKey:"value",children:M.map((t,u)=>e.jsx(K,{fill:C[u%C.length]},t.name))}),e.jsx(w,{contentStyle:{backgroundColor:"rgba(10,10,15,0.9)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"8px"}})]})})}),e.jsx("div",{className:"flex-1 space-y-2",children:M.map((t,u)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:C[u%C.length]}}),e.jsx("span",{className:"text-sm",children:t.name})]}),e.jsx("span",{className:"font-mono text-sm",children:t.value.toLocaleString()})]},t.name))})]})]}),e.jsxs(o,{className:"p-4",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5 text-yellow-400"}),"Latency Percentiles (ms)"]}),e.jsx("div",{className:"h-48",children:e.jsx(N,{width:"100%",height:"100%",children:e.jsxs(fe,{data:[{name:"P50",value:se,fill:"#10b981"},{name:"P90",value:te,fill:"#06b6d4"},{name:"P95",value:ae,fill:"#f59e0b"},{name:"P99",value:le,fill:"#ef4444"}],layout:"vertical",children:[e.jsx(L,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.1)"}),e.jsx(P,{type:"number",stroke:"#666",fontSize:10}),e.jsx(D,{type:"category",dataKey:"name",stroke:"#666",fontSize:12,width:40}),e.jsx(w,{contentStyle:{backgroundColor:"rgba(10,10,15,0.9)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"8px"},formatter:t=>[`${t.toFixed(2)}ms`]}),e.jsx(je,{dataKey:"value",radius:[0,4,4,0],children:[{name:"P50",fill:"#10b981"},{name:"P90",fill:"#06b6d4"},{name:"P95",fill:"#f59e0b"},{name:"P99",fill:"#ef4444"}].map(t=>e.jsx(K,{fill:t.fill},t.name))})]})})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(f,{title:"Total Requests",value:y,icon:B,color:"#8b5cf6"}),e.jsx(f,{title:"Total Errors",value:A,icon:E,color:"#ef4444"}),e.jsx(f,{title:"DB Idle",value:I,icon:be,color:"#06b6d4"}),e.jsx(f,{title:"DB Waiting",value:W,icon:ne,color:"#f59e0b"}),e.jsx(f,{title:"Cache Hits",value:V,icon:ge,color:"#10b981"}),e.jsx(f,{title:"Cache Misses",value:Y,icon:ve,color:"#ef4444"}),e.jsx(f,{title:"RSS Memory",value:Math.round(ee/1024/1024),unit:"MB",icon:O,color:"#8b5cf6"}),e.jsx(f,{title:"Event Loop Lag",value:b.toFixed(2),unit:"ms",icon:H,color:b<50?"#10b981":b<100?"#f59e0b":"#ef4444"})]}),e.jsx("div",{className:"text-center text-sm text-gray-500",children:e.jsx("a",{href:"/metrics",target:"_blank",rel:"noopener noreferrer",className:"hover:text-violet-400 transition-colors",children:"View raw Prometheus metrics →"})})]})})]})}export{Oe as default};
