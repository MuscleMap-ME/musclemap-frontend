import{r as l,j as e,L as V}from"./react-vendor-D847gc3Q.js";import{G as n}from"./GlassSurface-CW71V7bR.js";import{c as U,G as D,X as P,m as y,aV as M,aH as O,N as _,A as q}from"./index-MC6c9alI.js";import{A as B}from"./arrow-left-BeHOdKOt.js";import{R as z}from"./refresh-cw-DPxeal0t.js";import{T as S}from"./triangle-alert-CojvdWz8.js";import{F as G}from"./funnel-8aV_BnFj.js";import{L as k}from"./loader-circle-DJGTsjgH.js";import{E as F}from"./eye-DA4yhAbs.js";import{C as $}from"./circle-check-big-DxAtrlix.js";import{C as W}from"./circle-x-IdarCjD-.js";import{C as H}from"./check-DNO48pH2.js";import"./leaflet-vendor-DZbo3Ov0.js";import"./recharts-vendor-d8oTApeF.js";import"./d3-vendor-DkU_Wy0v.js";import"./apollo-vendor-BNHFeEEc.js";import"./reactflow-vendor-5ig9bY2l.js";const J=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],L=U("image",J),X=[{value:"nsfw",label:"NSFW/Inappropriate content"},{value:"wrong_exercise",label:"Wrong exercise shown"},{value:"poor_quality",label:"Poor image quality"},{value:"watermark",label:"Contains watermark/logo"},{value:"screenshot",label:"Screenshot/meme/not a photo"},{value:"duplicate",label:"Duplicate submission"},{value:"other",label:"Other reason"}],pe=()=>{const{getToken:t}=D(),[N,m]=l.useState([]),[s,v]=l.useState(null),[d,i]=l.useState(!0),[h,p]=l.useState(null),[r,R]=l.useState(null),[o,T]=l.useState("pending"),[C,f]=l.useState(null),u=l.useCallback(async()=>{try{i(!0);const a=t(),c=await fetch("/api/exercise-images/admin/pending",{headers:{Authorization:`Bearer ${a}`}});if(!c.ok)throw new Error("Failed to fetch submissions");const x=await c.json();m(x.submissions||[])}catch(a){f(a instanceof Error?a.message:"Unknown error")}finally{i(!1)}},[t]),g=l.useCallback(async()=>{try{const a=t(),c=await fetch("/api/exercise-images/admin/stats",{headers:{Authorization:`Bearer ${a}`}});if(!c.ok)throw new Error("Failed to fetch stats");const x=await c.json();v(x)}catch{}},[t]);l.useEffect(()=>{u(),g()},[u,g]);const A=async(a,c,x)=>{try{p(a);const j=t(),E=await fetch(`/api/exercise-images/admin/review/${a}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${j}`},body:JSON.stringify({action:c,reason:x})});if(!E.ok){const b=await E.json();throw new Error(b.error||"Review failed")}m(b=>b.filter(I=>I.id!==a)),R(null),g()}catch(j){f(j instanceof Error?j.message:"Review failed")}finally{p(null)}},w=N.filter(a=>o==="all"?!0:a.status===o);return e.jsx("div",{className:"min-h-screen bg-[#0a0a0f] text-white p-4 md:p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(V,{to:"/empire",className:"p-2 rounded-lg bg-white/5 hover:bg-white/10 transition-colors",children:e.jsx(B,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(L,{className:"w-6 h-6 text-violet-400"}),"Exercise Image Review"]}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Review and approve community-submitted exercise images"})]})]}),e.jsxs("button",{onClick:()=>{u(),g()},className:"flex items-center gap-2 px-4 py-2 bg-white/5 hover:bg-white/10 rounded-lg transition-colors",children:[e.jsx(z,{className:`w-4 h-4 ${d?"animate-spin":""}`}),"Refresh"]})]}),s&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-8",children:[e.jsxs(n,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-amber-400",children:s.pending}),e.jsx("div",{className:"text-sm text-gray-400",children:"Pending"})]}),e.jsxs(n,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-emerald-400",children:s.approved}),e.jsx("div",{className:"text-sm text-gray-400",children:"Approved"})]}),e.jsxs(n,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-red-400",children:s.rejected}),e.jsx("div",{className:"text-sm text-gray-400",children:"Rejected"})]}),e.jsxs(n,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-400",children:s.totalToday}),e.jsx("div",{className:"text-sm text-gray-400",children:"Today"})]}),e.jsxs(n,{className:"p-4 text-center",children:[e.jsxs("div",{className:"text-3xl font-bold text-violet-400",children:[s.avgReviewTime,"s"]}),e.jsx("div",{className:"text-sm text-gray-400",children:"Avg Review"})]})]}),e.jsx("div",{className:"flex gap-2 mb-6",children:["pending","approved","rejected","all"].map(a=>e.jsx("button",{onClick:()=>T(a),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${o===a?"bg-violet-500/20 text-violet-400 border border-violet-500/30":"bg-white/5 text-gray-400 hover:bg-white/10"}`,children:a.charAt(0).toUpperCase()+a.slice(1)},a))}),C&&e.jsxs("div",{className:"mb-6 p-4 bg-red-500/10 border border-red-500/30 rounded-lg flex items-center gap-3",children:[e.jsx(S,{className:"w-5 h-5 text-red-400"}),e.jsx("span",{className:"text-red-400",children:C}),e.jsx("button",{onClick:()=>f(null),className:"ml-auto",children:e.jsx(P,{className:"w-4 h-4 text-red-400"})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(n,{className:"p-4",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5 text-gray-400"}),"Submissions (",w.length,")"]}),d?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(k,{className:"w-8 h-8 animate-spin text-violet-400"})}):w.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-400",children:[e.jsx(L,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsxs("p",{children:["No ",o==="all"?"":o," submissions"]})]}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:w.map(a=>e.jsxs(y.button,{onClick:()=>R(a),className:`relative rounded-lg overflow-hidden border-2 transition-all ${r?.id===a.id?"border-violet-500":"border-transparent hover:border-white/20"}`,whileHover:{scale:1.02},whileTap:{scale:.98},children:[e.jsx("img",{src:a.thumbnailUrl,alt:a.exerciseName,className:"w-full aspect-square object-cover"}),e.jsx("div",{className:`absolute top-2 right-2 px-2 py-0.5 rounded text-xs font-medium ${a.status==="pending"?"bg-amber-500/80 text-white":a.status==="approved"?"bg-emerald-500/80 text-white":"bg-red-500/80 text-white"}`,children:a.status}),!a.aiValidationPassed&&e.jsx("div",{className:"absolute top-2 left-2 p-1 rounded bg-red-500/80",children:e.jsx(S,{className:"w-3 h-3 text-white"})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-2 bg-gradient-to-t from-black/80 to-transparent",children:e.jsx("p",{className:"text-xs text-white truncate",children:a.exerciseName})})]},a.id))})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(n,{className:"p-4 sticky top-4",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5 text-gray-400"}),"Review Panel"]}),r?e.jsx(K,{submission:r,onApprove:()=>A(r.id,"approve"),onReject:a=>A(r.id,"reject",a),isReviewing:h===r.id}):e.jsxs("div",{className:"text-center py-12 text-gray-400",children:[e.jsx(F,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Select a submission to review"})]})]})})]})]})})},K=({submission:t,onApprove:N,onReject:m,isReviewing:s})=>{const[v,d]=l.useState(!1),[i,h]=l.useState(""),p=()=>{i&&(m(i),d(!1),h(""))};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"rounded-lg overflow-hidden",children:e.jsx("img",{src:t.processedUrl||t.thumbnailUrl,alt:t.exerciseName,className:"w-full aspect-video object-contain bg-black/50"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white",children:t.exerciseName}),e.jsxs("p",{className:"text-sm text-gray-400",children:["Exercise ID: ",t.exerciseId]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx(M,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-300",children:t.username}),e.jsx(O,{className:"w-4 h-4 text-gray-400 ml-2"}),e.jsx("span",{className:"text-gray-400",children:new Date(t.createdAt).toLocaleDateString()})]}),e.jsxs("div",{className:"p-3 bg-white/5 rounded-lg space-y-2",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-300 flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4"}),"AI Validation"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400",children:"NSFW Score"}),e.jsxs("div",{className:`font-mono text-lg ${t.nsfwScore>.3?"text-red-400":t.nsfwScore>.15?"text-amber-400":"text-emerald-400"}`,children:[(t.nsfwScore*100).toFixed(1),"%"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400",children:"Exercise Match"}),e.jsxs("div",{className:`font-mono text-lg ${t.exerciseMatchScore>.7?"text-emerald-400":t.exerciseMatchScore>.4?"text-amber-400":"text-red-400"}`,children:[(t.exerciseMatchScore*100).toFixed(0),"%"]})]})]}),t.aiValidationNotes&&e.jsx("div",{className:"mt-2 text-xs text-gray-400 border-t border-white/10 pt-2",children:t.aiValidationNotes}),e.jsx("div",{className:`flex items-center gap-2 text-sm ${t.aiValidationPassed?"text-emerald-400":"text-amber-400"}`,children:t.aiValidationPassed?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-4 h-4"}),"AI Validation Passed"]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"w-4 h-4"}),"Requires Manual Review"]})})]}),t.status!=="pending"&&e.jsxs("div",{className:`p-3 rounded-lg ${t.status==="approved"?"bg-emerald-500/10 border border-emerald-500/30":"bg-red-500/10 border border-red-500/30"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t.status==="approved"?e.jsx($,{className:"w-4 h-4 text-emerald-400"}):e.jsx(W,{className:"w-4 h-4 text-red-400"}),e.jsx("span",{className:t.status==="approved"?"text-emerald-400":"text-red-400",children:t.status==="approved"?"Approved":"Rejected"})]}),t.rejectionReason&&e.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:["Reason: ",t.rejectionReason]}),t.reviewedAt&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:new Date(t.reviewedAt).toLocaleString()})]}),t.status==="pending"&&e.jsx(q,{mode:"wait",children:v?e.jsxs(y.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"space-y-3",children:[e.jsxs("select",{value:i,onChange:r=>h(r.target.value),className:"w-full p-2 bg-white/5 border border-white/10 rounded-lg text-white text-sm",children:[e.jsx("option",{value:"",children:"Select rejection reason..."}),X.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>d(!1),className:"flex-1 py-2 px-4 bg-white/5 hover:bg-white/10 rounded-lg text-gray-300 text-sm transition-colors",children:"Cancel"}),e.jsx("button",{onClick:p,disabled:!i||s,className:"flex-1 py-2 px-4 bg-red-500/20 hover:bg-red-500/30 rounded-lg text-red-400 text-sm transition-colors disabled:opacity-50",children:s?e.jsx(k,{className:"w-4 h-4 animate-spin mx-auto"}):"Confirm Reject"})]})]}):e.jsxs(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex gap-3",children:[e.jsx("button",{onClick:N,disabled:s,className:"flex-1 py-3 px-4 bg-emerald-500/20 hover:bg-emerald-500/30 border border-emerald-500/30 rounded-lg text-emerald-400 font-medium transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:s?e.jsx(k,{className:"w-4 h-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"w-4 h-4"}),"Approve"]})}),e.jsxs("button",{onClick:()=>d(!0),disabled:s,className:"flex-1 py-3 px-4 bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 rounded-lg text-red-400 font-medium transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:[e.jsx(P,{className:"w-4 h-4"}),"Reject"]})]})})]})};export{pe as default};
