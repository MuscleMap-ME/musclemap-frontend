import{r as n,j as e}from"./react-vendor-D1NxaRNd.js";import{u as F,a as N,A as O,m as T}from"./index-ChmNk_hk.js";import{G as I,a as r}from"./GlassSurface-BMiMerMg.js";import{G as f}from"./GlassButton-CnRYgllD.js";import"./leaflet-vendor-DZbo3Ov0.js";import"./apollo-vendor-BMQ75Ycx.js";import"./reactflow-vendor-Dz2P_-Qa.js";import"./d3-vendor-mcDw60ct.js";import"./recharts-vendor-BziRPEEi.js";const x={AlertTriangle:({className:s="w-5 h-5"})=>e.jsx("svg",{className:s,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),Check:({className:s="w-5 h-5"})=>e.jsx("svg",{className:s,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),X:({className:s="w-5 h-5"})=>e.jsx("svg",{className:s,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M6 18L18 6M6 6l12 12"})}),Clock:({className:s="w-5 h-5"})=>e.jsx("svg",{className:s,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),Coins:({className:s="w-5 h-5"})=>e.jsx("svg",{className:s,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),User:({className:s="w-5 h-5"})=>e.jsx("svg",{className:s,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),Scale:({className:s="w-5 h-5"})=>e.jsx("svg",{className:s,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3"})})},D={open:{label:"Open",bg:"bg-yellow-500/20",text:"text-yellow-400",border:"border-yellow-500/30"},investigating:{label:"Investigating",bg:"bg-blue-500/20",text:"text-blue-400",border:"border-blue-500/30"},pending_response:{label:"Pending Response",bg:"bg-purple-500/20",text:"text-purple-400",border:"border-purple-500/30"},resolved_reporter:{label:"Resolved (Reporter)",bg:"bg-green-500/20",text:"text-green-400",border:"border-green-500/30"},resolved_respondent:{label:"Resolved (Respondent)",bg:"bg-green-500/20",text:"text-green-400",border:"border-green-500/30"},resolved_split:{label:"Resolved (Split)",bg:"bg-green-500/20",text:"text-green-400",border:"border-green-500/30"},dismissed:{label:"Dismissed",bg:"bg-gray-500/20",text:"text-gray-400",border:"border-gray-500/30"},escalated:{label:"Escalated",bg:"bg-red-500/20",text:"text-red-400",border:"border-red-500/30"}},_={class_noshow:{label:"Class No-Show",icon:"üèÉ"},class_quality:{label:"Class Quality",icon:"‚≠ê"},transfer_fraud:{label:"Transfer Fraud",icon:"üí∏"},refund_request:{label:"Refund Request",icon:"üí∞"},other:{label:"Other",icon:"‚ùì"}};function z({dispute:s,onSelect:a}){const c=D[s.status]||D.open,p=_[s.disputeType]||_.other,i=s.deadline?new Date(s.deadline):null,h=i&&i<new Date;return e.jsx(T.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},className:"cursor-pointer",onClick:()=>a(s),children:e.jsxs(r,{className:"p-4 hover:bg-white/10 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:p.icon}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium",children:p.label}),e.jsx("div",{className:"text-white/50 text-xs",children:s.id})]})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${c.bg} ${c.text} ${c.border} border`,children:c.label})]}),e.jsx("p",{className:"text-white/70 text-sm mb-3 line-clamp-2",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-white/50",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[s.amountDisputed&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(x.Coins,{className:"w-4 h-4 text-amber-400"}),e.jsx("span",{className:"text-amber-400",children:s.amountDisputed})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(x.Clock,{className:"w-4 h-4"}),e.jsx("span",{children:new Date(s.createdAt).toLocaleDateString()})]})]}),i&&e.jsxs("div",{className:`flex items-center gap-1 ${h?"text-red-400":""}`,children:[e.jsx(x.AlertTriangle,{className:"w-4 h-4"}),e.jsx("span",{children:h?"Overdue":`Due ${i.toLocaleDateString()}`})]})]})]})})}function B({dispute:s,onClose:a,onResolve:c,onUpdateStatus:p}){const[i,h]=n.useState([]),[m,g]=n.useState(""),[j,u]=n.useState(!0),[y,d]=n.useState(!1),[v,L]=n.useState("resolved_reporter"),[w,b]=n.useState(""),[k,A]=n.useState(s.amountDisputed||0);n.useEffect(()=>{R()},[s.id]);const R=async()=>{try{const t=await N.get(`/admin/disputes/${s.id}/messages`);h(t.data.data||[])}catch{}finally{u(!1)}},S=async()=>{if(m.trim())try{await N.post(`/admin/disputes/${s.id}/messages`,{message:m}),g(""),await R()}catch{}},M=async()=>{d(!0);try{await N.post(`/admin/disputes/${s.id}/resolve`,{resolution:v,reason:w,amount:k}),c()}catch{}finally{d(!1)}},l=async t=>{try{await N.patch(`/admin/disputes/${s.id}/status`,{status:t}),p(t)}catch{}},o=D[s.status]||D.open,$=_[s.disputeType]||_.other,C=["resolved_reporter","resolved_respondent","resolved_split","dismissed"].includes(s.status);return e.jsx(T.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:a,children:e.jsxs(T.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:t=>t.stopPropagation(),className:"bg-[#12121a] border border-white/10 rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-3xl",children:$.icon}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:$.label}),e.jsx("p",{className:"text-white/50 text-sm",children:s.id})]})]}),e.jsx("button",{onClick:a,className:"text-white/50 hover:text-white",children:e.jsx(x.X,{className:"w-6 h-6"})})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${o.bg} ${o.text} ${o.border} border`,children:o.label})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-semibold mb-3",children:"Details"}),e.jsxs(r,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/50",children:"Reporter"}),e.jsx("span",{className:"text-white",children:s.reporterId})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/50",children:"Respondent"}),e.jsx("span",{className:"text-white",children:s.respondentId})]}),s.amountDisputed&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/50",children:"Amount"}),e.jsxs("span",{className:"text-amber-400 font-bold flex items-center gap-1",children:[e.jsx(x.Coins,{className:"w-4 h-4"}),s.amountDisputed]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/50",children:"Reference"}),e.jsxs("span",{className:"text-white",children:[s.referenceType,": ",s.referenceId]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/50",children:"Created"}),e.jsx("span",{className:"text-white",children:new Date(s.createdAt).toLocaleString()})]}),s.deadline&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-white/50",children:"Deadline"}),e.jsx("span",{className:new Date(s.deadline)<new Date?"text-red-400":"text-white",children:new Date(s.deadline).toLocaleString()})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-semibold mb-3",children:"Description"}),e.jsx(r,{className:"p-4",children:e.jsx("p",{className:"text-white/80",children:s.description})})]}),s.evidence?.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-semibold mb-3",children:"Evidence"}),e.jsx("div",{className:"space-y-2",children:s.evidence.map((t,E)=>e.jsxs(r,{className:"p-4",children:[e.jsx("div",{className:"text-white/50 text-xs mb-1 capitalize",children:t.type}),t.text&&e.jsx("p",{className:"text-white",children:t.text}),t.url&&e.jsx("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:underline break-all",children:t.url})]},E))})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-white font-semibold mb-3",children:["Messages (",i.length,")"]}),e.jsx("div",{className:"space-y-3 mb-4",children:j?e.jsx("div",{className:"text-center text-white/50",children:"Loading messages..."}):i.length===0?e.jsx("div",{className:"text-center text-white/50",children:"No messages yet"}):i.map(t=>e.jsxs("div",{className:`p-3 rounded-lg ${t.isAdmin?"bg-violet-500/20 border border-violet-500/30":"bg-white/5"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(x.User,{className:"w-4 h-4 text-white/50"}),e.jsx("span",{className:`text-sm ${t.isAdmin?"text-violet-400":"text-white/70"}`,children:t.isAdmin?"Admin":t.senderId}),e.jsx("span",{className:"text-xs text-white/30",children:new Date(t.createdAt).toLocaleString()})]}),e.jsx("p",{className:"text-white",children:t.message})]},t.id))}),!C&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:m,onChange:t=>g(t.target.value),onKeyPress:t=>t.key==="Enter"&&S(),className:"flex-1 px-4 py-2 bg-white/5 border border-white/10 rounded-lg text-white focus:border-violet-500 focus:outline-none",placeholder:"Send admin message..."}),e.jsx(f,{onClick:S,children:"Send"})]})]}),!C&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-semibold mb-3",children:"Resolve Dispute"}),e.jsxs(r,{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/70 text-sm mb-1",children:"Resolution Type"}),e.jsxs("select",{value:v,onChange:t=>L(t.target.value),className:"w-full px-4 py-2 bg-white/5 border border-white/10 rounded-lg text-white focus:border-violet-500 focus:outline-none",children:[e.jsx("option",{value:"resolved_reporter",children:"Resolve in favor of Reporter"}),e.jsx("option",{value:"resolved_respondent",children:"Resolve in favor of Respondent"}),e.jsx("option",{value:"resolved_split",children:"Split Resolution"}),e.jsx("option",{value:"dismissed",children:"Dismiss"})]})]}),v!=="dismissed"&&s.amountDisputed&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/70 text-sm mb-1",children:v==="resolved_split"?"Amount to Reporter":"Resolution Amount"}),e.jsx("input",{type:"number",value:k,onChange:t=>A(parseInt(t.target.value)||0),className:"w-full px-4 py-2 bg-white/5 border border-white/10 rounded-lg text-white focus:border-violet-500 focus:outline-none",min:0,max:s.amountDisputed})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/70 text-sm mb-1",children:"Reason"}),e.jsx("textarea",{value:w,onChange:t=>b(t.target.value),rows:3,className:"w-full px-4 py-2 bg-white/5 border border-white/10 rounded-lg text-white focus:border-violet-500 focus:outline-none resize-none",placeholder:"Explain the resolution..."})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(f,{onClick:M,disabled:y||!w,className:"flex-1 bg-green-500/20 border-green-500/30 text-green-400",children:[e.jsx(x.Check,{className:"w-4 h-4 mr-2"}),y?"Resolving...":"Resolve"]})})]})]}),!C&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-semibold mb-3",children:"Quick Actions"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.status==="open"&&e.jsx(f,{onClick:()=>l("investigating"),className:"text-sm",children:"Start Investigation"}),s.status==="investigating"&&e.jsx(f,{onClick:()=>l("pending_response"),className:"text-sm",children:"Request Response"}),e.jsx(f,{onClick:()=>l("escalated"),className:"text-sm text-red-400 border-red-400/30",children:"Escalate"})]})]}),C&&s.resolution&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-semibold mb-3",children:"Resolution"}),e.jsxs(r,{className:"p-4 bg-green-500/10 border border-green-500/30",children:[e.jsx("p",{className:"text-green-400 mb-2",children:s.resolution}),s.resolutionAmount>0&&e.jsxs("div",{className:"text-white/70 text-sm",children:["Amount: ",s.resolutionAmount," credits"]}),s.resolvedAt&&e.jsxs("div",{className:"text-white/50 text-xs mt-2",children:["Resolved: ",new Date(s.resolvedAt).toLocaleString()]})]})]})]})]})})}function K(){const{user:s}=F(),[a,c]=n.useState([]),[p,i]=n.useState(!0),[h,m]=n.useState(null),[g,j]=n.useState(null),[u,y]=n.useState(""),[d,v]=n.useState(""),[L,w]=n.useState(0),b=n.useCallback(async()=>{try{i(!0),m(null);const l=new URLSearchParams;u&&l.set("status",u),d&&l.set("disputeType",d),l.set("limit","50");const o=await N.get(`/admin/disputes?${l.toString()}`);c(o.data.data||[]),w(o.data.meta?.total||0)}catch(l){m(l.response?.data?.error?.message||"Failed to load disputes")}finally{i(!1)}},[u,d]);n.useEffect(()=>{b()},[b]);const k=()=>{j(null),b()},A=l=>{j(o=>({...o,status:l})),b()},R=a.filter(l=>l.status==="open").length,S=a.filter(l=>l.status==="investigating").length,M=a.filter(l=>l.status==="pending_response").length;return p&&a.length===0?e.jsx(I,{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-2 border-violet-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-white/60",children:"Loading disputes..."})]})}):e.jsx(I,{className:"min-h-screen p-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Dispute Management"}),e.jsx("p",{className:"text-white/60",children:"Review and resolve economy disputes"})]}),h&&e.jsxs("div",{className:"bg-red-500/20 border border-red-500/50 rounded-xl p-4 text-red-400",children:[h,e.jsx("button",{onClick:()=>m(null),className:"ml-2 text-red-300 hover:text-red-100",children:"Dismiss"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(r,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-yellow-400",children:R}),e.jsx("div",{className:"text-white/50 text-sm",children:"Open"})]}),e.jsxs(r,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-400",children:S}),e.jsx("div",{className:"text-white/50 text-sm",children:"Investigating"})]}),e.jsxs(r,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-purple-400",children:M}),e.jsx("div",{className:"text-white/50 text-sm",children:"Pending"})]}),e.jsxs(r,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-white",children:L}),e.jsx("div",{className:"text-white/50 text-sm",children:"Total"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/70 text-sm mb-1",children:"Status"}),e.jsxs("select",{value:u,onChange:l=>y(l.target.value),className:"px-4 py-2 bg-white/5 border border-white/10 rounded-lg text-white focus:border-violet-500 focus:outline-none",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"investigating",children:"Investigating"}),e.jsx("option",{value:"pending_response",children:"Pending Response"}),e.jsx("option",{value:"escalated",children:"Escalated"}),e.jsx("option",{value:"resolved_reporter",children:"Resolved (Reporter)"}),e.jsx("option",{value:"resolved_respondent",children:"Resolved (Respondent)"}),e.jsx("option",{value:"resolved_split",children:"Resolved (Split)"}),e.jsx("option",{value:"dismissed",children:"Dismissed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white/70 text-sm mb-1",children:"Type"}),e.jsxs("select",{value:d,onChange:l=>v(l.target.value),className:"px-4 py-2 bg-white/5 border border-white/10 rounded-lg text-white focus:border-violet-500 focus:outline-none",children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"class_noshow",children:"Class No-Show"}),e.jsx("option",{value:"class_quality",children:"Class Quality"}),e.jsx("option",{value:"transfer_fraud",children:"Transfer Fraud"}),e.jsx("option",{value:"refund_request",children:"Refund Request"}),e.jsx("option",{value:"other",children:"Other"})]})]})]}),a.length===0?e.jsxs(r,{className:"p-8 text-center",children:[e.jsx(x.Scale,{className:"w-16 h-16 text-white/30 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"No Disputes"}),e.jsx("p",{className:"text-white/60",children:u||d?"No disputes match your filters.":"There are no pending disputes to review."})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:a.map(l=>e.jsx(z,{dispute:l,onSelect:j},l.id))}),e.jsx(O,{children:g&&e.jsx(B,{dispute:g,onClose:()=>j(null),onResolve:k,onUpdateStatus:A})})]})})}export{K as default};
