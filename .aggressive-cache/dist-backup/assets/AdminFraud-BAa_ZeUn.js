import{r as i,j as e,L as Y}from"./react-vendor-D847gc3Q.js";import{c as x}from"./recharts-vendor-CxtoZpzE.js";import{G as K,A as F,m as b}from"./index-CPgxk9rr.js";import"./leaflet-vendor-DZbo3Ov0.js";import"./d3-vendor-mcDw60ct.js";import"./apollo-vendor-BNHFeEEc.js";import"./reactflow-vendor-CYb5nRwM.js";const m={Back:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 19l-7-7 7-7"})}),Shield:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})}),Refresh:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),Lock:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),Unlock:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"})}),Search:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})},g={low:{label:"Low",color:"bg-blue-500/20 text-blue-400 border-blue-500/30"},medium:{label:"Medium",color:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30"},high:{label:"High",color:"bg-orange-500/20 text-orange-400 border-orange-500/30"},critical:{label:"Critical",color:"bg-red-500/20 text-red-400 border-red-500/30"}},I={rapid_earning:{label:"Rapid Earning",icon:"ðŸš€"},bulk_transfers:{label:"Bulk Transfers",icon:"ðŸ“¦"},transfer_loop:{label:"Transfer Loop",icon:"ðŸ”„"},unusual_pattern:{label:"Unusual Pattern",icon:"ðŸ“Š"},impossible_value:{label:"Impossible Value",icon:"âŒ"},geo_mismatch:{label:"Geo Mismatch",icon:"ðŸ—ºï¸"},time_anomaly:{label:"Time Anomaly",icon:"â°"},suspicious_referral:{label:"Suspicious Referral",icon:"ðŸ”—"},excessive_tips:{label:"Excessive Tips",icon:"ðŸ’°"},alt_account_suspected:{label:"Alt Account",icon:"ðŸ‘¥"},velocity:{label:"Velocity",icon:"âš¡"},self_farming:{label:"Self Farming",icon:"ðŸŒ¾"},bot_behavior:{label:"Bot Behavior",icon:"ðŸ¤–"},collusion:{label:"Collusion",icon:"ðŸ¤"},manual:{label:"Manual Flag",icon:"ðŸš©"}},L={open:{label:"Open",color:"bg-red-500/20 text-red-400"},investigating:{label:"Investigating",color:"bg-yellow-500/20 text-yellow-400"},resolved_valid:{label:"Valid",color:"bg-green-500/20 text-green-400"},resolved_invalid:{label:"Invalid",color:"bg-gray-500/20 text-gray-400"},escalated:{label:"Escalated",color:"bg-purple-500/20 text-purple-400"}},T=t=>{try{return new Date(t).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return t}};function re(){const{token:t}=K(),[c,f]=i.useState([]),[u,j]=i.useState([]),[W,U]=i.useState(!0),[k,D]=i.useState("flags"),[a,C]=i.useState(null),[S,M]=i.useState("open"),[v,R]=i.useState("all"),[_,P]=i.useState(""),[r,z]=i.useState(null),[V,y]=i.useState(!1),[d,N]=i.useState({userId:"",amount:0,reason:""}),[A,B]=i.useState({show:!1,message:"",type:"success"});i.useEffect(()=>{h()},[S,v]);const h=async()=>{U(!0);try{const s={Authorization:`Bearer ${t}`},[l,n]=await Promise.all([fetch(`/api/admin/fraud-flags?status=${S}${v!=="all"?`&severity=${v}`:""}&limit=100`,{headers:s}),fetch("/api/admin/credits/audit?limit=50",{headers:s})]),[p,$]=await Promise.all([l.json(),n.json()]);f(p.data||[]),j($.data||[])}catch{}finally{U(!1)}},G=async()=>{if(_.trim())try{const l=await(await fetch(`/api/admin/wallet/${_}`,{headers:{Authorization:`Bearer ${t}`}})).json();z(l.data)}catch{o("User not found","error")}},w=async(s,l,n)=>{try{(await(await fetch(`/api/admin/fraud-flags/${s}/review`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({status:l,notes:n})})).json()).data?.success&&(o("Flag updated","success"),C(null),h())}catch{o("Failed to update flag","error")}},E=async(s,l)=>{try{(await(await fetch("/api/admin/wallet/freeze",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({userId:s,reason:l})})).json()).data?.success&&(o("Wallet frozen","success"),r?.userId===s&&z({...r,status:"frozen"}))}catch{o("Failed to freeze wallet","error")}},H=async(s,l)=>{try{(await(await fetch("/api/admin/wallet/unfreeze",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({userId:s,reason:l})})).json()).data?.success&&(o("Wallet unfrozen","success"),r?.userId===s&&z({...r,status:"active"}))}catch{o("Failed to unfreeze wallet","error")}},J=async s=>{s.preventDefault();try{(await(await fetch("/api/admin/credits/adjust",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(d)})).json()).data&&(o(`Adjusted ${d.amount} credits`,"success"),y(!1),N({userId:"",amount:0,reason:""}),h())}catch{o("Failed to adjust credits","error")}},q=async s=>{try{const n=await(await fetch(`/api/admin/abuse-check/${s}`,{method:"POST",headers:{Authorization:`Bearer ${t}`}})).json();n.data&&(o(`Check complete: ${n.data.flags?.length||0} issues found`,n.data.passed?"success":"error"),h())}catch{o("Failed to run check","error")}},o=(s,l)=>{B({show:!0,message:s,type:l}),setTimeout(()=>B({show:!1,message:"",type:"success"}),3e3)},O=c.filter(s=>s.status==="open"||s.status==="pending");return W?e.jsx("div",{className:"min-h-screen bg-[#0a0a0f] flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 border-2 border-violet-500 border-t-transparent rounded-full animate-spin"})}):e.jsxs("div",{className:"min-h-screen bg-[#0a0a0f] text-white pb-8",children:[e.jsx("header",{className:"sticky top-0 z-40 bg-[#0a0a0f]/80 backdrop-blur-xl border-b border-white/5",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 h-16 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Y,{to:"/dashboard",className:"p-2 -ml-2 rounded-xl hover:bg-white/5",children:e.jsx(m.Back,{})}),e.jsx("h1",{className:"text-xl font-semibold",children:"Fraud Management"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[O.length>0&&e.jsxs("span",{className:"px-3 py-1 bg-red-500/20 rounded-full text-red-400 text-sm font-medium",children:[O.length," Open"]}),e.jsx("button",{onClick:h,className:"p-2 hover:bg-white/5 rounded-xl",children:e.jsx(m.Refresh,{})})]})]})}),e.jsxs("main",{className:"max-w-6xl mx-auto px-4 py-6",children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 mb-6",children:[e.jsxs("button",{onClick:()=>y(!0),className:"flex items-center gap-2 p-3 bg-white/5 hover:bg-white/10 rounded-xl transition-all",children:[e.jsx("span",{className:"text-xl",children:"ðŸ’°"}),e.jsx("span",{className:"text-sm font-medium",children:"Adjust Credits"})]}),e.jsxs("button",{onClick:()=>{const s=prompt("Enter User ID to check:");s&&q(s)},className:"flex items-center gap-2 p-3 bg-white/5 hover:bg-white/10 rounded-xl transition-all",children:[e.jsx("span",{className:"text-xl",children:"ðŸ”"}),e.jsx("span",{className:"text-sm font-medium",children:"Run Abuse Check"})]}),e.jsxs("button",{onClick:()=>{const s=prompt("Enter User ID to freeze:");s&&E(s,"Manual freeze by admin")},className:"flex items-center gap-2 p-3 bg-red-500/10 hover:bg-red-500/20 rounded-xl transition-all text-red-400",children:[e.jsx(m.Lock,{}),e.jsx("span",{className:"text-sm font-medium",children:"Freeze Wallet"})]}),e.jsxs("button",{onClick:()=>{const s=prompt("Enter User ID to unfreeze:");s&&H(s,"Manual unfreeze by admin")},className:"flex items-center gap-2 p-3 bg-green-500/10 hover:bg-green-500/20 rounded-xl transition-all text-green-400",children:[e.jsx(m.Unlock,{}),e.jsx("span",{className:"text-sm font-medium",children:"Unfreeze Wallet"})]})]}),e.jsxs("div",{className:"bg-white/5 rounded-xl p-4 mb-6",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Wallet Lookup"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:_,onChange:s=>P(s.target.value),placeholder:"Enter User ID",className:"flex-1 px-4 py-2 bg-white/5 border border-white/10 rounded-xl focus:border-violet-500 focus:outline-none"}),e.jsx("button",{onClick:G,className:"px-4 py-2 bg-violet-600 hover:bg-violet-700 rounded-xl transition-all",children:e.jsx(m.Search,{})})]}),r&&e.jsxs("div",{className:"mt-4 p-4 bg-black/20 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("span",{className:"text-sm text-gray-400",children:["User ID: ",r.userId]}),e.jsx("span",{className:x("px-2 py-0.5 text-xs font-medium rounded-full",r.status==="active"?"bg-green-500/20 text-green-400":r.status==="frozen"?"bg-red-500/20 text-red-400":"bg-yellow-500/20 text-yellow-400"),children:r.status})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-400",children:"Balance"}),e.jsx("div",{className:"font-bold",children:r.balance?.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-400",children:"Earned"}),e.jsx("div",{className:"font-bold",children:r.totalEarned?.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-400",children:"Spent"}),e.jsx("div",{className:"font-bold",children:r.totalSpent?.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-400",children:"Transferred"}),e.jsx("div",{className:"font-bold",children:(r.totalTransferredOut||0).toLocaleString()})]})]}),r.status==="frozen"&&r.frozenReason&&e.jsxs("div",{className:"mt-3 p-2 bg-red-500/10 rounded text-sm text-red-400",children:["Frozen: ",r.frozenReason]})]})]}),e.jsx("div",{className:"flex gap-1 p-1 bg-white/5 rounded-xl mb-6",children:["flags","audit"].map(s=>e.jsx("button",{onClick:()=>D(s),className:x("flex-1 py-2.5 text-sm font-medium rounded-lg transition-all capitalize",k===s?"bg-white/10 text-white":"text-gray-400 hover:text-white"),children:s==="flags"?`Fraud Flags (${c.length})`:"Audit Log"},s))}),k==="flags"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-3 mb-4 flex-wrap",children:[e.jsx("div",{className:"flex gap-1 p-1 bg-white/5 rounded-xl",children:["open","investigating","resolved_valid","resolved_invalid","escalated"].map(s=>e.jsx("button",{onClick:()=>M(s),className:x("px-3 py-1.5 text-xs font-medium rounded-lg transition-all",S===s?"bg-white/10 text-white":"text-gray-400 hover:text-white"),children:L[s]?.label||s},s))}),e.jsxs("select",{value:v,onChange:s=>R(s.target.value),className:"px-3 py-1.5 bg-white/5 border border-white/10 rounded-xl text-sm",children:[e.jsx("option",{value:"all",children:"All Severities"}),Object.entries(g).map(([s,l])=>e.jsx("option",{value:s,children:l.label},s))]})]}),e.jsx("div",{className:"space-y-3",children:c.length===0?e.jsxs("div",{className:"bg-white/5 rounded-xl p-8 text-center text-gray-400",children:[e.jsx(m.Shield,{className:"w-12 h-12 mx-auto mb-4 text-green-500"}),e.jsx("p",{children:"No fraud flags found"})]}):c.map(s=>e.jsx(Q,{flag:s,onClick:()=>C(s)},s.id))})]}),k==="audit"&&e.jsx("div",{className:"space-y-2",children:u.length===0?e.jsx("div",{className:"bg-white/5 rounded-xl p-8 text-center text-gray-400",children:"No audit entries"}):u.map(s=>e.jsxs("div",{className:"bg-white/5 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium",children:s.action}),e.jsx("span",{className:"text-xs text-gray-400",children:T(s.createdAt||s.created_at)})]}),e.jsxs("div",{className:"text-sm text-gray-400",children:[s.targetUserId||s.target_user_id&&e.jsxs("span",{children:["User: ",s.targetUserId||s.target_user_id," â€¢ "]}),s.amount&&e.jsxs("span",{children:["Amount: ",s.amount," â€¢ "]}),e.jsxs("span",{children:["Reason: ",s.reason]})]})]},s.id))})]}),e.jsx(F,{children:a&&e.jsx(b.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:()=>C(null),children:e.jsx(b.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:s=>s.stopPropagation(),className:"bg-[#12121a] border border-white/10 rounded-2xl w-full max-w-lg max-h-[80vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Review Flag"}),e.jsx("span",{className:x("px-2 py-0.5 text-xs font-medium rounded-full border",g[a.severity]?.color),children:g[a.severity]?.label})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-3xl",children:I[a.flagType||a.flag_type]?.icon}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:I[a.flagType||a.flag_type]?.label}),e.jsx("div",{className:"text-sm text-gray-400",children:T(a.createdAt||a.created_at)})]})]}),e.jsxs("div",{className:"p-3 bg-white/5 rounded-xl",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"User ID"}),e.jsx("div",{className:"font-mono",children:a.userId||a.user_id})]}),a.details&&e.jsxs("div",{className:"p-3 bg-white/5 rounded-xl",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Details"}),e.jsx("pre",{className:"text-sm overflow-x-auto",children:JSON.stringify(a.details,null,2)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{onClick:()=>w(a.id,"resolved_valid","Confirmed suspicious activity"),className:"py-2 bg-red-600 hover:bg-red-700 rounded-xl text-sm font-medium transition-all",children:"Confirm Valid"}),e.jsx("button",{onClick:()=>w(a.id,"resolved_invalid","False positive"),className:"py-2 bg-gray-600 hover:bg-gray-700 rounded-xl text-sm font-medium transition-all",children:"Dismiss"}),e.jsx("button",{onClick:()=>w(a.id,"investigating","Under investigation"),className:"py-2 bg-yellow-600 hover:bg-yellow-700 rounded-xl text-sm font-medium transition-all",children:"Investigate"}),e.jsx("button",{onClick:()=>w(a.id,"escalated","Escalated for review"),className:"py-2 bg-purple-600 hover:bg-purple-700 rounded-xl text-sm font-medium transition-all",children:"Escalate"})]}),e.jsx("div",{className:"border-t border-white/10 pt-4",children:e.jsx("button",{onClick:()=>E(a.userId||a.user_id,`Fraud flag: ${a.flagType||a.flag_type}`),className:"w-full py-2 bg-red-600/20 hover:bg-red-600/30 text-red-400 rounded-xl text-sm font-medium transition-all",children:"Freeze User's Wallet"})})]})]})})})}),e.jsx(F,{children:V&&e.jsx(b.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:()=>y(!1),children:e.jsx(b.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:s=>s.stopPropagation(),className:"bg-[#12121a] border border-white/10 rounded-2xl w-full max-w-md",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-6",children:"Adjust Credits"}),e.jsxs("form",{onSubmit:J,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"User ID"}),e.jsx("input",{type:"text",value:d.userId,onChange:s=>N({...d,userId:s.target.value}),className:"w-full px-4 py-2 bg-white/5 border border-white/10 rounded-xl focus:border-violet-500 focus:outline-none",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Amount (+ to add, - to remove)"}),e.jsx("input",{type:"number",value:d.amount,onChange:s=>N({...d,amount:parseInt(s.target.value)}),className:"w-full px-4 py-2 bg-white/5 border border-white/10 rounded-xl focus:border-violet-500 focus:outline-none",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Reason"}),e.jsx("textarea",{value:d.reason,onChange:s=>N({...d,reason:s.target.value}),className:"w-full px-4 py-2 bg-white/5 border border-white/10 rounded-xl focus:border-violet-500 focus:outline-none h-20 resize-none",required:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>y(!1),className:"flex-1 py-3 bg-white/10 hover:bg-white/20 rounded-xl font-medium transition-all",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 py-3 bg-violet-600 hover:bg-violet-700 rounded-xl font-semibold transition-all",children:"Adjust"})]})]})]})})})}),e.jsx(F,{children:A.show&&e.jsx(b.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:50},className:x("fixed bottom-4 left-4 right-4 mx-auto max-w-md px-4 py-3 rounded-xl text-center font-medium z-50",A.type==="success"?"bg-green-600":"bg-red-600"),children:A.message})})]})}function Q({flag:t,onClick:c}){const f=I[t.flagType||t.flag_type]||{label:t.flagType||t.flag_type,icon:"ðŸš©"},u=g[t.severity]||g.medium,j=L[t.status]||L.open;return e.jsxs("div",{onClick:c,className:"bg-white/5 hover:bg-white/10 rounded-xl p-4 cursor-pointer transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:f.icon}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:f.label}),e.jsx("div",{className:"text-xs text-gray-400",children:t.userId||t.user_id})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:x("px-2 py-0.5 text-xs font-medium rounded-full",j.color),children:j.label}),e.jsx("span",{className:x("px-2 py-0.5 text-xs font-medium rounded-full border",u.color),children:u.label})]})]}),e.jsx("div",{className:"text-xs text-gray-400",children:T(t.createdAt||t.created_at)})]})}export{re as default};
