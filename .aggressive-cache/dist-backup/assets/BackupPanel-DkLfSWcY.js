import{r as a,j as e}from"./react-vendor-D1NxaRNd.js";import{G as y}from"./GlassSurface-BMiMerMg.js";import{L as b}from"./loader-circle-DwvpjhR_.js";import{A as _}from"./lock-DVwt5eS5.js";import{R as X}from"./refresh-cw-BWkjF4vB.js";import{U as Y}from"./upload-DeevRsYn.js";import{i as Q,a8 as B,ai as R,H as Z,a9 as ee}from"./index-DMo71FHX.js";import{H}from"./hard-drive-C0N8RL4l.js";import{D as se}from"./download-B3Y22nuj.js";import{C as v}from"./circle-check-big-Csod5jFR.js";import{C as te}from"./circle-x-B9zEt_jx.js";import{R as ae}from"./rotate-ccw-C2Ks3jFW.js";import{T as le}from"./trash-2-BbjoCw6c.js";import{T as ne}from"./triangle-alert-DXNthorc.js";import"./leaflet-vendor-DZbo3Ov0.js";import"./recharts-vendor-BziRPEEi.js";import"./d3-vendor-mcDw60ct.js";import"./apollo-vendor-BMQ75Ycx.js";import"./reactflow-vendor-Dz2P_-Qa.js";const re=[["path",{d:"M13.659 22H18a2 2 0 0 0 2-2V8a2.4 2.4 0 0 0-.706-1.706l-3.588-3.588A2.4 2.4 0 0 0 14 2H6a2 2 0 0 0-2 2v11.5",key:"4pqfef"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M8 12v-1",key:"1ej8lb"}],["path",{d:"M8 18v-2",key:"qcmpov"}],["path",{d:"M8 7V6",key:"1nbb54"}],["circle",{cx:"8",cy:"20",r:"2",key:"ckkr5m"}]],M=Q("file-archive",re),f="/api/admin/backup",ie=[{value:"disabled",label:"Disabled"},{value:"hourly",label:"Every Hour"},{value:"daily",label:"Daily (2 AM)"},{value:"weekly",label:"Weekly (Sunday 2 AM)"},{value:"monthly",label:"Monthly (1st, 2 AM)"}],T={completed:{bg:"bg-green-500/20",text:"text-green-400",icon:v},in_progress:{bg:"bg-blue-500/20",text:"text-blue-400",icon:b},failed:{bg:"bg-red-500/20",text:"text-red-400",icon:te},pending:{bg:"bg-yellow-500/20",text:"text-yellow-400",icon:B},verified:{bg:"bg-emerald-500/20",text:"text-emerald-400",icon:R}};function J(s){if(!s||s===0)return"0 B";if(typeof s=="string")return s;const l=1024,r=["B","KB","MB","GB","TB"],i=Math.floor(Math.log(s)/Math.log(l));return`${parseFloat((s/Math.pow(l,i)).toFixed(2))} ${r[i]}`}function N(s){return s?new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A"}function ce(s){if(!s)return"N/A";const l=Math.floor(s/1e3),r=Math.floor(l/60),i=Math.floor(r/60);return i>0?`${i}h ${r%60}m`:r>0?`${r}m ${l%60}s`:`${l}s`}function oe({isOpen:s,onClose:l,onConfirm:r,title:i,message:o,confirmText:x,isDangerous:m}){return s?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:l}),e.jsxs("div",{className:"relative bg-gray-900 border border-white/10 rounded-xl p-6 max-w-md w-full shadow-2xl",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${m?"bg-red-500/20":"bg-yellow-500/20"}`,children:e.jsx(ne,{className:`w-6 h-6 ${m?"text-red-400":"text-yellow-400"}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:i}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:o})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{onClick:l,className:"px-4 py-2 rounded-lg bg-white/5 hover:bg-white/10 text-gray-300 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:r,className:`px-4 py-2 rounded-lg transition-colors font-medium ${m?"bg-red-500/20 hover:bg-red-500/30 text-red-400 border border-red-500/30":"bg-yellow-500/20 hover:bg-yellow-500/30 text-yellow-400 border border-yellow-500/30"}`,children:x})]})]})]}):null}function de({status:s}){const l=T[s]||T.pending,r=l.icon,i=s==="in_progress";return e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2 py-1 rounded-full text-xs font-medium ${l.bg} ${l.text}`,children:[e.jsx(r,{className:`w-3 h-3 ${i?"animate-spin":""}`}),s.replace("_"," ")]})}function me({backup:s,onRestore:l,onDelete:r,onTest:i,isRestoring:o,isDeleting:x,isTesting:m}){const u=o||x||m;return e.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-lg bg-white/5 border border-white/10 hover:border-white/20 transition-colors",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-blue-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx(M,{className:"w-6 h-6 text-blue-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-white truncate",children:s.filename}),e.jsx(de,{status:s.status})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-xs text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(H,{className:"w-3 h-3"}),J(s.size)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"w-3 h-3"}),N(s.createdAt)]}),s.duration&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(B,{className:"w-3 h-3"}),ce(s.duration)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>i(s.id),disabled:u||s.status!=="completed",className:"p-2 rounded-lg bg-emerald-500/10 hover:bg-emerald-500/20 text-emerald-400 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Test Restore",children:m?e.jsx(b,{className:"w-4 h-4 animate-spin"}):e.jsx(R,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>l(s),disabled:u||s.status!=="completed",className:"p-2 rounded-lg bg-yellow-500/10 hover:bg-yellow-500/20 text-yellow-400 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Restore Backup",children:o?e.jsx(b,{className:"w-4 h-4 animate-spin"}):e.jsx(ae,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>r(s),disabled:u,className:"p-2 rounded-lg bg-red-500/10 hover:bg-red-500/20 text-red-400 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Delete Backup",children:x?e.jsx(b,{className:"w-4 h-4 animate-spin"}):e.jsx(le,{className:"w-4 h-4"})})]})]})}function xe({job:s}){if(!s)return null;const l=s.progress||0,r=T[s.status]||T.pending,i=r.icon,o=s.status==="in_progress";return e.jsxs(y,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-white flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4 text-cyan-400"}),"Current Job"]}),e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2 py-1 rounded-full text-xs font-medium ${r.bg} ${r.text}`,children:[e.jsx(i,{className:`w-3 h-3 ${o?"animate-spin":""}`}),s.status.replace("_"," ")]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-400",children:s.type==="backup"?"Creating backup":"Restoring backup"}),e.jsxs("span",{className:"text-white font-medium",children:[l,"%"]})]}),e.jsx("div",{className:"h-2 bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-300 ${s.status==="failed"?"bg-red-500":"bg-cyan-500"}`,style:{width:`${l}%`}})}),s.message&&e.jsx("div",{className:"text-xs text-gray-400",children:s.message}),s.startedAt&&e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.jsxs("span",{children:["Started: ",N(s.startedAt)]}),s.estimatedCompletion&&e.jsxs("span",{children:["ETA: ",N(s.estimatedCompletion)]})]})]})]})}function he({schedule:s,onUpdate:l,isLoading:r}){const[i,o]=a.useState(s?.frequency||"disabled"),[x,m]=a.useState(s?.retention||7),[u,g]=a.useState(!1);a.useEffect(()=>{o(s?.frequency||"disabled"),m(s?.retention||7),g(!1)},[s]);const k=d=>{o(d),g(!0)},$=d=>{m(parseInt(d,10)||7),g(!0)},C=()=>{l({frequency:i,retention:x}),g(!1)};return e.jsxs(y,{className:"p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4 text-purple-400"}),"Backup Schedule"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-400 mb-2",children:"Frequency"}),e.jsx("select",{value:i,onChange:d=>k(d.target.value),className:"w-full px-3 py-2 rounded-lg bg-white/5 border border-white/10 text-white text-sm focus:outline-none focus:border-cyan-500/50",children:ie.map(d=>e.jsx("option",{value:d.value,className:"bg-gray-900",children:d.label},d.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-400 mb-2",children:"Retention (days)"}),e.jsx("input",{type:"number",min:"1",max:"365",value:x,onChange:d=>$(d.target.value),className:"w-full px-3 py-2 rounded-lg bg-white/5 border border-white/10 text-white text-sm focus:outline-none focus:border-cyan-500/50"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Backups older than ",x," days will be automatically deleted"]})]}),s?.nextRun&&i!=="disabled"&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400 bg-white/5 rounded-lg p-3",children:[e.jsx(B,{className:"w-4 h-4"}),e.jsxs("span",{children:["Next backup: ",N(s.nextRun)]})]}),u&&e.jsx("button",{onClick:C,disabled:r,className:"w-full px-4 py-2 rounded-lg bg-cyan-500/20 hover:bg-cyan-500/30 text-cyan-400 transition-colors font-medium disabled:opacity-50",children:r?e.jsx(b,{className:"w-4 h-4 animate-spin mx-auto"}):"Save Schedule"})]})]})}function De(){const[s,l]=a.useState([]),[r,i]=a.useState(null),[o,x]=a.useState(null),[m,u]=a.useState(!0),[g,k]=a.useState(!1),[$,C]=a.useState(!1),[d,D]=a.useState(null),[P,O]=a.useState(null),[z,I]=a.useState(null),[j,w]=a.useState({isOpen:!1,title:"",message:"",confirmText:"",isDangerous:!1,onConfirm:()=>{}}),c=a.useCallback(()=>{try{const t=localStorage.getItem("musclemap-auth");if(t){const E=JSON.parse(t);if(E?.state?.token)return{Authorization:`Bearer ${E.state.token}`}}const n=localStorage.getItem("musclemap_token");return n?{Authorization:`Bearer ${n}`}:{}}catch{return{}}},[]),h=a.useCallback(async()=>{try{const t=await fetch(`${f}/list`,{headers:c()});if(t.ok){const n=await t.json();l(n.backups||[])}}catch{}},[c]),S=a.useCallback(async()=>{try{const t=await fetch(`${f}/schedule`,{headers:c()});if(t.ok){const n=await t.json();i(n.schedule||null)}}catch{}},[c]),p=a.useCallback(async()=>{try{const t=await fetch(`${f}/status`,{headers:c()});if(t.ok){const n=await t.json();x(n.job||null)}}catch{}},[c]),A=a.useCallback(async()=>{u(!0),await Promise.all([h(),S(),p()]),u(!1)},[h,S,p]),U=a.useCallback(async()=>{k(!0);try{(await fetch(`${f}/create`,{method:"POST",headers:{"Content-Type":"application/json",...c()},body:JSON.stringify({type:"full",compress:!0})})).ok&&(p(),setTimeout(h,2e3))}catch{}finally{k(!1)}},[c,h,p]),q=a.useCallback(async t=>{w({isOpen:!0,title:"Restore Backup",message:`This will restore the database from "${t.filename}". This action will overwrite ALL current data and cannot be undone. Are you absolutely sure?`,confirmText:"Yes, Restore Backup",isDangerous:!0,onConfirm:async()=>{w(n=>({...n,isOpen:!1})),D(t.id);try{(await fetch(`${f}/restore`,{method:"POST",headers:{"Content-Type":"application/json",...c()},body:JSON.stringify({backupId:t.id})})).ok&&(p(),setTimeout(h,2e3))}catch{}finally{D(null)}}})},[c,h,p]),F=a.useCallback(async t=>{w({isOpen:!0,title:"Delete Backup",message:`Are you sure you want to permanently delete "${t.filename}"? This action cannot be undone.`,confirmText:"Delete Backup",isDangerous:!0,onConfirm:async()=>{w(n=>({...n,isOpen:!1})),O(t.id);try{(await fetch(`${f}/delete`,{method:"DELETE",headers:{"Content-Type":"application/json",...c()},body:JSON.stringify({backupId:t.id})})).ok&&h()}catch{}finally{O(null)}}})},[c,h]),G=a.useCallback(async t=>{I(t);try{(await fetch(`${f}/test-restore/${t}`,{method:"POST",headers:{"Content-Type":"application/json",...c()}})).ok&&h()}catch{}finally{I(null)}},[c,h]),K=a.useCallback(async t=>{C(!0);try{(await fetch(`${f}/schedule`,{method:"PUT",headers:{"Content-Type":"application/json",...c()},body:JSON.stringify(t)})).ok&&S()}catch{}finally{C(!1)}},[c,S]),V=a.useCallback(()=>{w(t=>({...t,isOpen:!1}))},[]);a.useEffect(()=>{A();const t=setInterval(()=>{o?.status==="in_progress"&&p()},5e3);return()=>clearInterval(t)},[A,p,o?.status]);const W=s.reduce((t,n)=>t+(n.size||0),0),L=s.filter(t=>t.status==="completed").length;return m?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(b,{className:"w-8 h-8 animate-spin text-cyan-400"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(_,{className:"w-6 h-6 text-cyan-400"}),"Backup & Recovery"]}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Manage database backups and restore points"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:A,className:"flex items-center gap-2 px-3 py-2 rounded-lg bg-white/5 hover:bg-white/10 border border-white/10 transition-colors",children:[e.jsx(X,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Refresh"})]}),e.jsxs("button",{onClick:U,disabled:g||o?.status==="in_progress",className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-cyan-500/20 hover:bg-cyan-500/30 border border-cyan-500/30 text-cyan-400 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[g?e.jsx(b,{className:"w-4 h-4 animate-spin"}):e.jsx(Y,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Create Backup"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(y,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(M,{className:"w-4 h-4 text-blue-400"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"Total Backups"})]}),e.jsx("div",{className:"text-2xl font-bold text-white",children:s.length}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:[L," completed, ",s.length-L," other"]})]}),e.jsxs(y,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(H,{className:"w-4 h-4 text-purple-400"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"Storage Used"})]}),e.jsx("div",{className:"text-2xl font-bold text-white",children:J(W)}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Across all backups"})]}),e.jsxs(y,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(B,{className:"w-4 h-4 text-green-400"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"Last Backup"})]}),e.jsx("div",{className:"text-2xl font-bold text-white",children:s[0]?N(s[0].createdAt).split(",")[0]:"Never"}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:s[0]?N(s[0].createdAt).split(",")[1]:"No backups yet"})]})]}),o&&e.jsx(xe,{job:o}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(y,{className:"p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4 text-cyan-400"}),"Backup History"]}),s.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(M,{className:"w-12 h-12 text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-400 mb-2",children:"No backups yet"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Create your first backup to get started"})]}):e.jsx("div",{className:"space-y-3 max-h-[500px] overflow-y-auto pr-2",children:s.map(t=>e.jsx(me,{backup:t,onRestore:q,onDelete:F,onTest:G,isRestoring:d===t.id,isDeleting:P===t.id,isTesting:z===t.id},t.id))})]})}),e.jsxs("div",{children:[e.jsx(he,{schedule:r,onUpdate:K,isLoading:$}),e.jsxs(y,{className:"p-4 mt-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-white mb-3 flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4 text-emerald-400"}),"Best Practices"]}),e.jsxs("ul",{className:"space-y-2 text-xs text-gray-400",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(v,{className:"w-3 h-3 text-emerald-400 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Enable automatic backups on at least a daily schedule"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(v,{className:"w-3 h-3 text-emerald-400 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Test restore periodically to verify backup integrity"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(v,{className:"w-3 h-3 text-emerald-400 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Create a manual backup before major updates"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(v,{className:"w-3 h-3 text-emerald-400 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Keep at least 7 days of backup retention"})]})]})]})]})]}),e.jsx(oe,{isOpen:j.isOpen,onClose:V,onConfirm:j.onConfirm,title:j.title,message:j.message,confirmText:j.confirmText,isDangerous:j.isDangerous})]})}export{De as default};
