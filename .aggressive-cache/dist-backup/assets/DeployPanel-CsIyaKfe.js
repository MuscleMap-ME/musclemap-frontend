import{r as a,j as e}from"./react-vendor-D847gc3Q.js";import{G as w}from"./GlassSurface-CuHevRGA.js";import{L as f}from"./loader-circle-CyL7W7vr.js";import{R as v,T as xe}from"./terminal-B3Xu6XUb.js";import{R as U}from"./refresh-cw-Bkte_l7Z.js";import{aG as me,K as _,X as J}from"./index-KAEVVvQC.js";import{E as X}from"./eye-zDEn-xHv.js";import{H as F}from"./history-yI1TBx_m.js";import{G as E}from"./git-branch-BpIpzk8_.js";import{G as K}from"./git-commit-horizontal-CJM-rtkO.js";import{C as he}from"./chevron-down-Q7St0cHB.js";import{R as Y}from"./rotate-ccw-Ddid3Jeh.js";import{C as pe}from"./circle-x-CKSzC4S8.js";import{C as q}from"./circle-check-big-QsOTB2zD.js";import{T as ue}from"./triangle-alert-DhBhfz_A.js";import"./leaflet-vendor-DZbo3Ov0.js";import"./recharts-vendor-CxtoZpzE.js";import"./d3-vendor-mcDw60ct.js";import"./apollo-vendor-BNHFeEEc.js";import"./reactflow-vendor-CYb5nRwM.js";const y="/api/admin/deploy",D={success:{color:"text-green-400",bgColor:"bg-green-500/20",borderColor:"border-green-500/30",icon:q,label:"Success"},failed:{color:"text-red-400",bgColor:"bg-red-500/20",borderColor:"border-red-500/30",icon:pe,label:"Failed"},"in-progress":{color:"text-yellow-400",bgColor:"bg-yellow-500/20",borderColor:"border-yellow-500/30",icon:f,label:"In Progress"},pending:{color:"text-gray-400",bgColor:"bg-gray-500/20",borderColor:"border-gray-500/30",icon:_,label:"Pending"},"rolled-back":{color:"text-orange-400",bgColor:"bg-orange-500/20",borderColor:"border-orange-500/30",icon:Y,label:"Rolled Back"}};function Q(s){if(!s)return"N/A";const n=new Date,r=new Date(s),i=n-r,l=Math.floor(i/6e4),c=Math.floor(l/60),d=Math.floor(c/24);return l<1?"just now":l<60?`${l}m ago`:c<24?`${c}h ago`:d<7?`${d}d ago`:r.toLocaleDateString()}function V(s){return s?s.length>7?s.substring(0,7):s:"N/A"}function Z({status:s}){const n=D[s]||D.pending,r=n.icon,i=s==="in-progress";return e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium ${n.bgColor} ${n.color}`,children:[e.jsx(r,{className:`w-3.5 h-3.5 ${i?"animate-spin":""}`}),n.label]})}function ge({deployment:s,loading:n,onRefresh:r}){return n?e.jsx(w,{className:"p-4",children:e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(f,{className:"w-6 h-6 animate-spin text-cyan-400"})})}):s?e.jsxs(w,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-white flex items-center gap-2",children:[e.jsx(v,{className:"w-4 h-4 text-cyan-400"}),"Current Deployment"]}),e.jsx("button",{onClick:r,className:"p-1.5 rounded hover:bg-white/10 transition-colors",children:e.jsx(U,{className:"w-4 h-4 text-gray-400"})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white/5 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Status"}),e.jsx(Z,{status:s.status})]}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Branch"}),e.jsxs("div",{className:"flex items-center gap-1.5 text-white",children:[e.jsx(E,{className:"w-4 h-4 text-orange-400"}),e.jsx("span",{className:"font-mono text-sm",children:s.branch||"main"})]})]}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Commit"}),e.jsxs("div",{className:"flex items-center gap-1.5 text-white",children:[e.jsx(K,{className:"w-4 h-4 text-purple-400"}),e.jsx("span",{className:"font-mono text-sm",children:V(s.commit)})]})]}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Deployed"}),e.jsxs("div",{className:"flex items-center gap-1.5 text-white",children:[e.jsx(_,{className:"w-4 h-4 text-blue-400"}),e.jsx("span",{className:"text-sm",children:Q(s.timestamp)})]})]})]}),s.message&&e.jsxs("div",{className:"mt-3 p-3 bg-white/5 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Message"}),e.jsx("div",{className:"text-sm text-white",children:s.message})]})]}):e.jsx(w,{className:"p-4",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(v,{className:"w-12 h-12 text-gray-500 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-400",children:"No deployment information available"}),e.jsx("button",{onClick:r,className:"mt-3 px-4 py-2 rounded-lg bg-white/5 hover:bg-white/10 text-gray-300 text-sm transition-colors",children:"Refresh"})]})})}function fe({branches:s,selectedBranch:n,onSelect:r,loading:i}){const[l,c]=a.useState(!1),d=a.useRef(null);return a.useEffect(()=>{function m(C){d.current&&!d.current.contains(C.target)&&c(!1)}return document.addEventListener("mousedown",m),()=>document.removeEventListener("mousedown",m)},[]),e.jsxs("div",{className:"relative",ref:d,children:[e.jsxs("button",{onClick:()=>c(!l),disabled:i,className:"flex items-center gap-2 px-3 py-2 rounded-lg bg-white/5 hover:bg-white/10 border border-white/10 transition-colors min-w-[160px]",children:[e.jsx(E,{className:"w-4 h-4 text-orange-400"}),e.jsx("span",{className:"text-sm text-white flex-1 text-left font-mono",children:n||"Select branch"}),e.jsx(he,{className:`w-4 h-4 text-gray-400 transition-transform ${l?"rotate-180":""}`})]}),l&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-gray-900/95 border border-white/10 rounded-lg shadow-xl backdrop-blur-xl z-50 max-h-60 overflow-auto",children:i?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx(f,{className:"w-4 h-4 animate-spin text-gray-400"})}):s.length===0?e.jsx("div",{className:"text-center py-4 text-gray-400 text-sm",children:"No branches found"}):s.map(m=>e.jsx("button",{onClick:()=>{r(m),c(!1)},className:`w-full text-left px-3 py-2 text-sm hover:bg-white/10 transition-colors ${m===n?"bg-white/5 text-cyan-400":"text-white"}`,children:e.jsx("span",{className:"font-mono",children:m})},m))})]})}function be({isOpen:s,onClose:n,onConfirm:r,branch:i,changes:l,loading:c}){return s?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:n}),e.jsxs("div",{className:"relative bg-gray-900/95 border border-white/10 rounded-xl shadow-2xl w-full max-w-lg mx-4 backdrop-blur-xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/10",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx(ue,{className:"w-5 h-5 text-yellow-400"}),"Confirm Deployment"]}),e.jsx("button",{onClick:n,className:"p-1 rounded hover:bg-white/10 transition-colors",children:e.jsx(J,{className:"w-5 h-5 text-gray-400"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("p",{className:"text-gray-300",children:["You are about to deploy the ",e.jsx("span",{className:"font-mono text-cyan-400",children:i})," branch to production."]}),l&&l.length>0&&e.jsxs("div",{className:"bg-white/5 rounded-lg p-3 max-h-40 overflow-auto",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-2",children:"Changes to be deployed:"}),e.jsxs("div",{className:"font-mono text-xs text-gray-300 space-y-1",children:[l.slice(0,10).map((d,m)=>e.jsx("div",{className:"truncate",children:d},m)),l.length>10&&e.jsxs("div",{className:"text-gray-500",children:["... and ",l.length-10," more changes"]})]})]}),e.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-yellow-400",children:"This action will update the production server. Make sure all tests pass before proceeding."})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-4 border-t border-white/10",children:[e.jsx("button",{onClick:n,disabled:c,className:"px-4 py-2 rounded-lg bg-white/5 hover:bg-white/10 text-gray-300 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:r,disabled:c,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-cyan-500/20 hover:bg-cyan-500/30 text-cyan-400 transition-colors disabled:opacity-50",children:c?e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"w-4 h-4 animate-spin"}),"Deploying..."]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"w-4 h-4"}),"Deploy"]})})]})]})]}):null}function je({deployment:s,onRollback:n,isRollingBack:r}){const i=D[s.status]||D.pending,l=s.status==="success"&&!s.isCurrentDeployment;return e.jsxs("div",{className:`relative pl-6 pb-6 border-l-2 ${i.borderColor} last:pb-0`,children:[e.jsx("div",{className:`absolute -left-2 top-0 w-4 h-4 rounded-full ${i.bgColor} border-2 ${i.borderColor} flex items-center justify-center`,children:e.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${i.color.replace("text-","bg-")}`})}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-3 ml-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{status:s.status}),s.isCurrentDeployment&&e.jsx("span",{className:"text-xs bg-cyan-500/20 text-cyan-400 px-2 py-0.5 rounded",children:"Current"})]}),e.jsx("span",{className:"text-xs text-gray-400",children:Q(s.timestamp)})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-gray-300",children:[e.jsx(E,{className:"w-3.5 h-3.5 text-orange-400"}),e.jsx("span",{className:"font-mono",children:s.branch})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-gray-300",children:[e.jsx(K,{className:"w-3.5 h-3.5 text-purple-400"}),e.jsx("span",{className:"font-mono",children:V(s.commit)})]})]}),s.message&&e.jsx("div",{className:"mt-2 text-xs text-gray-400 truncate",children:s.message}),l&&e.jsxs("button",{onClick:()=>n(s.id),disabled:r,className:"mt-2 flex items-center gap-1.5 px-2.5 py-1 rounded bg-orange-500/20 hover:bg-orange-500/30 text-orange-400 text-xs transition-colors disabled:opacity-50",children:[r?e.jsx(f,{className:"w-3 h-3 animate-spin"}):e.jsx(Y,{className:"w-3 h-3"}),"Rollback to this version"]})]})]})}function ye({logs:s,isActive:n}){const r=a.useRef(null);return a.useEffect(()=>{r.current&&(r.current.scrollTop=r.current.scrollHeight)},[s]),e.jsxs(w,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-white flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4 text-green-400"}),"Deployment Progress"]}),n&&e.jsxs("span",{className:"flex items-center gap-1 text-xs bg-green-500/20 text-green-400 px-2 py-0.5 rounded",children:[e.jsx("span",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),"Live"]})]}),e.jsx("div",{ref:r,className:"font-mono text-xs text-gray-300 bg-black/40 rounded-lg p-3 h-64 overflow-auto whitespace-pre-wrap border border-white/5",children:s||"Waiting for deployment output..."})]})}function we({isOpen:s,onClose:n,changes:r,loading:i}){return s?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:n}),e.jsxs("div",{className:"relative bg-gray-900/95 border border-white/10 rounded-xl shadow-2xl w-full max-w-2xl mx-4 backdrop-blur-xl max-h-[80vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/10",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-blue-400"}),"Preview Changes"]}),e.jsx("button",{onClick:n,className:"p-1 rounded hover:bg-white/10 transition-colors",children:e.jsx(J,{className:"w-5 h-5 text-gray-400"})})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:i?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(f,{className:"w-6 h-6 animate-spin text-cyan-400"})}):r&&r.length>0?e.jsx("div",{className:"space-y-2",children:r.map((l,c)=>e.jsx("div",{className:`font-mono text-sm p-2 rounded ${l.startsWith("+")?"bg-green-500/10 text-green-400":l.startsWith("-")?"bg-red-500/10 text-red-400":l.startsWith("M ")?"bg-yellow-500/10 text-yellow-400":l.startsWith("A ")?"bg-green-500/10 text-green-400":l.startsWith("D ")?"bg-red-500/10 text-red-400":"bg-white/5 text-gray-300"}`,children:l},c))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(q,{className:"w-12 h-12 text-green-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-400",children:"No pending changes to deploy"})]})}),e.jsx("div",{className:"flex items-center justify-end p-4 border-t border-white/10",children:e.jsx("button",{onClick:n,className:"px-4 py-2 rounded-lg bg-white/5 hover:bg-white/10 text-gray-300 transition-colors",children:"Close"})})]})]}):null}function Fe(){const[s,n]=a.useState(null),[r,i]=a.useState([]),[l,c]=a.useState([]),[d,m]=a.useState("main"),[C,ee]=a.useState([]),[se,I]=a.useState(!0),[te,M]=a.useState(!1),[N,k]=a.useState(!1),[ae,L]=a.useState(null),[re,T]=a.useState(!1),[ne,$]=a.useState(!1),[le,H]=a.useState(!1),[O,p]=a.useState(""),[oe,R]=a.useState(!1),P=a.useRef(null),x=a.useCallback(()=>{try{const t=localStorage.getItem("musclemap-auth");if(t){const b=JSON.parse(t);if(b?.state?.token)return{Authorization:`Bearer ${b.state.token}`}}const o=localStorage.getItem("musclemap_token");return o?{Authorization:`Bearer ${o}`}:{}}catch{return{}}},[]),h=a.useCallback(async()=>{try{const t=await fetch(`${y}/status`,{headers:x()});if(t.ok){const o=await t.json();n(o)}}catch{}},[x]),u=a.useCallback(async()=>{try{const t=await fetch(`${y}/history`,{headers:x()});if(t.ok){const o=await t.json();i(o.deployments||[])}}catch{}},[x]),G=a.useCallback(async()=>{M(!0);try{const t=await fetch(`${y}/branches`,{headers:x()});if(t.ok){const o=await t.json();c(o.branches||[])}}catch{}finally{M(!1)}},[x]),W=a.useCallback(async()=>{T(!0);try{const t=await fetch(`${y}/preview/${encodeURIComponent(d)}`,{headers:x()});if(t.ok){const o=await t.json();ee(o.changes||[])}}catch{}finally{T(!1)}},[x,d]),z=a.useCallback(()=>{const t=localStorage.getItem("auth_token")||localStorage.getItem("token");if(!t)return;const b=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/api/admin/deploy/stream?token=${encodeURIComponent(t)}`,j=new WebSocket(b);return P.current=j,j.onopen=()=>{p(`Connected to deployment stream...
`),R(!0)},j.onmessage=B=>{try{const g=JSON.parse(B.data);g.type==="log"?p(S=>(S+g.data+`
`).split(`
`).slice(-500).join(`
`)):g.type==="complete"&&(p(S=>S+`
[Deployment ${g.success?"completed successfully":"failed"}]
`),k(!1),R(!1),h(),u())}catch{p(g=>(g+B.data+`
`).split(`
`).slice(-500).join(`
`))}},j.onerror=B=>{p(g=>g+`
[WebSocket Error: Connection failed]
`)},j.onclose=()=>{R(!1)},j},[h,u]),ie=a.useCallback(async()=>{k(!0),p(""),$(!1),z();try{const t=await fetch(`${y}/trigger`,{method:"POST",headers:{"Content-Type":"application/json",...x()},body:JSON.stringify({branch:d})});if(!t.ok){const o=await t.json();p(b=>b+`
[Error: ${o.error||"Deployment failed"}]
`),k(!1)}}catch(t){p(o=>o+`
[Error: ${t.message}]
`),k(!1)}},[z,x,d]),ce=a.useCallback(async t=>{L(t);try{const o=await fetch(`${y}/rollback/${t}`,{method:"POST",headers:{"Content-Type":"application/json",...x()}});if(o.ok)h(),u();else{const b=await o.json()}}catch{}finally{L(null)}},[x,h,u]),A=a.useCallback(async()=>{I(!0),await Promise.all([h(),u(),G()]),I(!1)},[h,u,G]),de=a.useCallback(()=>{H(!0),W()},[W]);return a.useEffect(()=>()=>{P.current&&P.current.close()},[]),a.useEffect(()=>{A();const t=setInterval(()=>{h(),u()},6e4);return()=>clearInterval(t)},[A,h,u]),se?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(f,{className:"w-8 h-8 animate-spin text-cyan-400"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(v,{className:"w-6 h-6 text-cyan-400"}),"Deployment Pipeline"]}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Deploy, rollback, and monitor production deployments"})]}),e.jsxs("button",{onClick:A,className:"flex items-center gap-2 px-3 py-2 rounded-lg bg-white/5 hover:bg-white/10 border border-white/10 transition-colors",children:[e.jsx(U,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Refresh"})]})]}),e.jsx(ge,{deployment:s,loading:!1,onRefresh:h}),e.jsxs(w,{className:"p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(me,{className:"w-4 h-4 text-green-400"}),"Deploy Controls"]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx(fe,{branches:l,selectedBranch:d,onSelect:m,loading:te}),e.jsxs("button",{onClick:de,disabled:N,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-blue-500/20 hover:bg-blue-500/30 text-blue-400 transition-colors disabled:opacity-50",children:[e.jsx(X,{className:"w-4 h-4"}),"Preview Changes"]}),e.jsx("button",{onClick:()=>$(!0),disabled:N,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-cyan-500/20 hover:bg-cyan-500/30 text-cyan-400 transition-colors disabled:opacity-50",children:N?e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"w-4 h-4 animate-spin"}),"Deploying..."]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"w-4 h-4"}),"Deploy to Production"]})})]})]}),(N||O)&&e.jsx(ye,{logs:O,isActive:oe}),e.jsxs(w,{className:"p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4 text-purple-400"}),"Deployment History"]}),r.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(F,{className:"w-12 h-12 text-gray-500 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-400",children:"No deployment history available"})]}):e.jsx("div",{className:"space-y-0",children:r.map(t=>e.jsx(je,{deployment:t,onRollback:ce,isRollingBack:ae===t.id},t.id))})]}),e.jsx(be,{isOpen:ne,onClose:()=>$(!1),onConfirm:ie,branch:d,changes:C,loading:N}),e.jsx(we,{isOpen:le,onClose:()=>H(!1),changes:C,loading:re})]})}export{Fe as default};
