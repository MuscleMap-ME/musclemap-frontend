import{r as a,j as e,L as ie}from"./react-vendor-D847gc3Q.js";import{c as u}from"./recharts-vendor-CxtoZpzE.js";import{m as P,A as G,G as le,w as ne,i as $}from"./index-CPgxk9rr.js";import"./nutritionStore-_e9m7C77.js";import"./musicStore-DfpeP5rG.js";import"./adventureMapStore-DGzFzV9e.js";import"./leaflet-vendor-DZbo3Ov0.js";import"./d3-vendor-mcDw60ct.js";import"./apollo-vendor-BNHFeEEc.js";import"./reactflow-vendor-CYb5nRwM.js";const ce={high:{quality:.9,maxWidth:2e3,maxHeight:2e3},medium:{quality:.7,maxWidth:1500,maxHeight:1500},low:{quality:.5,maxWidth:1e3,maxHeight:1e3},thumbnail:{quality:.6,maxWidth:300,maxHeight:400}};async function K(r,i={}){const{quality:s=.7,maxWidth:n=1500,maxHeight:l=1500,format:g="image/jpeg",preserveAspectRatio:S=!0}=i;return new Promise((j,w)=>{const b=new Image,d=r.size;b.onload=()=>{try{let{width:p,height:f}=b;if(S){const y=Math.min(n/p,l/f,1);p=Math.round(p*y),f=Math.round(f*y)}else p=Math.min(p,n),f=Math.min(f,l);const v=document.createElement("canvas");v.width=p,v.height=f;const h=v.getContext("2d");if(!h)throw new Error("Failed to get canvas context");h.drawImage(b,0,0,p,f),v.toBlob(y=>{if(!y){w(new Error("Failed to compress image"));return}const N=v.toDataURL(g,s);j({blob:y,dataUrl:N,originalSize:d,compressedSize:y.size,compressionRatio:y.size/d,width:p,height:f})},g,s)}catch(p){w(p)}finally{URL.revokeObjectURL(b.src)}},b.onerror=()=>{URL.revokeObjectURL(b.src),w(new Error("Failed to load image"))},b.src=URL.createObjectURL(r)})}async function de(r,i){const s=ce[i];return K(r,s)}async function he(r,i=300){return(await K(r,{maxWidth:i,maxHeight:i,quality:.6,format:"image/jpeg"})).dataUrl}function xe(r,i=20){const s=["image/jpeg","image/png","image/webp","image/heic","image/heif"];if(!s.includes(r.type))return{valid:!1,error:`Invalid file type. Supported: ${s.join(", ")}`};const n=i*1024*1024;return r.size>n?{valid:!1,error:`File too large. Maximum size: ${i}MB`}:{valid:!0}}function me({beforeSrc:r,afterSrc:i,beforeLabel:s="Before",afterLabel:n="After",beforeDate:l,afterDate:g,className:S}){const j=a.useRef(null),[w,b]=a.useState(50),[d,p]=a.useState(!1),[f,v]=a.useState({before:!1,after:!1}),h=a.useCallback(c=>{if(!j.current)return;const k=j.current.getBoundingClientRect(),M=c-k.left,O=Math.max(0,Math.min(100,M/k.width*100));b(O)},[]),y=a.useCallback(c=>{d&&h(c.clientX)},[d,h]),N=a.useCallback(c=>{d&&(c.preventDefault(),h(c.touches[0].clientX))},[d,h]),E=a.useCallback(()=>{p(!0)},[]),o=a.useCallback(()=>{p(!1)},[]);a.useEffect(()=>(d&&(window.addEventListener("mousemove",y),window.addEventListener("mouseup",o),window.addEventListener("touchmove",N,{passive:!1}),window.addEventListener("touchend",o)),()=>{window.removeEventListener("mousemove",y),window.removeEventListener("mouseup",o),window.removeEventListener("touchmove",N),window.removeEventListener("touchend",o)}),[d,y,N,o]);const x=f.before&&f.after;return e.jsxs("div",{ref:j,className:u("relative overflow-hidden rounded-2xl bg-[var(--glass-white-5)]","border border-[var(--border-default)]","select-none touch-none",S),style:{aspectRatio:"3/4"},children:[!x&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-900/80 z-20",children:e.jsx("div",{className:"w-8 h-8 border-2 border-white/30 border-t-white rounded-full animate-spin"})}),e.jsx("img",{src:i,alt:n,className:"absolute inset-0 w-full h-full object-cover",onLoad:()=>v(c=>({...c,after:!0})),draggable:!1}),e.jsx("div",{className:"absolute inset-0 overflow-hidden",style:{clipPath:`inset(0 ${100-w}% 0 0)`},children:e.jsx("img",{src:r,alt:s,className:"absolute inset-0 w-full h-full object-cover",onLoad:()=>v(c=>({...c,before:!0})),draggable:!1})}),e.jsxs("div",{className:"absolute top-0 bottom-0 z-10",style:{left:`${w}%`,transform:"translateX(-50%)"},children:[e.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 bg-white shadow-[0_0_10px_rgba(255,255,255,0.5)]"}),e.jsx(P.button,{className:u("absolute top-1/2 -translate-y-1/2 -translate-x-1/2","w-12 h-12 rounded-full","bg-white/20 backdrop-blur-md border border-white/30","flex items-center justify-center","cursor-grab active:cursor-grabbing","shadow-[0_0_20px_rgba(255,255,255,0.3)]","transition-transform",d&&"scale-110"),onMouseDown:E,onTouchStart:E,whileHover:{scale:1.1},whileTap:{scale:.95},children:e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"})}),e.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"})})]})})]}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 flex justify-between p-4 pointer-events-none",children:[e.jsxs(P.div,{className:u("glass px-3 py-2 rounded-xl","text-sm font-semibold text-white"),initial:{opacity:0,x:-20},animate:{opacity:w>15?1:0,x:0},transition:{duration:.2},children:[e.jsx("div",{children:s}),l&&e.jsx("div",{className:"text-xs text-gray-400 font-normal",children:l})]}),e.jsxs(P.div,{className:u("glass px-3 py-2 rounded-xl","text-sm font-semibold text-white"),initial:{opacity:0,x:20},animate:{opacity:w<85?1:0,x:0},transition:{duration:.2},children:[e.jsx("div",{children:n}),g&&e.jsx("div",{className:"text-xs text-gray-400 font-normal",children:g})]})]}),x&&e.jsx(P.div,{className:"absolute top-4 left-1/2 -translate-x-1/2 glass px-3 py-2 rounded-xl text-xs text-gray-300 pointer-events-none",initial:{opacity:1},animate:{opacity:d?0:1},transition:{delay:d?0:2,duration:.3},children:"Drag to compare"})]})}function ue({beforeSrc:r,afterSrc:i,beforeLabel:s="Before",afterLabel:n="After",beforeDate:l,afterDate:g,className:S}){return e.jsxs("div",{className:u("grid grid-cols-2 gap-2",S),children:[e.jsxs("div",{className:"relative rounded-xl overflow-hidden bg-[var(--glass-white-5)] border border-[var(--border-default)]",children:[e.jsx("img",{src:r,alt:s,className:"w-full h-full object-cover",style:{aspectRatio:"3/4"}}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-3 bg-gradient-to-t from-black/60",children:[e.jsx("div",{className:"text-sm font-semibold text-white",children:s}),l&&e.jsx("div",{className:"text-xs text-gray-300",children:l})]})]}),e.jsxs("div",{className:"relative rounded-xl overflow-hidden bg-[var(--glass-white-5)] border border-[var(--border-default)]",children:[e.jsx("img",{src:i,alt:n,className:"w-full h-full object-cover",style:{aspectRatio:"3/4"}}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-3 bg-gradient-to-t from-black/60",children:[e.jsx("div",{className:"text-sm font-semibold text-white",children:n}),g&&e.jsx("div",{className:"text-xs text-gray-300",children:g})]})]})]})}const T={front:{id:"front",label:"Front",icon:"ðŸ§"},back:{id:"back",label:"Back",icon:"ðŸ”™"},left:{id:"left_side",label:"Left Side",icon:"ðŸ‘ˆ"},right:{id:"right_side",label:"Right Side",icon:"ðŸ‘‰"},flexed:{id:"flexed",label:"Flexed",icon:"ðŸ’ª"},legs:{id:"legs",label:"Legs",icon:"ðŸ¦µ"}};function ge({photos:r=[],onSelectPhoto:i,onCompare:s,onDelete:n,className:l}){const[g,S]=a.useState(null),[j,w]=a.useState(!1),[b,d]=a.useState([]),[p,f]=a.useState("timeline"),v=a.useMemo(()=>{let o=[...r];return g&&(o=o.filter(x=>x.bodyPart===g)),o.sort((x,c)=>new Date(c.date)-new Date(x.date)),o},[r,g]),h=a.useMemo(()=>{const o={};return v.forEach(x=>{const c=new Date(x.date),k=`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}`,M=c.toLocaleDateString("en-US",{month:"long",year:"numeric"});o[k]||(o[k]={label:M,photos:[]}),o[k].photos.push(x)}),Object.entries(o).sort((x,c)=>c[0].localeCompare(x[0]))},[v]),y=a.useCallback(o=>{j?d(x=>x.some(k=>k.id===o.id)?x.filter(k=>k.id!==o.id):x.length>=2?[x[1],o]:[...x,o]):i?.(o)},[j,i]),N=a.useCallback(()=>{if(b.length===2){const o=[...b].sort((x,c)=>new Date(x.date)-new Date(c.date));s?.(o[0],o[1])}},[b,s]),E=a.useCallback(()=>{w(!1),d([])},[]);return e.jsxs("div",{className:u("space-y-4",l),children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide",children:[e.jsx("button",{onClick:()=>S(null),className:u("px-3 py-2 rounded-xl text-sm font-medium whitespace-nowrap transition-colors",g?"glass text-gray-300 hover:text-white":"bg-[var(--brand-blue-500)] text-white"),children:"All"}),Object.values(T).map(o=>e.jsxs("button",{onClick:()=>S(o.id),className:u("px-3 py-2 rounded-xl text-sm font-medium whitespace-nowrap transition-colors",g===o.id?"bg-[var(--brand-blue-500)] text-white":"glass text-gray-300 hover:text-white"),children:[e.jsx("span",{className:"mr-1",children:o.icon}),o.label]},o.id))]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"glass rounded-xl p-1 flex",children:[e.jsx("button",{onClick:()=>f("timeline"),className:u("px-3 py-1.5 rounded-lg text-sm transition-colors",p==="timeline"?"bg-white/10 text-white":"text-gray-400"),children:"Timeline"}),e.jsx("button",{onClick:()=>f("grid"),className:u("px-3 py-1.5 rounded-lg text-sm transition-colors",p==="grid"?"bg-white/10 text-white":"text-gray-400"),children:"Grid"})]}),j?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-400",children:[b.length,"/2 selected"]}),e.jsx("button",{onClick:N,disabled:b.length!==2,className:u("px-4 py-2 rounded-xl text-sm font-medium transition-colors",b.length===2?"bg-[var(--brand-blue-500)] text-white":"bg-gray-700 text-gray-400 cursor-not-allowed"),children:"Compare"}),e.jsx("button",{onClick:E,className:"px-4 py-2 rounded-xl text-sm font-medium glass text-gray-300",children:"Cancel"})]}):e.jsx("button",{onClick:()=>w(!0),className:"px-4 py-2 rounded-xl text-sm font-medium glass text-gray-300 hover:text-white transition-colors",children:"Select to Compare"})]})]}),v.length===0&&e.jsxs("div",{className:"glass rounded-2xl p-8 text-center",children:[e.jsx("div",{className:"text-4xl mb-3",children:"ðŸ“¸"}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"No photos yet"}),e.jsx("p",{className:"text-gray-400",children:g?`No ${T[g]?.label||"matching"} photos found`:"Add your first progress photo to start tracking your transformation"})]}),p==="timeline"&&h.length>0&&e.jsx("div",{className:"space-y-6",children:h.map(([o,x])=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-3 sticky top-0 bg-gray-900/80 backdrop-blur-sm py-2 z-10",children:x.label}),e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-2",children:e.jsx(G,{mode:"popLayout",children:x.photos.map((c,k)=>e.jsx(Y,{photo:c,isSelected:b.some(M=>M.id===c.id),selectionMode:j,onClick:()=>y(c),onDelete:n,index:k},c.id))})})]},o))}),p==="grid"&&v.length>0&&e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-2",children:e.jsx(G,{mode:"popLayout",children:v.map((o,x)=>e.jsx(Y,{photo:o,isSelected:b.some(c=>c.id===o.id),selectionMode:j,onClick:()=>y(o),onDelete:n,index:x,showDate:!0},o.id))})})]})}function Y({photo:r,isSelected:i,selectionMode:s,onClick:n,onDelete:l,index:g,showDate:S=!1}){const[j,w]=a.useState(!1),[b,d]=a.useState(!1);return e.jsxs(P.div,{layout:!0,initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{delay:g*.02,duration:.2},className:u("relative rounded-xl overflow-hidden cursor-pointer group","bg-[var(--glass-white-5)] border",i?"border-[var(--brand-blue-500)] ring-2 ring-[var(--brand-blue-500)]/50":"border-[var(--border-default)]"),style:{aspectRatio:"3/4"},onClick:n,onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),children:[!j&&e.jsx("div",{className:"absolute inset-0 bg-gray-800 animate-pulse"}),e.jsx("img",{src:r.thumbnailSrc||r.src,alt:`Progress photo - ${r.bodyPart}`,className:u("w-full h-full object-cover transition-opacity",j?"opacity-100":"opacity-0"),onLoad:()=>w(!0),loading:"lazy"}),s&&e.jsx("div",{className:"absolute top-2 right-2 z-10",children:e.jsx("div",{className:u("w-6 h-6 rounded-full border-2 flex items-center justify-center transition-colors",i?"bg-[var(--brand-blue-500)] border-[var(--brand-blue-500)]":"bg-black/50 border-white/50"),children:i&&e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})}),r.isLocal&&e.jsx("div",{className:"absolute top-2 left-2 z-10",children:e.jsx("div",{className:"w-6 h-6 rounded-full bg-amber-500/80 flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})})}),e.jsx(G,{children:b&&!s&&e.jsx(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent flex items-end p-2",children:l&&e.jsx("button",{onClick:p=>{p.stopPropagation(),l(r)},className:"ml-auto p-2 rounded-lg bg-red-500/80 text-white hover:bg-red-500 transition-colors",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})})}),S&&j&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 px-2 py-1 bg-black/60 text-xs text-white text-center",children:new Date(r.date).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),r.bodyPart&&T[r.bodyPart]&&e.jsx("div",{className:"absolute top-2 right-2 text-lg opacity-80 drop-shadow",children:T[r.bodyPart].icon})]})}function be(){return e.jsxs("svg",{className:"w-full h-full",preserveAspectRatio:"none",children:[e.jsx("line",{x1:"33.33%",y1:"0",x2:"33.33%",y2:"100%",stroke:"white",strokeWidth:"1"}),e.jsx("line",{x1:"66.66%",y1:"0",x2:"66.66%",y2:"100%",stroke:"white",strokeWidth:"1"}),e.jsx("line",{x1:"0",y1:"33.33%",x2:"100%",y2:"33.33%",stroke:"white",strokeWidth:"1"}),e.jsx("line",{x1:"0",y1:"66.66%",x2:"100%",y2:"66.66%",stroke:"white",strokeWidth:"1"}),e.jsx("line",{x1:"50%",y1:"45%",x2:"50%",y2:"55%",stroke:"white",strokeWidth:"2"}),e.jsx("line",{x1:"45%",y1:"50%",x2:"55%",y2:"50%",stroke:"white",strokeWidth:"2"})]})}function pe({opacity:r}){const n=[{position:"top-4 left-4",rotation:0},{position:"top-4 right-4",rotation:90},{position:"bottom-4 right-4",rotation:180},{position:"bottom-4 left-4",rotation:270}];return e.jsx(e.Fragment,{children:n.map((l,g)=>e.jsxs("div",{className:`absolute ${l.position}`,style:{width:30,height:30,opacity:r,transform:`rotate(${l.rotation}deg)`},children:[e.jsx("div",{className:"absolute top-0 left-0 bg-white",style:{width:30,height:3}}),e.jsx("div",{className:"absolute top-0 left-0 bg-white",style:{width:3,height:30}})]},g))})}function fe({type:r}){const i={front:e.jsx("path",{d:`M50 10
           C45 10 42 15 42 20
           C42 28 45 32 50 32
           C55 32 58 28 58 20
           C58 15 55 10 50 10
           M45 34 L40 35 L38 45 L40 75 L38 100
           M55 34 L60 35 L62 45 L60 75 L62 100
           M40 35 L38 50 L35 80 L32 95
           M60 35 L62 50 L65 80 L68 95`,fill:"none",stroke:"white",strokeWidth:"2"}),back:e.jsx("path",{d:`M50 10
           C45 10 42 15 42 20
           C42 28 45 32 50 32
           C55 32 58 28 58 20
           C58 15 55 10 50 10
           M45 34 L40 35 L38 45 L40 75 L38 100
           M55 34 L60 35 L62 45 L60 75 L62 100
           M40 35 L38 50 L35 80 L32 95
           M60 35 L62 50 L65 80 L68 95
           M42 38 L42 50 M58 38 L58 50`,fill:"none",stroke:"white",strokeWidth:"2"}),left_side:e.jsx("path",{d:`M50 10
           C47 10 45 15 45 20
           C45 28 48 32 50 32
           C52 32 55 28 55 20
           C55 15 53 10 50 10
           M50 34 L52 40 L54 75 L52 100
           M50 35 L48 50 L45 80 L42 95`,fill:"none",stroke:"white",strokeWidth:"2"}),right_side:e.jsx("path",{d:`M50 10
           C47 10 45 15 45 20
           C45 28 48 32 50 32
           C52 32 55 28 55 20
           C55 15 53 10 50 10
           M50 34 L48 40 L46 75 L48 100
           M50 35 L52 50 L55 80 L58 95`,fill:"none",stroke:"white",strokeWidth:"2"}),flexed:e.jsx("path",{d:`M50 10
           C45 10 42 15 42 20
           C42 28 45 32 50 32
           C55 32 58 28 58 20
           C58 15 55 10 50 10
           M45 34 L40 35 L38 45 L40 75 L38 100
           M55 34 L60 35 L62 45 L60 75 L62 100
           M40 35 L35 30 L32 25 L38 28 L40 35
           M60 35 L65 30 L68 25 L62 28 L60 35`,fill:"none",stroke:"white",strokeWidth:"2"})};return e.jsx("svg",{viewBox:"0 0 100 110",className:"w-auto h-3/4 max-h-[80%]",style:{opacity:.6},children:i[r]||i.front})}function ve({type:r="front",showGrid:i=!0,opacity:s=.4,className:n}){return e.jsxs("div",{className:u("absolute inset-0 pointer-events-none",n),children:[i&&e.jsx("div",{style:{opacity:s},children:e.jsx(be,{})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",style:{opacity:s},children:e.jsx(fe,{type:r})}),e.jsx(pe,{opacity:s})]})}const je={storageMode:"local",compressionQuality:"medium",reminderFrequency:"weekly",showGuide:!0},X="musclemap_progress_photos",J="musclemap_photo_settings";async function q(r){try{const s=(await Z()).transaction("photos","readwrite"),n=s.objectStore("photos");await n.clear();for(const l of r)await n.put(l);await s.done}catch{try{const s=r.map(n=>({...n,src:n.thumbnailSrc||n.src.substring(0,1e3)}));localStorage.setItem(X,JSON.stringify(s))}catch{}}}async function we(){try{const i=(await Z()).transaction("photos","readonly"),n=await i.objectStore("photos").getAll();return await i.done,n||[]}catch{try{const i=localStorage.getItem(X);return i?JSON.parse(i):[]}catch{return[]}}}function Z(){return new Promise((r,i)=>{const s=indexedDB.open("MuscleMapPhotos",1);s.onerror=()=>i(s.error),s.onsuccess=()=>r(s.result),s.onupgradeneeded=n=>{const l=n.target.result;l.objectStoreNames.contains("photos")||l.createObjectStore("photos",{keyPath:"id"})}})}function We(){const{token:r}=le(),{toast:i,error:s,success:n}=ne(),[l,g]=a.useState([]),[S,j]=a.useState(!0),[w,b]=a.useState(!1),[d,p]=a.useState(je),[f,v]=a.useState("gallery"),[h,y]=a.useState({before:null,after:null}),[N,E]=a.useState(null),[o,x]=a.useState("front"),[c,k]=a.useState(""),[M,O]=a.useState(""),[ee,Q]=a.useState(!1),[I,V]=a.useState("slider"),A=a.useRef(null),B=a.useRef(null),R=a.useRef(null);a.useEffect(()=>{async function t(){j(!0);try{const m=localStorage.getItem(J);m&&p(JSON.parse(m));const L=await we();if(g(L.map(C=>({...C,isLocal:!0}))),r)try{const C=await $.progressPhotos?.list()||[];g(D=>{const W=new Set(D.map(F=>F.id)),H=C.filter(F=>!W.has(F.id));return[...D,...H.map(F=>({...F,isLocal:!1}))]})}catch{}}catch{s("Failed to load photos")}finally{j(!1)}}t()},[r,s]),a.useEffect(()=>{localStorage.setItem(J,JSON.stringify(d))},[d]),a.useEffect(()=>()=>{R.current&&R.current.getTracks().forEach(t=>t.stop())},[]);const te=a.useCallback(async()=>{try{const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:{ideal:1920},height:{ideal:1080}}});R.current=t,B.current&&(B.current.srcObject=t),Q(!0)}catch{s("Failed to access camera. Please check permissions.")}},[s]),U=a.useCallback(()=>{R.current&&(R.current.getTracks().forEach(t=>t.stop()),R.current=null),Q(!1)},[]),se=a.useCallback(async()=>{if(B.current)try{b(!0);const t=document.createElement("canvas");t.width=B.current.videoWidth,t.height=B.current.videoHeight;const m=t.getContext("2d");if(!m)throw new Error("Failed to get canvas context");m.translate(t.width,0),m.scale(-1,1),m.drawImage(B.current,0,0);const L=await new Promise((C,D)=>{t.toBlob(W=>W?C(W):D(new Error("Failed to create blob")),"image/jpeg",.9)});await _(L),U()}catch{s("Failed to capture photo")}finally{b(!1)}},[U,s,_]),ae=a.useCallback(async t=>{const m=t.target.files;if(!m||m.length===0)return;const L=m[0],C=xe(L);if(!C.valid){s(C.error||"Invalid image");return}try{b(!0),await _(L)}catch{s("Failed to process image")}finally{b(!1),A.current&&(A.current.value="")}},[s,_]),_=a.useCallback(async t=>{const m=await de(t,d.compressionQuality),L=await he(t),C={id:`photo_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,src:m.dataUrl,thumbnailSrc:L,bodyPart:o,date:new Date().toISOString(),weight:c?parseFloat(c):void 0,notes:M||void 0,isLocal:d.storageMode==="local"};if(g(D=>[C,...D]),d.storageMode==="local"||!r){const D=[C,...l.filter(W=>W.isLocal)];await q(D)}else try{await $.progressPhotos?.create({imageData:m.dataUrl,thumbnailData:L,bodyPart:o,weight:c?parseFloat(c):null,notes:M||null})}catch{C.isLocal=!0;const W=[C,...l.filter(H=>H.isLocal)];await q(W),i("Saved locally (cloud upload failed)")}n("Photo saved!"),k(""),O(""),v("gallery")},[o,c,M,d,r,l,i,n]),re=a.useCallback(async t=>{if(confirm("Delete this photo? This cannot be undone."))try{if(g(m=>m.filter(L=>L.id!==t.id)),t.isLocal){const m=l.filter(L=>L.isLocal&&L.id!==t.id);await q(m)}else if(r)try{await $.progressPhotos?.delete(t.id)}catch{}n("Photo deleted")}catch{s("Failed to delete photo")}},[l,r,n,s]),oe=a.useCallback((t,m)=>{y({before:t,after:m}),v("compare")},[]),z=a.useCallback(t=>{p(m=>({...m,...t}))},[]);return S?e.jsx("div",{className:"min-h-screen bg-gray-900 text-white flex items-center justify-center",children:e.jsx("div",{className:"animate-pulse text-3xl",children:"Loading photos..."})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-gray-900 via-gray-800 to-gray-900 text-white pb-24",children:[e.jsx("header",{className:"bg-gray-900/80 backdrop-blur-lg p-4 sticky top-0 z-20",children:e.jsxs("div",{className:"max-w-5xl mx-auto flex items-center justify-between",children:[e.jsxs(ie,{to:"/dashboard",className:"text-blue-400 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back"]}),e.jsx("h1",{className:"text-xl font-bold",children:"Progress Photos"}),e.jsx("div",{className:"w-16"})," "]})}),e.jsx("div",{className:"sticky top-16 z-10 bg-gray-900/80 backdrop-blur-lg border-b border-white/10",children:e.jsx("div",{className:"max-w-5xl mx-auto px-4",children:e.jsx("div",{className:"flex gap-1 overflow-x-auto scrollbar-hide py-3",children:[{id:"gallery",label:"Gallery",icon:"ðŸ–¼"},{id:"capture",label:"Capture",icon:"ðŸ“¸"},{id:"compare",label:"Compare",icon:"âš–"},{id:"settings",label:"Settings",icon:"âš™"}].map(t=>e.jsxs("button",{onClick:()=>v(t.id),className:u("px-4 py-2 rounded-xl font-medium whitespace-nowrap transition-colors",f===t.id?"bg-[var(--brand-blue-500)] text-white":"glass text-gray-300 hover:text-white"),children:[e.jsx("span",{className:"mr-2",children:t.icon}),t.label]},t.id))})})}),e.jsxs("main",{className:"max-w-5xl mx-auto p-4",children:[f==="gallery"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"glass rounded-xl p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:l.length}),e.jsx("div",{className:"text-sm text-gray-400",children:"Total Photos"})]}),e.jsxs("div",{className:"glass rounded-xl p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:l.filter(t=>t.isLocal).length}),e.jsx("div",{className:"text-sm text-gray-400",children:"Local Only"})]}),e.jsxs("div",{className:"glass rounded-xl p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:l.length>0?Math.ceil((new Date().getTime()-new Date(l[l.length-1].date).getTime())/(1e3*60*60*24)):0}),e.jsx("div",{className:"text-sm text-gray-400",children:"Days Tracking"})]}),e.jsxs("div",{className:"glass rounded-xl p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:Object.keys(l.reduce((t,m)=>({...t,[m.bodyPart]:!0}),{})).length}),e.jsx("div",{className:"text-sm text-gray-400",children:"Body Parts"})]})]}),e.jsx(ge,{photos:l,onSelectPhoto:E,onCompare:oe,onDelete:re}),l.length===0&&e.jsx("div",{className:"text-center py-8",children:e.jsx("button",{onClick:()=>v("capture"),className:"px-6 py-3 bg-[var(--brand-blue-500)] hover:bg-[var(--brand-blue-600)] rounded-xl font-semibold transition-colors",children:"Take Your First Photo"})})]}),f==="capture"&&e.jsx("div",{className:"space-y-6",children:ee?e.jsxs("div",{className:"relative rounded-2xl overflow-hidden bg-black",style:{aspectRatio:"3/4"},children:[e.jsx("video",{ref:B,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover transform scale-x-[-1]"}),d.showGuide&&e.jsx(ve,{type:o,showGrid:!0,opacity:.4}),e.jsxs("div",{className:"absolute bottom-6 left-0 right-0 flex justify-center gap-4",children:[e.jsx("button",{onClick:U,className:"w-14 h-14 rounded-full glass flex items-center justify-center text-white",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx(P.button,{onClick:se,disabled:w,className:u("w-20 h-20 rounded-full","bg-white/20 backdrop-blur-md border-4 border-white","flex items-center justify-center",w&&"opacity-50"),whileHover:{scale:1.05},whileTap:{scale:.95},children:w?e.jsx("div",{className:"w-8 h-8 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsx("div",{className:"w-14 h-14 rounded-full bg-white"})}),e.jsx("div",{className:"w-14"})," "]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-300 mb-3 block",children:"Select Body Part"}),e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-6 gap-2",children:Object.values(T).map(t=>e.jsxs("button",{onClick:()=>x(t.id),className:u("p-3 rounded-xl text-center transition-colors",o===t.id?"bg-[var(--brand-blue-500)] text-white":"glass text-gray-300 hover:text-white"),children:[e.jsx("div",{className:"text-2xl mb-1",children:t.icon}),e.jsx("div",{className:"text-xs",children:t.label})]},t.id))})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-300 mb-2 block",children:"Current Weight (optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:c,onChange:t=>k(t.target.value),placeholder:"Enter weight",className:"w-full bg-gray-800/50 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-[var(--brand-blue-500)]"}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-400",children:"lbs"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-300 mb-2 block",children:"Notes (optional)"}),e.jsx("input",{type:"text",value:M,onChange:t=>O(t.target.value),placeholder:"Any notes about this photo",className:"w-full bg-gray-800/50 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-[var(--brand-blue-500)]"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs(P.button,{onClick:te,className:"glass p-6 rounded-2xl text-center hover:bg-white/10 transition-colors",whileHover:{scale:1.02},whileTap:{scale:.98},children:[e.jsx("div",{className:"text-4xl mb-3",children:"ðŸ“·"}),e.jsx("div",{className:"font-semibold text-white",children:"Take Photo"}),e.jsx("div",{className:"text-sm text-gray-400 mt-1",children:"Use your camera"})]}),e.jsxs(P.button,{onClick:()=>A.current?.click(),className:"glass p-6 rounded-2xl text-center hover:bg-white/10 transition-colors",whileHover:{scale:1.02},whileTap:{scale:.98},children:[e.jsx("div",{className:"text-4xl mb-3",children:"ðŸ“"}),e.jsx("div",{className:"font-semibold text-white",children:"Upload Photo"}),e.jsx("div",{className:"text-sm text-gray-400 mt-1",children:"From your device"})]}),e.jsx("input",{ref:A,type:"file",accept:"image/*",onChange:ae,className:"hidden"})]}),w&&e.jsxs("div",{className:"glass rounded-xl p-4 text-center",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-white/30 border-t-white rounded-full animate-spin mx-auto mb-2"}),e.jsx("div",{className:"text-sm text-gray-300",children:"Processing image..."})]})]})}),f==="compare"&&e.jsx("div",{className:"space-y-6",children:h.before&&h.after?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{onClick:()=>V("slider"),className:u("px-4 py-2 rounded-xl font-medium transition-colors",I==="slider"?"bg-[var(--brand-blue-500)] text-white":"glass text-gray-300"),children:"Slider View"}),e.jsx("button",{onClick:()=>V("sideBySide"),className:u("px-4 py-2 rounded-xl font-medium transition-colors",I==="sideBySide"?"bg-[var(--brand-blue-500)] text-white":"glass text-gray-300"),children:"Side by Side"})]}),I==="slider"?e.jsx(me,{beforeSrc:h.before.src,afterSrc:h.after.src,beforeDate:new Date(h.before.date).toLocaleDateString(),afterDate:new Date(h.after.date).toLocaleDateString(),className:"max-w-md mx-auto"}):e.jsx(ue,{beforeSrc:h.before.src,afterSrc:h.after.src,beforeDate:new Date(h.before.date).toLocaleDateString(),afterDate:new Date(h.after.date).toLocaleDateString(),className:"max-w-2xl mx-auto"}),h.before.weight&&h.after.weight&&e.jsxs("div",{className:"glass rounded-xl p-4 text-center max-w-md mx-auto",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Weight Change"}),e.jsxs("div",{className:"text-2xl font-bold",children:[h.after.weight-h.before.weight>0?"+":"",(h.after.weight-h.before.weight).toFixed(1)," lbs"]}),e.jsxs("div",{className:"text-sm text-gray-400 mt-1",children:[h.before.weight," lbs â†’ ",h.after.weight," lbs"]})]}),e.jsx("div",{className:"text-center",children:e.jsx("button",{onClick:()=>y({before:null,after:null}),className:"text-gray-400 hover:text-white text-sm",children:"Clear selection"})})]}):e.jsxs("div",{className:"glass rounded-2xl p-8 text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"âš–"}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"No Photos Selected"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"Go to the Gallery tab and select two photos to compare your progress"}),e.jsx("button",{onClick:()=>v("gallery"),className:"px-6 py-3 bg-[var(--brand-blue-500)] hover:bg-[var(--brand-blue-600)] rounded-xl font-semibold transition-colors",children:"Go to Gallery"})]})}),f==="settings"&&e.jsxs("div",{className:"space-y-6 max-w-md mx-auto",children:[e.jsxs("div",{className:"glass rounded-xl p-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-300 mb-3 block",children:"Default Storage Mode"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>z({storageMode:"local"}),className:u("p-4 rounded-xl text-center transition-colors",d.storageMode==="local"?"bg-[var(--brand-blue-500)] text-white":"bg-white/10 text-gray-300"),children:[e.jsx("div",{className:"text-2xl mb-2",children:"ðŸ”’"}),e.jsx("div",{className:"font-medium",children:"Local Only"}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Privacy mode"})]}),e.jsxs("button",{onClick:()=>z({storageMode:"cloud"}),className:u("p-4 rounded-xl text-center transition-colors",d.storageMode==="cloud"?"bg-[var(--brand-blue-500)] text-white":"bg-white/10 text-gray-300"),children:[e.jsx("div",{className:"text-2xl mb-2",children:"â˜"}),e.jsx("div",{className:"font-medium",children:"Cloud Sync"}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Access anywhere"})]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-3",children:d.storageMode==="local"?"Photos stay on your device only. More private but no backup.":"Photos sync to cloud. Access from any device with your account."})]}),e.jsxs("div",{className:"glass rounded-xl p-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-300 mb-3 block",children:"Photo Quality"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:["high","medium","low"].map(t=>e.jsx("button",{onClick:()=>z({compressionQuality:t}),className:u("p-3 rounded-xl text-center capitalize transition-colors",d.compressionQuality===t?"bg-[var(--brand-blue-500)] text-white":"bg-white/10 text-gray-300"),children:t},t))}),e.jsx("p",{className:"text-xs text-gray-500 mt-3",children:"Higher quality = larger file size. Medium recommended for most users."})]}),e.jsxs("div",{className:"glass rounded-xl p-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-300 mb-3 block",children:"Photo Reminder"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:["weekly","monthly","daily","never"].map(t=>e.jsx("button",{onClick:()=>z({reminderFrequency:t}),className:u("p-3 rounded-xl text-center capitalize transition-colors",d.reminderFrequency===t?"bg-[var(--brand-blue-500)] text-white":"bg-white/10 text-gray-300"),children:t},t))}),e.jsx("p",{className:"text-xs text-gray-500 mt-3",children:"Get reminded to take progress photos for consistent tracking."})]}),e.jsx("div",{className:"glass rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:"Show Pose Guide"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Display alignment guides when taking photos"})]}),e.jsx("button",{onClick:()=>z({showGuide:!d.showGuide}),className:u("w-12 h-7 rounded-full transition-colors relative",d.showGuide?"bg-[var(--brand-blue-500)]":"bg-gray-600"),children:e.jsx("div",{className:u("w-5 h-5 rounded-full bg-white absolute top-1 transition-transform",d.showGuide?"translate-x-6":"translate-x-1")})})]})}),e.jsxs("div",{className:"glass rounded-xl p-4",children:[e.jsx("h3",{className:"font-medium text-white mb-3",children:"Storage Info"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between text-gray-300",children:[e.jsx("span",{children:"Local photos:"}),e.jsx("span",{children:l.filter(t=>t.isLocal).length})]}),e.jsxs("div",{className:"flex justify-between text-gray-300",children:[e.jsx("span",{children:"Cloud photos:"}),e.jsx("span",{children:l.filter(t=>!t.isLocal).length})]})]})]})]})]}),e.jsx(G,{children:N&&e.jsx(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/90 flex items-center justify-center p-4",onClick:()=>E(null),children:e.jsxs(P.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"max-w-lg w-full",onClick:t=>t.stopPropagation(),children:[e.jsx("img",{src:N.src,alt:"Progress photo",className:"w-full rounded-2xl"}),e.jsxs("div",{className:"mt-4 text-center text-white",children:[e.jsx("div",{className:"text-lg font-semibold",children:T[N.bodyPart]?.label||"Photo"}),e.jsx("div",{className:"text-gray-400",children:new Date(N.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),N.weight&&e.jsxs("div",{className:"text-gray-300 mt-1",children:[N.weight," lbs"]}),N.notes&&e.jsx("div",{className:"text-gray-400 mt-2 text-sm",children:N.notes}),N.isLocal&&e.jsxs("div",{className:"mt-2 text-amber-400 text-sm flex items-center justify-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),"Local only"]})]}),e.jsx("button",{onClick:()=>E(null),className:"absolute top-4 right-4 w-10 h-10 rounded-full glass flex items-center justify-center text-white",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})})]})}export{We as default};
