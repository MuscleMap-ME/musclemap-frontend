import{l as R,u as z,r,j as e,L as A}from"./react-vendor-D847gc3Q.js";import{c as P,G as I,N as J,aH as H,aN as W,aT as X,aR as Z,aL as q,Z as K,J as U,o as Q,aJ as V}from"./index-DXxw33y3.js";import{G as l}from"./GlassSurface-DZwHl8aR.js";import{L as m}from"./loader-circle-61W_4598.js";import{A as L}from"./arrow-left-D7Jg5X_q.js";import{R as Y}from"./refresh-cw-BXp7t2ED.js";import{B as $}from"./ban-CS1zb1wv.js";import{M as ee,G as j}from"./mail-Df4lY2Ll.js";import"./leaflet-vendor-DZbo3Ov0.js";import"./apollo-vendor-BNHFeEEc.js";import"./reactflow-vendor-5ig9bY2l.js";import"./d3-vendor-DkU_Wy0v.js";import"./recharts-vendor-d8oTApeF.js";const se=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],te=P("user-x",se);function ue(){const{userId:i}=R(),G=z(),{token:N}=I(),[E,b]=r.useState(!0),[y,v]=r.useState(null),[w,F]=r.useState(null),[c,o]=r.useState(null),[T,h]=r.useState(!1),[n,k]=r.useState(100),x=r.useCallback(()=>({Authorization:`Bearer ${N}`}),[N]),d=r.useCallback(async()=>{if(i)try{b(!0),v(null);const s=await fetch(`/api/admin/analytics/users/${i}`,{headers:x()});if(!s.ok)throw new Error("Failed to fetch user data");const a=await s.json();F(a.data||a)}catch(s){v(s instanceof Error?s.message:"Failed to load user data")}finally{b(!1)}},[i,x]);r.useEffect(()=>{d()},[d]);const _=async s=>{if(i){o(s);try{const a=await fetch(`/api/admin-control/users/${i}/${s}`,{method:"POST",headers:{...x(),"Content-Type":"application/json"}});if(a.ok)await d();else{const O=await a.json();alert(O.error?.message||`Failed to ${s} user`)}}catch{alert(`Failed to ${s} user`)}finally{o(null)}}},B=async()=>{if(!(!i||!n)){o("gift");try{const s=await fetch("/api/owner/gift-credits",{method:"POST",headers:{...x(),"Content-Type":"application/json"},body:JSON.stringify({targetUserId:i,amount:n,reason:"Admin gift from Empire Control"})});if(s.ok)h(!1),await d(),alert(`Successfully gifted ${n} credits!`);else{const a=await s.json();alert(a.error?.message||"Failed to gift credits")}}catch{alert("Failed to gift credits")}finally{o(null)}}},C=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),g=s=>s<1e3?`${s}ms`:s<6e4?`${(s/1e3).toFixed(1)}s`:`${(s/6e4).toFixed(1)}m`,D=s=>{const a=["text-gray-400","text-amber-700","text-gray-300","text-yellow-400","text-cyan-300","text-blue-300","text-purple-500"];return a[s]||a[0]},M=s=>["Broke","Bronze","Silver","Gold","Platinum","Diamond","Obsidian"][s]||"Unknown";if(E)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-950 to-gray-900 text-white flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(m,{className:"w-8 h-8 animate-spin text-violet-400"}),e.jsx("span",{className:"text-lg",children:"Loading user data..."})]})});if(y||!w)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-950 to-gray-900 text-white p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs(A,{to:"/empire",className:"inline-flex items-center gap-2 text-violet-400 hover:text-violet-300 mb-6",children:[e.jsx(L,{className:"w-4 h-4"}),"Back to Empire"]}),e.jsxs(l,{className:"p-8 text-center",children:[e.jsx(te,{className:"w-16 h-16 mx-auto text-red-400 mb-4"}),e.jsx("h2",{className:"text-xl font-bold mb-2",children:"User Not Found"}),e.jsx("p",{className:"text-gray-400",children:y||"Unable to load user data"})]})]})});const{user:t,activity_summary:p,top_features:u,recent_activity:f}=w,S=t.status==="banned";return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-950 to-gray-900 text-white p-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs(A,{to:"/empire",className:"inline-flex items-center gap-2 text-violet-400 hover:text-violet-300",children:[e.jsx(L,{className:"w-4 h-4"}),"Back to Empire"]}),e.jsxs("button",{onClick:d,className:"flex items-center gap-2 text-gray-400 hover:text-white",children:[e.jsx(Y,{className:"w-4 h-4"}),"Refresh"]})]}),e.jsx(l,{className:"p-6 mb-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-violet-500 to-fuchsia-500 flex items-center justify-center text-white text-3xl font-bold",children:t.avatar_url?e.jsx("img",{src:t.avatar_url,alt:t.username,className:"w-full h-full rounded-full object-cover"}):t.username?.charAt(0).toUpperCase()||"?"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[e.jsx("h1",{className:"text-2xl font-bold",children:t.display_name||t.username}),S&&e.jsxs("span",{className:"px-2 py-1 bg-red-500/20 text-red-400 text-xs rounded-full flex items-center gap-1",children:[e.jsx($,{className:"w-3 h-3"}),"Banned"]}),t.roles?.includes("admin")&&e.jsxs("span",{className:"px-2 py-1 bg-violet-500/20 text-violet-400 text-xs rounded-full flex items-center gap-1",children:[e.jsx(J,{className:"w-3 h-3"}),"Admin"]})]}),e.jsxs("p",{className:"text-gray-400",children:["@",t.username]}),e.jsxs("p",{className:"text-gray-500 text-sm flex items-center gap-2 mt-1",children:[e.jsx(ee,{className:"w-3 h-3"}),t.email]}),e.jsxs("p",{className:"text-gray-500 text-sm flex items-center gap-2",children:[e.jsx(H,{className:"w-3 h-3"}),"Joined ",C(t.created_at)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>h(!0),className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg transition-colors",children:[e.jsx(j,{className:"w-4 h-4"}),"Gift Credits"]}),e.jsxs("button",{onClick:()=>G(`/messages?user=${t.id}`),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors",children:[e.jsx(W,{className:"w-4 h-4"}),"Message"]}),S?e.jsxs("button",{onClick:()=>_("unban"),disabled:c==="unban",className:"flex items-center gap-2 px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg transition-colors",children:[c==="unban"?e.jsx(m,{className:"w-4 h-4 animate-spin"}):e.jsx(X,{className:"w-4 h-4"}),"Unban"]}):e.jsxs("button",{onClick:()=>_("ban"),disabled:c==="ban",className:"flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg transition-colors",children:[c==="ban"?e.jsx(m,{className:"w-4 h-4 animate-spin"}):e.jsx($,{className:"w-4 h-4"}),"Ban"]})]})]})}),e.jsxs("div",{className:"grid md:grid-cols-4 gap-4 mb-6",children:[e.jsx(l,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-violet-500/20 rounded-lg",children:e.jsx(Z,{className:"w-5 h-5 text-violet-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"Total XP"}),e.jsx("p",{className:"text-xl font-bold",children:(t.total_xp||0).toLocaleString()}),e.jsx("p",{className:"text-xs text-gray-500",children:t.current_rank||"Unranked"})]})]})}),e.jsx(l,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-green-500/20 rounded-lg",children:e.jsx(q,{className:"w-5 h-5 text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"Credits"}),e.jsx("p",{className:"text-xl font-bold",children:(t.credit_balance||0).toLocaleString()}),e.jsx("p",{className:`text-xs ${D(t.wealth_tier)}`,children:M(t.wealth_tier)})]})]})}),e.jsx(l,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-blue-500/20 rounded-lg",children:e.jsx(K,{className:"w-5 h-5 text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"Actions (7d)"}),e.jsx("p",{className:"text-xl font-bold",children:p?.total_actions_7d||0}),e.jsxs("p",{className:"text-xs text-gray-500",children:[p?.active_days_7d||0," active days"]})]})]})}),e.jsx(l,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-amber-500/20 rounded-lg",children:e.jsx(U,{className:"w-5 h-5 text-amber-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"Avg Session"}),e.jsx("p",{className:"text-xl font-bold",children:g(p?.avg_session_duration_ms||0)}),e.jsx("p",{className:"text-xs text-gray-500",children:"per session"})]})]})})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(l,{className:"p-4",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5 text-cyan-400"}),"Top Features Used"]}),u&&u.length>0?e.jsx("div",{className:"space-y-3",children:u.slice(0,8).map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-white/10 rounded-lg flex items-center justify-center text-sm font-bold",children:a+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.feature_id}),e.jsx("p",{className:"text-xs text-gray-400",children:s.feature_category})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-medium",children:s.action_count}),e.jsx("p",{className:"text-xs text-gray-400",children:g(s.total_duration_ms)})]})]},a))}):e.jsx("p",{className:"text-center text-gray-400 py-8",children:"No feature usage data"})]}),e.jsxs(l,{className:"p-4",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(U,{className:"w-5 h-5 text-violet-400"}),"Recent Activity"]}),f&&f.length>0?e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:f.slice(0,10).map(s=>e.jsxs("div",{className:"flex items-start gap-3 p-2 rounded-lg bg-white/5",children:[e.jsx("div",{className:"p-2 bg-white/10 rounded-lg",children:e.jsx(V,{className:"w-4 h-4 text-gray-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"font-medium text-sm truncate",children:[s.feature_id," - ",s.action]}),e.jsx("p",{className:"text-xs text-gray-400",children:s.feature_category}),e.jsxs("p",{className:"text-xs text-gray-500",children:[C(s.created_at)," (",g(s.duration_ms),")"]})]})]},s.id))}):e.jsx("p",{className:"text-center text-gray-400 py-8",children:"No recent activity"})]})]}),T&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs(l,{className:"p-6 max-w-md w-full",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx(j,{className:"w-5 h-5 text-green-400"}),"Gift Credits to ",t.username]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"Amount"}),e.jsx("input",{type:"number",value:n,onChange:s=>k(parseInt(s.target.value)||0),min:"1",className:"w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-lg",placeholder:"Enter amount"})]}),e.jsx("div",{className:"flex gap-3",children:[100,500,1e3,5e3].map(s=>e.jsx("button",{onClick:()=>k(s),className:`flex-1 py-2 rounded-lg transition-colors ${n===s?"bg-green-600 text-white":"bg-white/10 hover:bg-white/20"}`,children:s},s))}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>h(!1),className:"flex-1 px-4 py-3 bg-white/10 hover:bg-white/20 rounded-lg",children:"Cancel"}),e.jsx("button",{onClick:B,disabled:c==="gift"||n<1,className:"flex-1 px-4 py-3 bg-green-600 hover:bg-green-700 rounded-lg flex items-center justify-center gap-2 disabled:opacity-50",children:c==="gift"?e.jsx(m,{className:"w-5 h-5 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"w-5 h-5"}),"Gift ",n," Credits"]})})]})]})})]})})}export{ue as default};
