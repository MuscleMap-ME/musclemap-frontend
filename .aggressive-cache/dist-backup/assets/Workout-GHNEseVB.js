const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BI5UmSTE.js","assets/react-vendor-D1NxaRNd.js","assets/illustrations-CFkZtwGd.js","assets/index-C8OGbIE3.js","assets/leaflet-vendor-CIGW-MKW.css","assets/reactflow-vendor-B5DZHykP.css","assets/index-5BN-nJww.css"])))=>i.map(i=>d[i]);
import{e as pe,J as Ke,K as st,R as tt,N as at,O as rt,Q as lt,V as nt,Y as it,$ as ot,a0 as ct,a1 as dt,a2 as xt,a3 as ut,a4 as mt,j as Cs,q as ht,a5 as gt,D as Fe,P as Ne,m as J,E as We,A as ue,l as Ze,Z as Ms,a6 as Le,a7 as Es,X as be,a8 as Xe,a9 as Ts,h as ge,aa as Re,ab as ns,G as pt,ac as Ve,H as bt,_ as ft}from"./index-C8OGbIE3.js";import{r as t,j as e,a as yt,d as vt,L as jt}from"./react-vendor-D1NxaRNd.js";import{T as Rs}from"./TipCard-DzZNIOHJ.js";import{h as wt}from"./illustrations-CFkZtwGd.js";import{M as is}from"./MuscleViewer-DNFmFdlg.js";import{M as Nt}from"./MuscleActivationBadge-BtA9phb5.js";import"./GlassSurface-BMiMerMg.js";import"./GlassButton-DgbRAnXo.js";import{FloatingRestTimer as St}from"./FloatingRestTimer-BxMtHY8K.js";import{u as os,b as cs,c as xe,g as Is}from"./apollo-vendor-BMQ75Ycx.js";import{C as Oe}from"./circle-alert-ABXb5uCb.js";import{M as Ie}from"./minus-PClcgh1J.js";import{L as Se}from"./loader-circle-ByxdmXyb.js";import{A as ds}from"./award-yl_S7_RI.js";import{R as es}from"./refresh-cw-CyYDvQtB.js";import{I as ss}from"./info-BKXesCl2.js";import{C as Be}from"./chevron-down-Cusn_Y9U.js";import{T as _s}from"./timer-BrqlS8QT.js";import{C as Ps}from"./check-xHNFrnSn.js";import{C as As}from"./chevron-right-DPJo9cL3.js";import{T as $s}from"./trash-2-BxpKv-Af.js";import{R as Je}from"./rotate-ccw-Az9Lp6R0.js";import{C as kt}from"./copy-CHXwguZX.js";import{P as xs}from"./pause-CcroR9u1.js";import{V as Ct,a as Mt}from"./volume-x-EvxVL2XU.js";import{F as us}from"./flag-DBHsKtjz.js";import{T as Fs}from"./trending-down-DZ2ZkQJ6.js";import{P as Et}from"./pen-DfFM9gM3.js";import{C as Tt}from"./chevron-up-CL1XhNmc.js";import{S as Rt}from"./save-D4ACK0EX.js";import"./reactflow-vendor-Dz2P_-Qa.js";import"./d3-vendor-mcDw60ct.js";import"./recharts-vendor-BziRPEEi.js";import"./leaflet-vendor-DZbo3Ov0.js";import"./use-drag-controls-CI_v_3DU.js";import"./minimize-2-DPN4AtDA.js";import"./skip-forward-D3ZR8VgH.js";const It=[["path",{d:"M22 14v-4",key:"14q9d5"}],["path",{d:"M6 14v-4",key:"14a6bd"}],["rect",{x:"2",y:"6",width:"16",height:"12",rx:"2",key:"13zb55"}]],_t=pe("battery-low",It);const Pt=[["path",{d:"M10 14v-4",key:"suye4c"}],["path",{d:"M22 14v-4",key:"14q9d5"}],["path",{d:"M6 14v-4",key:"14a6bd"}],["rect",{x:"2",y:"6",width:"16",height:"12",rx:"2",key:"13zb55"}]],At=pe("battery-medium",Pt);const $t=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]],Ft=pe("chart-line",$t);const Wt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M16 16s-1.5-2-4-2-4 2-4 2",key:"epbg0q"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]],Lt=pe("frown",Wt);const Ot=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"8",x2:"16",y1:"15",y2:"15",key:"1xb1d9"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]],Dt=pe("meh",Ot);const Bt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]],ms=pe("smile",Bt);const Ut=[["path",{d:"M21 9a2.4 2.4 0 0 0-.706-1.706l-3.588-3.588A2.4 2.4 0 0 0 15 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2z",key:"1dfntj"}],["path",{d:"M15 3v5a1 1 0 0 0 1 1h5",key:"6s6qgf"}]],hs=pe("sticky-note",Ut);const Gt=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],qt=pe("tag",Gt),Vt="musclemap-sessions",zt=1,De="active_session";let _e=null;function Ht(){return _e||(_e=new Promise((a,n)=>{const i=indexedDB.open(Vt,zt);i.onerror=()=>{n(i.error)},i.onsuccess=()=>{a(i.result)},i.onupgradeneeded=m=>{const j=m.target.result;j.objectStoreNames.contains(De)||j.createObjectStore(De,{keyPath:"id"})}}),_e)}async function Yt(){try{const i=(await Ht()).transaction(De,"readwrite").objectStore(De);await new Promise((m,j)=>{const d=i.delete("current");d.onsuccess=()=>m(),d.onerror=()=>j(d.error)})}catch{}}let ie=null;const Qt=5e3,Kt=3e4;let ze=0;async function Jt(a,n=!1){if(!localStorage.getItem("token"))return;const m=Date.now();if(n||m-ze>Kt){ie&&(clearTimeout(ie),ie=null);try{await Ke.post("/sessions",gs(a)),ze=m}catch{}return}ie&&clearTimeout(ie),ie=setTimeout(async()=>{try{await Ke.post("/sessions",gs(a)),ze=Date.now()}catch{}ie=null},Qt)}async function Zt(a,n){if(localStorage.getItem("token"))try{await Ke.delete("/sessions/active",{data:{reason:a,workoutId:n}})}catch{}}function gs(a){return{sessionId:a.sessionId,startedAt:a.startTime,pausedAt:a.pausedAt,totalPausedTime:a.totalPausedTime,workoutPlan:a.workoutPlan||{exercises:a.exercises},currentExerciseIndex:a.currentExerciseIndex,currentSetIndex:a.currentSetIndex,sets:a.sets,totalVolume:a.totalVolume,totalReps:a.totalReps,estimatedCalories:a.estimatedCalories,musclesWorked:a.musclesWorked,sessionPRs:a.sessionPRs,restTimer:a.restTimer,exerciseGroups:a.exerciseGroups,activeGroup:a.activeGroup,activeGroupExerciseIndex:a.activeGroupExerciseIndex,activeGroupRound:a.activeGroupRound,groupSets:a.groupSets,clientVersion:a.clientVersion}}async function ps(a="completed",n){ie&&(clearTimeout(ie),ie=null),await Yt(),await Zt(a,n)}function Ue(){const a=t.useRef(null),n=t.useRef(null),i=t.useRef(null),{data:m,loading:j,refetch:d,error:P}=os(st,{fetchPolicy:"network-only",notifyOnNetworkStatusChange:!0,errorPolicy:"all"}),{data:C,loading:M,refetch:b}=os(tt,{fetchPolicy:"network-only",errorPolicy:"all"}),[E,{data:w,loading:g}]=cs(at,{errorPolicy:"all"}),[k,{loading:T}]=cs(rt,{errorPolicy:"all"}),[l,{loading:u}]=xe(lt),[c,{loading:N}]=xe(nt),[$,{loading:G}]=xe(it),[f,{loading:F}]=xe(ot),[x,{loading:p}]=xe(ct),[O,{loading:Y}]=xe(dt),[U,{loading:D}]=xe(xt),[Z,{loading:Q}]=xe(ut),[q,{loading:V}]=xe(mt),y=t.useMemo(()=>m?.activeWorkoutSession||null,[m]),o=t.useMemo(()=>(C?.recoverableSessions||[]).map(I=>({...I,exerciseCount:I.musclesWorked?.length||0,setCount:I.setsLogged,lastActivityAt:I.archivedAt})),[C]),_=t.useMemo(()=>{const R={};if(w?.exerciseHistory)for(const I of w.exerciseHistory)R[I.exerciseId]=I;return R},[w]),z=!!y,se=!!y?.pausedAt,le=t.useCallback(async(R,I)=>{try{const{data:W,errors:ee}=await l({variables:{input:R?{workoutPlan:R,clientId:I}:void 0}});return ee?.length?{success:!1,error:ee[0]?.message||"Failed to start session"}:W?.startWorkoutSession?.session?(await d(),{success:!0,sessionId:W.startWorkoutSession.session.id}):{success:!1,error:"Failed to start session"}}catch(W){return{success:!1,error:W instanceof Error?W.message:"Unknown error"}}},[l,d]),me=t.useCallback(async R=>{try{const{data:I,errors:W}=await c({variables:{input:R}});if(W?.length)return{success:!1,error:W[0]?.message||"Failed to log set"};if(I?.logSet){const ee=I.logSet,ae=ee.prsAchieved||[];for(const Ge of ae)a.current&&a.current(Ge);return await d(),{success:!0,set:ee.setLogged,prs:ae}}return{success:!1,error:"Failed to log set"}}catch(I){return{success:!1,error:I instanceof Error?I.message:"Unknown error"}}},[c,d]),ne=t.useCallback(async(R,I)=>{try{const{data:W,errors:ee}=await $({variables:{input:{setId:R,...I}}});return ee?.length?{success:!1,error:ee[0]?.message||"Failed to update set"}:W?.updateSet?(await d(),{success:!0,set:W.updateSet}):{success:!1,error:"Failed to update set"}}catch(W){return{success:!1,error:W instanceof Error?W.message:"Unknown error"}}},[$,d]),K=t.useCallback(async R=>{try{const{data:I,errors:W}=await f({variables:{setId:R}});return W?.length?{success:!1,error:W[0]?.message||"Failed to delete set"}:I?.deleteSet!==void 0?(await d(),{success:!0}):{success:!1,error:"Failed to delete set"}}catch(I){return{success:!1,error:I instanceof Error?I.message:"Unknown error"}}},[f,d]),oe=t.useCallback(async()=>{if(!y)return{success:!1,error:"No active session"};try{const{data:R,errors:I}=await x({variables:{sessionId:y.id}});return I?.length?{success:!1,error:I[0]?.message||"Failed to pause session"}:R?.pauseWorkoutSession?(await d(),{success:!0}):{success:!1,error:"Failed to pause session"}}catch(R){return{success:!1,error:R instanceof Error?R.message:"Unknown error"}}},[y,x,d]),ce=t.useCallback(async()=>{if(!y)return{success:!1,error:"No active session"};try{const{data:R,errors:I}=await O({variables:{sessionId:y.id}});return I?.length?{success:!1,error:I[0]?.message||"Failed to resume session"}:R?.resumeWorkoutSession?(await d(),{success:!0}):{success:!1,error:"Failed to resume session"}}catch(R){return{success:!1,error:R instanceof Error?R.message:"Unknown error"}}},[y,O,d]),te=t.useCallback(async(R,I)=>{if(!y)return{success:!1,error:"No active session"};try{const{data:W,errors:ee}=await U({variables:{input:{sessionId:y.id,notes:R,isPublic:I}}});if(ee?.length)return{success:!1,error:ee[0]?.message||"Failed to complete session"};const ae=W?.completeWorkoutSession;return ae?(ae.levelUp&&n.current&&n.current(Math.floor(ae.xpEarned/1e3)+1),i.current&&i.current(ae),await d(),{success:!0,result:ae}):{success:!1,error:"Failed to complete session"}}catch(W){return{success:!1,error:W instanceof Error?W.message:"Unknown error"}}},[y,U,d]),S=t.useCallback(async R=>{if(!y)return{success:!1,error:"No active session"};try{const{data:I,errors:W}=await Z({variables:{sessionId:y.id,reason:R}});return W?.length?{success:!1,error:W[0]?.message||"Failed to abandon session"}:I?.abandonWorkoutSession!==void 0?(await d(),{success:!0}):{success:!1,error:"Failed to abandon session"}}catch(I){return{success:!1,error:I instanceof Error?I.message:"Unknown error"}}},[y,Z,d]),B=t.useCallback(async R=>{try{const{data:I,errors:W}=await q({variables:{archivedSessionId:R}});return W?.length?{success:!1,error:W[0]?.message||"Failed to recover session"}:I?.recoverWorkoutSession?(await d(),await b(),{success:!0,session:I.recoverWorkoutSession}):{success:!1,error:"Failed to recover session"}}catch(I){return{success:!1,error:I instanceof Error?I.message:"Unknown error"}}},[q,d,b]),X=t.useCallback(async R=>{R.length!==0&&await E({variables:{exerciseIds:R}})},[E]),fe=t.useCallback(async(R,I,W)=>{try{const{data:ee}=await k({variables:{exerciseId:R,equipment:I,maxResults:W||5}});return ee?.exerciseSubstitutions||[]}catch{return[]}},[k]),ye=t.useCallback(R=>{R.onPRAchieved&&(a.current=R.onPRAchieved),R.onLevelUp&&(n.current=R.onLevelUp),R.onWorkoutComplete&&(i.current=R.onWorkoutComplete)},[]),je=t.useMemo(()=>{if(!y)return 0;const R=new Date(y.startedAt).getTime(),W=Date.now()-R;return Math.floor((W-y.totalPausedTime*1e3)/1e3)},[y]),ke=t.useMemo(()=>{if(!y?.sets||y.sets.length===0)return[];const R=y.sets[y.sets.length-1];return R?y.sets.filter(I=>I.exerciseId===R.exerciseId):[]},[y]),Ce=t.useCallback(R=>y?.sets?y.sets.filter(I=>I.exerciseId===R):[],[y]),Me=y?.sets?.length||0;return{activeSession:y,isSessionActive:z,isPaused:se,recoverableSessions:o,exerciseHistory:_,sessionDuration:je,currentExerciseSets:ke,getSetsForExercise:Ce,totalSets:Me,errors:{activeSession:P},loading:{activeSession:j,recoverableSessions:M,exerciseHistory:g,substitutions:T,startingSession:u,loggingSet:N,updatingSet:G,deletingSet:F,pausingSession:p,resumingSession:Y,completingSession:D,abandoningSession:Q,recoveringSession:V},startSession:le,logSet:me,updateSet:ne,deleteSet:K,pauseSession:oe,resumeSession:ce,completeSession:te,abandonSession:S,recoverSession:B,loadExerciseHistory:X,findSubstitutes:fe,registerCallbacks:ye,refetchActiveSession:d,refetchRecoverableSessions:b}}function Xt({exerciseId:a,delay:n=2e3}){const[i,m]=t.useState(null),[j,d]=t.useState(!1),[P,C]=t.useState(!1);return t.useEffect(()=>{if(!a)return;m(null),d(!1),C(!1),(async()=>{try{const b=await Cs(`/tips/exercise/${a}`);b?.data&&(m(b.data),setTimeout(()=>d(!0),n))}catch{}})()},[a,n]),!i||!j||P?null:e.jsx("div",{className:"animate-fadeIn",children:e.jsx(Rs,{tip:i,onDismiss:()=>C(!0),compact:!0})})}const ea={first_workout:"ðŸŽ‰",workouts_10:"ðŸ”¥",workouts_50:"âš¡",workouts_100:"ðŸ†",streak_7:"ðŸ“…",streak_30:"ðŸ—“ï¸",exercises_100:"ðŸ’¯",reps_1000:"ðŸŽ¯",reps_10000:"ðŸš€",hours_10:"â±ï¸"};function sa({milestone:a,onContinue:n}){if(!a)return null;const i=ea[a.id]||"ðŸ…";return e.jsxs("div",{className:"bg-gradient-to-b from-yellow-500/20 via-amber-500/10 to-transparent rounded-2xl p-6 border border-yellow-500/30 text-center",children:[e.jsxs("div",{className:"relative inline-block mb-4",children:[e.jsx("div",{className:"text-6xl animate-bounce",children:i}),e.jsx("div",{className:"absolute -top-2 -right-2 w-8 h-8 bg-yellow-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-black",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]}),e.jsx("h3",{className:"text-xl font-bold text-yellow-400 mb-1",children:"Milestone Achieved!"}),e.jsx("p",{className:"text-2xl font-bold text-white mb-2",children:a.name}),a.description&&e.jsx("p",{className:"text-gray-300 text-sm mb-4",children:a.description}),n&&e.jsx("button",{onClick:n,className:"mt-4 px-6 py-2 bg-yellow-500 hover:bg-yellow-400 text-black font-medium rounded-lg transition-colors",children:"Awesome!"})]})}function ta({workout:a,onClose:n}){const[i,m]=t.useState(null),[j,d]=t.useState(null),[P,C]=t.useState(!0),[M,b]=t.useState(!0);t.useEffect(()=>{(async()=>{try{const g=await Cs("/tips/completion",{method:"POST",body:{goals:a?.goals||[]}});m(g?.data?.tip),d(g?.data?.milestone)}catch{}finally{C(!1)}})()},[a?.goals]);const E=[{icon:"â±ï¸",value:a?.duration||"-",label:"minutes",color:"text-blue-400"},{icon:"ðŸ‹ï¸",value:a?.exerciseCount||a?.exercises?.length||"-",label:"exercises",color:"text-yellow-400"},{icon:"ðŸ”¥",value:a?.totalSets||"-",label:"sets",color:"text-orange-400"},{icon:"ðŸ’ª",value:a?.totalTU?Math.round(a.totalTU):"-",label:"TU earned",color:"text-purple-400"}];return e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-gray-900 rounded-2xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"relative pt-8 pb-4 px-6 text-center overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute top-0 left-1/4 w-2 h-2 bg-yellow-400 rounded-full animate-ping",style:{animationDelay:"0s"}}),e.jsx("div",{className:"absolute top-4 right-1/4 w-2 h-2 bg-purple-400 rounded-full animate-ping",style:{animationDelay:"0.2s"}}),e.jsx("div",{className:"absolute top-2 left-1/2 w-2 h-2 bg-pink-400 rounded-full animate-ping",style:{animationDelay:"0.4s"}})]}),e.jsx("div",{className:"text-6xl mb-3",children:"ðŸŽ‰"}),e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Workout Complete!"}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Great job staying consistent"})]}),e.jsx("div",{className:"px-6 pb-4",children:e.jsx("div",{className:"grid grid-cols-4 gap-2",children:E.map((w,g)=>e.jsxs("div",{className:"bg-gray-800 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-lg mb-1",children:w.icon}),e.jsx("div",{className:`text-lg font-bold ${w.color}`,children:w.value}),e.jsx("div",{className:"text-xs text-gray-500",children:w.label})]},g))})}),j&&M&&e.jsx("div",{className:"px-6 pb-4",children:e.jsx(sa,{milestone:j,onContinue:()=>b(!1)})}),!P&&i&&(!j||!M)&&e.jsx("div",{className:"px-6 pb-4",children:e.jsx(Rs,{tip:i})}),P&&e.jsx("div",{className:"px-6 pb-4",children:e.jsx("div",{className:"bg-gray-800 rounded-xl p-4 animate-pulse",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-700 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-gray-700 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-700 rounded w-1/2"})]})]})})}),e.jsx("div",{className:"px-6 pb-6",children:e.jsx("button",{onClick:n,className:"w-full py-3 bg-purple-600 hover:bg-purple-500 text-white font-medium rounded-xl transition-colors",children:"Done"})})]})})}function aa({content:a,children:n}){const[i,m]=yt.useState(!1);return e.jsxs("div",{className:"relative inline-block",onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),onTouchStart:()=>m(!0),onTouchEnd:()=>setTimeout(()=>m(!1),2e3),children:[n,e.jsx(ue,{children:i&&e.jsxs(J.div,{initial:{opacity:0,y:4,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:4,scale:.95},transition:{duration:.15},className:"absolute z-50 bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-2 text-xs text-gray-200 bg-gray-900 border border-gray-700 rounded-lg shadow-xl whitespace-nowrap max-w-[200px] text-center",style:{whiteSpace:"normal"},children:[a,e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-gray-900"})]})})]})}const ra={warmup:{label:"Warmup",color:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30",icon:Es,tooltip:"Light weight to prepare muscles and joints before working sets"},working:{label:"Working",color:"bg-blue-500/20 text-blue-400 border-blue-500/30",icon:Le,tooltip:"Main sets at your target weight for building strength/muscle"},failure:{label:"Failure",color:"bg-red-500/20 text-red-400 border-red-500/30",icon:Ms,tooltip:"Pushed until you cannot complete another rep with good form"},drop:{label:"Drop",color:"bg-purple-500/20 text-purple-400 border-purple-500/30",icon:Be,tooltip:"Reduced weight immediately after a set with no rest"},amrap:{label:"AMRAP",color:"bg-orange-500/20 text-orange-400 border-orange-500/30",icon:Ze,tooltip:"As Many Reps As Possible - max effort set"}},la=[{value:0,label:"0 RIR",description:"Total failure"},{value:1,label:"1 RIR",description:"Could do 1 more"},{value:2,label:"2 RIR",description:"Could do 2 more"},{value:3,label:"3 RIR",description:"Could do 3 more"},{value:4,label:"4+ RIR",description:"Easy"}];function na({exerciseId:a,exerciseName:n,suggestedSets:i=3,suggestedReps:m=10,onSetLogged:j,onAllSetsComplete:d,onStartSession:P,compact:C=!1}){const{error:M}=ht(),b=gt(),[E,w]=t.useState(""),[g,k]=t.useState(m.toString()),[T,l]=t.useState("working"),[u,c]=t.useState(null),[N,$]=t.useState(null),[G,f]=t.useState(""),[F,x]=t.useState(!1),[p,O]=t.useState(null),[Y,U]=t.useState([]),{logSet:D,loadExerciseHistory:Z,exerciseHistory:Q,getSetsForExercise:q,activeSession:V,loading:y}=Ue(),o=y.loggingSet;t.useEffect(()=>{Z([a])},[a,Z]);const _=Q[a],z=q(a),se=z.length+1,le=t.useMemo(()=>_?.bestWeight?Math.round(_.bestWeight*.85/5)*5:null,[_]);t.useEffect(()=>{le&&!E&&w(le.toString())},[le,E]);const me=t.useCallback(async()=>{const S=parseFloat(E),B=parseInt(g);if(isNaN(S)||S<0){M("Please enter a valid weight (0 or greater)");return}if(!B||B<=0){M("Please enter reps greater than 0");return}if(!V){M("No active workout session. Please start a new workout from the beginning.");return}const X=await D({sessionId:V.id,exerciseId:a,setNumber:se,reps:B,weightKg:S/2.205,rpe:u||void 0,rir:N||void 0,tag:T||void 0,notes:G.trim()||void 0});if(X?.set){if(U(X.set.muscleActivations||[]),X.set.isPRWeight||X.set.isPR1RM||X.set.isPRReps){const fe=X.set.isPR1RM?"1rm":X.set.isPRWeight?"weight":"reps";O({type:fe,value:Math.round(fe==="1rm"?X.set.weightKg*2.205/(1.0278-.0278*B):X.set.weightKg*2.205)}),setTimeout(()=>O(null),4e3)}k(m.toString()),c(null),$(null),f(""),j?.(X.set),se>=i&&d?.()}},[E,g,T,u,N,G,a,V,D,m,i,se,j,d,M]),ne=S=>{const B=parseFloat(E)||0;w(Math.max(0,B+S).toString())},K=S=>{const B=parseFloat(S);S===""||S==="-"?w(""):isNaN(B)||w(Math.max(0,B).toString())},oe=S=>{const B=parseInt(g)||0;k(Math.max(0,B+S).toString())},ce=t.useMemo(()=>{const S=parseFloat(E),B=parseInt(g);return S>0&&B>0&&B<=15?Math.round(S/(1.0278-.0278*B)):null},[E,g]),te=ce&&_?.best1RM&&ce>_.best1RM;return V?C?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs text-gray-400 mb-1 block",children:"Weight (lbs)"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>ne(-5),className:"p-1.5 rounded bg-gray-800 hover:bg-gray-700 text-gray-400",children:e.jsx(Ie,{className:"w-4 h-4"})}),e.jsx("input",{type:"number",min:"0",value:E,onChange:S=>K(S.target.value),placeholder:"0",className:"flex-1 bg-gray-800/50 border border-gray-700 rounded px-2 py-2 text-center text-lg font-bold focus:border-blue-500 focus:outline-none w-20"}),e.jsx("button",{onClick:()=>ne(5),className:"p-1.5 rounded bg-gray-800 hover:bg-gray-700 text-gray-400",children:e.jsx(Ne,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs text-gray-400 mb-1 block",children:"Reps"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>oe(-1),className:"p-1.5 rounded bg-gray-800 hover:bg-gray-700 text-gray-400",children:e.jsx(Ie,{className:"w-4 h-4"})}),e.jsx("input",{type:"number",value:g,onChange:S=>k(S.target.value),placeholder:"0",className:"flex-1 bg-gray-800/50 border border-gray-700 rounded px-2 py-2 text-center text-lg font-bold focus:border-blue-500 focus:outline-none w-16"}),e.jsx("button",{onClick:()=>oe(1),className:"p-1.5 rounded bg-gray-800 hover:bg-gray-700 text-gray-400",children:e.jsx(Ne,{className:"w-4 h-4"})})]})]})]}),e.jsx(J.button,{whileTap:{scale:.98},onClick:me,disabled:!E||!g||o,className:`w-full py-3 rounded-xl font-bold text-base transition-all flex items-center justify-center gap-2 ${E&&g&&!o?"bg-gradient-to-r from-green-600 to-green-500 hover:from-green-500 hover:to-green-400 text-white":"bg-gray-800 text-gray-500 cursor-not-allowed"}`,children:o?e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"w-4 h-4 animate-spin"}),"Logging..."]}):e.jsxs(e.Fragment,{children:[e.jsx(We,{className:"w-4 h-4"}),"Log Set ",se,"/",i]})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(ue,{children:p&&e.jsxs(J.div,{initial:{opacity:0,y:-20,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-20,scale:.9},className:"bg-gradient-to-r from-yellow-500/20 to-orange-500/20 border border-yellow-500/30 rounded-lg p-4 flex items-center gap-3",children:[e.jsx(ds,{className:"w-8 h-8 text-yellow-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-yellow-400",children:"NEW PR!"}),e.jsxs("p",{className:"text-sm text-gray-300",children:[p.type==="1rm"&&`Estimated 1RM: ${p.value} lbs`,p.type==="weight"&&`Max weight: ${p.value} lbs`,p.type==="volume"&&`Set volume: ${p.value} lbs`]})]})]})}),_&&e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-3 flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[e.jsx(es,{className:"w-4 h-4"}),e.jsxs("span",{children:["Last: ",_.totalSessions," sessions"]})]}),e.jsxs("div",{className:"flex gap-4",children:[_.bestWeight&&e.jsxs("span",{className:"text-blue-400",children:["Best: ",Math.round(_.bestWeight*2.205)," lbs"]}),_.best1RM&&e.jsxs("span",{className:"text-purple-400",children:["1RM: ",Math.round(_.best1RM*2.205)," lbs"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Set Progress:"}),e.jsx("div",{className:"flex gap-1",children:Array.from({length:i}).map((S,B)=>e.jsx("div",{className:`w-8 h-2 rounded-full transition-colors ${B<z.length?"bg-green-500":B===z.length?"bg-blue-500 animate-pulse":"bg-gray-700"}`},B))}),e.jsxs("span",{className:"text-sm font-medium",children:[z.length,"/",i]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(ss,{className:"w-3 h-3"}),e.jsx("span",{children:"Tap and hold for info"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(ra).map(([S,B])=>{const X=B.icon;return e.jsx(aa,{content:B.tooltip,children:e.jsxs("button",{onClick:()=>l(S),className:`px-3 py-1.5 rounded-full text-sm font-medium border transition-all flex items-center gap-1.5 ${T===S?B.color:"bg-gray-800/50 text-gray-400 border-gray-700 hover:border-gray-600"}`,children:[e.jsx(X,{className:"w-4 h-4"}),B.label]})},S)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Weight (lbs)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>ne(-5),className:"p-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-gray-400",children:e.jsx(Ie,{className:"w-5 h-5"})}),e.jsx("input",{type:"number",min:"0",value:E,onChange:S=>K(S.target.value),placeholder:"0",className:"flex-1 bg-gray-800/50 border border-gray-700 rounded-lg px-4 py-3 text-center text-2xl font-bold focus:border-blue-500 focus:outline-none"}),e.jsx("button",{onClick:()=>ne(5),className:"p-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-gray-400",children:e.jsx(Ne,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Reps"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>oe(-1),className:"p-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-gray-400",children:e.jsx(Ie,{className:"w-5 h-5"})}),e.jsx("input",{type:"number",value:g,onChange:S=>k(S.target.value),placeholder:"0",className:"flex-1 bg-gray-800/50 border border-gray-700 rounded-lg px-4 py-3 text-center text-2xl font-bold focus:border-blue-500 focus:outline-none"}),e.jsx("button",{onClick:()=>oe(1),className:"p-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-gray-400",children:e.jsx(Ne,{className:"w-5 h-5"})})]})]}),ce&&e.jsxs("div",{className:`p-3 rounded-lg border ${te?"bg-yellow-500/10 border-yellow-500/30":"bg-gray-800/50 border-gray-700"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Estimated 1RM"}),e.jsxs("span",{className:`font-bold ${te?"text-yellow-400":"text-white"}`,children:[ce," lbs",te&&e.jsx("span",{className:"ml-2 text-xs",children:"NEW PR!"})]})]}),_?.best1RM&&e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Previous Best"}),e.jsxs("span",{className:"text-xs text-gray-400",children:[Math.round(_.best1RM*2.205)," lbs"]})]})]}),Y.length>0&&e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-2",children:"Last Set - Muscle Activation"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:Y.map(S=>e.jsxs("span",{className:"bg-purple-500/30 text-purple-200 px-2 py-0.5 rounded text-xs",children:[S.muscleName," (",Math.round(S.activation*100),"%)"]},S.muscleId))})]}),e.jsxs("button",{onClick:()=>x(!F),className:"w-full py-2 text-sm text-gray-400 hover:text-gray-300 flex items-center justify-center gap-2",children:[e.jsxs("span",{children:[F?"Hide":"Show"," Advanced Options"]}),e.jsx(Be,{className:`w-4 h-4 transition-transform ${F?"rotate-180":""}`})]}),e.jsx(ue,{children:F&&e.jsxs(J.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"space-y-4 overflow-hidden",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"RPE (1-10)"}),e.jsx("span",{className:"text-sm font-medium",children:u||"-"})]}),e.jsx("input",{type:"range",min:"1",max:"10",value:u||5,onChange:S=>c(parseInt(S.target.value)),className:"w-full accent-blue-500"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsx("span",{children:"Easy"}),e.jsx("span",{children:"Max Effort"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Reps in Reserve"}),e.jsx("div",{className:"flex gap-2",children:la.map(S=>e.jsx("button",{onClick:()=>$(N===S.value?null:S.value),className:`flex-1 py-2 px-2 rounded-lg text-xs font-medium border transition-all ${N===S.value?"bg-blue-500/20 text-blue-400 border-blue-500/30":"bg-gray-800/50 text-gray-400 border-gray-700 hover:border-gray-600"}`,children:S.label},S.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Notes"}),e.jsx("input",{type:"text",value:G,onChange:S=>f(S.target.value),placeholder:"Optional notes...",className:"w-full bg-gray-800/50 border border-gray-700 rounded-lg px-4 py-2 text-sm focus:border-blue-500 focus:outline-none"})]})]})}),z.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm text-gray-400",children:"Logged Sets"}),e.jsx("div",{className:"space-y-1",children:z.map((S,B)=>e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-2 flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-400",children:["Set ",B+1]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"font-medium",children:[Math.round((S.weightKg||0)*2.205)," lbs x ",S.reps]}),e.jsxs("span",{className:"text-purple-400",children:[S.tu," TU"]}),S.isPRWeight&&e.jsx(ds,{className:"w-4 h-4 text-yellow-400"})]})]},S.id))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-400 flex items-center gap-1.5",children:[e.jsx(_s,{className:"w-4 h-4"}),"Rest Timer"]}),b.isActive&&e.jsx("button",{onClick:b.stop,className:"text-xs text-red-400 hover:text-red-300",children:"Stop"})]}),e.jsx(ue,{children:b.isActive&&e.jsx(J.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"overflow-hidden",children:e.jsxs("div",{className:`p-4 rounded-xl border ${b.time<=10?"bg-red-500/10 border-red-500/30":b.time<=30?"bg-yellow-500/10 border-yellow-500/30":"bg-gray-800/50 border-gray-700"}`,children:[e.jsx("div",{className:"h-1.5 bg-gray-700 rounded-full overflow-hidden mb-3",children:e.jsx(J.div,{className:`h-full ${b.time<=10?"bg-red-500":b.time<=30?"bg-yellow-500":"bg-blue-500"}`,initial:{width:"0%"},animate:{width:`${b.progress}%`},transition:{duration:.3}})}),e.jsx("div",{className:"text-center mb-3",children:e.jsx("span",{className:`text-3xl font-mono font-bold ${b.time<=10?"text-red-400":b.time<=30?"text-yellow-400":"text-white"}`,children:b.formatted})}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:()=>b.adjust(-30),className:"px-3 py-1.5 rounded-lg bg-gray-700 hover:bg-gray-600 text-gray-300 text-sm font-medium",children:"-30s"}),e.jsx("button",{onClick:()=>b.adjust(30),className:"px-3 py-1.5 rounded-lg bg-blue-500/20 hover:bg-blue-500/30 text-blue-400 text-sm font-medium",children:"+30s"})]})]})})}),!b.isActive&&e.jsx("div",{className:"flex flex-wrap gap-2",children:b.presets.slice(0,4).map(S=>e.jsxs("button",{onClick:()=>b.start(S.seconds),className:"flex-1 min-w-[60px] py-2 px-3 rounded-lg bg-gray-800/50 hover:bg-gray-700/50 border border-gray-700 hover:border-gray-600 text-gray-300 text-sm font-medium flex items-center justify-center gap-1.5 transition-all",children:[e.jsx(Fe,{className:"w-3 h-3"}),S.label]},S.seconds))})]}),e.jsx(J.button,{whileTap:{scale:.98},onClick:me,disabled:!E||!g||o,className:`w-full py-4 rounded-xl font-bold text-lg transition-all flex items-center justify-center gap-2 ${E&&g&&!o?"bg-gradient-to-r from-green-600 to-green-500 hover:from-green-500 hover:to-green-400 text-white":"bg-gray-800 text-gray-500 cursor-not-allowed"}`,children:o?e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"w-5 h-5 animate-spin"}),"Logging Set..."]}):e.jsxs(e.Fragment,{children:[e.jsx(We,{className:"w-5 h-5"}),"Log Set ",se]})})]}):e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(Oe,{className:"w-5 h-5 text-yellow-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-yellow-200 font-medium",children:"No Active Session"}),e.jsx("p",{className:"text-xs text-yellow-400/80 mt-1",children:'Please start a new workout to log your sets. Use the "Generate Workout" button or go back and start fresh.'}),P&&e.jsxs("button",{onClick:P,className:"mt-3 flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded-lg transition-colors",children:[e.jsx(Fe,{className:"w-4 h-4"}),"Start Session Now"]})]})]})})}function ia({exerciseId:a,exerciseName:n,availableEquipment:i,onSelect:m,onCancel:j}){const[d,P]=t.useState([]),[C,M]=t.useState(!0),[b,E]=t.useState(null),[w,g]=t.useState(null),{findSubstitutes:k}=Ue();t.useEffect(()=>{(async()=>{M(!0),E(null);const N=await k(a,i,8);N&&N.length>0?P(N):E("No alternative exercises found for your equipment."),M(!1)})()},[a,i,k]);const T=t.useCallback(c=>{g(c.exercise.id),setTimeout(()=>{m(c.exercise)},200)},[m]),l=c=>c>=.8?"text-green-400":c>=.6?"text-yellow-400":"text-orange-400",u=c=>c>=.8?"Excellent match":c>=.6?"Good match":"Partial match";return e.jsx(J.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-end sm:items-center justify-center",onClick:j,children:e.jsxs(J.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},exit:{y:100,opacity:0},onClick:c=>c.stopPropagation(),className:"bg-gray-900 rounded-t-3xl sm:rounded-3xl w-full max-w-lg max-h-[85vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-gray-800 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold",children:"Swap Exercise"}),e.jsxs("p",{className:"text-sm text-gray-400",children:["Find alternatives for ",n]})]}),e.jsx("button",{onClick:j,className:"p-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-gray-400",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:C?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(Se,{className:"w-8 h-8 text-blue-400 animate-spin mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Finding similar exercises..."})]}):b?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(Oe,{className:"w-8 h-8 text-orange-400 mb-4"}),e.jsx("p",{className:"text-gray-400 text-center",children:b}),e.jsx("button",{onClick:j,className:"mt-4 px-4 py-2 bg-gray-800 hover:bg-gray-700 rounded-lg text-sm",children:"Keep Current Exercise"})]}):e.jsx("div",{className:"space-y-3",children:d.map(c=>e.jsx(J.button,{whileTap:{scale:.98},onClick:()=>T(c),className:`w-full text-left p-4 rounded-xl border transition-all ${w===c.exercise.id?"bg-green-500/20 border-green-500/50":"bg-gray-800/50 border-gray-700 hover:border-gray-600"}`,children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(We,{className:"w-4 h-4 text-blue-400"}),e.jsx("span",{className:"font-medium",children:c.exercise.name})]}),c.exercise.equipment&&c.exercise.equipment.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:c.exercise.equipment.slice(0,3).map(N=>e.jsx("span",{className:"text-xs bg-gray-700/50 text-gray-300 px-2 py-0.5 rounded",children:N},N))}),c.matchedMuscles&&c.matchedMuscles.length>0&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-400 mb-1",children:[e.jsx(Le,{className:"w-3 h-3"}),e.jsxs("span",{children:["Targets: ",c.matchedMuscles.join(", ")]})]}),c.missingMuscles&&c.missingMuscles.length>0&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-orange-400",children:[e.jsx(Oe,{className:"w-3 h-3"}),e.jsxs("span",{children:["Missing: ",c.missingMuscles.join(", ")]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsxs("div",{className:`text-sm font-medium ${l(c.similarityScore)}`,children:[Math.round(c.similarityScore*100),"%"]}),e.jsx("div",{className:"text-xs text-gray-500",children:u(c.similarityScore)}),w===c.exercise.id?e.jsx(Ps,{className:"w-5 h-5 text-green-400 mt-2"}):e.jsx(As,{className:"w-5 h-5 text-gray-600 mt-2"})]})]})},c.exercise.id))})}),!C&&!b&&e.jsx("div",{className:"p-4 border-t border-gray-800",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(es,{className:"w-3 h-3"}),e.jsx("span",{children:"Alternatives sorted by muscle similarity"})]})})]})})}function oa({sessions:a,onRecover:n,onDiscard:i,onDismiss:m}){const[j,d]=t.useState(null),[P,C]=t.useState(!1),[M,b]=t.useState(!1),{recoverSession:E}=Ue(),w=l=>{const u=new Date(l),N=new Date().getTime()-u.getTime(),$=Math.round(N/6e4),G=Math.round(N/36e5),f=Math.round(N/864e5);return $<60?`${$} min ago`:G<24?`${G} hours ago`:`${f} days ago`},g=l=>l>=1e3?`${(l/1e3).toFixed(1)}k lbs`:`${Math.round(l)} lbs`,k=async l=>{d(l),C(!0),(await E(l)).success?n(l):(C(!1),d(null))},T=async l=>{d(l),b(!0),i(l),b(!1),d(null)};return a.length===0?null:e.jsx(J.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs(J.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-gray-900 rounded-2xl w-full max-w-md overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-gray-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 rounded-xl bg-orange-500/20",children:e.jsx(Oe,{className:"w-6 h-6 text-orange-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold",children:"Unfinished Workout"}),e.jsx("p",{className:"text-sm text-gray-400",children:a.length===1?"You have an incomplete session":`You have ${a.length} incomplete sessions`})]})]})}),e.jsx("div",{className:"p-4 max-h-[400px] overflow-y-auto space-y-3",children:a.map(l=>e.jsxs("div",{className:"bg-gray-800/50 rounded-xl p-4 border border-gray-700",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400 mb-1",children:[e.jsx(Xe,{className:"w-4 h-4"}),e.jsx("span",{children:w(l.archivedAt||l.startedAt)})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(We,{className:"w-4 h-4 text-blue-400"}),e.jsxs("span",{className:"font-medium",children:[l.musclesWorked?.length||0," muscles"]})]}),e.jsxs("span",{className:"text-gray-400",children:[l.setsLogged||0," sets"]}),e.jsx("span",{className:"text-purple-400",children:g(l.totalVolume||0)})]})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>k(l.id),disabled:P||M,className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-green-600 hover:bg-green-500 text-white font-medium transition-colors disabled:opacity-50",children:P&&j===l.id?e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"w-4 h-4 animate-spin"}),"Resuming..."]}):e.jsxs(e.Fragment,{children:[e.jsx(es,{className:"w-4 h-4"}),"Resume"]})}),e.jsx("button",{onClick:()=>T(l.id),disabled:P||M,className:"flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg bg-gray-700 hover:bg-gray-600 text-gray-300 font-medium transition-colors disabled:opacity-50",children:M&&j===l.id?e.jsx(Se,{className:"w-4 h-4 animate-spin"}):e.jsx($s,{className:"w-4 h-4"})})]})]},l.id))}),e.jsx("div",{className:"p-4 border-t border-gray-800",children:e.jsxs("button",{onClick:m,disabled:P||M,className:"w-full py-3 rounded-xl bg-gray-800 hover:bg-gray-700 text-gray-300 font-medium transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[e.jsx("span",{children:"Start Fresh Instead"}),e.jsx(As,{className:"w-4 h-4"})]})})]})})}Is`
  query GetRPETrends($exerciseId: ID!, $days: Int) {
    rpeTrends(exerciseId: $exerciseId, days: $days) {
      exerciseId
      exerciseName
      trends {
        date
        avgRpe
        avgRir
        setCount
        avgWeight
        maxWeight
        avgReps
      }
      summary {
        avgRpe
        totalSets
        daysWithData
        trend
      }
    }
  }
`;Is`
  query GetFatigue {
    rpeFatigue {
      fatigueScore
      classification
      indicators
      recommendation
      suggestedIntensity
      recentRpeTrend
    }
  }
`;const bs=[{weight:25,color:"#DC2626",width:42,available:4},{weight:20,color:"#2563EB",width:40,available:4},{weight:15,color:"#FBBF24",width:36,available:4},{weight:10,color:"#22C55E",width:32,available:4},{weight:5,color:"#F8F8F8",width:28,available:4},{weight:2.5,color:"#EF4444",width:18,available:4},{weight:2,color:"#3B82F6",width:16,available:4},{weight:1.25,color:"#FCD34D",width:14,available:4},{weight:1,color:"#4ADE80",width:12,available:4},{weight:.5,color:"#A3A3A3",width:10,available:4},{weight:.25,color:"#737373",width:8,available:4}],fs=[{weight:45,color:"#2563EB",width:42,available:4},{weight:35,color:"#FBBF24",width:38,available:4},{weight:25,color:"#22C55E",width:34,available:4},{weight:10,color:"#F8F8F8",width:28,available:4},{weight:5,color:"#EF4444",width:20,available:4},{weight:2.5,color:"#A3A3A3",width:14,available:4}],ca={metric:[{label:"Olympic Bar",weight:20},{label:"Women's Bar",weight:15},{label:"EZ Curl Bar",weight:10},{label:"Trap Bar",weight:25},{label:"Custom",weight:0}],imperial:[{label:"Olympic Bar",weight:45},{label:"Women's Bar",weight:35},{label:"EZ Curl Bar",weight:25},{label:"Trap Bar",weight:55},{label:"Custom",weight:0}]};function da({targetWeight:a,isMetric:n=!0,barWeight:i,onClose:m,compact:j=!1}){const[d,P]=t.useState(n?"metric":"imperial"),[C,M]=t.useState(i||(d==="metric"?20:45)),[b,E]=t.useState(""),[w,g]=t.useState(a?.toString()||""),[k,T]=t.useState(!1),[l,u]=t.useState(d==="metric"?bs:fs),c=t.useCallback((x,p,O)=>{const Y=(x-p)/2;if(Y<=0)return{plates:[],remaining:0,valid:x===p};const U=[];let D=Y;const Z={},Q=[...O].sort((q,V)=>V.weight-q.weight);for(const q of Q){const V=Math.floor(q.available/2),y=Math.floor(D/q.weight),o=Math.min(V,y);if(o>0){for(let _=0;_<o;_++)U.push({weight:q.weight,color:q.color,width:q.width});Z[q.weight]=o,D-=o*q.weight}}return D=Math.round(D*100)/100,{plates:U,remaining:D,valid:D===0}},[]),N=t.useMemo(()=>{const x=parseFloat(w);if(isNaN(x)||x<=0)return null;const p=b?parseFloat(b):C;return x<p?{plates:[],remaining:0,valid:!1,error:"Target is less than bar weight"}:c(x,p,l)},[w,C,b,l,c]),$=x=>{P(x),u(x==="metric"?bs:fs),M(x==="metric"?20:45),g("")},G=d==="metric"?[60,80,100,120,140,160]:[135,185,225,275,315,405],f=d==="metric"?"kg":"lbs",F=b?parseFloat(b):C;return e.jsxs("div",{className:`bg-gray-900 rounded-2xl border border-gray-800 overflow-hidden ${j?"":"max-w-md"}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-800",children:[e.jsx("h3",{className:"font-semibold text-white",children:"Plate Calculator"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>T(!k),className:`p-2 rounded-lg ${k?"bg-blue-500/20 text-blue-400":"hover:bg-gray-800 text-gray-400"}`,children:e.jsx(Ts,{className:"w-4 h-4"})}),m&&e.jsx("button",{onClick:m,className:"p-2 hover:bg-gray-800 rounded-lg text-gray-400",children:e.jsx(be,{className:"w-4 h-4"})})]})]}),e.jsx(ue,{children:k&&e.jsx(J.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden border-b border-gray-800",children:e.jsxs("div",{className:"p-4 space-y-4 bg-gray-900/50",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Unit System"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>$("metric"),className:`flex-1 py-2 rounded-lg text-sm font-medium ${d==="metric"?"bg-blue-600 text-white":"bg-gray-800 text-gray-400"}`,children:"Metric (kg)"}),e.jsx("button",{onClick:()=>$("imperial"),className:`flex-1 py-2 rounded-lg text-sm font-medium ${d==="imperial"?"bg-blue-600 text-white":"bg-gray-800 text-gray-400"}`,children:"Imperial (lbs)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Bar Weight"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ca[d].map(x=>e.jsxs("button",{onClick:()=>{M(x.weight),E("")},className:`px-3 py-1.5 rounded-lg text-sm ${C===x.weight&&!b?"bg-blue-600 text-white":"bg-gray-800 text-gray-400 hover:text-white"}`,children:[x.label," ",x.weight>0&&`(${x.weight})`]},x.label))}),C===0&&e.jsx("input",{type:"number",value:b,onChange:x=>E(x.target.value),placeholder:`Custom bar weight (${f})`,className:"mt-2 w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-sm"})]})]})})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 mb-1",children:["Target Weight (",f,")"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",value:w,onChange:x=>g(x.target.value),placeholder:"Enter target weight",className:"flex-1 px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-lg font-medium"}),e.jsx("button",{onClick:()=>g(""),className:"p-2 bg-gray-800 hover:bg-gray-700 rounded-lg text-gray-400",children:e.jsx(Je,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:G.map(x=>e.jsx("button",{onClick:()=>g(x.toString()),className:`px-3 py-1.5 rounded-lg text-sm font-medium ${w===x.toString()?"bg-blue-500/20 text-blue-400 border border-blue-500/50":"bg-gray-800 text-gray-400 hover:text-white"}`,children:x},x))}),N&&e.jsx("div",{className:"mt-4",children:!N.valid&&N.error?e.jsx("div",{className:"p-3 bg-red-500/10 border border-red-500/30 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-400",children:N.error})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative flex items-center justify-center py-6 bg-gray-800/50 rounded-xl overflow-hidden",children:[e.jsx("div",{className:"flex items-center",children:[...N.plates].reverse().map((x,p)=>e.jsx(J.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:p*.05},className:"relative flex items-center justify-center rounded",style:{backgroundColor:x.color,width:x.width,height:60+x.width,marginRight:-2,zIndex:N.plates.length-p},children:e.jsx("span",{className:"absolute text-xs font-bold",style:{color:x.color==="#F8F8F8"||x.color==="#FCD34D"||x.color==="#FBBF24"?"#333":"#fff",writingMode:"vertical-rl",transform:"rotate(180deg)"},children:x.weight})},`left-${p}`))}),e.jsxs("div",{className:"w-24 h-4 bg-gray-500 rounded-full relative z-50",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 w-4 bg-gray-600 rounded-l-full"}),e.jsx("div",{className:"absolute inset-y-0 right-0 w-4 bg-gray-600 rounded-r-full"})]}),e.jsx("div",{className:"flex items-center",children:N.plates.map((x,p)=>e.jsx(J.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:p*.05},className:"relative flex items-center justify-center rounded",style:{backgroundColor:x.color,width:x.width,height:60+x.width,marginLeft:-2,zIndex:N.plates.length-p},children:e.jsx("span",{className:"absolute text-xs font-bold",style:{color:x.color==="#F8F8F8"||x.color==="#FCD34D"||x.color==="#FBBF24"?"#333":"#fff",writingMode:"vertical-rl"},children:x.weight})},`right-${p}`))})]}),e.jsxs("div",{className:"mt-4 p-3 bg-gray-800/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Per side:"}),e.jsxs("span",{className:"text-sm font-medium",children:[((parseFloat(w)-F)/2).toFixed(1)," ",f]})]}),N.plates.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(N.plates.reduce((x,p)=>(x[p.weight]=(x[p.weight]||0)+1,x),{})).sort(([x],[p])=>parseFloat(p)-parseFloat(x)).map(([x,p])=>e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-gray-900 rounded-lg",children:[e.jsx("div",{className:"w-3 h-3 rounded",style:{backgroundColor:N.plates.find(O=>O.weight===parseFloat(x))?.color}}),e.jsxs("span",{className:"text-sm font-medium",children:[p,"Ã—",x]})]},x))}):e.jsx("p",{className:"text-sm text-gray-500",children:"Just the bar"}),!N.valid&&N.remaining>0&&e.jsxs("div",{className:"flex items-start gap-2 mt-3 p-2 bg-yellow-500/10 border border-yellow-500/30 rounded-lg",children:[e.jsx(ss,{className:"w-4 h-4 text-yellow-400 flex-shrink-0 mt-0.5"}),e.jsxs("p",{className:"text-xs text-yellow-400",children:["Cannot make exact weight. Missing ",N.remaining.toFixed(2)," ",f," per side. Showing closest possible (",(parseFloat(w)-N.remaining*2).toFixed(1)," ",f," total)."]})]})]}),e.jsx("div",{className:"mt-3 text-center",children:e.jsxs("p",{className:"text-xs text-gray-500",children:["Bar: ",F,f," + Plates: ",(parseFloat(w)-F).toFixed(1),f,"= ",e.jsxs("span",{className:"font-bold text-white",children:[w,f]})]})})]})}),!w&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:e.jsx("p",{className:"text-sm",children:"Enter a target weight to see which plates to load"})})]})]})}const ys={compound:{label:"Compound (5 sets)",sets:[{percent:0,reps:10,label:"Bar"},{percent:40,reps:8,label:"40%"},{percent:60,reps:5,label:"60%"},{percent:75,reps:3,label:"75%"},{percent:90,reps:1,label:"90%"}]},moderate:{label:"Moderate (3 sets)",sets:[{percent:50,reps:8,label:"50%"},{percent:70,reps:5,label:"70%"},{percent:85,reps:3,label:"85%"}]},quick:{label:"Quick (2 sets)",sets:[{percent:50,reps:8,label:"50%"},{percent:75,reps:5,label:"75%"}]},accessory:{label:"Accessory (1 set)",sets:[{percent:50,reps:10,label:"50%"}]}};function xa({workingWeight:a,barWeight:n=45,isMetric:i=!1,onCopySet:m,onClose:j,compact:d=!1}){const[P,C]=t.useState(a?.toString()||""),[M,b]=t.useState(n.toString()),[E,w]=t.useState("compound"),[g,k]=t.useState(!1),[T,l]=t.useState(null),u=i?"kg":"lbs",c=parseFloat(M)||n,N=t.useMemo(()=>{const f=parseFloat(P);return!f||f<=c?[]:ys[E].sets.map(x=>{let p;return x.percent===0?p=c:(p=Math.round(f*(x.percent/100)/5)*5,p=Math.max(p,c)),{...x,weight:p,plates:$(p,c,i)}})},[P,E,c,i]);function $(f,F,x){const p=(f-F)/2;if(p<=0)return"Just bar";const O=x?[25,20,15,10,5,2.5,1.25]:[45,35,25,10,5,2.5],Y=[];let U=p;for(const D of O){const Z=Math.floor(U/D);Z>0&&(Y.push(`${Z}Ã—${D}`),U-=Z*D)}return Y.length>0?Y.join(" + "):"Just bar"}const G=(f,F,x)=>{m?.(f,F),l(x),setTimeout(()=>l(null),1500)};return e.jsxs("div",{className:`bg-gray-900 rounded-2xl border border-gray-800 overflow-hidden ${d?"":"max-w-md"}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Es,{className:"w-5 h-5 text-orange-400"}),e.jsx("h3",{className:"font-semibold text-white",children:"Warmup Calculator"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>k(!g),className:`p-2 rounded-lg ${g?"bg-blue-500/20 text-blue-400":"hover:bg-gray-800 text-gray-400"}`,children:e.jsx(Ts,{className:"w-4 h-4"})}),j&&e.jsx("button",{onClick:j,className:"p-2 hover:bg-gray-800 rounded-lg text-gray-400",children:e.jsx(be,{className:"w-4 h-4"})})]})]}),e.jsx(ue,{children:g&&e.jsx(J.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden border-b border-gray-800",children:e.jsxs("div",{className:"p-4 space-y-4 bg-gray-900/50",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 mb-1",children:["Bar Weight (",u,")"]}),e.jsx("div",{className:"flex gap-2",children:(i?[20,15,10]:[45,35,25]).map(f=>e.jsx("button",{onClick:()=>b(f.toString()),className:`flex-1 py-2 rounded-lg text-sm font-medium ${parseFloat(M)===f?"bg-blue-600 text-white":"bg-gray-800 text-gray-400 hover:text-white"}`,children:f},f))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Warmup Preset"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(ys).map(([f,F])=>e.jsx("button",{onClick:()=>w(f),className:`px-3 py-1.5 rounded-lg text-sm ${E===f?"bg-blue-600 text-white":"bg-gray-800 text-gray-400 hover:text-white"}`,children:F.label},f))})]})]})})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 mb-1",children:["Working Weight (",u,")"]}),e.jsx("input",{type:"number",value:P,onChange:f=>C(f.target.value),placeholder:"Enter your working weight",className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-lg font-medium"})]}),N.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Suggested Warmup Sets"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[N.length," sets"]})]}),e.jsx("div",{className:"space-y-2",children:N.map((f,F)=>e.jsxs(J.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:F*.05},className:"flex items-center gap-3 p-3 bg-gray-800/50 rounded-lg",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-orange-500/20 flex items-center justify-center text-orange-400 font-bold text-sm",children:F+1}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsxs("span",{className:"font-bold text-white",children:[f.weight," ",u]}),e.jsx("span",{className:"text-gray-400",children:"Ã—"}),e.jsxs("span",{className:"font-medium text-gray-300",children:[f.reps," reps"]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",f.label,")"]})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:f.plates})]}),m&&e.jsx("button",{onClick:()=>G(f.weight,f.reps,F),className:`p-2 rounded-lg transition-colors ${T===F?"bg-green-500/20 text-green-400":"hover:bg-gray-700 text-gray-400"}`,children:T===F?e.jsx(Ps,{className:"w-4 h-4"}):e.jsx(kt,{className:"w-4 h-4"})})]},F))})]}):P?e.jsxs("div",{className:"text-center py-6 text-gray-500 text-sm",children:["Working weight must be greater than bar weight (",c," ",u,")"]}):e.jsx("div",{className:"text-center py-6 text-gray-500 text-sm",children:"Enter your working weight to calculate warmup sets"}),e.jsxs("div",{className:"p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg text-xs text-blue-300",children:[e.jsx("strong",{children:"Tip:"})," Warmup sets prepare your muscles and joints, and help you practice form. Rest 30-60 seconds between warmup sets."]})]})]})}function He(a){const n=Math.floor(a/1e3),i=Math.floor(n/3600),m=Math.floor(n%3600/60),j=n%60,d=Math.floor(a%1e3/10);return i>0?`${i}:${m.toString().padStart(2,"0")}:${j.toString().padStart(2,"0")}`:`${m.toString().padStart(2,"0")}:${j.toString().padStart(2,"0")}.${d.toString().padStart(2,"0")}`}function vs(a){const n=Math.floor(a/1e3),i=Math.floor(n/60),m=n%60,j=Math.floor(a%1e3/10);return`${i}:${m.toString().padStart(2,"0")}.${j.toString().padStart(2,"0")}`}const ua=[{label:"30s",value:30},{label:"45s",value:45},{label:"1m",value:60},{label:"90s",value:90},{label:"2m",value:120},{label:"3m",value:180},{label:"5m",value:300}];function ma({onTimeRecorded:a,onClose:n,compact:i=!1,initialMode:m="stopwatch",initialCountdown:j=60}){const[d,P]=t.useState(m),[C,M]=t.useState(!1),[b,E]=t.useState(0),[w,g]=t.useState(j),[k,T]=t.useState(""),[l,u]=t.useState([]),[c,N]=t.useState(!0),[$,G]=t.useState(!1),f=t.useRef(null),F=t.useRef(0),x=t.useRef(0),p=t.useRef(null),O=t.useCallback((y=800,o=100)=>{if(c)try{p.current||(p.current=new(window.AudioContext||window.webkitAudioContext));const _=p.current,z=_.createOscillator(),se=_.createGain();z.connect(se),se.connect(_.destination),z.frequency.value=y,z.type="sine",se.gain.setValueAtTime(.3,_.currentTime),se.gain.exponentialRampToValueAtTime(.01,_.currentTime+o/1e3),z.start(_.currentTime),z.stop(_.currentTime+o/1e3)}catch{}},[c]),Y=t.useCallback(()=>{C?(f.current&&(clearInterval(f.current),f.current=null),M(!1)):(F.current=Date.now()-b,f.current=setInterval(()=>{const y=Date.now()-F.current;if(E(y),d==="countdown"){const o=w*1e3-y;o<=0?(clearInterval(f.current),f.current=null,M(!1),E(w*1e3),O(1e3,500),ge("heavy"),a?.(w*1e3)):o<=3e3&&o>2900?(O(600,100),ge("light")):o<=2e3&&o>1900?(O(600,100),ge("light")):o<=1e3&&o>900&&(O(600,100),ge("light"))}},10),M(!0),ge("light"))},[C,b,d,w,O,a]),U=t.useCallback(()=>{f.current&&(clearInterval(f.current),f.current=null),M(!1),E(0),u([]),x.current=0,ge("light")},[]),D=t.useCallback(()=>{const y=b-x.current,o=l.length>0?y-l[l.length-1].time:0;u(_=>[..._,{number:_.length+1,time:y,delta:o}]),x.current=b,ge("medium"),O(600,50)},[b,l,O]),Z=t.useCallback(()=>{f.current&&(clearInterval(f.current),f.current=null),M(!1),a?.(b),ge("medium")},[b,a]);t.useEffect(()=>()=>{f.current&&clearInterval(f.current)},[]);const Q=d==="countdown"?Math.max(0,w*1e3-b):b,q=d==="countdown"&&b>=w*1e3,V=d==="countdown"?b/(w*1e3)*100:0;return i?e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-800/50 rounded-lg",children:[e.jsx("button",{onClick:Y,className:`p-2 rounded-lg ${C?"bg-red-500/20 text-red-400":"bg-green-500/20 text-green-400"}`,children:C?e.jsx(xs,{className:"w-5 h-5"}):e.jsx(Fe,{className:"w-5 h-5"})}),e.jsx("span",{className:"font-mono text-xl font-bold flex-1",children:He(Q)}),e.jsx("button",{onClick:U,className:"p-2 rounded-lg hover:bg-gray-700 text-gray-400",children:e.jsx(Je,{className:"w-5 h-5"})})]}):e.jsxs("div",{className:"bg-gray-900 rounded-2xl border border-gray-800 overflow-hidden max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[d==="stopwatch"?e.jsx(Xe,{className:"w-5 h-5 text-blue-400"}):e.jsx(_s,{className:"w-5 h-5 text-orange-400"}),e.jsx("h3",{className:"font-semibold text-white",children:d==="stopwatch"?"Stopwatch":"Countdown Timer"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>N(!c),className:`p-2 rounded-lg ${c?"text-blue-400":"text-gray-600"}`,children:c?e.jsx(Ct,{className:"w-4 h-4"}):e.jsx(Mt,{className:"w-4 h-4"})}),n&&e.jsx("button",{onClick:n,className:"p-2 hover:bg-gray-800 rounded-lg text-gray-400",children:e.jsx(be,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex gap-2 p-4 border-b border-gray-800",children:[e.jsx("button",{onClick:()=>{P("stopwatch"),U()},className:`flex-1 py-2 rounded-lg text-sm font-medium ${d==="stopwatch"?"bg-blue-600 text-white":"bg-gray-800 text-gray-400"}`,children:"Stopwatch"}),e.jsx("button",{onClick:()=>{P("countdown"),U()},className:`flex-1 py-2 rounded-lg text-sm font-medium ${d==="countdown"?"bg-orange-600 text-white":"bg-gray-800 text-gray-400"}`,children:"Countdown"})]}),e.jsxs("div",{className:"p-6",children:[d==="countdown"&&e.jsxs("div",{className:"relative w-48 h-48 mx-auto mb-6",children:[e.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[e.jsx("circle",{cx:"96",cy:"96",r:"88",fill:"none",stroke:"#374151",strokeWidth:"8"}),e.jsx("circle",{cx:"96",cy:"96",r:"88",fill:"none",stroke:q||V>90?"#EF4444":V>75?"#F59E0B":"#3B82F6",strokeWidth:"8",strokeLinecap:"round",strokeDasharray:`${2*Math.PI*88}`,strokeDashoffset:`${2*Math.PI*88*(1-V/100)}`,className:"transition-all duration-100"})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("span",{className:`font-mono text-4xl font-bold ${q||Q<=1e4?"text-red-400":Q<=3e4?"text-yellow-400":"text-white"}`,children:He(Q)}),q&&e.jsx("span",{className:"text-red-400 text-sm mt-1",children:"Time's Up!"})]})]}),d==="stopwatch"&&e.jsx("div",{className:"text-center mb-6",children:e.jsx("span",{className:"font-mono text-5xl font-bold text-white",children:He(Q)})}),d==="countdown"&&!C&&e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"flex flex-wrap justify-center gap-2 mb-3",children:ua.map(y=>e.jsx("button",{onClick:()=>{g(y.value),U()},className:`px-3 py-1.5 rounded-lg text-sm font-medium ${w===y.value?"bg-orange-600 text-white":"bg-gray-800 text-gray-400 hover:text-white"}`,children:y.label},y.value))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",value:k,onChange:y=>T(y.target.value),placeholder:"Custom (seconds)",className:"flex-1 px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-sm"}),e.jsx("button",{onClick:()=>{const y=parseInt(k);y>0&&(g(y),U())},className:"px-4 py-2 bg-gray-800 hover:bg-gray-700 rounded-lg text-sm",disabled:!k||parseInt(k)<=0,children:"Set"})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx("button",{onClick:U,className:"p-3 bg-gray-800 hover:bg-gray-700 rounded-full text-gray-400",children:e.jsx(Je,{className:"w-6 h-6"})}),e.jsx("button",{onClick:Y,disabled:q,className:`p-4 rounded-full text-white ${C?"bg-red-600 hover:bg-red-700":q?"bg-gray-700 cursor-not-allowed":"bg-green-600 hover:bg-green-700"}`,children:C?e.jsx(xs,{className:"w-8 h-8"}):e.jsx(Fe,{className:"w-8 h-8 ml-1"})}),d==="stopwatch"&&C&&e.jsx("button",{onClick:D,className:"p-3 bg-blue-600 hover:bg-blue-700 rounded-full text-white",children:e.jsx(us,{className:"w-6 h-6"})}),!C&&b>0&&a&&e.jsx("button",{onClick:Z,className:"p-3 bg-green-600 hover:bg-green-700 rounded-full text-white",children:e.jsx(us,{className:"w-6 h-6"})})]}),d==="stopwatch"&&l.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("button",{onClick:()=>G(!$),className:"flex items-center justify-between w-full p-3 bg-gray-800/50 rounded-lg text-sm",children:[e.jsxs("span",{className:"text-gray-400",children:["Laps (",l.length,")"]}),e.jsx(Be,{className:`w-4 h-4 text-gray-500 transition-transform ${$?"rotate-180":""}`})]}),e.jsx(ue,{children:$&&e.jsx(J.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsx("div",{className:"mt-2 space-y-1 max-h-40 overflow-y-auto",children:[...l].reverse().map(y=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-800/30 rounded text-sm",children:[e.jsxs("span",{className:"text-gray-500",children:["Lap ",y.number]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-mono",children:vs(y.time)}),y.delta!==0&&e.jsxs("span",{className:y.delta>0?"text-red-400":"text-green-400",children:[y.delta>0?"+":"",vs(Math.abs(y.delta))]})]})]},y.number))})})})]})]})]})}const js=[{value:"1M",label:"1 Month",days:30},{value:"3M",label:"3 Months",days:90},{value:"6M",label:"6 Months",days:180},{value:"1Y",label:"1 Year",days:365},{value:"ALL",label:"All Time",days:1/0}],$e=[{value:"weight",label:"Max Weight",unit:"kg",description:"Heaviest weight lifted per session"},{value:"volume",label:"Total Volume",unit:"kg",description:"Weight Ã— Reps summed across all sets"},{value:"e1rm",label:"Est. 1RM",unit:"kg",description:"Estimated one-rep max (Epley formula)"},{value:"reps",label:"Total Reps",unit:"",description:"Total repetitions per session"}];function ha(a,n){return n===1?a:(n>12,a*(1+n/30))}function Pe(a,n=!1){const i=new Date(a);return n?i.toLocaleDateString("en-US",{month:"short",day:"numeric"}):i.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function ws(a,n){if(n===0)return{value:0,direction:"same"};const i=(a-n)/n*100;return Math.abs(i)<.5?{value:0,direction:"same"}:{value:Math.abs(i),direction:i>0?"up":"down"}}function Ns({data:a,metric:n,height:i=200}){const m=$e.find(g=>g.value===n);if(a.length===0)return e.jsx("div",{className:"flex items-center justify-center h-48 text-white/40",children:"No data available for this period"});const j=a.map(g=>g.value),d=Math.min(...j)*.9,P=Math.max(...j)*1.1,C=P-d||1,M=a.map((g,k)=>({x:k/(a.length-1||1)*100,y:100-(g.value-d)/C*100})),b=M.length>1?`M ${M.map(g=>`${g.x},${g.y}`).join(" L ")}`:"",E=M.length>1?`M ${M[0].x},100 L ${M.map(g=>`${g.x},${g.y}`).join(" L ")} L ${M[M.length-1].x},100 Z`:"",w=[d,(d+P)/2,P].map(g=>g>=1e3?`${(g/1e3).toFixed(1)}k`:g.toFixed(0));return e.jsxs("div",{className:"relative",style:{height:i},children:[e.jsxs("div",{className:"absolute left-0 top-0 bottom-8 w-12 flex flex-col justify-between text-xs text-white/40 pr-2",children:[e.jsxs("span",{className:"text-right",children:[w[2],m?.unit]}),e.jsxs("span",{className:"text-right",children:[w[1],m?.unit]}),e.jsxs("span",{className:"text-right",children:[w[0],m?.unit]})]}),e.jsxs("div",{className:"ml-12 h-full pr-2",children:[e.jsxs("svg",{viewBox:"0 0 100 100",preserveAspectRatio:"none",className:"w-full h-[calc(100%-2rem)]",children:[e.jsx("line",{x1:"0",y1:"0",x2:"100",y2:"0",stroke:"white",strokeOpacity:"0.1",strokeWidth:"0.5",vectorEffect:"non-scaling-stroke"}),e.jsx("line",{x1:"0",y1:"50",x2:"100",y2:"50",stroke:"white",strokeOpacity:"0.1",strokeWidth:"0.5",vectorEffect:"non-scaling-stroke"}),e.jsx("line",{x1:"0",y1:"100",x2:"100",y2:"100",stroke:"white",strokeOpacity:"0.1",strokeWidth:"0.5",vectorEffect:"non-scaling-stroke"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:`gradient-${n}`,x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"#8B5CF6",stopOpacity:"0.3"}),e.jsx("stop",{offset:"100%",stopColor:"#8B5CF6",stopOpacity:"0"})]})}),E&&e.jsx("path",{d:E,fill:`url(#gradient-${n})`}),b&&e.jsx("path",{d:b,fill:"none",stroke:"#8B5CF6",strokeWidth:"2",vectorEffect:"non-scaling-stroke",strokeLinecap:"round",strokeLinejoin:"round"}),M.map((g,k)=>e.jsx("circle",{cx:g.x,cy:g.y,r:"3",fill:"#8B5CF6",stroke:"white",strokeWidth:"1",vectorEffect:"non-scaling-stroke",className:"cursor-pointer hover:r-4 transition-all",children:e.jsx("title",{children:`${Pe(a[k].date)}: ${a[k].value.toFixed(1)}${m?.unit}`})},k))]}),e.jsx("div",{className:"flex justify-between text-xs text-white/40 mt-1",children:a.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:Pe(a[0].date,!0)}),a.length>2&&e.jsx("span",{children:Pe(a[Math.floor(a.length/2)].date,!0)}),e.jsx("span",{children:Pe(a[a.length-1].date,!0)})]})})]})]})}function Ae({label:a,value:n,unit:i,change:m,icon:j}){return e.jsxs("div",{className:"bg-white/5 rounded-xl p-4 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[j&&e.jsx(j,{className:"w-4 h-4 text-violet-400"}),e.jsx("span",{className:"text-xs text-white/60",children:a})]}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-2xl font-bold text-white",children:n}),i&&e.jsx("span",{className:"text-sm text-white/40",children:i})]}),m&&m.direction!=="same"&&e.jsxs("div",{className:`flex items-center gap-1 mt-1 text-xs ${m.direction==="up"?"text-green-400":"text-red-400"}`,children:[m.direction==="up"?e.jsx(Ze,{className:"w-3 h-3"}):e.jsx(Fs,{className:"w-3 h-3"}),e.jsxs("span",{children:[m.value.toFixed(1),"%"]})]})]})}function ga({exerciseId:a,exerciseName:n,history:i,onClose:m,compact:j=!1}){const[d,P]=t.useState("3M"),[C,M]=t.useState("weight"),[b,E]=t.useState(!1),w=t.useMemo(()=>{const l=js.find(c=>c.value===d);if(!l||l.days===1/0)return i;const u=new Date;return u.setDate(u.getDate()-l.days),i.filter(c=>new Date(c.date)>=u)},[i,d]),g=t.useMemo(()=>w.map(l=>{const u=l.sets;let c;switch(C){case"weight":c=Math.max(...u.map(N=>N.weight));break;case"volume":c=u.reduce((N,$)=>N+$.weight*$.reps,0);break;case"e1rm":c=Math.max(...u.map(N=>ha(N.weight,N.reps)));break;case"reps":c=u.reduce((N,$)=>N+$.reps,0);break;default:c=0}return{date:l.date,value:c,entry:l}}).sort((l,u)=>new Date(l.date).getTime()-new Date(u.date).getTime()),[w,C]),k=t.useMemo(()=>{if(g.length===0)return null;const l=g.map(f=>f.value),u=l[l.length-1],c=l.length>1?l[l.length-2]:u,N=l[0],$=Math.max(...l),G=l.reduce((f,F)=>f+F,0)/l.length;return{current:u,max:$,avg:G,totalWorkouts:g.length,periodChange:ws(u,N),lastChange:ws(u,c)}},[g]),T=$e.find(l=>l.value===C);return j?e.jsxs("div",{className:"bg-black/40 backdrop-blur-xl rounded-2xl border border-white/10 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:n}),m&&e.jsx("button",{onClick:m,className:"p-1 rounded-lg hover:bg-white/10 transition-colors",children:e.jsx(be,{className:"w-5 h-5 text-white/60"})})]}),e.jsx("div",{className:"flex gap-2 mb-4 overflow-x-auto pb-1",children:$e.map(l=>e.jsx("button",{onClick:()=>M(l.value),className:`px-3 py-1.5 rounded-lg text-xs font-medium whitespace-nowrap transition-colors ${C===l.value?"bg-violet-500 text-white":"bg-white/5 text-white/60 hover:bg-white/10"}`,children:l.label},l.value))}),e.jsx(Ns,{data:g,metric:C,height:160}),k&&e.jsxs("div",{className:"mt-4 flex items-center justify-between text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-white/60",children:"Current:"})," ",e.jsxs("span",{className:"text-white font-semibold",children:[k.current.toFixed(1),T?.unit]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white/60",children:"Peak:"})," ",e.jsxs("span",{className:"text-white font-semibold",children:[k.max.toFixed(1),T?.unit]})]})]})]}):e.jsxs("div",{className:"bg-black/40 backdrop-blur-xl rounded-2xl border border-white/10 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-violet-500/20 flex items-center justify-center",children:e.jsx(Re,{className:"w-5 h-5 text-violet-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:n}),e.jsx("p",{className:"text-sm text-white/60",children:"Progress over time"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>E(!b),className:"p-2 rounded-lg hover:bg-white/10 transition-colors",children:e.jsx(ss,{className:"w-5 h-5 text-white/60"})}),m&&e.jsx("button",{onClick:m,className:"p-2 rounded-lg hover:bg-white/10 transition-colors",children:e.jsx(be,{className:"w-5 h-5 text-white/60"})})]})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-1",children:js.map(l=>e.jsx("button",{onClick:()=>P(l.value),className:`px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition-colors ${d===l.value?"bg-violet-500 text-white":"bg-white/5 text-white/60 hover:bg-white/10"}`,children:l.label},l.value))})]}),e.jsx(ue,{children:b&&e.jsx(J.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"border-b border-white/10 overflow-hidden",children:e.jsx("div",{className:"p-4 bg-violet-500/10",children:e.jsxs("p",{className:"text-sm text-white/80",children:[e.jsx("strong",{children:"Estimated 1RM"})," uses the Epley formula: Weight Ã— (1 + Reps/30). Most accurate for 1-10 reps."]})})})}),e.jsxs("div",{className:"p-4 border-b border-white/10",children:[e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-1",children:$e.map(l=>e.jsxs("button",{onClick:()=>M(l.value),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition-colors ${C===l.value?"bg-white/10 text-white border border-violet-500/50":"bg-white/5 text-white/60 hover:bg-white/10 border border-transparent"}`,children:[l.value==="weight"&&e.jsx(ns,{className:"w-4 h-4"}),l.value==="volume"&&e.jsx(Re,{className:"w-4 h-4"}),l.value==="e1rm"&&e.jsx(Le,{className:"w-4 h-4"}),l.value==="reps"&&e.jsx(Ft,{className:"w-4 h-4"}),l.label]},l.value))}),e.jsx("p",{className:"text-xs text-white/40 mt-2",children:T?.description})]}),e.jsx("div",{className:"p-6",children:e.jsx(Ns,{data:g,metric:C,height:240})}),k&&e.jsxs("div",{className:"p-6 border-t border-white/10",children:[e.jsx("h3",{className:"text-sm font-medium text-white/60 mb-4",children:"Summary"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Ae,{label:"Current",value:k.current.toFixed(1),unit:T?.unit,change:k.lastChange,icon:ns}),e.jsx(Ae,{label:"Peak",value:k.max.toFixed(1),unit:T?.unit,icon:Le}),e.jsx(Ae,{label:"Average",value:k.avg.toFixed(1),unit:T?.unit,icon:Re}),e.jsx(Ae,{label:"Workouts",value:k.totalWorkouts,icon:pt})]}),k.periodChange.direction!=="same"&&e.jsx("div",{className:`mt-4 p-4 rounded-xl ${k.periodChange.direction==="up"?"bg-green-500/10":"bg-red-500/10"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[k.periodChange.direction==="up"?e.jsx(Ze,{className:"w-5 h-5 text-green-400"}):e.jsx(Fs,{className:"w-5 h-5 text-red-400"}),e.jsxs("span",{className:`text-sm font-medium ${k.periodChange.direction==="up"?"text-green-400":"text-red-400"}`,children:[k.periodChange.direction==="up"?"+":"-",k.periodChange.value.toFixed(1),"% over this period"]})]})})]}),g.length===0&&e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(Re,{className:"w-12 h-12 text-white/20 mx-auto mb-4"}),e.jsx("p",{className:"text-white/60",children:"No workout data for this period"}),e.jsx("p",{className:"text-sm text-white/40 mt-1",children:"Complete some workouts to see your progress"})]})]})}const pa=[{value:"great",label:"Great",icon:ms,color:"text-green-400"},{value:"good",label:"Good",icon:ms,color:"text-blue-400"},{value:"okay",label:"Okay",icon:Dt,color:"text-yellow-400"},{value:"bad",label:"Bad",icon:Lt,color:"text-red-400"}],ba=[{value:"high",label:"High Energy",icon:Ms,color:"text-yellow-400"},{value:"medium",label:"Normal",icon:At,color:"text-blue-400"},{value:"low",label:"Low Energy",icon:_t,color:"text-red-400"}],fa=[{value:"good",label:"Good Sleep",icon:Ve,color:"text-violet-400"},{value:"average",label:"Average",icon:Ve,color:"text-blue-400"},{value:"poor",label:"Poor Sleep",icon:Ve,color:"text-orange-400"}],ya=["PR Day","Deload","Testing","Recovery","First Day Back","Travel","Morning","Evening","Fasted","Post-Meal","Pre-Workout","No Caffeine","New Exercise","Form Focus","High Volume","Low Volume"];function va({workoutId:a,initialNotes:n,onSave:i,onDelete:m,compact:j=!1,autoSave:d=!0,className:P=""}){const[C,M]=t.useState(!j),[b,E]=t.useState(!n),[w,g]=t.useState(n?.content||""),[k,T]=t.useState(n?.mood),[l,u]=t.useState(n?.energy),[c,N]=t.useState(n?.sleepQuality),[$,G]=t.useState(n?.tags||[]),[f,F]=t.useState(!1),[x,p]=t.useState(""),[O,Y]=t.useState(!1),U=t.useRef(null),D=t.useRef();t.useEffect(()=>{const o=w!==(n?.content||"")||k!==n?.mood||l!==n?.energy||c!==n?.sleepQuality||JSON.stringify($)!==JSON.stringify(n?.tags||[]);Y(o)},[w,k,l,c,$,n]);const Z=t.useCallback(()=>{U.current&&(U.current.style.height="auto",U.current.style.height=`${U.current.scrollHeight}px`)},[]);t.useEffect(()=>{Z()},[w,Z]);const Q=t.useCallback(()=>{const o={id:n?.id||`note-${Date.now()}`,content:w,mood:k,energy:l,sleepQuality:c,tags:$,createdAt:n?.createdAt||new Date().toISOString(),updatedAt:new Date().toISOString()};i?.(o),Y(!1),j||E(!1)},[w,k,l,c,$,n,i,j]);t.useEffect(()=>(d&&O&&(D.current&&clearTimeout(D.current),D.current=setTimeout(()=>{Q()},2e3)),()=>{D.current&&clearTimeout(D.current)}),[d,O,Q]);const q=t.useCallback(()=>{window.confirm("Delete this note?")&&(m?.(),g(""),T(void 0),u(void 0),N(void 0),G([]),E(!0))},[m]),V=t.useCallback(o=>{G(_=>_.includes(o)?_.filter(z=>z!==o):[..._,o])},[]),y=t.useCallback(()=>{x.trim()&&!$.includes(x.trim())&&(G(o=>[...o,x.trim()]),p(""))},[x,$]);return j&&!C?e.jsxs("button",{onClick:()=>M(!0),className:`flex items-center gap-2 px-3 py-2 rounded-lg bg-white/5 hover:bg-white/10 transition-colors ${P}`,children:[e.jsx(hs,{className:"w-4 h-4 text-yellow-400"}),e.jsx("span",{className:"text-sm text-white/60",children:n?.content?"View Notes":"Add Notes"}),n&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-yellow-400"}),e.jsx(Be,{className:"w-4 h-4 text-white/40"})]}):e.jsxs(J.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`bg-black/40 backdrop-blur-xl rounded-2xl border border-white/10 overflow-hidden ${P}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-yellow-500/20 flex items-center justify-center",children:e.jsx(hs,{className:"w-5 h-5 text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Workout Notes"}),n?.updatedAt&&e.jsxs("p",{className:"text-xs text-white/40 flex items-center gap-1",children:[e.jsx(Xe,{className:"w-3 h-3"}),"Last updated ",new Date(n.updatedAt).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[O&&d&&e.jsx("span",{className:"text-xs text-yellow-400",children:"Saving..."}),!b&&n&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>E(!0),className:"p-2 rounded-lg hover:bg-white/10 transition-colors",children:e.jsx(Et,{className:"w-4 h-4 text-white/60"})}),e.jsx("button",{onClick:q,className:"p-2 rounded-lg hover:bg-red-500/20 transition-colors",children:e.jsx($s,{className:"w-4 h-4 text-red-400"})})]}),j&&e.jsx("button",{onClick:()=>M(!1),className:"p-2 rounded-lg hover:bg-white/10 transition-colors",children:e.jsx(Tt,{className:"w-4 h-4 text-white/60"})})]})]}),e.jsxs("div",{className:"p-4 border-b border-white/10 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-white/60 mb-2 block",children:"How did you feel?"}),e.jsx("div",{className:"flex gap-2",children:pa.map(o=>{const _=o.icon;return e.jsxs("button",{onClick:()=>T(k===o.value?void 0:o.value),className:`flex items-center gap-2 px-3 py-2 rounded-lg text-sm transition-colors ${k===o.value?"bg-white/10 border border-white/20":"bg-white/5 border border-transparent hover:bg-white/10"}`,children:[e.jsx(_,{className:`w-4 h-4 ${k===o.value?o.color:"text-white/40"}`}),e.jsx("span",{className:k===o.value?"text-white":"text-white/60",children:o.label})]},o.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-white/60 mb-2 block",children:"Energy level"}),e.jsx("div",{className:"flex gap-2",children:ba.map(o=>{const _=o.icon;return e.jsxs("button",{onClick:()=>u(l===o.value?void 0:o.value),className:`flex items-center gap-2 px-3 py-2 rounded-lg text-sm transition-colors ${l===o.value?"bg-white/10 border border-white/20":"bg-white/5 border border-transparent hover:bg-white/10"}`,children:[e.jsx(_,{className:`w-4 h-4 ${l===o.value?o.color:"text-white/40"}`}),e.jsx("span",{className:l===o.value?"text-white":"text-white/60",children:o.label})]},o.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-white/60 mb-2 block",children:"Sleep quality"}),e.jsx("div",{className:"flex gap-2",children:fa.map(o=>{const _=o.icon;return e.jsxs("button",{onClick:()=>N(c===o.value?void 0:o.value),className:`flex items-center gap-2 px-3 py-2 rounded-lg text-sm transition-colors ${c===o.value?"bg-white/10 border border-white/20":"bg-white/5 border border-transparent hover:bg-white/10"}`,children:[e.jsx(_,{className:`w-4 h-4 ${c===o.value?o.color:"text-white/40"}`}),e.jsx("span",{className:c===o.value?"text-white":"text-white/60",children:o.label})]},o.value)})})]})]}),e.jsxs("div",{className:"p-4 border-b border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-xs font-medium text-white/60",children:"Tags"}),e.jsxs("button",{onClick:()=>F(!f),className:"flex items-center gap-1 text-xs text-violet-400 hover:text-violet-300 transition-colors",children:[e.jsx(Ne,{className:"w-3 h-3"}),"Add Tag"]})]}),$.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:$.map(o=>e.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 rounded-full bg-violet-500/20 text-violet-300 text-xs",children:[e.jsx(qt,{className:"w-3 h-3"}),o,e.jsx("button",{onClick:()=>V(o),className:"ml-1 hover:text-red-400 transition-colors",children:e.jsx(be,{className:"w-3 h-3"})})]},o))}),e.jsx(ue,{children:f&&e.jsxs(J.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:[e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:ya.filter(o=>!$.includes(o)).map(o=>e.jsx("button",{onClick:()=>V(o),className:"px-2 py-1 rounded-full bg-white/5 hover:bg-white/10 text-white/60 text-xs transition-colors",children:o},o))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:x,onChange:o=>p(o.target.value),onKeyDown:o=>o.key==="Enter"&&y(),placeholder:"Custom tag...",className:"flex-1 px-3 py-2 rounded-lg bg-white/5 border border-white/10 text-white text-sm placeholder:text-white/40 focus:outline-none focus:border-violet-500"}),e.jsx("button",{onClick:y,disabled:!x.trim(),className:"px-3 py-2 rounded-lg bg-violet-500 text-white text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:bg-violet-600 transition-colors",children:"Add"})]})]})})]}),e.jsx("div",{className:"p-4",children:b?e.jsxs(e.Fragment,{children:[e.jsx("textarea",{ref:U,value:w,onChange:o=>g(o.target.value),placeholder:"How was your workout? Any observations, adjustments, or things to remember for next time...",className:"w-full min-h-[120px] p-3 rounded-xl bg-white/5 border border-white/10 text-white placeholder:text-white/40 focus:outline-none focus:border-violet-500 resize-none"}),!d&&e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[n&&e.jsx("button",{onClick:()=>{g(n.content||""),T(n.mood),u(n.energy),N(n.sleepQuality),G(n.tags||[]),E(!1)},className:"px-4 py-2 rounded-lg text-white/60 hover:bg-white/10 transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:Q,disabled:!O,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-violet-500 text-white font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:bg-violet-600 transition-colors",children:[e.jsx(Rt,{className:"w-4 h-4"}),"Save Notes"]})]})]}):e.jsx("div",{className:"prose prose-invert prose-sm max-w-none",children:w?e.jsx("p",{className:"text-white/80 whitespace-pre-wrap",children:w}):e.jsx("p",{className:"text-white/40 italic",children:"No notes added yet"})})})]})}const ja=t.lazy(()=>ft(()=>import("./index-BI5UmSTE.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(a=>({default:a.ExerciseIllustration}))),wa={"chest-upper":"chest","chest-mid":"chest","chest-lower":"chest",pectoralis:"chest",pec:"chest","back-upper":"upper_back","back-mid":"lats","back-lower":"lower_back",latissimus:"lats",rhomboids:"upper_back",trapezius:"traps",traps:"traps","rear-delts":"rear_delts","front-delts":"front_delts","side-delts":"side_delts",shoulders:"front_delts",deltoid:"front_delts",biceps:"biceps",triceps:"triceps",forearms:"forearms",quadriceps:"quads",quads:"quads",hamstrings:"hamstrings",glutes:"glutes",calves:"calves",abs:"abs",obliques:"obliques",core:"abs","hip-flexors":"hip_flexors",adductors:"adductors",erector:"lower_back"};function ve(a){const n=a.toLowerCase().replace(/[_\s]/g,"-");return wa[n]||n.replace(/-/g,"_")}const Na=[{value:15,label:"15 min",description:"Quick session"},{value:30,label:"30 min",description:"Standard"},{value:45,label:"45 min",description:"Extended"},{value:60,label:"60 min",description:"Full workout"}],Ye=[{value:"gym",label:"Gym",icon:"ðŸ‹ï¸"},{value:"home",label:"Home",icon:"ðŸ "},{value:"park",label:"Park",icon:"ðŸŒ³"},{value:"hotel",label:"Hotel",icon:"ðŸ¨"},{value:"office",label:"Office",icon:"ðŸ¢"}],Sa={gym:[{value:"barbell",label:"Barbell",icon:"ðŸ‹ï¸"},{value:"dumbbells",label:"Dumbbells",icon:"ðŸ”©"},{value:"cable_machine",label:"Cable Machine",icon:"âš™ï¸"},{value:"leg_press",label:"Leg Press",icon:"ðŸ¦µ"},{value:"lat_pulldown",label:"Lat Pulldown",icon:"ðŸ“"},{value:"bench",label:"Bench",icon:"ðŸª‘"},{value:"squat_rack",label:"Squat Rack",icon:"ðŸ—ï¸"},{value:"smith_machine",label:"Smith Machine",icon:"ðŸ”§"},{value:"rowing_machine",label:"Row Machine",icon:"ðŸš£"},{value:"treadmill",label:"Treadmill",icon:"ðŸƒ"},{value:"elliptical",label:"Elliptical",icon:"â­•"},{value:"kettlebell",label:"Kettlebell",icon:"ðŸ””"}],home:[{value:"dumbbells",label:"Dumbbells",icon:"ðŸ”©"},{value:"pullup_bar",label:"Pull-up Bar",icon:"ðŸ”²"},{value:"kettlebell",label:"Kettlebell",icon:"ðŸ””"},{value:"bands",label:"Resistance Bands",icon:"âž°"},{value:"yoga_mat",label:"Yoga Mat",icon:"ðŸ§˜"},{value:"foam_roller",label:"Foam Roller",icon:"ðŸ›¼"},{value:"jump_rope",label:"Jump Rope",icon:"ðŸª¢"},{value:"stability_ball",label:"Stability Ball",icon:"âšª"}],park:[{value:"pullup_bar",label:"Pull-up Bar",icon:"ðŸ”²"},{value:"parallel_bars",label:"Parallel Bars",icon:"â¸ï¸"},{value:"bench",label:"Park Bench",icon:"ðŸª‘"},{value:"bands",label:"Resistance Bands",icon:"âž°"},{value:"jump_rope",label:"Jump Rope",icon:"ðŸª¢"},{value:"stairs",label:"Stairs",icon:"ðŸ“¶"}],hotel:[{value:"bands",label:"Resistance Bands",icon:"âž°"},{value:"dumbbells",label:"Hotel Dumbbells",icon:"ðŸ”©"},{value:"yoga_mat",label:"Yoga Mat",icon:"ðŸ§˜"},{value:"chair",label:"Chair",icon:"ðŸ’º"},{value:"treadmill",label:"Treadmill",icon:"ðŸƒ"}],office:[{value:"bands",label:"Resistance Bands",icon:"âž°"},{value:"chair",label:"Office Chair",icon:"ðŸ’º"},{value:"desk",label:"Desk",icon:"ðŸ–¥ï¸"},{value:"stairs",label:"Stairs",icon:"ðŸ“¶"}]},ka=[{value:"dumbbells",label:"Dumbbells",icon:"ðŸ”©"},{value:"pullup_bar",label:"Pull-up Bar",icon:"ðŸ”²"},{value:"kettlebell",label:"Kettlebell",icon:"ðŸ””"},{value:"bands",label:"Resistance Bands",icon:"âž°"},{value:"barbell",label:"Barbell",icon:"ðŸ‹ï¸"}],Ca=[{value:"strength",label:"Strength",icon:"ðŸ’ª"},{value:"hypertrophy",label:"Muscle Growth",icon:"ðŸ“ˆ"},{value:"endurance",label:"Endurance",icon:"ðŸƒ"},{value:"fat_loss",label:"Fat Loss",icon:"ðŸ”¥"}],Ws=[{id:"chest",name:"Chest",icon:"ðŸª¶",match:["ch_","pec","chest"]},{id:"back",name:"Back",icon:"ðŸ”§",match:["bk_","lat","romboid","trap","back"]},{id:"shoulders",name:"Shoulders",icon:"ðŸ’ª",match:["sh_","delt","shoulder"]},{id:"arms",name:"Arms",icon:"ðŸ’ª",match:["ar_","bicep","tricep","forearm"]},{id:"legs",name:"Legs",icon:"ðŸ¦µ",match:["lg_","quad","hamstring","calf","leg"]},{id:"glutes",name:"Glutes",icon:"ðŸ‘",match:["glute"]},{id:"core",name:"Core",icon:"ðŸ¤³",match:["core","ab","oblique"]}];function Qe(a){if(!a||!a.length)return null;const n=(a[0]||"").toLowerCase();for(const i of Ws)if(i.match.some(m=>n.includes(m)))return i;return null}const Ss={barbell:{c:"from-red-500 to-orange-500"},dumbbell:{c:"from-blue-500 to-purple-500"},bodyweight:{c:"from-green-500 to-teal-500"},kettlebell:{c:"from-yellow-500 to-orange-500"},machine:{c:"from-gray-500 to-gray-700"},cable:{c:"from-purple-500 to-pink-500"},default:{c:"from-gray-600 to-gray-700"}},ks=({currentExercise:a,onWeightCalculated:n})=>{const[i,m]=t.useState(!1),[j,d]=t.useState("plates"),P=[{id:"plates",label:"Plates",icon:"ðŸ”¢",description:"Calculate plates needed"},{id:"warmup",label:"Warmup",icon:"ðŸ”¥",description:"Generate warmup sets"},{id:"timer",label:"Timer",icon:"â±ï¸",description:"Stopwatch & countdown"},{id:"notes",label:"Notes",icon:"ðŸ“",description:"Session notes"},{id:"history",label:"History",icon:"ðŸ“Š",description:"Exercise progress"}];return e.jsxs("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl overflow-hidden mb-6 border border-white/5",children:[e.jsxs("button",{onClick:()=>m(!i),className:"w-full p-4 flex items-center justify-between text-left min-h-[56px] touch-action-manipulation",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-2xl",children:"ðŸ› ï¸"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-white",children:"Workout Tools"}),e.jsx("div",{className:"text-xs text-gray-400",children:"Plate calculator, warmup sets, timer & more"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-blue-400 bg-blue-400/10 px-2 py-1 rounded-full",children:"New"}),e.jsx("svg",{className:`w-5 h-5 text-gray-400 transition-transform ${i?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),i&&e.jsxs("div",{className:"p-4 pt-0",children:[e.jsx("div",{className:"flex gap-2 mb-4 overflow-x-auto pb-2 scrollbar-hide -mx-1 px-1",children:P.map(C=>e.jsxs("button",{onClick:()=>d(C.id),className:`flex items-center gap-2 px-4 py-3 rounded-xl text-sm whitespace-nowrap transition-all min-h-[48px] touch-action-manipulation ${j===C.id?"bg-blue-500 text-white shadow-lg shadow-blue-500/25":"bg-gray-700/50 text-gray-300 hover:bg-gray-700 active:scale-95"}`,title:C.description,children:[e.jsx("span",{className:"text-lg",children:C.icon}),e.jsx("span",{className:"font-medium",children:C.label})]},C.id))}),e.jsxs("div",{className:"bg-gray-900/50 rounded-xl p-4",children:[j==="plates"&&e.jsx(da,{onWeightCalculated:n}),j==="warmup"&&e.jsx(xa,{workingWeight:135}),j==="timer"&&e.jsx(ma,{}),j==="notes"&&e.jsx(va,{workoutId:`workout-${Date.now()}`}),j==="history"&&a?.id&&e.jsx(ga,{exerciseId:a.id,exerciseName:a.name||"Exercise"}),j==="history"&&!a?.id&&e.jsxs("div",{className:"text-center text-gray-400 py-8",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ðŸ“Š"}),e.jsx("p",{children:"Select an exercise to view history"})]})]})]})]})};function dr(){const{token:a}=bt(),n=vt(),[i,m]=t.useState("select"),[j,d]=t.useState(!0),[P,C]=t.useState(30),[M,b]=t.useState("gym"),[E,w]=t.useState([]),[g,k]=t.useState(["strength"]),[T,l]=t.useState(null),[u,c]=t.useState(0),[N,$]=t.useState([]),[G,f]=t.useState(""),[F,x]=t.useState(null),[p,O]=t.useState([]),[Y,U]=t.useState(!1),[D,Z]=t.useState(null),[Q,q]=t.useState(3),[V,y]=t.useState(!1),[o,_]=t.useState(null),[z,se]=t.useState(10),[le,me]=t.useState(0),[ne,K]=t.useState(null),[oe,ce]=t.useState(null),te=t.useRef(null),S=t.useRef(null),[B,X]=t.useState(!1),[fe,ye]=t.useState(!1),[je,ke]=t.useState([]),{activeSession:Ce,isSessionActive:Me,startSession:R,completeSession:I,recoverSession:W,abandonSession:ee,recoverableSessions:ae,totalSets:Ge,registerCallbacks:ts}=Ue();t.useEffect(()=>{ts({onPR:s=>{K(`NEW ${s.prType.toUpperCase()} PR! ${s.exerciseName}`),setTimeout(()=>K(null),3e3)},onLevelUp:s=>{K(`LEVEL UP! You're now level ${s}!`),setTimeout(()=>K(null),4e3)}})},[ts]),t.useEffect(()=>{ae&&ae.length>0&&(ke(ae),ye(!0))},[ae]),t.useEffect(()=>{(i==="workout"||i==="manual")&&!te.current&&(te.current=`session-${Date.now()}-${Math.random().toString(36).slice(2)}`,S.current=Date.now())},[i]);const as=t.useCallback(async s=>{if(!a||!te.current||s.length===0)return;const r={sessionId:te.current,isActive:!0,startTime:S.current||Date.now(),pausedAt:null,totalPausedTime:0,exercises:s.map(v=>({id:v.id,name:v.name,primaryMuscles:v.primaryMuscles||v.primary_muscles||[],secondaryMuscles:v.secondaryMuscles||v.secondary_muscles||[]})),currentExercise:s[s.length-1]||null,currentExerciseIndex:s.length-1,currentSetIndex:0,sets:s.map((v,h)=>({id:`set-${h}`,exerciseId:v.id,exerciseName:v.name,weight:v.weight||0,reps:v.reps||0,tag:"working",timestamp:Date.now()})),totalVolume:s.reduce((v,h)=>v+(h.weight||0)*(h.reps||0)*(h.sets||1),0),totalReps:s.reduce((v,h)=>v+(h.reps||0)*(h.sets||1),0),estimatedCalories:s.length*50,musclesWorked:[...new Set(s.flatMap(v=>v.primaryMuscles||v.primary_muscles||[]))],sessionPRs:[],exerciseGroups:[],activeGroupExerciseIndex:0,activeGroupRound:1,groupSets:[],clientVersion:1};try{await Jt(r,!1)}catch{}},[a]);t.useEffect(()=>{p.length>0&&(i==="workout"||i==="manual")&&as(p)},[p,i,as]),t.useEffect(()=>{w([])},[M]);const Ls=Sa[M]||ka,re=t.useCallback(()=>{if(!T)return[];const s=[];return T.warmup&&s.push(...T.warmup.map(r=>({...r,phase:"warmup"}))),T.exercises&&s.push(...T.exercises.map(r=>({...r,phase:"main"}))),T.cooldown&&s.push(...T.cooldown.map(r=>({...r,phase:"cooldown"}))),s},[T]),Ee=t.useMemo(()=>{const s={};return p.forEach(r=>{const v=r.primaryMuscles||r.primary_muscles||[],h=r.secondaryMuscles||r.secondary_muscles||[],A=r.sets||3,L=r.reps||10,H=Math.min(1,A*L/50);v.forEach(de=>{const he=ve(de),we=s[he]||{intensity:0};s[he]={intensity:Math.min(1,we.intensity+H*.4),isPrimary:!0}}),h.forEach(de=>{const he=ve(de),we=s[he]||{intensity:0,isPrimary:!1};we.isPrimary?s[he].intensity=Math.min(1,we.intensity+H*.2):s[he]={intensity:Math.min(1,we.intensity+H*.2),isPrimary:!1}})}),Object.entries(s).map(([r,{intensity:v,isPrimary:h}])=>({id:r,intensity:v,isPrimary:h}))},[p]),Os=t.useMemo(()=>{if(!T)return[];const r=re()[u];if(!r)return[];const v=[],h=r.primaryMuscles||r.primary_muscles||[],A=r.secondaryMuscles||r.secondary_muscles||[];return h.forEach(L=>{v.push({id:ve(L),intensity:1,isPrimary:!0})}),A.forEach(L=>{v.push({id:ve(L),intensity:.5,isPrimary:!1})}),v},[T,u]);t.useEffect(()=>{i==="manual"&&N.length===0&&(U(!0),fetch("/api/exercises").then(s=>s.json()).then(s=>{const v=(s.data||s.exercises||[]).map(h=>({...h,primary_muscles:typeof h.primaryMuscles=="string"?h.primaryMuscles.split(",").map(A=>A.trim()).filter(Boolean):h.primaryMuscles||[]}));$(v),U(!1)}).catch(()=>U(!1)))},[i,N.length]);const Ds=async()=>{U(!0),ce(null);try{const s=await fetch("/api/prescription/generate",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({timeAvailable:P,location:M,equipment:E,goals:g})}),r=await s.json();if(!s.ok)throw new Error(r.error?.message||"Failed to generate workout");const v=r.data;l(v),c(0),m("workout");const h=[...v.warmup||[],...v.exercises||[],...v.cooldown||[]].filter(A=>A.id||A.exerciseId).map(A=>({exerciseId:A.id||A.exerciseId,name:A.name,plannedSets:A.sets||3,plannedReps:typeof A.reps=="number"?A.reps:10}));h.length>0&&await R(h)}catch(s){ce(s.message||"Failed to generate workout. Try different constraints.")}finally{U(!1)}},Bs=s=>{w(r=>r.includes(s)?r.filter(v=>v!==s):[...r,s])},Us=s=>{k(r=>r.includes(s)?r.length>1?r.filter(v=>v!==s):r:[...r,s])},Gs=t.useCallback(async()=>{if(!T)return;const r=re().filter(v=>v.id||v.exerciseId).map(v=>({exerciseId:v.id||v.exerciseId,name:v.name,plannedSets:v.sets||3,plannedReps:typeof v.reps=="number"?v.reps:10}));r.length>0&&await R(r)},[T,re,R]),Te=t.useRef(!1),rs=async()=>{if(Te.current||p.length===0)return;Te.current=!0,y(!0);const s=[...p];try{if(Me&&Ce){const r=await I();r?(te.current&&(await ps("completed",r.workout?.id),te.current=null,S.current=null),_({tuEarned:r.tuEarned||0,xpEarned:r.xpEarned||0,characterStats:r.characterStats,exerciseCount:r.sessionSummary?.exerciseCount||s.length,totalSets:r.sessionSummary?.totalSets||Ge,exercises:s,levelUp:r.levelUp,newLevel:r.newLevel,achievements:r.achievements,sessionSummary:r.sessionSummary}),O([])):alert("Failed to complete workout. Please try again.")}else{const r=s.filter(L=>{const H=L.id&&typeof L.id=="string"&&!L.id.startsWith("activity-"),de=!L.isActivity;return H&&de}).map(L=>({exerciseId:L.id,sets:L.sets||3,reps:typeof L.reps=="number"?L.reps:10,weight:L.weight||void 0}));if(r.length===0){alert("No exercises to log. Complete at least one exercise (not just warmup/cooldown) to save your workout."),Te.current=!1,y(!1);return}const v=`workout-${Date.now()}-${Math.random().toString(36).slice(2)}`,h=await fetch("/api/workouts",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+a},body:JSON.stringify({exercises:r,idempotencyKey:v,notes:`${p.length} exercises completed`})}),A=await h.json();if(h.ok&&A.data){te.current&&(await ps("completed",A.data.id),te.current=null,S.current=null);const L=s.length,H=s.reduce((de,he)=>de+(he.sets||0),0);_({tuEarned:A.data.totalTU,characterStats:A.data.characterStats,exerciseCount:L,totalSets:H,exercises:s}),O([])}else alert(A.error?.message||A.error||"Failed to complete workout")}}catch{alert("Error completing workout. Please try again.")}finally{Te.current=!1,y(!1)}},qs=N.filter(s=>{const r=!G||s.name.toLowerCase().includes(G.toLowerCase()),v=Qe(s.primary_muscles),h=!F||v&&v.id===F;return r&&h}).slice(0,24);async function Vs(){if(D)try{await fetch("/api/workouts/exercise",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+a},body:JSON.stringify({exerciseId:D.id,sets:Q,reps:z,weight:le})}),O([...p,{...D,sets:Q,reps:z,weight:le}]),K(D.name),setTimeout(()=>K(null),2e3),Z(null)}catch{}}const zs=s=>Ss[s.type]||Ss.default,qe=s=>{const r=Qe(s.primary_muscles||s.primaryMuscles);return r?r.icon:"ðŸ’ª"},ls=s=>{const r=Qe(s.primary_muscles||s.primaryMuscles);return r?r.name:""},Hs=async s=>{const r=s.id||s.exerciseId;if(s.isActivity||!r){const h=`activity-${u}`;p.some(H=>H.id===h)||O(H=>[...H,{id:h,name:s.name||s.description||"Activity",sets:s.sets||1,reps:s.reps||1,weight:0,isActivity:!0}]),K(s.name||s.description),setTimeout(()=>K(null),2e3);const L=re();u<L.length-1&&c(u+1);return}try{await fetch("/api/workouts/exercise",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+a},body:JSON.stringify({exerciseId:r,sets:s.sets,reps:typeof s.reps=="number"?s.reps:10,weight:0})}),O([...p,{id:r,name:s.name,sets:s.sets,reps:s.reps,weight:0,primaryMuscles:s.primaryMuscles}]),K(s.name),setTimeout(()=>K(null),2e3);const h=re();u<h.length-1&&c(u+1)}catch{}},Ys=()=>e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-gray-900 via-gray-800 to-gray-900 text-white pb-24",children:[e.jsx("header",{className:"bg-gray-900/80 backdrop-blur-lg p-4 sticky top-0 z-10 border-b border-gray-700/30",children:e.jsxs("div",{className:"max-w-5xl mx-auto flex items-center justify-between",children:[e.jsxs(jt,{to:"/dashboard",className:"flex items-center gap-2 text-blue-400 hover:text-blue-300 transition-colors",children:[e.jsx("span",{children:"â†"}),e.jsx("img",{src:"/logo.png",alt:"MuscleMap",className:"w-6 h-6 rounded-md"})]}),e.jsx("h1",{className:"text-xl font-bold",children:"Start Workout"}),e.jsx("div",{})]})}),e.jsxs("main",{className:"max-w-lg mx-auto p-4 space-y-6",children:[oe&&e.jsx("div",{className:"bg-red-500/20 border border-red-500 rounded-xl p-4 text-red-200",children:oe}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-sm text-gray-400 uppercase mb-3",children:"How long do you have?"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:Na.map(s=>e.jsxs("button",{onClick:()=>C(s.value),className:`p-3 rounded-xl text-center transition-all ${P===s.value?"bg-purple-600 ring-2 ring-purple-400":"bg-gray-800 hover:bg-gray-700"}`,children:[e.jsx("div",{className:"font-bold",children:s.label}),e.jsx("div",{className:"text-xs text-gray-400",children:s.description})]},s.value))})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-sm text-gray-400 uppercase mb-3",children:"Where are you?"}),e.jsx("div",{className:"grid grid-cols-5 gap-2",children:Ye.map(s=>e.jsxs("button",{onClick:()=>b(s.value),className:`p-3 rounded-xl text-center transition-all ${M===s.value?"bg-purple-600 ring-2 ring-purple-400":"bg-gray-800 hover:bg-gray-700"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:s.icon}),e.jsx("div",{className:"text-xs",children:s.label})]},s.value))})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-sm text-gray-400 uppercase mb-3",children:["Available at ",Ye.find(s=>s.value===M)?.label||"Location"," (optional)"]}),e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-2 max-h-48 overflow-y-auto",children:Ls.map(s=>e.jsxs("button",{onClick:()=>Bs(s.value),className:`p-3 rounded-xl text-center transition-all ${E.includes(s.value)?"bg-green-600 ring-2 ring-green-400":"bg-gray-800 hover:bg-gray-700"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:s.icon}),e.jsx("div",{className:"text-xs leading-tight",children:s.label})]},s.value))}),E.length===0&&e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"No equipment selected = bodyweight exercises"}),E.length>0&&e.jsxs("p",{className:"text-xs text-green-400 mt-2",children:[E.length," item",E.length>1?"s":""," selected"]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-sm text-gray-400 uppercase mb-3",children:"Your Goal"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Ca.map(s=>e.jsxs("button",{onClick:()=>Us(s.value),className:`p-3 rounded-xl text-left transition-all ${g.includes(s.value)?"bg-blue-600 ring-2 ring-blue-400":"bg-gray-800 hover:bg-gray-700"}`,children:[e.jsx("span",{className:"text-xl mr-2",children:s.icon}),e.jsx("span",{className:"font-medium",children:s.label})]},s.value))})]}),e.jsx("button",{onClick:Ds,disabled:Y,className:"w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-500 hover:to-blue-500 py-4 rounded-2xl font-bold text-lg transition-all disabled:opacity-50",children:Y?"Generating...":"Generate Workout"}),e.jsx("button",{onClick:()=>m("manual"),className:"w-full bg-gray-800 hover:bg-gray-700 py-3 rounded-xl text-gray-400 text-sm",children:"Or browse all exercises manually"})]})]}),Qs=()=>{const s=re(),r=s[u],v=s.length>0?(u+1)/s.length*100:0;return e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-gray-900 via-gray-800 to-gray-900 text-white pb-24",children:[ne&&e.jsxs("div",{className:"fixed top-20 left-1/2 -translate-x-1/2 z-50 bg-green-500 px-8 py-4 rounded-2xl font-bold animate-bounce",children:["Done: ",ne]}),e.jsx("header",{className:"bg-gray-900/80 backdrop-blur-lg p-4 sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-5xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("button",{onClick:()=>{m("select"),l(null)},className:"text-blue-400",children:"â† Exit"}),e.jsx("h1",{className:"text-xl font-bold",children:"Your Workout"}),e.jsxs("div",{className:"bg-green-600 px-3 py-1 rounded-full text-sm font-bold",children:[p.length,"/",s.length]})]}),e.jsx("div",{className:"h-2 bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-green-500 to-emerald-400 transition-all duration-300",style:{width:`${v}%`}})})]})}),e.jsxs("main",{className:"max-w-lg mx-auto p-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl overflow-hidden mb-6 border border-white/5",children:[e.jsxs("button",{onClick:()=>d(!j),className:"w-full p-3 flex items-center justify-between text-left",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-2xl",children:"ðŸ”¥"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-white",children:"Muscle Activation"}),e.jsxs("div",{className:"text-xs text-gray-400",children:[Ee.length," muscle groups worked"]})]})]}),e.jsx("svg",{className:`w-5 h-5 text-gray-400 transition-transform ${j?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),j&&e.jsx("div",{className:"p-4 pt-0",children:e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase mb-2",children:"Current Exercise"}),e.jsx(is,{muscles:Os,mode:"compact",interactive:!1,showLabels:!1,autoRotate:!1,className:"w-full",style:{height:140}}),r&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2 justify-center",children:r.primaryMuscles?.slice(0,3).map(h=>e.jsx("span",{className:"bg-purple-500/30 text-purple-200 px-2 py-0.5 rounded text-xs",children:h},h))})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase mb-2",children:"Workout Total"}),e.jsx(is,{muscles:Ee,mode:"compact",interactive:!1,showLabels:!1,autoRotate:!1,className:"w-full",style:{height:140}}),Ee.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2 justify-center",children:Ee.slice(0,3).map(h=>e.jsx("span",{className:"bg-green-500/30 text-green-200 px-2 py-0.5 rounded text-xs",children:h.id.replace(/_/g," ")},h.id))})]})]})})]}),e.jsx(ks,{currentExercise:r,onWeightCalculated:h=>{}}),e.jsxs("div",{className:"bg-gray-800 rounded-2xl p-4 mb-6",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-400 mb-2",children:[e.jsxs("span",{children:[T?.actualDuration||P," min"]}),e.jsxs("span",{children:[Ye.find(h=>h.value===M)?.icon," ",M]}),e.jsxs("span",{children:[s.length," exercises"]})]}),T?.muscleCoverage&&e.jsx("div",{className:"flex flex-wrap gap-1",children:Object.keys(T.muscleCoverage).slice(0,6).map(h=>e.jsx("span",{className:"bg-gray-700 px-2 py-1 rounded text-xs",children:h},h))})]}),r&&e.jsxs("div",{className:"bg-gradient-to-br from-purple-600 to-blue-600 rounded-3xl overflow-hidden mb-6 shadow-2xl",children:[r.id&&wt(r.id)&&e.jsx("div",{className:"h-40 bg-black/20",children:e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-white/5 to-white/10 animate-pulse"}),children:e.jsx(ja,{exerciseId:r.id,exerciseName:r.name,primaryMuscles:r.primaryMuscles,size:"md",showMuscleLabels:!1,interactive:!1,className:"w-full h-full"})})}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide opacity-70 mb-2",children:r.phase==="warmup"?"Warm-up":r.phase==="cooldown"?"Cool-down":`Exercise ${u+1-(T?.warmup?.length||0)}`}),e.jsx("h2",{className:"text-2xl font-bold mb-4",children:r.name}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-white/20 rounded-xl p-3 text-center",children:[e.jsx("div",{className:"text-3xl font-bold",children:r.sets}),e.jsx("div",{className:"text-xs opacity-80",children:"Sets"})]}),e.jsxs("div",{className:"bg-white/20 rounded-xl p-3 text-center",children:[e.jsx("div",{className:"text-3xl font-bold",children:r.reps}),e.jsx("div",{className:"text-xs opacity-80",children:"Reps"})]}),e.jsxs("div",{className:"bg-white/20 rounded-xl p-3 text-center",children:[e.jsxs("div",{className:"text-3xl font-bold",children:[r.restSeconds,"s"]}),e.jsx("div",{className:"text-xs opacity-80",children:"Rest"})]})]}),r.notes&&e.jsx("p",{className:"text-sm opacity-80 mb-4",children:r.notes}),e.jsx("div",{className:"flex gap-2 text-xs opacity-70 flex-wrap",children:r.primaryMuscles?.map(h=>e.jsx("span",{className:"bg-white/10 px-2 py-1 rounded",children:h},h))})]})]}),r&&e.jsx("div",{className:"mb-6",children:e.jsx(Xt,{exerciseId:r.exerciseId,delay:1500})}),r&&r.id&&!r.isActivity&&e.jsxs("div",{className:"mb-6 bg-gray-800/50 rounded-2xl p-4 border border-gray-700/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-300",children:"Log Your Sets"}),e.jsx("button",{onClick:()=>X(!0),className:"text-xs text-blue-400 hover:text-blue-300",children:"Swap Exercise"})]}),e.jsx(na,{exerciseId:r.id,exerciseName:r.name,suggestedSets:r.sets||3,suggestedReps:typeof r.reps=="number"?r.reps:10,onStartSession:Gs,onSetLogged:h=>{O(A=>A.find(H=>H.id===r.id)?A.map(H=>H.id===r.id?{...H,sets:(H.sets||0)+1,tu:(H.tu||0)+(h.tu||0)}:H):[...A,{id:r.id,name:r.name,sets:1,reps:h.reps,weight:Math.round((h.weightKg||0)*2.205),tu:h.tu||0,primaryMuscles:r.primaryMuscles}])},onAllSetsComplete:()=>{const h=re();u<h.length-1&&c(u+1),K(`${r.name} completed!`),setTimeout(()=>K(null),2e3)},compact:!1})]}),r&&(r.isActivity||!r.id)&&e.jsxs("div",{className:"flex gap-3 mb-6",children:[e.jsx("button",{onClick:()=>u>0&&c(u-1),disabled:u===0,className:"flex-1 bg-gray-700 hover:bg-gray-600 disabled:opacity-50 py-4 rounded-xl font-bold",children:"Previous"}),e.jsx("button",{onClick:()=>Hs(r),className:"flex-[2] bg-green-600 hover:bg-green-500 py-4 rounded-xl font-bold text-lg",children:"Done"}),e.jsx("button",{onClick:()=>u<s.length-1&&c(u+1),disabled:u===s.length-1,className:"flex-1 bg-gray-700 hover:bg-gray-600 disabled:opacity-50 py-4 rounded-xl font-bold",children:"Skip"})]}),r&&r.id&&!r.isActivity&&e.jsxs("div",{className:"flex gap-3 mb-6",children:[e.jsx("button",{onClick:()=>u>0&&c(u-1),disabled:u===0,className:"flex-1 bg-gray-700 hover:bg-gray-600 disabled:opacity-50 py-3 rounded-xl font-medium",children:"Previous"}),e.jsx("button",{onClick:()=>{p.some(L=>L.id===r.id)||O(L=>[...L,{id:r.id,name:r.name,sets:r.sets||3,reps:typeof r.reps=="number"?r.reps:10,weight:0,primaryMuscles:r.primaryMuscles}]),K(`${r.name} completed!`),setTimeout(()=>K(null),2e3);const A=re();u<A.length-1&&c(u+1)},className:"flex-[2] bg-green-600 hover:bg-green-500 py-3 rounded-xl font-bold",children:"Done"}),e.jsx("button",{onClick:()=>{const h=re();u<h.length-1&&c(u+1)},disabled:u===s.length-1,className:"flex-1 bg-gray-700 hover:bg-gray-600 disabled:opacity-50 py-3 rounded-xl font-medium",children:"Skip"})]}),p.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm text-gray-400 uppercase mb-3",children:"Completed"}),e.jsx("div",{className:"space-y-2",children:p.map((h,A)=>e.jsxs("div",{className:"bg-gray-800 rounded-xl p-3 flex items-center gap-3",children:[e.jsx("div",{className:"bg-green-600 w-8 h-8 rounded-full flex items-center justify-center text-sm",children:"âœ“"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:h.name}),e.jsxs("div",{className:"text-xs text-gray-400",children:[h.sets," x ",h.reps]})]})]},A))})]}),p.length>0&&e.jsx("button",{onClick:rs,disabled:V,className:"w-full bg-gradient-to-r from-green-600 to-emerald-500 hover:from-green-500 hover:to-emerald-400 py-4 rounded-2xl font-bold text-lg transition-all",children:V?"Completing...":`Complete Workout (${p.length} exercises)`}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-sm text-gray-400 uppercase mb-3",children:"All Exercises"}),e.jsx("div",{className:"space-y-2",children:s.map((h,A)=>{const L=p.some(de=>de.name===h.name),H=A===u;return e.jsxs("button",{onClick:()=>c(A),className:`w-full text-left rounded-xl p-3 flex items-center gap-3 transition-all ${H?"bg-purple-600":L?"bg-gray-800 opacity-60":"bg-gray-800 hover:bg-gray-700"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm ${L?"bg-green-600":H?"bg-white/20":"bg-gray-700"}`,children:L?"âœ“":A+1}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:h.name}),e.jsxs("div",{className:"text-xs text-gray-400",children:[h.sets," x ",h.reps," | ",h.phase]})]})]},A)})})]})]})]})},Ks=()=>e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-gray-900 via-gray-800 to-gray-900 text-white pb-24",children:[ne&&e.jsxs("div",{className:"fixed top-20 left-1/2 -translate-x-1/2 z-50 bg-green-500 px-8 py-4 rounded-2xl font-bold animate-bounce",children:[ne,"!"]}),D&&e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-end justify-center",onClick:()=>Z(null),children:e.jsxs("div",{className:"bg-gray-800 rounded-t-3xl p-6 w-full max-w-lg",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("span",{className:"text-5xl",children:qe(D)}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:D.name}),e.jsx("p",{className:"text-gray-400",children:ls(D)})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Sets"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-2",children:[e.jsx("button",{onClick:()=>q(Math.max(1,Q-1)),className:"bg-gray-700 w-10 h-10 rounded-full text-xl",children:"-"}),e.jsx("span",{className:"text-3xl font-bold w-12 text-center",children:Q}),e.jsx("button",{onClick:()=>q(Q+1),className:"bg-gray-700 w-10 h-10 rounded-full text-xl",children:"+"})]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Reps"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-2",children:[e.jsx("button",{onClick:()=>se(Math.max(1,z-1)),className:"bg-gray-700 w-10 h-10 rounded-full text-xl",children:"-"}),e.jsx("span",{className:"text-3xl font-bold w-12 text-center",children:z}),e.jsx("button",{onClick:()=>se(z+1),className:"bg-gray-700 w-10 h-10 rounded-full text-xl",children:"+"})]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"lbs"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-2",children:[e.jsx("button",{onClick:()=>me(Math.max(0,le-5)),className:"bg-gray-700 w-10 h-10 rounded-full text-xl",children:"-"}),e.jsx("span",{className:"text-3xl font-bold w-12 text-center",children:le}),e.jsx("button",{onClick:()=>me(le+5),className:"bg-gray-700 w-10 h-10 rounded-full text-xl",children:"+"})]})]})]}),e.jsx("button",{onClick:Vs,className:"w-full bg-green-600 hover:bg-green-700 py-4 rounded-2xl font-bold text-lg",children:"Log Exercise"})]})}),e.jsx("header",{className:"bg-gray-900/80 backdrop-blur-lg p-4 sticky top-0 z-10 border-b border-gray-700/30",children:e.jsxs("div",{className:"max-w-5xl mx-auto flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>m("select"),className:"flex items-center gap-2 text-blue-400 hover:text-blue-300 transition-colors",children:[e.jsx("span",{children:"â†"}),e.jsx("img",{src:"/logo.png",alt:"MuscleMap",className:"w-6 h-6 rounded-md"})]}),e.jsx("h1",{className:"text-xl font-bold",children:"Browse Exercises"}),e.jsxs("div",{className:"bg-green-600 px-3 py-1 rounded-full text-sm font-bold",children:[p.length," logged"]})]})}),e.jsxs("main",{className:"max-w-5xl mx-auto p-4",children:[e.jsx(ks,{currentExercise:D,onWeightCalculated:s=>me(s)}),p.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-sm text-gray-400 mb-2 uppercase",children:"Today's Workout"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:p.map((s,r)=>e.jsxs("div",{className:"bg-gray-800 rounded-xl p-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:qe(s)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-sm truncate",children:s.name}),e.jsxs("div",{className:"text-xs text-gray-400",children:[s.sets,"x",s.reps," ",s.weight>0?`${s.weight}lb`:""]})]})]},r))}),e.jsx("button",{onClick:rs,disabled:V,className:"w-full bg-green-600 hover:bg-green-500 py-4 rounded-2xl font-bold text-lg mt-4 transition-all",children:V?"Completing...":"Complete Workout"})]}),e.jsx("input",{type:"text",placeholder:"Search exercises...",value:G,onChange:s=>f(s.target.value),className:"w-full bg-gray-800 rounded-2xl p-4 mb-4 text-lg"}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-4 mb-4",children:[e.jsx("button",{onClick:()=>x(null),className:`px-4 py-2 rounded-full text-sm font-bold whitespace-nowrap ${F?"bg-gray-700":"bg-purple-600"}`,children:"All"}),Ws.map(s=>e.jsxs("button",{onClick:()=>x(s.id),className:`px-4 py-2 rounded-full text-sm font-bold whitespace-nowrap ${F===s.id?"bg-purple-600":"bg-gray-700"}`,children:[s.icon," ",s.name]},s.id))]}),Y?e.jsx("div",{className:"text-center py-12 text-gray-400",children:"Loading exercises..."}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:qs.map(s=>{const r=[...(s.primary_muscles||[]).map(v=>({id:ve(v),intensity:1,isPrimary:!0})),...(s.secondary_muscles||[]).slice(0,2).map(v=>({id:ve(v),intensity:.5,isPrimary:!1}))];return e.jsxs("button",{onClick:()=>Z(s),className:`bg-gradient-to-br ${zs(s).c} rounded-2xl p-3 text-left hover:scale-105 active:scale-95 transition-all shadow-lg relative`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("div",{className:"text-3xl",children:qe(s)}),r.length>0&&e.jsx(Nt,{muscles:r,size:"xs",className:"opacity-90"})]}),e.jsx("div",{className:"font-bold text-sm truncate mt-1",children:s.name}),e.jsx("div",{className:"text-xs opacity-80",children:ls(s)})]},s.id)})})]})]}),Js=()=>o&&e.jsx(ta,{workout:{duration:P,exerciseCount:o.exerciseCount||0,totalSets:o.totalSets||0,totalTU:o.tuEarned||0,exercises:o.exercises||[],goals:g},onClose:()=>{_(null),m("select"),l(null),O([]),n("/dashboard")}}),Zs=async s=>{await W(s)&&Ce&&(m("workout"),ye(!1))},Xs=async s=>{await ee(s),ke(r=>r.filter(v=>v.id!==s)),je.length<=1&&ye(!1)},et=s=>{const v=re()[u];if(T&&v){const h=A=>A.map(L=>L.id===v.id||L.exerciseId===v.exerciseId?{...L,id:s.id,exerciseId:s.id,name:s.name,primaryMuscles:s.primaryMuscles}:L);l({...T,warmup:T.warmup?h(T.warmup):void 0,exercises:T.exercises?h(T.exercises):void 0,cooldown:T.cooldown?h(T.cooldown):void 0})}X(!1),K(`Switched to ${s.name}`),setTimeout(()=>K(null),2e3)};return e.jsxs(e.Fragment,{children:[Js(),i==="select"&&Ys(),i==="workout"&&Qs(),i==="manual"&&Ks(),(i==="workout"||i==="manual")&&Me&&e.jsx(St,{}),B&&u>=0&&e.jsx(ia,{exerciseId:re()[u]?.id||"",exerciseName:re()[u]?.name||"",availableEquipment:E,onSelect:et,onCancel:()=>X(!1)}),fe&&je.length>0&&e.jsx(oa,{sessions:je,onRecover:Zs,onDiscard:Xs,onDismiss:()=>ye(!1)})]})}export{dr as default};
