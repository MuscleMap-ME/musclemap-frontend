import{r as o,j as e}from"./react-vendor-D1NxaRNd.js";import{G as $}from"./GlassSurface-BMiMerMg.js";import{ad as O,e6 as V,Z as B,aa as H,U as J,q as z,ac as Z,bf as K,at as Q}from"./index-Ccc0k-LV.js";import{R as X}from"./refresh-cw--UgqUSLd.js";import{T as Y}from"./triangle-alert-CEKTQ3Ql.js";import{T as ee}from"./trending-down-BaRaDMHZ.js";import{L as A}from"./loader-circle-DK5iRVaE.js";import{G as te}from"./gauge-DuwLrm79.js";import{W as se}from"./wifi--NCg5msY.js";import{W as re}from"./wifi-off-CaBt1y3B.js";import{A as ae}from"./arrow-up-down-DicB2gcz.js";import"./leaflet-vendor-DZbo3Ov0.js";import"./recharts-vendor-BziRPEEi.js";import"./d3-vendor-mcDw60ct.js";import"./apollo-vendor-BMQ75Ycx.js";import"./reactflow-vendor-Dz2P_-Qa.js";const S="/api",ne=[{id:"5m",label:"5 min",seconds:300},{id:"15m",label:"15 min",seconds:900},{id:"1h",label:"1 hour",seconds:3600},{id:"6h",label:"6 hours",seconds:21600},{id:"24h",label:"24 hours",seconds:86400}],C={requests:"#3b82f6",errors:"#ef4444",latency:"#f59e0b",users:"#10b981"};function E(t,a=0){return t==null?"0":t>=1e6?`${(t/1e6).toFixed(1)}M`:t>=1e3?`${(t/1e3).toFixed(1)}K`:t.toFixed(a)}function D(t){return t==null?"0ms":t>=1e3?`${(t/1e3).toFixed(2)}s`:`${t.toFixed(0)}ms`}function le(t){return t==null?"0%":`${t.toFixed(2)}%`}function ce(t,a){return!a||t===a?"neutral":t>a?"up":"down"}function oe(t,a){return a==="errors"||a==="latency"?t==="up"?"text-red-400":t==="down"?"text-green-400":"text-gray-400":t==="up"?"text-green-400":t==="down"?"text-red-400":"text-gray-400"}function ie({data:t,color:a,height:r=40,width:h=100}){if(!t||t.length<2)return e.jsx("div",{className:"flex items-center justify-center bg-white/5 rounded",style:{height:r,width:h},children:e.jsx("span",{className:"text-xs text-gray-500",children:"No data"})});const n=Math.min(...t),i=Math.max(...t)-n||1,s=t.map((j,b)=>{const R=b/(t.length-1)*h,m=r-(j-n)/i*r*.8-r*.1;return`${R},${m}`}).join(" "),N=`0,${r} ${s} ${h},${r}`;return e.jsxs("svg",{width:h,height:r,className:"overflow-visible",children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:`gradient-${a.replace("#","")}`,x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:a,stopOpacity:"0.3"}),e.jsx("stop",{offset:"100%",stopColor:a,stopOpacity:"0"})]})}),e.jsx("polygon",{points:N,fill:`url(#gradient-${a.replace("#","")})`}),e.jsx("polyline",{points:s,fill:"none",stroke:a,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("circle",{cx:h,cy:r-(t[t.length-1]-n)/i*r*.8-r*.1,r:"3",fill:a,className:"animate-pulse"})]})}function L({title:t,value:a,unit:r,trend:h,trendValue:n,sparklineData:u,color:i,icon:s,isLoading:N}){const j=ce(a,n),b=j==="up"?z:j==="down"?ee:O;return e.jsxs($,{className:"p-4 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-10 blur-3xl",style:{backgroundColor:i}}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center",style:{backgroundColor:`${i}20`},children:e.jsx(s,{className:"w-4 h-4",style:{color:i}})}),e.jsx("span",{className:"text-sm font-medium text-gray-300",children:t})]}),j!=="neutral"&&e.jsxs("div",{className:`flex items-center gap-1 text-xs ${oe(j,t.toLowerCase())}`,children:[e.jsx(b,{className:"w-3 h-3"}),e.jsxs("span",{children:[j==="up"?"+":"-",Math.abs((a-n)/n*100).toFixed(1),"%"]})]})]}),e.jsx("div",{className:"flex items-baseline gap-1 mb-3",children:N?e.jsx(A,{className:"w-6 h-6 animate-spin text-gray-400"}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-3xl font-bold text-white transition-all duration-300",children:typeof a=="number"?E(a,1):a}),r&&e.jsx("span",{className:"text-sm text-gray-400",children:r})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(ie,{data:u,color:i,width:120,height:32})})]})]})}function de({percentiles:t,isLoading:a}){const r=[{label:"p50",value:t?.p50,description:"Median"},{label:"p95",value:t?.p95,description:"95th"},{label:"p99",value:t?.p99,description:"99th"}],h=n=>n?n<100?"text-green-400":n<500?"text-yellow-400":"text-red-400":"text-gray-400";return e.jsxs($,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(te,{className:"w-5 h-5 text-amber-400"}),e.jsx("h3",{className:"text-sm font-semibold text-white",children:"Latency Percentiles"})]}),a?e.jsx("div",{className:"flex items-center justify-center h-20",children:e.jsx(A,{className:"w-6 h-6 animate-spin text-gray-400"})}):e.jsx("div",{className:"grid grid-cols-3 gap-4",children:r.map(({label:n,value:u,description:i})=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:i}),e.jsx("div",{className:`text-xl font-bold ${h(u)}`,children:D(u)}),e.jsx("div",{className:"text-xs text-gray-500",children:n})]},n))}),e.jsx("div",{className:"mt-4 space-y-2",children:r.map(({label:n,value:u})=>{const i=Math.max(t?.p99||100,100),s=(u||0)/i*100;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 text-xs text-gray-400",children:n}),e.jsx("div",{className:"flex-1 h-2 bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-500 rounded-full ${(u||0)<100?"bg-green-500":(u||0)<500?"bg-yellow-500":"bg-red-500"}`,style:{width:`${Math.min(s,100)}%`}})})]},n)})})]})}function xe({connected:t,connectionCount:a,lastUpdate:r}){return e.jsxs($,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t?e.jsx(se,{className:"w-5 h-5 text-green-400"}):e.jsx(re,{className:"w-5 h-5 text-red-400"}),e.jsx("h3",{className:"text-sm font-semibold text-white",children:"WebSocket"})]}),e.jsxs("div",{className:`flex items-center gap-1 text-xs px-2 py-1 rounded ${t?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"}`,children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${t?"bg-green-400 animate-pulse":"bg-red-400"}`}),t?"Connected":"Disconnected"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white/5 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Active Connections"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:a||0})]}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Last Update"}),e.jsx("div",{className:"text-sm font-medium text-white",children:r?new Date(r).toLocaleTimeString():"Never"})]})]})]})}function me({endpoints:t,isLoading:a,sortConfig:r,onSort:h}){const n=[{key:"endpoint",label:"Endpoint",sortable:!0},{key:"method",label:"Method",sortable:!0},{key:"requests",label:"Requests",sortable:!0},{key:"errors",label:"Errors",sortable:!0},{key:"errorRate",label:"Error Rate",sortable:!0},{key:"avgLatency",label:"Avg Latency",sortable:!0},{key:"p99Latency",label:"p99 Latency",sortable:!0}],u=s=>({GET:"bg-green-500/20 text-green-400",POST:"bg-blue-500/20 text-blue-400",PUT:"bg-yellow-500/20 text-yellow-400",DELETE:"bg-red-500/20 text-red-400",PATCH:"bg-purple-500/20 text-purple-400"})[s]||"bg-gray-500/20 text-gray-400",i=s=>r.key!==s?e.jsx(ae,{className:"w-3 h-3 text-gray-500"}):r.direction==="asc"?e.jsx(K,{className:"w-3 h-3 text-cyan-400"}):e.jsx(Q,{className:"w-3 h-3 text-cyan-400"});return e.jsxs($,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Z,{className:"w-5 h-5 text-blue-400"}),e.jsx("h3",{className:"text-sm font-semibold text-white",children:"Endpoint Statistics"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-white/10",children:n.map(s=>e.jsx("th",{className:`text-left text-xs font-medium text-gray-400 pb-3 pr-4 ${s.sortable?"cursor-pointer hover:text-white select-none":""}`,onClick:()=>s.sortable&&h(s.key),children:e.jsxs("div",{className:"flex items-center gap-1",children:[s.label,s.sortable&&i(s.key)]})},s.key))})}),e.jsx("tbody",{children:a?e.jsx("tr",{children:e.jsx("td",{colSpan:n.length,className:"py-8 text-center",children:e.jsx(A,{className:"w-6 h-6 animate-spin text-gray-400 mx-auto"})})}):t?.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:n.length,className:"py-8 text-center text-gray-400 text-sm",children:"No endpoint data available"})}):t?.map((s,N)=>e.jsxs("tr",{className:"border-b border-white/5 hover:bg-white/5 transition-colors",children:[e.jsx("td",{className:"py-3 pr-4",children:e.jsx("code",{className:"text-xs text-gray-300 font-mono",children:s.endpoint})}),e.jsx("td",{className:"py-3 pr-4",children:e.jsx("span",{className:`text-xs px-2 py-0.5 rounded font-medium ${u(s.method)}`,children:s.method})}),e.jsx("td",{className:"py-3 pr-4 text-sm text-white font-medium",children:E(s.requests)}),e.jsx("td",{className:"py-3 pr-4",children:e.jsx("span",{className:`text-sm ${s.errors>0?"text-red-400":"text-gray-400"}`,children:E(s.errors)})}),e.jsx("td",{className:"py-3 pr-4",children:e.jsx("span",{className:`text-sm ${s.errorRate>5?"text-red-400":s.errorRate>1?"text-yellow-400":"text-green-400"}`,children:le(s.errorRate)})}),e.jsx("td",{className:"py-3 pr-4",children:e.jsx("span",{className:`text-sm ${s.avgLatency>500?"text-red-400":s.avgLatency>200?"text-yellow-400":"text-green-400"}`,children:D(s.avgLatency)})}),e.jsx("td",{className:"py-3 pr-4",children:e.jsx("span",{className:`text-sm ${s.p99Latency>1e3?"text-red-400":s.p99Latency>500?"text-yellow-400":"text-green-400"}`,children:D(s.p99Latency)})})]},`${s.method}-${s.endpoint}-${N}`))})]})})]})}function ue({value:t,onChange:a}){return e.jsx("div",{className:"flex items-center gap-1 bg-white/5 rounded-lg p-1",children:ne.map(r=>e.jsx("button",{onClick:()=>a(r.id),className:`px-3 py-1.5 text-xs font-medium rounded-md transition-all ${t===r.id?"bg-cyan-500/20 text-cyan-400":"text-gray-400 hover:text-white hover:bg-white/5"}`,children:r.label},r.id))})}function qe(){const[t,a]=o.useState(null),[r,h]=o.useState(!0),[n,u]=o.useState("5m"),[i,s]=o.useState(!1),[N,j]=o.useState(null),[b,R]=o.useState({key:"requests",direction:"desc"}),[m,P]=o.useState({requests:[],errors:[],latency:[],users:[]}),k=o.useRef(null),q=o.useRef(null),U=o.useCallback(()=>{try{const l=localStorage.getItem("musclemap-auth");if(l){const p=JSON.parse(l);if(p?.state?.token)return{Authorization:`Bearer ${p.state.token}`}}const f=localStorage.getItem("musclemap_token");return f?{Authorization:`Bearer ${f}`}:{}}catch{return{}}},[]),v=o.useCallback(async()=>{try{const l=U(),[f,p,d,w]=await Promise.all([fetch(`${S}/admin/metrics/realtime`,{headers:l}),fetch(`${S}/admin/metrics/endpoints`,{headers:l}),fetch(`${S}/admin/metrics/users`,{headers:l}),fetch(`${S}/admin/metrics/websockets`,{headers:l})]),x=f.ok?await f.json():null,g=p.ok?await p.json():null,M=d.ok?await d.json():null,T=w.ok?await w.json():null,y={requestsPerSecond:x?.requests?.perSecond||0,requestsPerMinute:x?.requests?.perMinute||0,totalRequests:x?.requests?.total||0,errorRate:x?.errors?.rate||0,totalErrors:x?.errors?.total||0,avgLatency:x?.latency?.avg||0,percentiles:{p50:x?.latency?.p50||0,p95:x?.latency?.p95||0,p99:x?.latency?.p99||0},statusCodes:x?.statusCodes||{},activeUsers:M?.activeUsers?.last5m||0,endpoints:g?.endpoints?.map(c=>({endpoint:c.endpoint,method:c.method,requests:c.requests,errors:c.errors,errorRate:c.errorRate,avgLatency:c.latency?.avg||0,p99Latency:c.latency?.p99||0}))||[],websocketConnections:T?.connections?.total||0};a(y),j(Date.now()),P(c=>({requests:[...c.requests.slice(-19),y.requestsPerSecond],errors:[...c.errors.slice(-19),y.errorRate],latency:[...c.latency.slice(-19),y.avgLatency],users:[...c.users.slice(-19),y.activeUsers]}))}catch{}finally{h(!1)}},[U]),I=o.useCallback(()=>{let l=localStorage.getItem("auth_token")||localStorage.getItem("token");if(!l)try{const d=localStorage.getItem("musclemap-auth");d&&(l=JSON.parse(d)?.state?.token||null)}catch{}if(l||(l=localStorage.getItem("musclemap_token")),!l)return;const p=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/api/admin/metrics/stream?token=${encodeURIComponent(l)}`;try{const d=new WebSocket(p);k.current=d,d.onopen=()=>{s(!0)},d.onmessage=w=>{try{const x=JSON.parse(w.data);if(x.type==="metrics"&&x.data){const g=x.data.realtime,M=x.data.users,T=x.data.websockets,y={requestsPerSecond:g?.requests?.perSecond||0,requestsPerMinute:g?.requests?.perMinute||0,totalRequests:g?.requests?.total||0,errorRate:g?.errors?.rate||0,totalErrors:g?.errors?.total||0,avgLatency:g?.latency?.avg||0,percentiles:{p50:g?.latency?.p50||0,p95:g?.latency?.p95||0,p99:g?.latency?.p99||0},statusCodes:g?.statusCodes||{},activeUsers:M?.activeUsers?.last5m||0,websocketConnections:T?.connections?.total||0};a(c=>({...c,...y})),j(Date.now()),P(c=>({requests:[...c.requests.slice(-19),y.requestsPerSecond],errors:[...c.errors.slice(-19),y.errorRate],latency:[...c.latency.slice(-19),y.avgLatency],users:[...c.users.slice(-19),y.activeUsers]}))}}catch{}},d.onerror=w=>{s(!1)},d.onclose=()=>{s(!1),q.current=setTimeout(()=>{I()},5e3)}}catch{s(!1)}},[]),F=o.useCallback(()=>{q.current&&clearTimeout(q.current),k.current&&(k.current.close(),k.current=null)},[]),G=o.useMemo(()=>t?.endpoints?[...t.endpoints].sort((l,f)=>{const p=l[b.key]||0,d=f[b.key]||0;return typeof p=="string"?b.direction==="asc"?p.localeCompare(d):d.localeCompare(p):b.direction==="asc"?p-d:d-p}):[],[t?.endpoints,b]),_=o.useCallback(l=>{R(f=>({key:l,direction:f.key===l&&f.direction==="desc"?"asc":"desc"}))},[]),W=o.useRef(!1);return o.useEffect(()=>{W.current=i},[i]),o.useEffect(()=>{v(),I();const l=setInterval(()=>{W.current||v()},5e3);return()=>{clearInterval(l),F()}},[]),o.useEffect(()=>{v()},[n,v]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(O,{className:"w-6 h-6 text-cyan-400"}),"Real-Time Metrics"]}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Monitor API performance and system health"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ue,{value:n,onChange:u}),e.jsx("button",{onClick:v,disabled:r,className:"flex items-center gap-2 px-3 py-2 rounded-lg bg-white/5 hover:bg-white/10 border border-white/10 transition-colors disabled:opacity-50",children:e.jsx(X,{className:`w-4 h-4 text-gray-400 ${r?"animate-spin":""}`})})]})]}),i&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-green-400",children:[e.jsx(V,{className:"w-3 h-3 animate-pulse"}),e.jsx("span",{children:"Live updates enabled"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(L,{title:"Requests/sec",value:t?.requestsPerSecond,unit:"req/s",trend:"up",trendValue:m.requests[m.requests.length-2],sparklineData:m.requests,color:C.requests,icon:B,isLoading:r}),e.jsx(L,{title:"Error Rate",value:t?.errorRate,unit:"%",trend:"down",trendValue:m.errors[m.errors.length-2],sparklineData:m.errors,color:C.errors,icon:Y,isLoading:r}),e.jsx(L,{title:"Avg Latency",value:t?.avgLatency,unit:"ms",trend:"down",trendValue:m.latency[m.latency.length-2],sparklineData:m.latency,color:C.latency,icon:H,isLoading:r}),e.jsx(L,{title:"Active Users",value:t?.activeUsers,unit:"users",trend:"up",trendValue:m.users[m.users.length-2],sparklineData:m.users,color:C.users,icon:J,isLoading:r})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx(de,{percentiles:t?.percentiles,isLoading:r}),e.jsx(xe,{connected:i,connectionCount:t?.websocketConnections,lastUpdate:N})]}),e.jsx(me,{endpoints:G,isLoading:r,sortConfig:b,onSort:_})]})}export{qe as default};
