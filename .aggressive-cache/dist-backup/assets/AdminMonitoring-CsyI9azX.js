import{r as a,j as e,L as J}from"./react-vendor-D1NxaRNd.js";import{k as K,e as Q,ad as V,B as k,H as Y,aa as Z}from"./index-YhIq0fk2.js";import{G as l}from"./GlassSurface-BMiMerMg.js";import{T as S}from"./triangle-alert-FxtdNUox.js";import{S as ee}from"./server-WHacOOel.js";import{R as N}from"./refresh-cw-BQspzjTn.js";import{C}from"./circle-check-big-DqcC1HSs.js";import{C as T}from"./circle-x-CXwJsdRJ.js";import{C as I}from"./chevron-down-DxQkCsRL.js";import{C as P}from"./chevron-right-BICnbdva.js";import"./leaflet-vendor-DZbo3Ov0.js";import"./apollo-vendor-BMQ75Ycx.js";import"./reactflow-vendor-Dz2P_-Qa.js";import"./d3-vendor-mcDw60ct.js";import"./recharts-vendor-BziRPEEi.js";const se=[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]],te=K("route",se),o="/api/monitoring";function ve(){const{user:L}=Q(),[i,B]=a.useState("dashboard"),[O,E]=a.useState(!0),[d,z]=a.useState(null),[n,g]=a.useState(null),[A,M]=a.useState([]),[D,U]=a.useState([]),[R,_]=a.useState([]),[x,F]=a.useState(null),[v,$]=a.useState(!1),[u,q]=a.useState(null),[f,G]=a.useState(null),r=a.useCallback(()=>{try{const s=localStorage.getItem("musclemap-auth");if(s){const c=JSON.parse(s)?.state?.token;if(c)return{Authorization:`Bearer ${c}`}}}catch{}return{}},[]),m=a.useCallback(async()=>{try{const s=await fetch(`${o}/dashboard`,{headers:{...r()}});if(s.ok){const t=await s.json();z(t.data)}}catch{}},[r]),h=a.useCallback(async()=>{try{const s=await fetch(`${o}/health`,{headers:{...r()}});if(s.ok){const t=await s.json();F(t.data)}}catch{}},[r]),y=a.useCallback(async()=>{try{const s=await fetch(`${o}/tests/history?limit=10`,{headers:{...r()}});if(s.ok){const t=await s.json();M(t.data||[])}}catch{}},[r]),j=a.useCallback(async(s=!1)=>{try{const t=await fetch(`${o}/journeys?limit=20&hasErrors=${s}`,{headers:{...r()}});if(t.ok){const c=await t.json();U(c.data||[])}}catch{}},[r]),p=a.useCallback(async()=>{try{const s=await fetch(`${o}/errors?limit=50`,{headers:{...r()}});if(s.ok){const t=await s.json();_(t.data||[])}}catch{}},[r]),W=async(s="https://musclemap.me")=>{$(!0),g(null);try{const t=localStorage.getItem("musclemap-auth"),c=t?JSON.parse(t)?.state?.token:null,b=await fetch(`${o}/tests/run`,{method:"POST",headers:{"Content-Type":"application/json",...r()},body:JSON.stringify({targetUrl:s,authToken:c,verbose:!0})});if(b.ok){const w=await b.json();g(w),y()}else{const w=await b.json();g({error:w.error?.message||"Test run failed"})}}catch(t){g({error:t.message})}finally{$(!1)}},X=async s=>{try{await fetch(`${o}/errors/${s}/resolve`,{method:"POST",headers:{...r()}}),p()}catch{}};if(a.useEffect(()=>{(async()=>{E(!0),await Promise.all([m(),h(),y(),j(),p()]),E(!1)})()},[m,h,y,j,p]),a.useEffect(()=>{const s=setInterval(()=>{i==="dashboard"&&(m(),h())},3e4);return()=>clearInterval(s)},[i,m,h]),!L?.is_admin)return e.jsx("div",{className:"min-h-screen bg-[#0a0a0f] text-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(S,{className:"w-16 h-16 text-yellow-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-400",children:"Admin access required"}),e.jsx(J,{to:"/dashboard",className:"mt-4 inline-block text-violet-400 hover:underline",children:"Return to Dashboard"})]})});const H=({status:s})=>{const t={healthy:"bg-green-500/20 text-green-400",degraded:"bg-yellow-500/20 text-yellow-400",unhealthy:"bg-red-500/20 text-red-400",pass:"bg-green-500/20 text-green-400",fail:"bg-red-500/20 text-red-400",skip:"bg-gray-500/20 text-gray-400",error:"bg-orange-500/20 text-orange-400"};return e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${t[s]||"bg-gray-500/20 text-gray-400"}`,children:s})};return e.jsxs("div",{className:"min-h-screen bg-[#0a0a0f] text-white",children:[e.jsx("header",{className:"border-b border-white/10 bg-[#0a0a0f]/80 backdrop-blur-xl sticky top-0 z-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(J,{to:"/admin-control",className:"text-gray-400 hover:text-white",children:"← Admin"}),e.jsxs("h1",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(ee,{className:"w-6 h-6 text-violet-400"}),"System Monitoring"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[x&&e.jsx(H,{status:x.overall}),e.jsx("button",{onClick:()=>{m(),h()},className:"p-2 rounded-lg hover:bg-white/10 transition-colors",children:e.jsx(N,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"flex gap-1 mt-4",children:["dashboard","tests","journeys","errors"].map(s=>e.jsx("button",{onClick:()=>B(s),className:`px-4 py-2 rounded-lg transition-colors capitalize ${i===s?"bg-violet-500/20 text-violet-400":"text-gray-400 hover:text-white hover:bg-white/5"}`,children:s},s))})]})}),e.jsx("main",{className:"max-w-7xl mx-auto px-4 py-6",children:O?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(N,{className:"w-8 h-8 animate-spin text-violet-400"})}):e.jsxs(e.Fragment,{children:[i==="dashboard"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(l,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Tests (24h)"}),e.jsx("div",{className:"text-2xl font-bold",children:d?.testsRun24h||0}),e.jsxs("div",{className:"text-xs text-green-400 mt-1",children:[d?.testPassRate||100,"% pass rate"]})]}),e.jsxs(l,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Journeys (24h)"}),e.jsx("div",{className:"text-2xl font-bold",children:d?.journeysTracked24h||0}),e.jsxs("div",{className:"text-xs text-yellow-400 mt-1",children:[d?.journeysWithErrors||0," with errors"]})]}),e.jsxs(l,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Unresolved Errors"}),e.jsx("div",{className:"text-2xl font-bold text-red-400",children:d?.unresolvedErrors||0})]}),e.jsxs(l,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"System Status"}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[x?.overall==="healthy"?e.jsx(C,{className:"w-6 h-6 text-green-400"}):x?.overall==="degraded"?e.jsx(S,{className:"w-6 h-6 text-yellow-400"}):e.jsx(T,{className:"w-6 h-6 text-red-400"}),e.jsx("span",{className:"capitalize",children:x?.overall||"Unknown"})]})]})]}),x&&e.jsxs(l,{className:"p-4",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5"}),"Health Checks"]}),e.jsx("div",{className:"grid gap-3",children:x.checks.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.status==="healthy"?e.jsx(C,{className:"w-5 h-5 text-green-400"}):s.status==="degraded"?e.jsx(S,{className:"w-5 h-5 text-yellow-400"}):e.jsx(T,{className:"w-5 h-5 text-red-400"}),e.jsx("span",{className:"capitalize",children:s.name})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-400",children:[s.latency&&e.jsxs("span",{children:[s.latency,"ms"]}),s.message&&e.jsx("span",{children:s.message}),e.jsx(H,{status:s.status})]})]},t))})]}),d?.topErrors?.length>0&&e.jsxs(l,{className:"p-4",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5"}),"Top Errors"]}),e.jsx("div",{className:"space-y-2",children:d.topErrors.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-500/5 rounded-lg",children:[e.jsx("span",{className:"text-sm truncate flex-1",children:s.message}),e.jsxs("span",{className:"text-red-400 font-mono text-sm ml-4",children:["×",s.occurrences]})]},t))})]})]}),i==="tests"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(l,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Run API Tests"}),e.jsxs("button",{onClick:()=>W(),disabled:v,className:"flex items-center gap-2 px-4 py-2 bg-violet-500 hover:bg-violet-600 disabled:opacity-50 rounded-lg transition-colors",children:[v?e.jsx(N,{className:"w-4 h-4 animate-spin"}):e.jsx(Y,{className:"w-4 h-4"}),v?"Running...":"Run Tests"]})]}),n&&e.jsx("div",{className:"mt-4",children:n.error?e.jsxs("div",{className:"p-4 bg-red-500/10 border border-red-500/20 rounded-lg",children:[e.jsx("div",{className:"text-red-400 font-medium",children:"Test run failed"}),e.jsx("div",{className:"text-sm text-gray-400 mt-1",children:n.error})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center p-3 bg-green-500/10 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-400",children:n.summary?.passed}),e.jsx("div",{className:"text-xs text-gray-400",children:"Passed"})]}),e.jsxs("div",{className:"text-center p-3 bg-red-500/10 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-red-400",children:n.summary?.failed}),e.jsx("div",{className:"text-xs text-gray-400",children:"Failed"})]}),e.jsxs("div",{className:"text-center p-3 bg-gray-500/10 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-400",children:n.summary?.skipped}),e.jsx("div",{className:"text-xs text-gray-400",children:"Skipped"})]}),e.jsxs("div",{className:"text-center p-3 bg-white/5 rounded-lg",children:[e.jsxs("div",{className:"text-2xl font-bold",children:[n.summary?.duration,"ms"]}),e.jsx("div",{className:"text-xs text-gray-400",children:"Duration"})]})]}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:n.data?.results?.map((s,t)=>e.jsxs("div",{className:`p-3 rounded-lg cursor-pointer ${s.status==="pass"?"bg-green-500/5 hover:bg-green-500/10":s.status==="fail"?"bg-red-500/5 hover:bg-red-500/10":"bg-gray-500/5 hover:bg-gray-500/10"}`,onClick:()=>G(f===t?null:t),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.status==="pass"?e.jsx(C,{className:"w-4 h-4 text-green-400"}):s.status==="fail"?e.jsx(T,{className:"w-4 h-4 text-red-400"}):e.jsx(Z,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:s.name}),e.jsx("span",{className:"text-xs text-gray-500",children:s.category})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-400",children:[s.duration,"ms"]}),s.message||s.details?f===t?e.jsx(I,{className:"w-4 h-4"}):e.jsx(P,{className:"w-4 h-4"}):null]})]}),f===t&&(s.message||s.details)&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-white/10 text-sm",children:[s.message&&e.jsx("div",{className:"text-red-400 mb-2",children:s.message}),s.details&&e.jsx("pre",{className:"text-xs text-gray-400 overflow-x-auto",children:JSON.stringify(s.details,null,2)})]})]},t))})]})})]}),e.jsxs(l,{className:"p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Test History"}),e.jsx("div",{className:"space-y-2",children:A.length===0?e.jsx("div",{className:"text-center text-gray-400 py-8",children:"No test history"}):A.map((s,t)=>e.jsx("div",{className:"p-3 bg-white/5 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-xs text-gray-400",children:new Date(s.startedAt).toLocaleString()})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-green-400",children:[s.passed," passed"]}),e.jsxs("span",{className:"text-red-400",children:[s.failed," failed"]}),e.jsxs("span",{className:"text-gray-400",children:[s.skipped," skipped"]})]})]})},t))})]})]}),i==="journeys"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5"}),"User Journeys"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>j(!1),className:"px-3 py-1 text-sm bg-white/10 hover:bg-white/20 rounded-lg transition-colors",children:"All"}),e.jsx("button",{onClick:()=>j(!0),className:"px-3 py-1 text-sm bg-red-500/20 hover:bg-red-500/30 text-red-400 rounded-lg transition-colors",children:"With Errors"})]})]}),e.jsx("div",{className:"space-y-3",children:D.length===0?e.jsx(l,{className:"p-8 text-center text-gray-400",children:"No journeys recorded yet"}):D.map(s=>e.jsxs(l,{className:"p-4 cursor-pointer hover:bg-white/5 transition-colors",onClick:()=>q(u===s.id?null:s.id),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[u===s.id?e.jsx(I,{className:"w-4 h-4"}):e.jsx(P,{className:"w-4 h-4"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[s.userId||"Anonymous"," - ",s.sessionId.substring(0,16),"..."]}),e.jsxs("div",{className:"text-xs text-gray-400",children:[new Date(s.startedAt).toLocaleString(),s.endedAt&&` - ${Math.round((new Date(s.endedAt)-new Date(s.startedAt))/1e3)}s`]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-gray-400",children:[s.steps?.length||0," steps"]}),s.errors?.length>0&&e.jsxs("span",{className:"text-red-400 flex items-center gap-1",children:[e.jsx(k,{className:"w-4 h-4"}),s.errors.length]})]})]}),u===s.id&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/10",children:[s.steps?.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"Steps"}),e.jsx("div",{className:"space-y-1 max-h-60 overflow-y-auto",children:s.steps.map((t,c)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm p-2 bg-white/5 rounded",children:[e.jsx("span",{className:"text-xs text-gray-500 w-16",children:t.type}),e.jsx("span",{className:"flex-1",children:t.name}),t.duration&&e.jsxs("span",{className:"text-xs text-gray-400",children:[t.duration,"ms"]})]},c))})]}),s.errors?.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-red-400 mb-2",children:"Errors"}),e.jsx("div",{className:"space-y-2",children:s.errors.map((t,c)=>e.jsxs("div",{className:"p-2 bg-red-500/10 rounded text-sm",children:[e.jsx("div",{className:"text-red-400",children:t.message}),t.stack&&e.jsx("pre",{className:"text-xs text-gray-500 mt-1 overflow-x-auto",children:t.stack.split(`
`).slice(0,3).join(`
`)})]},c))})]})]})]},s.id))})]}),i==="errors"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5"}),"Tracked Errors"]}),e.jsx("button",{onClick:p,className:"p-2 rounded-lg hover:bg-white/10 transition-colors",children:e.jsx(N,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"space-y-3",children:R.length===0?e.jsx(l,{className:"p-8 text-center text-gray-400",children:"No errors tracked"}):R.map(s=>e.jsx(l,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${s.resolved?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"}`,children:s.resolved?"Resolved":s.type}),e.jsxs("span",{className:"text-xs text-gray-400",children:["×",s.occurrences]})]}),e.jsx("div",{className:"text-sm mb-2 truncate",children:s.message}),e.jsxs("div",{className:"text-xs text-gray-500",children:[s.path&&e.jsx("span",{className:"mr-3",children:s.path}),new Date(s.timestamp).toLocaleString()]}),s.stack&&e.jsx("pre",{className:"text-xs text-gray-600 mt-2 overflow-x-auto max-h-20",children:s.stack.split(`
`).slice(0,3).join(`
`)})]}),!s.resolved&&e.jsx("button",{onClick:()=>X(s.id),className:"px-3 py-1 text-xs bg-green-500/20 text-green-400 hover:bg-green-500/30 rounded transition-colors",children:"Resolve"})]})},s.id))})]})]})})]})}export{ve as default};
