import{r as a,j as e}from"./react-vendor-D847gc3Q.js";import{G as u}from"./GlassSurface-DZwHl8aR.js";import{L as V}from"./loader-circle-CzVNrrx-.js";import{S as _}from"./server-zowaJhkT.js";import{R as T}from"./refresh-cw-Bz_Xj2cy.js";import{c as ie,aE as A,Z as ne,J as le,aF as M,aT as H}from"./index-Ii7_m7xX.js";import{D as W}from"./database-DUpDkIZu.js";import{M as z}from"./memory-stick-WuIi_rqu.js";import{H as ce}from"./hard-drive-CoHaqsK7.js";import{C as $}from"./chevron-down-CqumoECd.js";import{C as R}from"./chevron-right-PPhtnn3u.js";import{S as Q}from"./square-B5TTUzEz.js";import{R as Z}from"./rotate-ccw-BZO1VlHU.js";import{U as oe}from"./upload-CQ-4Hg6r.js";import{C as J}from"./circle-check-big-CDQOKD3g.js";import{F as q}from"./file-text-_fXGfESs.js";import{G as de}from"./git-branch-DD5WHpF-.js";import{G as me}from"./git-commit-horizontal-Cd-HmHGo.js";import{T as I}from"./terminal-CWQIDjbp.js";import{T as xe}from"./triangle-alert-B1wM2TXM.js";import{C as he}from"./circle-x-Ci2v_oaM.js";import"./leaflet-vendor-DZbo3Ov0.js";import"./recharts-vendor-d8oTApeF.js";import"./d3-vendor-DkU_Wy0v.js";import"./apollo-vendor-BNHFeEEc.js";import"./reactflow-vendor-5ig9bY2l.js";const ue=[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["line",{x1:"6",x2:"6",y1:"9",y2:"21",key:"rroup"}]],ge=ie("git-pull-request",ue),N="/api",pe=[{id:"status",name:"Check Status",icon:A,color:"#10b981",description:"Check all service status"},{id:"start",name:"Start Services",icon:M,color:"#22c55e",description:"Start PostgreSQL, Redis, API, Vite"},{id:"stop",name:"Stop Services",icon:Q,color:"#ef4444",description:"Stop all services",dangerous:!0},{id:"restart-api",name:"Restart API",icon:Z,color:"#f59e0b",description:"Restart API server"},{id:"build",name:"Build All",icon:H,color:"#8b5cf6",description:"Build packages and frontend"},{id:"deploy",name:"Deploy",icon:oe,color:"#3b82f6",description:"Full production deploy",dangerous:!0},{id:"test",name:"Run Tests",icon:J,color:"#06b6d4",description:"Run test suite"},{id:"typecheck",name:"Typecheck",icon:q,color:"#14b8a6",description:"TypeScript validation"},{id:"lint",name:"Lint",icon:H,color:"#a855f7",description:"ESLint code quality"},{id:"migrate",name:"Migrate DB",icon:W,color:"#f97316",description:"Run database migrations",dangerous:!0},{id:"pre-deploy-check",name:"Pre-Deploy Check",icon:J,color:"#10b981",description:"Validation checks"},{id:"generate-docs",name:"Generate Docs",icon:q,color:"#6366f1",description:"Regenerate documentation"}];function K(s){if(!s)return"N/A";const i=Math.floor(s/1e3),n=Math.floor(i/60),r=Math.floor(n/60),l=Math.floor(r/24);return l>0?`${l}d ${r%24}h`:r>0?`${r}h ${n%60}m`:n>0?`${n}m ${i%60}s`:`${i}s`}function fe(s){if(!s)return"0 B";if(typeof s=="string")return s;const i=1024,n=["B","KB","MB","GB"],r=Math.floor(Math.log(s)/Math.log(i));return`${parseFloat((s/Math.pow(i,r)).toFixed(1))} ${n[r]}`}function L({name:s,online:i,icon:n}){return e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-white/5",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${i?"bg-green-500/20":"bg-red-500/20"}`,children:e.jsx(n,{className:`w-5 h-5 ${i?"text-green-400":"text-red-400"}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-white",children:s}),e.jsx("div",{className:`text-xs ${i?"text-green-400":"text-red-400"}`,children:i?"Online":"Offline"})]}),e.jsx("div",{className:`w-2 h-2 rounded-full ${i?"bg-green-400":"bg-red-400"}`})]})}function je({process:s,onAction:i}){const[n,r]=a.useState(!1),l=async m=>{r(!0),await i(m,s.name),r(!1)},w={online:"text-green-400",stopped:"text-gray-400",errored:"text-red-400",launching:"text-yellow-400"};return e.jsxs("div",{className:"p-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:s.name}),e.jsxs("div",{className:`text-xs ${w[s.status]||"text-gray-400"}`,children:[s.status," • PID: ",s.pid||"N/A"]})]}),e.jsx("div",{className:"flex gap-1",children:s.status==="online"?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>l("restart"),disabled:n,className:"p-1.5 rounded bg-yellow-500/20 hover:bg-yellow-500/30 text-yellow-400 transition-colors disabled:opacity-50",title:"Restart",children:e.jsx(Z,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>l("stop"),disabled:n,className:"p-1.5 rounded bg-red-500/20 hover:bg-red-500/30 text-red-400 transition-colors disabled:opacity-50",title:"Stop",children:e.jsx(Q,{className:"w-4 h-4"})})]}):e.jsx("button",{onClick:()=>l("start"),disabled:n,className:"p-1.5 rounded bg-green-500/20 hover:bg-green-500/30 text-green-400 transition-colors disabled:opacity-50",title:"Start",children:e.jsx(M,{className:"w-4 h-4"})})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-white/5 rounded p-2",children:[e.jsx("div",{className:"text-gray-400",children:"CPU"}),e.jsxs("div",{className:"text-white font-medium",children:[s.cpu?.toFixed(1)||0,"%"]})]}),e.jsxs("div",{className:"bg-white/5 rounded p-2",children:[e.jsx("div",{className:"text-gray-400",children:"Memory"}),e.jsx("div",{className:"text-white font-medium",children:fe(s.memory)})]}),e.jsxs("div",{className:"bg-white/5 rounded p-2",children:[e.jsx("div",{className:"text-gray-400",children:"Uptime"}),e.jsx("div",{className:"text-white font-medium",children:K(s.uptime)})]})]}),s.restarts>0&&e.jsxs("div",{className:"mt-2 text-xs text-yellow-400",children:["⚠️ ",s.restarts," restart",s.restarts>1?"s":""]})]})}function be({script:s,onRun:i,running:n}){const r=s.icon,l=n===s.id;return e.jsxs("button",{onClick:()=>i(s.id),disabled:n,className:`
        relative p-3 rounded-lg border transition-all duration-200
        ${s.dangerous?"border-red-500/30 hover:border-red-500/50 hover:bg-red-500/10":"border-white/10 hover:border-white/30 hover:bg-white/5"}
        ${n?"opacity-50 cursor-not-allowed":"cursor-pointer"}
        group
      `,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center transition-transform group-hover:scale-110",style:{backgroundColor:`${s.color}20`},children:l?e.jsx(V,{className:"w-5 h-5 animate-spin",style:{color:s.color}}):e.jsx(r,{className:"w-5 h-5",style:{color:s.color}})}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-sm font-medium text-white",children:s.name}),e.jsx("div",{className:"text-xs text-gray-400",children:s.description})]})]}),s.dangerous&&e.jsx("div",{className:"absolute top-1 right-1",children:e.jsx(xe,{className:"w-3 h-3 text-red-400"})})]})}function Ne({logs:s,loading:i,onRefresh:n,streamEnabled:r,onToggleStream:l,streamLogs:w}){const m=a.useRef(null),k=r?w:s;return a.useEffect(()=>{m.current&&(m.current.scrollTop=m.current.scrollHeight)},[k]),e.jsxs("div",{className:"rounded-lg border border-white/10 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 border-b border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4 text-green-400"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"Logs"}),r&&e.jsxs("span",{className:"flex items-center gap-1 text-xs bg-green-500/20 text-green-400 px-2 py-0.5 rounded",children:[e.jsx("span",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),"Live"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:l,className:`px-2 py-1 rounded text-xs transition-colors ${r?"bg-green-500/20 text-green-400 hover:bg-green-500/30":"bg-white/5 text-gray-400 hover:bg-white/10"}`,children:r?"Stop Live":"Go Live"}),e.jsx("button",{onClick:n,disabled:i||r,className:"p-1.5 rounded hover:bg-white/10 transition-colors disabled:opacity-50",children:e.jsx(T,{className:`w-4 h-4 text-gray-400 ${i?"animate-spin":""}`})})]})]}),e.jsx("div",{ref:m,className:"p-3 font-mono text-xs text-gray-300 bg-black/40 h-64 overflow-auto whitespace-pre-wrap",children:k||'No logs available. Click refresh to load or "Go Live" for real-time streaming.'})]})}function we({output:s,title:i,onClose:n}){const r=a.useRef(null);return a.useEffect(()=>{r.current&&(r.current.scrollTop=r.current.scrollHeight)},[s]),s?e.jsx("div",{className:"fixed inset-x-0 bottom-0 z-50 p-4 bg-gray-900/95 border-t border-white/10 backdrop-blur-xl",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4 text-cyan-400"}),e.jsx("span",{className:"text-sm font-medium text-white",children:i}),s.success!==void 0&&e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${s.success?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"}`,children:s.success?"Success":"Failed"}),s.duration!==void 0&&e.jsxs("span",{className:"text-xs text-gray-400",children:[(s.duration/1e3).toFixed(1),"s"]})]}),e.jsx("button",{onClick:n,className:"p-1 rounded hover:bg-white/10 transition-colors",children:e.jsx(he,{className:"w-5 h-5 text-gray-400"})})]}),e.jsx("div",{ref:r,className:"font-mono text-xs text-gray-300 bg-black/60 rounded-lg p-3 h-48 overflow-auto whitespace-pre-wrap",children:s.output||s.error||"No output"})]})}):null}function Ke(){const[s,i]=a.useState(null),[n,r]=a.useState(""),[l,w]=a.useState(null),[m,k]=a.useState(!0),[X,B]=a.useState(!1),[Y,G]=a.useState(null),[D,g]=a.useState(null),[ve,ye]=a.useState("overview"),[o,C]=a.useState("scripts"),[v,O]=a.useState(!1),[ee,p]=a.useState(""),f=a.useRef(null),d=a.useCallback(()=>{try{const t=localStorage.getItem("musclemap-auth");if(t){const h=JSON.parse(t);if(h?.state?.token)return{Authorization:`Bearer ${h.state.token}`}}const c=localStorage.getItem("musclemap_token");return c?{Authorization:`Bearer ${c}`}:{}}catch{return{}}},[]),x=a.useCallback(async()=>{try{const t=await fetch(`${N}/admin/server/status`,{headers:d()});if(t.ok){const c=await t.json();i(c)}}catch{}finally{k(!1)}},[d]),P=a.useCallback(async()=>{B(!0);try{const t=await fetch(`${N}/admin/server/logs?lines=200`,{headers:d()});if(t.ok){const c=await t.json();r(c.logs)}}catch{}finally{B(!1)}},[d]),y=a.useCallback(async()=>{try{const t=await fetch(`${N}/admin/server/git`,{headers:d()});if(t.ok){const c=await t.json();w(c)}}catch{}},[d]),se=a.useCallback(async t=>{G(t),g(null);try{const h=await(await fetch(`${N}/admin/server/script`,{method:"POST",headers:{"Content-Type":"application/json",...d()},body:JSON.stringify({script:t})})).json();g({...h,script:t}),x()}catch(c){g({success:!1,error:c.message,script:t})}finally{G(null)}},[d,x]),te=a.useCallback(async(t,c)=>{try{(await(await fetch(`${N}/admin/server/process`,{method:"POST",headers:{"Content-Type":"application/json",...d()},body:JSON.stringify({action:t,process:c})})).json()).success&&setTimeout(x,1e3)}catch{}},[d,x]),ae=a.useCallback(async()=>{try{const c=await(await fetch(`${N}/admin/server/git/pull`,{method:"POST",headers:d()})).json();g({...c,script:"git-pull"}),y()}catch(t){g({success:!1,error:t.message,script:"git-pull"})}},[d,y]),F=a.useCallback(()=>{const t=localStorage.getItem("auth_token")||localStorage.getItem("token");if(!t)return;const h=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/api/admin/server/logs/stream?token=${encodeURIComponent(t)}`,j=new WebSocket(h);f.current=j,j.onopen=()=>{p(`Connected to live log stream...
`)},j.onmessage=S=>{try{const b=JSON.parse(S.data);b.type==="log"&&p(U=>(U+b.data+`
`).split(`
`).slice(-500).join(`
`))}catch{p(b=>(b+S.data+`
`).split(`
`).slice(-500).join(`
`))}},j.onerror=S=>{p(b=>b+`
[WebSocket Error: Connection failed]
`)},j.onclose=()=>{v&&p(S=>S+`
[Disconnected]
`)}},[v]),E=a.useCallback(()=>{f.current&&(f.current.close(),f.current=null)},[]),re=a.useCallback(()=>{v?(E(),O(!1)):(p(""),O(!0),F())},[v,F,E]);return a.useEffect(()=>()=>{f.current&&f.current.close()},[]),a.useEffect(()=>{x(),y(),P();const t=setInterval(x,3e4);return()=>clearInterval(t)},[x,y,P]),m?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(V,{className:"w-8 h-8 animate-spin text-cyan-400"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(_,{className:"w-6 h-6 text-cyan-400"}),"Server Control"]}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Manage services, run scripts, and monitor the system"})]}),e.jsxs("button",{onClick:x,className:"flex items-center gap-2 px-3 py-2 rounded-lg bg-white/5 hover:bg-white/10 border border-white/10 transition-colors",children:[e.jsx(T,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Refresh"})]})]}),e.jsxs(u,{className:"p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-white mb-3 flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4 text-cyan-400"}),"Services"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsx(L,{name:"PostgreSQL",online:s?.services?.postgres,icon:W}),e.jsx(L,{name:"Redis",online:s?.services?.redis,icon:z}),e.jsx(L,{name:"API Server",online:s?.services?.api,icon:_}),e.jsx(L,{name:"Vite Dev",online:s?.services?.vite,icon:ne})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(u,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ce,{className:"w-4 h-4 text-blue-400"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"Disk Usage"})]}),e.jsxs("div",{className:"text-2xl font-bold text-white",children:[s?.disk?.percent||0,"%"]}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:[s?.disk?.used||"0"," / ",s?.disk?.total||"0"]}),e.jsx("div",{className:"mt-2 h-2 bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 transition-all",style:{width:`${s?.disk?.percent||0}%`}})})]}),e.jsxs(u,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(z,{className:"w-4 h-4 text-purple-400"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"Memory"})]}),e.jsxs("div",{className:"text-2xl font-bold text-white",children:[s?.memory?.percent||0,"%"]}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:[s?.memory?.used||"0"," / ",s?.memory?.total||"0"]}),e.jsx("div",{className:"mt-2 h-2 bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-purple-500 transition-all",style:{width:`${s?.memory?.percent||0}%`}})})]}),e.jsxs(u,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(le,{className:"w-4 h-4 text-green-400"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"Uptime"})]}),e.jsx("div",{className:"text-2xl font-bold text-white",children:K(s?.uptime)}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"System running since boot"})]})]}),e.jsxs(u,{className:"p-4",children:[e.jsxs("button",{onClick:()=>C(o==="scripts"?"":"scripts"),className:"w-full flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-white flex items-center gap-2",children:[e.jsx(M,{className:"w-4 h-4 text-green-400"}),"Scripts"]}),o==="scripts"?e.jsx($,{className:"w-4 h-4 text-gray-400"}):e.jsx(R,{className:"w-4 h-4 text-gray-400"})]}),o==="scripts"&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:pe.map(t=>e.jsx(be,{script:t,onRun:se,running:Y},t.id))})]}),s?.processes?.length>0&&e.jsxs(u,{className:"p-4",children:[e.jsxs("button",{onClick:()=>C(o==="processes"?"":"processes"),className:"w-full flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-white flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4 text-yellow-400"}),"PM2 Processes (",s.processes.length,")"]}),o==="processes"?e.jsx($,{className:"w-4 h-4 text-gray-400"}):e.jsx(R,{className:"w-4 h-4 text-gray-400"})]}),o==="processes"&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:s.processes.map(t=>e.jsx(je,{process:t,onAction:te},t.name))})]}),e.jsxs(u,{className:"p-4",children:[e.jsxs("button",{onClick:()=>C(o==="git"?"":"git"),className:"w-full flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-white flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-orange-400"}),"Git Status",l?.branch&&e.jsx("span",{className:"text-xs bg-orange-500/20 text-orange-400 px-2 py-0.5 rounded",children:l.branch})]}),o==="git"?e.jsx($,{className:"w-4 h-4 text-gray-400"}):e.jsx(R,{className:"w-4 h-4 text-gray-400"})]}),o==="git"&&l&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:ae,className:"flex items-center gap-2 px-3 py-2 rounded-lg bg-blue-500/20 hover:bg-blue-500/30 text-blue-400 transition-colors",children:[e.jsx(ge,{className:"w-4 h-4"}),"Pull Latest"]}),e.jsxs("button",{onClick:y,className:"flex items-center gap-2 px-3 py-2 rounded-lg bg-white/5 hover:bg-white/10 text-gray-400 transition-colors",children:[e.jsx(T,{className:"w-4 h-4"}),"Refresh"]})]}),l.status?.length>0&&e.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-3",children:[e.jsxs("div",{className:"text-xs font-medium text-yellow-400 mb-2",children:[l.status.length," uncommitted change",l.status.length!==1?"s":""]}),e.jsxs("div",{className:"font-mono text-xs text-gray-300 space-y-1",children:[l.status.slice(0,10).map((t,c)=>e.jsx("div",{children:t},c)),l.status.length>10&&e.jsxs("div",{className:"text-gray-500",children:["... and ",l.status.length-10," more"]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-400 mb-2",children:"Recent Commits"}),e.jsx("div",{className:"font-mono text-xs text-gray-300 space-y-1",children:l.recentCommits?.slice(0,5).map((t,c)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"w-3 h-3 text-gray-500"}),e.jsx("span",{children:t})]},c))})]})]})]}),e.jsxs(u,{className:"p-4",children:[e.jsxs("button",{onClick:()=>C(o==="logs"?"":"logs"),className:"w-full flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-white flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4 text-green-400"}),"Server Logs"]}),o==="logs"?e.jsx($,{className:"w-4 h-4 text-gray-400"}):e.jsx(R,{className:"w-4 h-4 text-gray-400"})]}),o==="logs"&&e.jsx(Ne,{logs:n,loading:X,onRefresh:P,streamEnabled:v,onToggleStream:re,streamLogs:ee})]}),e.jsx(we,{output:D,title:`Output: ${D?.script||"Script"}`,onClose:()=>g(null)})]})}export{Ke as default};
