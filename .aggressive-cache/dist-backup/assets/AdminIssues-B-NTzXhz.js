import{d as I,r as c,j as e,L as B}from"./react-vendor-D1NxaRNd.js";import{K as D,e as E,m as A}from"./index-YhIq0fk2.js";import{f as _}from"./date-vendor-C_JWt2cu.js";import"./leaflet-vendor-DZbo3Ov0.js";import"./apollo-vendor-BMQ75Ycx.js";import"./reactflow-vendor-Dz2P_-Qa.js";import"./d3-vendor-mcDw60ct.js";import"./recharts-vendor-BziRPEEi.js";const h={Back:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 19l-7-7 7-7"})}),Plus:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 4v16m8-8H4"})}),ChevronDown:()=>e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})},P={0:{label:"Bug",color:"text-red-400"},1:{label:"Feature",color:"text-green-400"},2:{label:"Enhancement",color:"text-blue-400"},3:{label:"Account",color:"text-orange-400"},4:{label:"Question",color:"text-pink-400"},5:{label:"Other",color:"text-gray-400"}},y={0:{label:"Open",color:"bg-green-500"},1:{label:"In Progress",color:"bg-blue-500"},2:{label:"Under Review",color:"bg-purple-500"},3:{label:"Resolved",color:"bg-emerald-500"},4:{label:"Closed",color:"bg-gray-500"},5:{label:"Won't Fix",color:"bg-red-500"},6:{label:"Duplicate",color:"bg-yellow-500"}},w={0:{label:"Low",color:"text-gray-400"},1:{label:"Medium",color:"text-blue-400"},2:{label:"High",color:"text-orange-400"},3:{label:"Critical",color:"text-red-400"}},F=[{value:0,label:"Update"},{value:1,label:"Release"},{value:2,label:"Announcement"},{value:3,label:"Bug Fix"},{value:4,label:"Maintenance"}];function q({value:s,onChange:n}){const[d,t]=c.useState(!1),l=y[s]||y[0];return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>t(!d),className:"flex items-center gap-1 text-xs px-2 py-1 rounded bg-gray-700 hover:bg-gray-600",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${l.color}`}),l.label,e.jsx(h.ChevronDown,{})]}),d&&e.jsx("div",{className:"absolute top-full left-0 mt-1 bg-gray-800 border border-gray-700 rounded-lg shadow-lg z-10 min-w-[140px]",children:Object.entries(y).map(([i,{label:x,color:o}])=>e.jsxs("button",{onClick:()=>{n(parseInt(i)),t(!1)},className:"w-full text-left px-3 py-2 text-sm hover:bg-gray-700 flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${o}`}),x]},i))})]})}function J({value:s,onChange:n}){const[d,t]=c.useState(!1),l=w[s]||w[1];return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>t(!d),className:`flex items-center gap-1 text-xs px-2 py-1 rounded bg-gray-700 hover:bg-gray-600 ${l.color}`,children:[l.label,e.jsx(h.ChevronDown,{})]}),d&&e.jsx("div",{className:"absolute top-full left-0 mt-1 bg-gray-800 border border-gray-700 rounded-lg shadow-lg z-10 min-w-[100px]",children:Object.entries(w).map(([i,{label:x,color:o}])=>e.jsx("button",{onClick:()=>{n(parseInt(i)),t(!1)},className:`w-full text-left px-3 py-2 text-sm hover:bg-gray-700 ${o}`,children:x},i))})]})}function W({issue:s,selected:n,onSelect:d,onUpdate:t}){const l=I(),i=P[s.type]||P[5],x=async a=>{t(s.id,{status:a})},o=async a=>{t(s.id,{priority:a})};return e.jsxs("tr",{className:"hover:bg-gray-800/30 border-b border-gray-700/50",children:[e.jsx("td",{className:"px-3 py-3",children:e.jsx("input",{type:"checkbox",checked:n,onChange:()=>d(s.id),className:"w-4 h-4 rounded border-gray-600 bg-gray-700 text-purple-500"})}),e.jsx("td",{className:"px-3 py-3",children:e.jsxs("span",{className:"text-gray-500 text-sm",children:["#",s.issue_number]})}),e.jsxs("td",{className:"px-3 py-3",children:[e.jsx("button",{onClick:()=>l(`/issues/${s.issue_number}`),className:"text-white hover:text-purple-400 font-medium text-left truncate max-w-[250px] block",children:s.title}),e.jsx("span",{className:`text-xs ${i.color}`,children:i.label})]}),e.jsx("td",{className:"px-3 py-3",children:e.jsx(q,{value:s.status,onChange:x})}),e.jsx("td",{className:"px-3 py-3",children:e.jsx(J,{value:s.priority,onChange:o})}),e.jsx("td",{className:"px-3 py-3 text-sm text-gray-400",children:s.author_username||"Unknown"}),e.jsx("td",{className:"px-3 py-3 text-center text-sm text-gray-400",children:s.vote_count}),e.jsx("td",{className:"px-3 py-3 text-center text-sm text-gray-400",children:s.comment_count}),e.jsx("td",{className:"px-3 py-3 text-sm text-gray-500 text-right",children:_(new Date(s.created_at),{addSuffix:!0})})]})}function H({isOpen:s,onClose:n,onSubmit:d}){const[t,l]=c.useState({title:"",content:"",type:0,isPublished:!0}),[i,x]=c.useState(!1),o=async a=>{a.preventDefault(),x(!0),await d(t),x(!1),n(),l({title:"",content:"",type:0,isPublished:!0})};return s?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/70",onClick:n}),e.jsxs(A.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"relative bg-gray-800 rounded-xl border border-gray-700 w-full max-w-lg p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Create Dev Update"}),e.jsxs("form",{onSubmit:o,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Type"}),e.jsx("select",{value:t.type,onChange:a=>l({...t,type:parseInt(a.target.value)}),className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white",children:F.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Title"}),e.jsx("input",{type:"text",value:t.title,onChange:a=>l({...t,title:a.target.value}),className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Content"}),e.jsx("textarea",{value:t.content,onChange:a=>l({...t,content:a.target.value}),rows:6,className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white resize-none",required:!0})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:t.isPublished,onChange:a=>l({...t,isPublished:a.target.checked}),className:"w-4 h-4 rounded border-gray-600 bg-gray-700 text-purple-500"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Publish immediately"})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:n,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-white",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:i,className:"flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg text-white font-medium disabled:opacity-50",children:i?"Creating...":"Create Update"})]})]})]})]}):null}function Q({isOpen:s,onClose:n,onSubmit:d}){const[t,l]=c.useState({title:"",description:"",status:0,quarter:"",category:"",progress:0}),[i,x]=c.useState(!1),o=async a=>{a.preventDefault(),x(!0),await d(t),x(!1),n(),l({title:"",description:"",status:0,quarter:"",category:"",progress:0})};return s?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/70",onClick:n}),e.jsxs(A.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"relative bg-gray-800 rounded-xl border border-gray-700 w-full max-w-lg p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Add Roadmap Item"}),e.jsxs("form",{onSubmit:o,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Title"}),e.jsx("input",{type:"text",value:t.title,onChange:a=>l({...t,title:a.target.value}),className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Description"}),e.jsx("textarea",{value:t.description,onChange:a=>l({...t,description:a.target.value}),rows:3,className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white resize-none"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Status"}),e.jsxs("select",{value:t.status,onChange:a=>l({...t,status:parseInt(a.target.value)}),className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white",children:[e.jsx("option",{value:0,children:"Planned"}),e.jsx("option",{value:1,children:"In Progress"}),e.jsx("option",{value:2,children:"Completed"}),e.jsx("option",{value:3,children:"Paused"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Quarter"}),e.jsx("input",{type:"text",value:t.quarter,onChange:a=>l({...t,quarter:a.target.value}),placeholder:"Q1 2024",className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Category"}),e.jsx("input",{type:"text",value:t.category,onChange:a=>l({...t,category:a.target.value}),placeholder:"Feature, Performance...",className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Progress %"}),e.jsx("input",{type:"number",min:0,max:100,value:t.progress,onChange:a=>l({...t,progress:parseInt(a.target.value)||0}),className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:n,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-white",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:i,className:"flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg text-white font-medium disabled:opacity-50",children:i?"Creating...":"Add to Roadmap"})]})]})]})]}):null}function ae(){const{token:s}=D(),{user:n}=E(),d=I(),[t,l]=c.useState([]),[i,x]=c.useState(!0),[o,a]=c.useState(new Set),[g,C]=c.useState({status:void 0}),[u,b]=c.useState(0),[j,T]=c.useState(0),[U,S]=c.useState(!1),[z,k]=c.useState(!1),m=25;c.useEffect(()=>{if(!s){d("/login");return}n&&!n.is_admin&&!n.roles?.includes("admin")&&d("/dashboard")},[s,n,d]),c.useEffect(()=>{f()},[g,u]);const f=async()=>{x(!0);try{const r=new URLSearchParams;g.status!==void 0&&r.set("status",g.status.toString()),r.set("limit",m.toString()),r.set("offset",(u*m).toString());const N=await(await fetch(`/api/admin/issues?${r}`,{headers:{Authorization:`Bearer ${s}`}})).json();l(N.data||[]),T(N.pagination?.total||0)}catch{}finally{x(!1)}},O=r=>{const p=new Set(o);p.has(r)?p.delete(r):p.add(r),a(p)},R=()=>{o.size===t.length?a(new Set):a(new Set(t.map(r=>r.id)))},$=async(r,p)=>{try{await fetch(`/api/issues/${r}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(p)}),f()}catch{}},v=async r=>{if(o.size!==0)try{await fetch("/api/admin/issues/bulk",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({issueIds:Array.from(o),update:r})}),a(new Set),f()}catch{}},L=async r=>{try{await fetch("/api/updates",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(r)})}catch{}},M=async r=>{try{await fetch("/api/roadmap",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(r)})}catch{}};return e.jsxs("div",{className:"min-h-screen bg-gray-900 text-white pb-24",children:[e.jsx("header",{className:"bg-gray-800 border-b border-gray-700 sticky top-0 z-20",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(B,{to:"/admin-control",className:"text-gray-400 hover:text-white flex items-center gap-2",children:[e.jsx(h.Back,{}),e.jsx("span",{className:"hidden sm:inline",children:"Admin"})]}),e.jsx("h1",{className:"text-xl font-bold",children:"Issue Management"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>S(!0),className:"bg-blue-600 hover:bg-blue-700 px-3 py-2 rounded-lg text-sm font-medium flex items-center gap-2",children:[e.jsx(h.Plus,{})," Update"]}),e.jsxs("button",{onClick:()=>k(!0),className:"bg-green-600 hover:bg-green-700 px-3 py-2 rounded-lg text-sm font-medium flex items-center gap-2",children:[e.jsx(h.Plus,{})," Roadmap"]})]})]})})}),e.jsx("div",{className:"bg-gray-800/50 border-b border-gray-700/50",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex gap-2 overflow-x-auto",children:[e.jsx("button",{onClick:()=>{C({status:void 0}),b(0)},className:`px-3 py-1 rounded-lg text-sm ${g.status===void 0?"bg-purple-600 text-white":"bg-gray-700 text-gray-300"}`,children:"All"}),Object.entries(y).map(([r,{label:p}])=>e.jsx("button",{onClick:()=>{C({status:parseInt(r)}),b(0)},className:`px-3 py-1 rounded-lg text-sm whitespace-nowrap ${g.status===parseInt(r)?"bg-purple-600 text-white":"bg-gray-700 text-gray-300"}`,children:p},r))]}),o.size>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-400",children:[o.size," selected"]}),e.jsx("button",{onClick:()=>v({status:1}),className:"px-3 py-1 bg-blue-600 rounded-lg text-sm",children:"In Progress"}),e.jsx("button",{onClick:()=>v({status:3}),className:"px-3 py-1 bg-green-600 rounded-lg text-sm",children:"Resolve"}),e.jsx("button",{onClick:()=>v({status:4}),className:"px-3 py-1 bg-gray-600 rounded-lg text-sm",children:"Close"})]})]})})}),e.jsx("main",{className:"max-w-7xl mx-auto px-4 py-6",children:i?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-purple-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Loading issues..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-gray-800/30 rounded-xl border border-gray-700/50 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-800/50 text-left text-xs text-gray-400 font-medium",children:[e.jsx("th",{className:"px-3 py-3 w-10",children:e.jsx("input",{type:"checkbox",checked:o.size===t.length&&t.length>0,onChange:R,className:"w-4 h-4 rounded border-gray-600 bg-gray-700 text-purple-500"})}),e.jsx("th",{className:"px-3 py-3",children:"#"}),e.jsx("th",{className:"px-3 py-3",children:"Issue"}),e.jsx("th",{className:"px-3 py-3",children:"Status"}),e.jsx("th",{className:"px-3 py-3",children:"Priority"}),e.jsx("th",{className:"px-3 py-3",children:"Author"}),e.jsx("th",{className:"px-3 py-3 text-center",children:"Votes"}),e.jsx("th",{className:"px-3 py-3 text-center",children:"Comments"}),e.jsx("th",{className:"px-3 py-3 text-right",children:"Created"})]})}),e.jsx("tbody",{children:t.map(r=>e.jsx(W,{issue:r,selected:o.has(r.id),onSelect:O,onUpdate:$},r.id))})]})})}),j>m&&e.jsxs("div",{className:"flex justify-center gap-2 mt-6",children:[e.jsx("button",{onClick:()=>b(Math.max(0,u-1)),disabled:u===0,className:"px-4 py-2 bg-gray-800 rounded-lg text-gray-300 hover:text-white disabled:opacity-50",children:"Previous"}),e.jsxs("span",{className:"px-4 py-2 text-gray-400",children:["Page ",u+1," of ",Math.ceil(j/m)]}),e.jsx("button",{onClick:()=>b(u+1),disabled:(u+1)*m>=j,className:"px-4 py-2 bg-gray-800 rounded-lg text-gray-300 hover:text-white disabled:opacity-50",children:"Next"})]})]})}),e.jsx(H,{isOpen:U,onClose:()=>S(!1),onSubmit:L}),e.jsx(Q,{isOpen:z,onClose:()=>k(!1),onSubmit:M})]})}export{ae as default};
