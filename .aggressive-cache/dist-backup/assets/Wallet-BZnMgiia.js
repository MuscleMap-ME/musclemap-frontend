import{k as re,r as a,j as e,L as ae,a as ie}from"./react-vendor-D1NxaRNd.js";import{B as n,C as b,A as ne,T as oe,I as ce,a as le,b as s,c as de,P as l,d as W,L as ue,e as c,S as he,f as U,g as xe,G as x,h as ge,i as be,V as me,j as pe,k as fe,l as je,m as ye,n as ve,o as Se,p as Ce,D as E,q as V,r as O,s as G,t as q,u as I,v as we,w as ke}from"./ui-vendor-BuzSqiox.js";import{a as A}from"./index-BRHeW3t7.js";import"./leaflet-vendor-DZbo3Ov0.js";import"./recharts-vendor-BziRPEEi.js";import"./d3-vendor-mcDw60ct.js";import"./apollo-vendor-D9c7jRvS.js";import"./reactflow-vendor-Dz2P_-Qa.js";const m={bronze:{color:"linear-gradient(135deg, #92400e 0%, #78350f 100%)",min:0,discount:0},silver:{color:"linear-gradient(135deg, #9ca3af 0%, #4b5563 100%)",min:100,discount:5},gold:{color:"linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%)",min:500,discount:10},platinum:{color:"linear-gradient(135deg, #67e8f9 0%, #3b82f6 100%)",min:2e3,discount:15},diamond:{color:"linear-gradient(135deg, #a78bfa 0%, #7c3aed 100%)",min:1e4,discount:20}},We=u=>{try{return new Date(u).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return u}};function Pe(){const[u]=re(),[p,H]=a.useState(null),[o,N]=a.useState(null),[y,J]=a.useState([]),[K,Q]=a.useState(!0),[X,v]=a.useState(!1),[Y,f]=a.useState(!1),[T,z]=a.useState(""),[B,R]=a.useState(""),[L,D]=a.useState(""),[h,P]=a.useState(!1),[_,$]=a.useState(!1),[g,i]=a.useState({open:!1,message:"",severity:"success"});a.useEffect(()=>{M();const t=u.get("subscription");t==="success"?i({open:!0,message:"Subscription activated! Enjoy unlimited access.",severity:"success"}):t==="canceled"&&i({open:!0,message:"Subscription canceled.",severity:"info"});const r=u.get("credits");r==="success"?i({open:!0,message:"100 credits added to your account!",severity:"success"}):r==="canceled"&&i({open:!0,message:"Credit purchase canceled.",severity:"info"})},[u]);const M=async()=>{try{const[t,r,w]=await Promise.all([A.wallet.balance().catch(()=>null),fetch("/api/entitlements",{headers:{Authorization:`Bearer ${localStorage.getItem("musclemap_token")}`}}).then(k=>k.json()).then(k=>k.data).catch(()=>null),A.wallet.transactions(20).catch(()=>({transactions:[]}))]);H(t),N(r),J(w.transactions||[])}catch{}finally{Q(!1)}},S=async()=>{P(!0);try{const r=await(await fetch("/api/billing/checkout",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("musclemap_token")}`}})).json();r.data?.url&&(window.location.href=r.data.url)}catch{i({open:!0,message:"Failed to start subscription. Please try again.",severity:"error"})}finally{P(!1)}},Z=async()=>{try{const r=await(await fetch("/api/billing/portal",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("musclemap_token")}`}})).json();r.data?.url&&(window.location.href=r.data.url)}catch{i({open:!0,message:"Failed to open billing portal.",severity:"error"})}},ee=async()=>{$(!0);try{const r=await(await fetch("/api/billing/credits/checkout",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("musclemap_token")}`}})).json();r.data?.url&&(window.location.href=r.data.url)}catch{i({open:!0,message:"Failed to start purchase. Please try again.",severity:"error"})}finally{$(!1)}},te=async t=>{t.preventDefault();try{(await A.wallet.transfer({recipient_username:B,amount:parseFloat(T),message:L})).success&&(f(!1),z(""),R(""),D(""),M(),i({open:!0,message:"Credits sent successfully!",severity:"success"}))}catch{i({open:!0,message:"Failed to send credits.",severity:"error"})}},d=p?.ranking?.vip_tier||"bronze",C=m[d]||m.bronze,F=o?.unlimited,se=o?.reason==="trial",j=o?.reason==="subscribed";return K?e.jsx(n,{sx:{minHeight:"100vh",bgcolor:"background.default",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(b,{})}):e.jsxs(n,{sx:{minHeight:"100vh",bgcolor:"background.default",pb:4},children:[e.jsx(ne,{position:"sticky",color:"transparent",elevation:0,sx:{backdropFilter:"blur(20px)",borderBottom:"1px solid rgba(255,255,255,0.05)"},children:e.jsxs(oe,{children:[e.jsx(ce,{edge:"start",component:ae,to:"/dashboard",sx:{mr:2},children:e.jsx(le,{})}),e.jsx(s,{variant:"h6",sx:{flexGrow:1,fontWeight:600},children:"Wallet"})]})}),e.jsxs(de,{maxWidth:"sm",sx:{py:3},children:[F&&e.jsxs(l,{sx:{p:3,mb:3,borderRadius:3,background:j?"linear-gradient(135deg, #7c3aed 0%, #4f46e5 100%)":"linear-gradient(135deg, #059669 0%, #047857 100%)",position:"relative",overflow:"hidden"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(W,{sx:{fontSize:40}}),e.jsxs(n,{children:[e.jsx(s,{variant:"h5",fontWeight:700,children:j?"Unlimited Subscriber":"Free Trial Active"}),e.jsx(s,{variant:"body2",sx:{opacity:.9},children:j?"All features unlocked - no credit limits!":`${o?.daysLeftInTrial} days remaining in your free trial`})]})]}),se&&e.jsxs(e.Fragment,{children:[e.jsx(ue,{variant:"determinate",value:(90-o?.daysLeftInTrial)/90*100,sx:{mb:2,height:8,borderRadius:4,bgcolor:"rgba(255,255,255,0.2)","& .MuiLinearProgress-bar":{bgcolor:"white"}}}),e.jsx(c,{variant:"contained",fullWidth:!0,onClick:S,disabled:h,sx:{bgcolor:"white",color:"#059669",fontWeight:700,"&:hover":{bgcolor:"rgba(255,255,255,0.9)"}},children:h?e.jsx(b,{size:24}):"Subscribe for $1/month - Stay Unlimited"})]}),j&&e.jsx(c,{variant:"outlined",fullWidth:!0,onClick:Z,sx:{borderColor:"rgba(255,255,255,0.5)",color:"white","&:hover":{borderColor:"white",bgcolor:"rgba(255,255,255,0.1)"}},startIcon:e.jsx(he,{}),children:"Manage Subscription"})]}),!F&&e.jsxs(l,{sx:{p:3,mb:3,borderRadius:3,background:"linear-gradient(135deg, #7c3aed 0%, #4f46e5 100%)",textAlign:"center"},children:[e.jsx(W,{sx:{fontSize:48,mb:1}}),e.jsx(s,{variant:"h5",fontWeight:700,gutterBottom:!0,children:"Go Unlimited"}),e.jsx(s,{variant:"body2",sx:{opacity:.9,mb:2},children:"Subscribe for just $1/month and never worry about credits again. Send unlimited messages, log unlimited workouts - everything is included."}),e.jsx(c,{variant:"contained",size:"large",fullWidth:!0,onClick:S,disabled:h,sx:{bgcolor:"white",color:"#7c3aed",fontWeight:700,py:1.5,"&:hover":{bgcolor:"rgba(255,255,255,0.9)"}},children:h?e.jsx(b,{size:24}):"Subscribe - $1/month"})]}),o?.creditsVisible&&e.jsxs(l,{sx:{p:3,mb:3,borderRadius:3,background:C.color,position:"relative"},children:[e.jsx(U,{icon:e.jsx(xe,{sx:{fontSize:16}}),label:d.charAt(0).toUpperCase()+d.slice(1),size:"small",sx:{position:"absolute",top:16,right:16,bgcolor:"rgba(255,255,255,0.2)",color:"white",fontWeight:600}}),e.jsx(s,{variant:"body2",sx:{opacity:.8,mb:.5},children:"Available Balance"}),e.jsx(s,{variant:"h3",fontWeight:700,sx:{mb:.5},children:(o?.creditBalance||0).toLocaleString()}),e.jsx(s,{variant:"body2",sx:{opacity:.8,mb:3},children:"credits"}),e.jsxs(x,{container:!0,spacing:2,children:[e.jsx(x,{item:!0,xs:6,children:e.jsx(c,{fullWidth:!0,variant:"contained",startIcon:e.jsx(ge,{}),onClick:()=>v(!0),sx:{bgcolor:"rgba(255,255,255,0.2)","&:hover":{bgcolor:"rgba(255,255,255,0.3)"}},children:"Add Credits"})}),e.jsx(x,{item:!0,xs:6,children:e.jsx(c,{fullWidth:!0,variant:"contained",startIcon:e.jsx(be,{}),onClick:()=>f(!0),sx:{bgcolor:"rgba(255,255,255,0.2)","&:hover":{bgcolor:"rgba(255,255,255,0.3)"}},children:"Send"})})]})]}),o?.creditsVisible&&e.jsxs(x,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(x,{item:!0,xs:6,children:e.jsxs(l,{sx:{p:2,bgcolor:"rgba(255,255,255,0.05)",borderRadius:2},children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Lifetime Earned"}),e.jsx(s,{variant:"h6",fontWeight:600,children:(p?.wallet?.lifetime_earned||0).toLocaleString()})]})}),e.jsx(x,{item:!0,xs:6,children:e.jsxs(l,{sx:{p:2,bgcolor:"rgba(255,255,255,0.05)",borderRadius:2},children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Lifetime Spent"}),e.jsx(s,{variant:"h6",fontWeight:600,children:(p?.wallet?.lifetime_spent||0).toLocaleString()})]})})]}),o?.creditsVisible&&e.jsxs(l,{sx:{p:3,mb:3,bgcolor:"rgba(255,255,255,0.05)",borderRadius:3},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(me,{color:"primary"}),e.jsx(s,{fontWeight:600,children:"VIP Status"})]}),C.discount>0&&e.jsx(U,{label:`${C.discount}% discount`,size:"small",color:"success"})]}),e.jsx(n,{sx:{display:"flex",gap:.5,mb:1},children:Object.entries(m).map(([t,r],w)=>e.jsx(n,{sx:{flex:1,height:8,borderRadius:4,background:d===t?r.color:Object.keys(m).indexOf(d)>w?"rgba(255,255,255,0.3)":"rgba(255,255,255,0.1)"}},t))}),e.jsx(n,{sx:{display:"flex",justifyContent:"space-between"},children:Object.entries(m).map(([t])=>e.jsx(s,{variant:"caption",sx:{color:d===t?"white":"text.secondary",fontWeight:d===t?600:400,textTransform:"capitalize"},children:t},t))})]}),o?.creditsVisible&&e.jsxs(n,{children:[e.jsx(s,{variant:"h6",fontWeight:600,sx:{mb:2},children:"Recent Transactions"}),y.length===0?e.jsxs(l,{sx:{p:4,textAlign:"center",bgcolor:"rgba(255,255,255,0.05)",borderRadius:3},children:[e.jsx(pe,{sx:{fontSize:48,color:"text.secondary",mb:1}}),e.jsx(s,{color:"text.secondary",children:"No transactions yet"})]}):e.jsx(fe,{sx:{bgcolor:"rgba(255,255,255,0.05)",borderRadius:3},children:y.map((t,r)=>e.jsxs(ie.Fragment,{children:[e.jsxs(je,{children:[e.jsx(ye,{children:e.jsx(n,{sx:{width:40,height:40,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:t.amount>0?"success.dark":"error.dark"},children:t.amount>0?e.jsx(ve,{color:"success"}):e.jsx(Se,{color:"error"})})}),e.jsx(Ce,{primary:t.action||t.type||"Transaction",secondary:We(t.created_at)}),e.jsxs(s,{variant:"body1",fontWeight:600,color:t.amount>0?"success.main":"error.main",children:[t.amount>0?"+":"",t.amount]})]}),r<y.length-1&&e.jsx(E,{})]},t.id))})]})]}),e.jsxs(V,{open:X,onClose:()=>v(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(O,{children:"Get More Credits"}),e.jsxs(G,{children:[e.jsxs(l,{sx:{p:3,mb:2,borderRadius:2,border:"2px solid",borderColor:"primary.main",textAlign:"center"},children:[e.jsx(s,{variant:"h4",fontWeight:700,color:"primary",children:"100 Credits"}),e.jsx(s,{variant:"h6",color:"text.secondary",sx:{mb:2},children:"$1.00"}),e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Each workout prescription costs 1 credit"}),e.jsx(c,{variant:"contained",fullWidth:!0,size:"large",onClick:ee,disabled:_,sx:{fontWeight:700},children:_?e.jsx(b,{size:24}):"Buy 100 Credits - $1"})]}),e.jsx(E,{sx:{my:2},children:"or"}),e.jsxs(l,{sx:{p:3,borderRadius:2,background:"linear-gradient(135deg, #7c3aed 0%, #4f46e5 100%)",textAlign:"center"},children:[e.jsx(W,{sx:{fontSize:40,mb:1}}),e.jsx(s,{variant:"h5",fontWeight:700,children:"Go Unlimited"}),e.jsx(s,{variant:"body2",sx:{opacity:.9,mb:2},children:"$1/month - No credit limits ever"}),e.jsx(c,{variant:"contained",fullWidth:!0,onClick:S,disabled:h,sx:{bgcolor:"white",color:"#7c3aed",fontWeight:700,"&:hover":{bgcolor:"rgba(255,255,255,0.9)"}},children:h?e.jsx(b,{size:24}):"Subscribe - $1/month"})]})]}),e.jsx(q,{children:e.jsx(c,{onClick:()=>v(!1),children:"Close"})})]}),e.jsxs(V,{open:Y,onClose:()=>f(!1),maxWidth:"xs",fullWidth:!0,children:[e.jsx(O,{children:"Send Credits"}),e.jsxs("form",{onSubmit:te,children:[e.jsxs(G,{children:[e.jsx(I,{fullWidth:!0,label:"Recipient Username",value:B,onChange:t=>R(t.target.value),required:!0,sx:{mb:2}}),e.jsx(I,{fullWidth:!0,label:"Amount",type:"number",value:T,onChange:t=>z(t.target.value),required:!0,inputProps:{min:1},sx:{mb:2}}),e.jsx(I,{fullWidth:!0,label:"Message (optional)",value:L,onChange:t=>D(t.target.value)})]}),e.jsxs(q,{children:[e.jsx(c,{onClick:()=>f(!1),children:"Cancel"}),e.jsx(c,{type:"submit",variant:"contained",children:"Send Credits"})]})]})]}),e.jsx(we,{open:g.open,autoHideDuration:4e3,onClose:()=>i({...g,open:!1}),children:e.jsx(ke,{severity:g.severity,onClose:()=>i({...g,open:!1}),children:g.message})})]})}export{Pe as default};
