import{r,j as e}from"./react-vendor-D1NxaRNd.js";import{G as Q}from"./GlassSurface-BMiMerMg.js";import{L as P}from"./loader-circle-CiHSGue1.js";import{D as q}from"./database-tQLqHvwy.js";import{T as ae}from"./trash-2-u04fJ-pn.js";import{R as re}from"./refresh-cw-Z-9S_Xnw.js";import{k as le,Z as K,ad as ne,aa as B,q as ce,H as ie,y as oe}from"./index-IJRH5ohh.js";import{T as xe}from"./triangle-alert-DVtZNLaR.js";import{C as G}from"./circle-x-CARZyZom.js";import{S as de}from"./server-BErZyOjg.js";import{L as me}from"./layers-v8dhCly8.js";import{C}from"./chevron-down-Cv76wpCH.js";import{C as b}from"./chevron-right-CMlq6PdB.js";import{H as he}from"./hard-drive-DGx2VOFg.js";import{C as ue}from"./chevron-left-Ds-2G-UY.js";import"./leaflet-vendor-DZbo3Ov0.js";import"./recharts-vendor-BziRPEEi.js";import"./d3-vendor-mcDw60ct.js";import"./apollo-vendor-BMQ75Ycx.js";import"./reactflow-vendor-Dz2P_-Qa.js";const ge=[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]],pe=le("table",ge),y="/api";function N(s){return!s&&s!==0?"-":new Intl.NumberFormat().format(s)}function $(s){return!s&&s!==0?"-":s<1?`${(s*1e3).toFixed(2)} Âµs`:s<1e3?`${s.toFixed(2)} ms`:`${(s/1e3).toFixed(2)} s`}function E({icon:s,label:n,value:l,subValue:x,color:d="#0ea5e9"}){return e.jsx("div",{className:"p-4 rounded-lg bg-white/5 border border-white/10",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center",style:{backgroundColor:`${d}20`},children:e.jsx(s,{className:"w-5 h-5",style:{color:d}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs text-gray-400 truncate",children:n}),e.jsx("div",{className:"text-lg font-bold text-white",children:l}),x&&e.jsx("div",{className:"text-xs text-gray-500",children:x})]})]})})}function je({table:s,onSelect:n,selected:l}){return e.jsxs("tr",{onClick:()=>n(s),className:`
        cursor-pointer transition-colors
        ${l?"bg-cyan-500/20":"hover:bg-white/5"}
      `,children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4 text-cyan-400"}),e.jsx("span",{className:"font-medium text-white",children:s.name})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-400 text-right",children:N(s.rowCount)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-400 text-right",children:s.size}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-400 text-right",children:s.indexSize||"-"})]})}function fe({value:s,onChange:n,onRun:l,running:x,error:d}){const p=r.useRef(null),j=c=>{if((c.ctrlKey||c.metaKey)&&c.key==="Enter"&&(c.preventDefault(),l()),c.key==="Tab"){c.preventDefault();const h=c.target.selectionStart,f=c.target.selectionEnd,g=s.substring(0,h)+"  "+s.substring(f);n(g),setTimeout(()=>{p.current.selectionStart=h+2,p.current.selectionEnd=h+2},0)}};return e.jsxs("div",{className:"rounded-lg border border-white/10 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 border-b border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4 text-cyan-400"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"SQL Query"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ctrl+Enter to run"})]}),e.jsxs("button",{onClick:l,disabled:x||!s.trim(),className:`
            flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm font-medium transition-colors
            ${x||!s.trim()?"bg-gray-500/20 text-gray-500 cursor-not-allowed":"bg-green-500/20 text-green-400 hover:bg-green-500/30"}
          `,children:[x?e.jsx(P,{className:"w-4 h-4 animate-spin"}):e.jsx(ie,{className:"w-4 h-4"}),"Run Query"]})]}),e.jsx("textarea",{ref:p,value:s,onChange:c=>n(c.target.value),onKeyDown:j,placeholder:"SELECT * FROM users LIMIT 10;",className:`
          w-full h-40 p-4 bg-black/40 text-gray-200 font-mono text-sm
          placeholder-gray-600 resize-none focus:outline-none
        `,spellCheck:!1}),d&&e.jsx("div",{className:"p-3 bg-red-500/10 border-t border-red-500/20",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-red-400 mt-0.5 flex-shrink-0"}),e.jsx("pre",{className:"text-xs text-red-400 whitespace-pre-wrap font-mono",children:d})]})})]})}function we({results:s,loading:n,pagination:l,onPageChange:x}){if(n)return e.jsx("div",{className:"flex items-center justify-center h-48",children:e.jsx(P,{className:"w-6 h-6 animate-spin text-cyan-400"})});if(!s)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-48 text-gray-500",children:[e.jsx(q,{className:"w-8 h-8 mb-2"}),e.jsx("p",{className:"text-sm",children:"Run a query to see results"})]});if(s.rowCount===0)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-48 text-gray-500",children:[e.jsx(oe,{className:"w-8 h-8 mb-2"}),e.jsx("p",{className:"text-sm",children:"Query returned no results"})]});const{rows:d,fields:p,rowCount:j,executionTime:c}=s;return e.jsxs("div",{className:"rounded-lg border border-white/10 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 border-b border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-gray-400",children:[N(j)," row",j!==1?"s":""]}),c!==void 0&&e.jsxs("span",{className:"text-xs text-gray-500",children:["Executed in ",$(c)]})]}),l&&l.totalPages>1&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>x(l.page-1),disabled:l.page<=1,className:"p-1 rounded hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(ue,{className:"w-4 h-4 text-gray-400"})}),e.jsxs("span",{className:"text-xs text-gray-400",children:["Page ",l.page," of ",l.totalPages]}),e.jsx("button",{onClick:()=>x(l.page+1),disabled:l.page>=l.totalPages,className:"p-1 rounded hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(b,{className:"w-4 h-4 text-gray-400"})})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-white/5",children:e.jsx("tr",{children:p?.map((h,f)=>e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:h.name||h},f))})}),e.jsx("tbody",{className:"divide-y divide-white/5",children:d?.map((h,f)=>e.jsx("tr",{className:"hover:bg-white/5",children:p?.map((g,S)=>{const i=h[g.name||g];return e.jsx("td",{className:"px-4 py-2 text-sm text-gray-300 whitespace-nowrap max-w-xs truncate",title:typeof i=="object"?JSON.stringify(i):String(i),children:i===null?e.jsx("span",{className:"text-gray-600 italic",children:"NULL"}):typeof i=="object"?e.jsx("span",{className:"text-yellow-400 font-mono text-xs",children:JSON.stringify(i).slice(0,50)}):typeof i=="boolean"?e.jsx("span",{className:i?"text-green-400":"text-red-400",children:i.toString()}):String(i)},S)})},f))})]})})]})}function ye({query:s,index:n}){const[l,x]=r.useState(!1);return e.jsxs("div",{className:"border-b border-white/5 last:border-0",children:[e.jsxs("button",{onClick:()=>x(!l),className:"w-full flex items-center justify-between p-3 hover:bg-white/5 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsxs("span",{className:"text-xs text-gray-500 w-6",children:["#",n+1]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"text-sm text-white font-mono truncate text-left",children:[s.query?.slice(0,80),s.query?.length>80&&"..."]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500 mt-1",children:[e.jsx("span",{children:$(s.duration||s.mean_time)}),e.jsxs("span",{children:[N(s.calls)," calls"]})]})]})]}),l?e.jsx(C,{className:"w-4 h-4 text-gray-500"}):e.jsx(b,{className:"w-4 h-4 text-gray-500"})]}),l&&e.jsxs("div",{className:"p-3 bg-black/20",children:[e.jsx("pre",{className:"text-xs text-gray-300 font-mono whitespace-pre-wrap overflow-x-auto",children:s.query}),e.jsxs("div",{className:"mt-2 grid grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-white/5 rounded p-2",children:[e.jsx("div",{className:"text-gray-500",children:"Total Time"}),e.jsx("div",{className:"text-white",children:$(s.total_time)})]}),e.jsxs("div",{className:"bg-white/5 rounded p-2",children:[e.jsx("div",{className:"text-gray-500",children:"Mean Time"}),e.jsx("div",{className:"text-white",children:$(s.mean_time)})]}),e.jsxs("div",{className:"bg-white/5 rounded p-2",children:[e.jsx("div",{className:"text-gray-500",children:"Calls"}),e.jsx("div",{className:"text-white",children:N(s.calls)})]})]})]})]})}function be({index:s}){const n=s.idx_scan&&s.seq_scan?s.idx_scan/(s.idx_scan+s.seq_scan)*100:s.idx_scan>0?100:0,l=n>=80?"text-green-400":n>=50?"text-yellow-400":"text-red-400";return e.jsxs("tr",{className:"hover:bg-white/5",children:[e.jsxs("td",{className:"px-4 py-3 text-sm",children:[e.jsx("div",{className:"font-medium text-white",children:s.indexrelname||s.name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.relname||s.table})]}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-400 text-right",children:N(s.idx_scan)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-400 text-right",children:N(s.idx_tup_read)}),e.jsx("td",{className:"px-4 py-3 text-sm text-right",children:e.jsxs("span",{className:l,children:[n.toFixed(1),"%"]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-400 text-right",children:s.index_size||"-"})]})}function Oe(){const[s,n]=r.useState([]),[l,x]=r.useState(null),[d,p]=r.useState(null),[j,c]=r.useState([]),[h,f]=r.useState([]),[g,S]=r.useState(""),[i,z]=r.useState(null),[Z,k]=r.useState(null),[V,O]=r.useState(!1),[W,X]=r.useState(1),[Y,F]=r.useState(!0),[u,T]=r.useState("tables"),[L,J]=r.useState(!1),[v,R]=r.useState(null),m=r.useCallback(()=>{try{const t=localStorage.getItem("musclemap-auth");if(t){const o=JSON.parse(t);if(o?.state?.token)return{Authorization:`Bearer ${o.state.token}`}}const a=localStorage.getItem("musclemap_token");return a?{Authorization:`Bearer ${a}`}:{}}catch{return{}}},[]),_=r.useCallback(async()=>{try{const t=await fetch(`${y}/admin/database/stats`,{headers:m()});if(t.ok){const M=((await t.json()).tables||[]).map(w=>({name:w.table_name,rowCount:w.row_count||0,size:w.total_size||"-",indexSize:w.index_size||"-"}));n(M);return}const a=await fetch(`${y}/admin/database/tables`,{headers:m()});if(a.ok){const M=((await a.json()).tables||[]).map(w=>({name:w.table_name,rowCount:w.row_count||0,size:"-",indexSize:"-"}));n(M)}}catch{}},[m]),I=r.useCallback(async()=>{try{const t=await fetch(`${y}/admin/database/connections`,{headers:m()});if(t.ok){const a=await t.json();p({totalCount:a.pool?.totalConnections||0,activeCount:a.database?.active_connections||0,idleCount:a.pool?.idleConnections||a.database?.idle_connections||0,waitingCount:a.pool?.waitingClients||a.database?.waiting_connections||0})}}catch{}},[m]),U=r.useCallback(async()=>{try{const t=await fetch(`${y}/admin/database/slow-queries`,{headers:m()});if(t.ok){const a=await t.json();c(a.slowQueries||a.queries||[])}}catch{}},[m]),H=r.useCallback(async()=>{try{const t=await fetch(`${y}/admin/database/indexes`,{headers:m()});if(t.ok){const a=await t.json();f(a.indexes||[])}}catch{}},[m]),D=r.useCallback(async(t=1)=>{if(g.trim()){O(!0),k(null),X(t);try{const a=await fetch(`${y}/admin/database/query`,{method:"POST",headers:{"Content-Type":"application/json",...m()},body:JSON.stringify({query:g.trim(),page:t,pageSize:50})}),o=await a.json();a.ok?(z({rows:o.rows,fields:o.fields,rowCount:o.rowCount,executionTime:o.executionTime}),k(null)):(k(o.error||o.message||"Query failed"),z(null))}catch(a){k(a.message),z(null)}finally{O(!1)}}},[g,m]),ee=r.useCallback(async(t=null)=>{J(!0),R(null);try{const a=await fetch(`${y}/admin/database/vacuum`,{method:"POST",headers:{"Content-Type":"application/json",...m()},body:JSON.stringify({table:t})}),o=await a.json();R({success:a.ok,message:o.message||o.error||(a.ok?"Vacuum completed successfully":"Vacuum failed")}),a.ok&&_()}catch(a){R({success:!1,message:a.message})}finally{J(!1)}},[m,_]),se=r.useCallback(t=>{x(t),S(`SELECT * FROM ${t.name} LIMIT 50;`)},[]),te=r.useCallback(t=>{D(t)},[D]),A=r.useCallback(async()=>{F(!0),await Promise.all([_(),I(),U(),H()]),F(!1)},[_,I,U,H]);return r.useEffect(()=>{A();const t=setInterval(I,3e4);return()=>clearInterval(t)},[A,I]),Y?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(P,{className:"w-8 h-8 animate-spin text-cyan-400"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(q,{className:"w-6 h-6 text-cyan-400"}),"Database Management"]}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Monitor tables, run queries, and maintain the database"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>ee(),disabled:L,className:`
              flex items-center gap-2 px-3 py-2 rounded-lg border transition-colors
              ${L?"bg-gray-500/20 border-gray-500/30 text-gray-500 cursor-not-allowed":"bg-orange-500/20 border-orange-500/30 text-orange-400 hover:bg-orange-500/30"}
            `,children:[L?e.jsx(P,{className:"w-4 h-4 animate-spin"}):e.jsx(ae,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Vacuum All"})]}),e.jsxs("button",{onClick:A,className:"flex items-center gap-2 px-3 py-2 rounded-lg bg-white/5 hover:bg-white/10 border border-white/10 transition-colors",children:[e.jsx(re,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Refresh"})]})]})]}),v&&e.jsxs("div",{className:`p-3 rounded-lg flex items-center gap-2 ${v.success?"bg-green-500/10 border border-green-500/20":"bg-red-500/10 border border-red-500/20"}`,children:[v.success?e.jsx(K,{className:"w-4 h-4 text-green-400"}):e.jsx(xe,{className:"w-4 h-4 text-red-400"}),e.jsx("span",{className:`text-sm ${v.success?"text-green-400":"text-red-400"}`,children:v.message}),e.jsx("button",{onClick:()=>R(null),className:"ml-auto p-1 hover:bg-white/10 rounded",children:e.jsx(G,{className:"w-4 h-4 text-gray-400"})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(E,{icon:de,label:"Total Connections",value:d?.totalCount||0,subValue:"In pool",color:"#0ea5e9"}),e.jsx(E,{icon:ne,label:"Active",value:d?.activeCount||0,subValue:"In use now",color:"#22c55e"}),e.jsx(E,{icon:B,label:"Idle",value:d?.idleCount||0,subValue:"Available",color:"#f59e0b"}),e.jsx(E,{icon:ce,label:"Waiting",value:d?.waitingCount||0,subValue:"In queue",color:d?.waitingCount>0?"#ef4444":"#6b7280"})]}),e.jsxs(Q,{className:"p-4",children:[e.jsxs("button",{onClick:()=>T(u==="tables"?"":"tables"),className:"w-full flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-white flex items-center gap-2",children:[e.jsx(me,{className:"w-4 h-4 text-cyan-400"}),"Tables (",s.length,")"]}),u==="tables"?e.jsx(C,{className:"w-4 h-4 text-gray-400"}):e.jsx(b,{className:"w-4 h-4 text-gray-400"})]}),u==="tables"&&e.jsx("div",{className:"overflow-x-auto rounded-lg border border-white/10",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-white/5",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Table Name"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Rows"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Size"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Index Size"})]})}),e.jsx("tbody",{className:"divide-y divide-white/5",children:s.map(t=>e.jsx(je,{table:t,onSelect:se,selected:l?.name===t.name},t.name))})]})})]}),e.jsxs(Q,{className:"p-4",children:[e.jsxs("button",{onClick:()=>T(u==="query"?"":"query"),className:"w-full flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-white flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4 text-green-400"}),"SQL Query Editor"]}),u==="query"?e.jsx(C,{className:"w-4 h-4 text-gray-400"}):e.jsx(b,{className:"w-4 h-4 text-gray-400"})]}),u==="query"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(fe,{value:g,onChange:S,onRun:()=>D(1),running:V,error:Z}),e.jsx(we,{results:i,loading:V,pagination:i?{page:W,totalPages:Math.ceil((i.rowCount||0)/50)}:null,onPageChange:te})]})]}),e.jsxs(Q,{className:"p-4",children:[e.jsxs("button",{onClick:()=>T(u==="slow"?"":"slow"),className:"w-full flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-white flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4 text-yellow-400"}),"Slow Queries (",j.length,")"]}),u==="slow"?e.jsx(C,{className:"w-4 h-4 text-gray-400"}):e.jsx(b,{className:"w-4 h-4 text-gray-400"})]}),u==="slow"&&e.jsx("div",{className:"rounded-lg border border-white/10 overflow-hidden",children:j.length>0?j.map((t,a)=>e.jsx(ye,{query:t,index:a},a)):e.jsxs("div",{className:"flex flex-col items-center justify-center h-32 text-gray-500",children:[e.jsx(K,{className:"w-6 h-6 mb-2"}),e.jsx("p",{className:"text-sm",children:"No slow queries detected"})]})})]}),e.jsxs(Q,{className:"p-4",children:[e.jsxs("button",{onClick:()=>T(u==="indexes"?"":"indexes"),className:"w-full flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-white flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4 text-purple-400"}),"Index Usage (",h.length,")"]}),u==="indexes"?e.jsx(C,{className:"w-4 h-4 text-gray-400"}):e.jsx(b,{className:"w-4 h-4 text-gray-400"})]}),u==="indexes"&&e.jsx("div",{className:"overflow-x-auto rounded-lg border border-white/10",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-white/5",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Index / Table"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Scans"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Tuples Read"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Usage %"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Size"})]})}),e.jsx("tbody",{className:"divide-y divide-white/5",children:h.length>0?h.map((t,a)=>e.jsx(be,{index:t},a)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-8 text-center text-gray-500",children:"No index statistics available"})})})]})})]})]})}export{Oe as default};
