import{A as F,a as O}from"./AdventureHUD-C6lkooxT.js";import{C as oe,d as le,L as ce,c as de,b as xe,M as ue,S as he,u as me,e as pe}from"./AdventureHUD-C6lkooxT.js";import{j as e,r as i,d as $}from"./react-vendor-D1NxaRNd.js";import{m as r,A as W}from"./index-BV5ySY7X.js";import{u as E,a as P,c as y,g as S,d as z,R as B,b as D,L as H,k as C}from"./adventureMapStore-ZEwrCWQp.js";import{P as ge,q as be,r as we,e as ve,j as ye,v as je,f as Ne,n as ke,x as Le,p as Me,l as Ce,m as Ee,w as Pe,o as Se,t as Ae}from"./adventureMapStore-ZEwrCWQp.js";import"./leaflet-vendor-DZbo3Ov0.js";import"./apollo-vendor-BMQ75Ycx.js";import"./reactflow-vendor-Dz2P_-Qa.js";import"./d3-vendor-mcDw60ct.js";import"./recharts-vendor-BziRPEEi.js";const U={"summit-peak":{x:50,y:10,color:"#fbbf24"},"wellness-springs":{x:20,y:30,color:"#06b6d4"},"market-district":{x:80,y:30,color:"#f59e0b"},"warrior-arena":{x:20,y:50,color:"#ef4444"},"central-hub":{x:50,y:50,color:"#3b82f6"},"guild-hall":{x:80,y:50,color:"#22c55e"},"progress-path":{x:30,y:75,color:"#8b5cf6"},"scholars-tower":{x:70,y:75,color:"#ec4899"}};function q({characterPosition:h,currentRegion:l,visitedLocations:c,totalLocations:o,onClick:s,className:d=""}){const f=h.x/1e3*100,m=h.y/800*100;return e.jsxs(r.button,{className:`relative w-32 h-24 rounded-lg bg-black/60 backdrop-blur-sm border border-white/20 overflow-hidden ${d}`,onClick:s,whileHover:{scale:1.05},whileTap:{scale:.98},children:[e.jsxs("svg",{className:"absolute inset-0 w-full h-full",viewBox:"0 0 100 100",children:[e.jsx("defs",{children:e.jsx("pattern",{id:"minimap-grid",width:"20",height:"20",patternUnits:"userSpaceOnUse",children:e.jsx("path",{d:"M 20 0 L 0 0 0 20",fill:"none",stroke:"rgba(255,255,255,0.05)",strokeWidth:"0.5"})})}),e.jsx("rect",{width:"100",height:"100",fill:"url(#minimap-grid)"}),Object.entries(U).map(([a,x])=>{const t=a===l;return e.jsxs("g",{children:[e.jsx("circle",{cx:x.x,cy:x.y,r:t?6:4,fill:x.color,fillOpacity:t?.8:.4}),t&&e.jsx(r.circle,{cx:x.x,cy:x.y,r:10,fill:"none",stroke:x.color,strokeWidth:1,strokeOpacity:.5,animate:{r:[8,12,8],opacity:[.5,.2,.5]},transition:{repeat:1/0,duration:1.5}})]},a)}),e.jsxs("g",{stroke:"rgba(255,255,255,0.1)",strokeWidth:"0.5",children:[e.jsx("line",{x1:"50",y1:"50",x2:"20",y2:"50"}),e.jsx("line",{x1:"50",y1:"50",x2:"80",y2:"50"}),e.jsx("line",{x1:"50",y1:"50",x2:"50",y2:"10"}),e.jsx("line",{x1:"50",y1:"50",x2:"30",y2:"75"}),e.jsx("line",{x1:"50",y1:"50",x2:"70",y2:"75"}),e.jsx("line",{x1:"20",y1:"50",x2:"20",y2:"30"}),e.jsx("line",{x1:"80",y1:"50",x2:"80",y2:"30"})]}),e.jsxs(r.g,{animate:{x:f-50,y:m-50},transition:{type:"spring",stiffness:200,damping:25},children:[e.jsx(r.circle,{cx:50,cy:50,r:4,fill:"#a855f7",animate:{scale:[1,1.3,1]},transition:{repeat:1/0,duration:1}}),e.jsx("circle",{cx:50,cy:50,r:2,fill:"white"})]})]}),e.jsxs("div",{className:"absolute bottom-1 left-1 right-1 flex justify-between items-center px-1",children:[e.jsxs("span",{className:"text-white/60 text-[10px]",children:[c.length,"/",o]}),e.jsx("span",{className:"text-white/40 text-[10px]",children:"ðŸ—ºï¸"})]}),e.jsx("div",{className:"absolute top-1 right-1",children:e.jsx(r.span,{className:"text-white/40 text-xs",animate:{opacity:[.4,.8,.4]},transition:{repeat:1/0,duration:2},children:"â¤¢"})})]})}function se({className:h="",onExpand:l,variant:c="default"}){const[o,s]=i.useState(!1),[d,f]=i.useState(!1);i.useEffect(()=>{const u=()=>f(window.innerWidth<768);return u(),window.addEventListener("resize",u),()=>window.removeEventListener("resize",u)},[]);const{position:m,region:a}=E(),{visited:x,visitedCount:t}=P(),b=y(u=>u.openMap),p=S(m),w=B[a],v=z().filter(u=>!u.requiredRole).length,j=Math.round(t/v*100),k=i.useCallback(()=>{b(),l&&l()},[b,l]),L=c==="hero"?"min-h-[300px] md:min-h-[350px]":c==="compact"?"min-h-[150px]":"min-h-[220px] md:min-h-[250px]";return e.jsxs(r.button,{className:`
        adventure-map-widget relative overflow-hidden rounded-2xl
        bg-gradient-to-br from-[#0f0f1a] via-[#151528] to-[#1a1a2e]
        border border-white/10 hover:border-purple-500/40
        shadow-lg shadow-purple-900/20 hover:shadow-purple-800/30
        transition-shadow duration-300
        ${L} ${h}
      `,onClick:k,onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),whileHover:{scale:d?1:1.01,y:d?0:-2},whileTap:{scale:.98},children:[e.jsx("div",{className:"absolute inset-0 pointer-events-none overflow-hidden",children:[...Array(20)].map((u,N)=>e.jsx(r.div,{className:"absolute w-1 h-1 bg-white/30 rounded-full",style:{left:`${Math.random()*100}%`,top:`${Math.random()*100}%`},animate:{opacity:[.2,.5,.2]},transition:{repeat:1/0,duration:2+Math.random()*2,delay:Math.random()}},N))}),e.jsxs("div",{className:"relative z-10 h-full p-4 md:p-5 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[e.jsx("div",{className:"w-10 h-10 md:w-12 md:h-12 rounded-xl bg-purple-600/20 border border-purple-500/20 flex items-center justify-center",children:e.jsx("span",{className:"text-xl md:text-2xl",children:w?.theme.icon||"ðŸ°"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"text-white font-bold text-sm md:text-base",children:"Adventure Map"}),e.jsx("p",{className:"text-white/50 text-xs md:text-sm",children:w?.name||"Unknown Region"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right hidden sm:block",children:[e.jsx("div",{className:"text-white font-bold text-base",children:t}),e.jsxs("div",{className:"text-white/40 text-xs",children:["/ ",v," discovered"]})]}),e.jsxs("div",{className:"relative w-12 h-12 md:w-14 md:h-14",children:[e.jsxs("svg",{className:"w-full h-full -rotate-90",children:[e.jsx("circle",{cx:"50%",cy:"50%",r:"45%",fill:"none",stroke:"rgba(139, 92, 246, 0.2)",strokeWidth:"4"}),e.jsx("circle",{cx:"50%",cy:"50%",r:"45%",fill:"none",stroke:"rgba(139, 92, 246, 0.8)",strokeWidth:"4",strokeLinecap:"round",strokeDasharray:`${j*2.83} 283`})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("span",{className:"text-white font-bold text-xs md:text-sm",children:[j,"%"]})})]})]})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center min-h-0 py-2",children:e.jsx(q,{characterPosition:m,currentRegion:a,visitedLocations:x,totalLocations:v,className:"w-full h-full max-w-[220px] md:max-w-[260px] max-h-[140px] md:max-h-[160px]"})}),p&&e.jsxs("div",{className:"mt-3 flex items-center justify-between bg-white/5 hover:bg-white/10 rounded-xl px-4 py-3 border border-white/5 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:p.icon}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white/90 text-sm font-medium block",children:p.name}),e.jsx("span",{className:"text-white/40 text-xs",children:"Current Location"})]})]}),e.jsx(r.div,{className:"text-purple-400 text-sm",animate:{x:o?4:0},transition:{duration:.2},children:"â†’"})]}),e.jsxs("div",{className:"mt-3 sm:hidden",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-white/50",children:"Discovery Progress"}),e.jsxs("span",{className:"text-purple-400 font-medium",children:[t," / ",v]})]}),e.jsx("div",{className:"h-1.5 bg-white/10 rounded-full overflow-hidden",children:e.jsx(r.div,{className:"h-full bg-gradient-to-r from-purple-500 to-blue-500 rounded-full",initial:{width:0},animate:{width:`${j}%`},transition:{duration:.5,ease:"easeOut"}})})]}),e.jsx(r.div,{className:"absolute inset-0 bg-gradient-to-t from-purple-600/20 to-transparent pointer-events-none",initial:{opacity:0},animate:{opacity:o?1:0},transition:{duration:.2}}),e.jsxs(r.div,{className:`
            absolute bottom-3 right-3 text-xs flex items-center gap-1.5
            px-2.5 py-1.5 rounded-full bg-black/40 backdrop-blur-sm border border-white/10
            ${d?"text-white/60":"text-white/40"}
          `,initial:{opacity:d?.7:0},animate:{opacity:o||d?1:0},children:[e.jsx("span",{children:d?"Tap to explore":"Click to explore"}),e.jsx("span",{className:"text-purple-400",children:"â¤¢"})]})]}),e.jsx(r.div,{className:"absolute inset-0 rounded-2xl pointer-events-none",style:{border:"2px solid transparent",background:"linear-gradient(135deg, rgba(139, 92, 246, 0.3), rgba(59, 130, 246, 0.3)) border-box",WebkitMask:"linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0)",WebkitMaskComposite:"xor",maskComposite:"exclude"},initial:{opacity:0},animate:{opacity:o?1:0},transition:{duration:.3}})]})}const V={level:12,xp:1234,xpToNextLevel:2e3,credits:2340,wealthTier:3,characterStats:{strength:45,dexterity:32,endurance:28,constitution:38,power:25,vitality:40}},_={stage:3,name:"Buddy",equipped:{aura:"aura-cosmic",wings:"wings-butterfly"}};function ie({stats:h=V,companionData:l=_,onClose:c}){const o=$(),[s,d]=i.useState(!1),[f,m]=i.useState(!1),[a,x]=i.useState(!1),t=i.useRef(null),{isOpen:b,close:p,toggleFullscreen:w,hudExpanded:v,toggleHud:j}=D(),{position:k}=E(),{visited:L}=P(),u=S(k,40);i.useEffect(()=>{const n=()=>{const g=window.innerWidth;d(g<640),m(g>=640&&g<1024)};return n(),window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),i.useEffect(()=>{const n=()=>{x(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",n),document.addEventListener("webkitfullscreenchange",n),()=>{document.removeEventListener("fullscreenchange",n),document.removeEventListener("webkitfullscreenchange",n)}},[]);const N=i.useCallback(()=>{document.fullscreenElement&&document.exitFullscreen?.().catch(()=>{}),p(),c&&c()},[p,c]);i.useEffect(()=>{const n=g=>{g.key==="Escape"&&(a?document.exitFullscreen?.().catch(()=>{}):N())};if(b)return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[b,a,N]);const A=i.useCallback((n,g)=>{document.fullscreenElement&&document.exitFullscreen?.().catch(()=>{}),p(),o(g)},[p,o]),I=i.useCallback(async()=>{try{document.fullscreenElement?await document.exitFullscreen():t.current?await t.current.requestFullscreen():await document.documentElement.requestFullscreen(),w()}catch{w()}},[w]),T=window.matchMedia("(prefers-reduced-motion: reduce)").matches;if(!b)return null;const R=s?60:f?70:80,M=a?0:typeof window<"u"&&"CSS"in window&&CSS.supports("padding-bottom","env(safe-area-inset-bottom)")?"env(safe-area-inset-bottom)":"0px";return e.jsx(W,{children:e.jsxs(r.div,{ref:t,className:"adventure-map-fullscreen fixed inset-0 z-[100] bg-[#0a0a12]",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{paddingTop:a?0:"env(safe-area-inset-top, 0px)",paddingLeft:a?0:"env(safe-area-inset-left, 0px)",paddingRight:a?0:"env(safe-area-inset-right, 0px)"},children:[e.jsxs(r.div,{className:"absolute inset-0",style:{paddingBottom:`calc(${R}px + ${M})`},initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},transition:{type:"spring",stiffness:300,damping:30},children:[e.jsx("button",{onClick:N,className:`
              absolute z-50 rounded-full bg-black/70 backdrop-blur-sm border border-white/20
              text-white hover:bg-white/10 active:bg-white/20 transition-colors
              flex items-center justify-center touch-manipulation
              ${s?"top-2 right-2 w-10 h-10 text-lg":"top-4 right-4 w-12 h-12 text-xl"}
            `,"aria-label":"Close map",children:"âœ•"}),e.jsx("button",{onClick:I,className:`
              absolute z-50 rounded-full bg-black/70 backdrop-blur-sm border border-white/20
              text-white hover:bg-white/10 active:bg-white/20 transition-colors
              flex items-center justify-center touch-manipulation
              ${s?"top-2 right-14 w-10 h-10 text-sm":"top-4 right-20 w-12 h-12 text-base"}
            `,"aria-label":a?"Exit fullscreen":"Enter fullscreen",children:a?"âŠ™":"â›¶"}),e.jsxs("div",{className:`
              absolute z-50 bg-black/70 backdrop-blur-sm rounded-lg border border-white/20
              ${s?"top-2 left-2 px-3 py-1.5":"top-4 left-4 px-4 py-2"}
            `,children:[e.jsx("h1",{className:`text-white font-bold ${s?"text-sm":"text-lg"}`,children:"Adventure Map"}),e.jsxs("p",{className:`text-white/50 ${s?"text-xs":"text-sm"}`,children:[L.length," / ",Object.values(H).filter(n=>!n.requiredRole).length," discovered"]})]}),e.jsx(F,{className:"w-full h-full",onLocationEnter:A,isFullscreen:!0,reducedMotion:T})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 z-50",style:{paddingBottom:M},children:e.jsx(O,{stats:h,companionData:l,currentLocation:u,onMinimapClick:()=>{},onMenuClick:()=>{},isMobile:s,isExpanded:v,onToggleExpand:j})})]})})}function ae(){const h=y(t=>t.characterPosition),l=y(t=>t.visitedLocations),c=y(t=>t.lastVisitedLocation),o=y(t=>t.totalVisits),s=y(t=>t.setCharacterPosition),d=l.length>0,f=i.useCallback(()=>{const t=C();s(t.position),localStorage.removeItem("musclemap-adventure-map"),window.location.reload()},[s]),m=i.useCallback(()=>{const t=C();s(t.position)},[s]),a=i.useCallback(()=>({characterPosition:h,visitedLocations:l,lastVisitedLocation:c,totalVisits:o}),[h,l,c,o]),x=i.useCallback(t=>{t.characterPosition&&s(t.characterPosition)},[s]);return{isHydrated:d,visitedCount:l.length,totalVisits:o,lastVisited:c,resetProgress:f,restoreDefaultPosition:m,exportState:a,importState:x}}export{O as AdventureHUD,F as AdventureMapCanvas,ie as AdventureMapFullscreen,se as AdventureMapWidget,oe as CompanionWidget,le as CreditsWidget,H as LOCATIONS,ce as LocationNode,de as MapCharacter,xe as MapPath,ue as MapRegion,q as MinimapWidget,ge as PATH_CONNECTIONS,B as REGIONS,he as StatsBar,be as findPath,we as findPathPositions,ve as getAdjacentLocations,z as getAllLocations,ye as getAllRegions,S as getClosestLocation,je as getDistance,Ne as getLocation,ke as getLocationsByRegion,Le as getMovementWaypoints,Me as getPathsForLocation,Ce as getRegion,Ee as getRegionAtPosition,C as getStartingLocation,Pe as interpolatePosition,Se as isNearLocation,Ae as pathToPositions,me as useCharacterMovement,pe as useMapNavigation,ae as useMapPersistence};
