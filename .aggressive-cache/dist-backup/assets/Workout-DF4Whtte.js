const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BcufNXW5.js","assets/react-vendor-D1NxaRNd.js","assets/illustrations-CFkZtwGd.js","assets/index-YhIq0fk2.js","assets/leaflet-vendor-CIGW-MKW.css","assets/reactflow-vendor-B5DZHykP.css","assets/index-C0SO9pZV.css"])))=>i.map(i=>d[i]);
import{k as fe,a as Ze,O as st,R as tt,Q as at,V as rt,Y as lt,$ as nt,a0 as it,a1 as ot,a2 as ct,a3 as dt,a4 as ut,a5 as xt,a6 as mt,n as Cs,x as ht,a7 as gt,H as Oe,P as Te,m as J,I as De,A as me,q as es,Z as Ms,a8 as Be,a9 as Es,X as ve,aa as ss,ab as Ts,h as be,ac as Pe,ad as ns,J as pt,ae as ze,K as bt,_ as ft}from"./index-YhIq0fk2.js";import{r as t,j as e,a as yt,d as vt,L as jt}from"./react-vendor-D1NxaRNd.js";import{T as Rs}from"./TipCard-Cb_XIStH.js";import{h as wt}from"./illustrations-CFkZtwGd.js";import{M as is}from"./MuscleViewer-B4A2U0Ou.js";import{M as Nt}from"./MuscleActivationBadge-BXYRgQpx.js";import"./GlassSurface-BMiMerMg.js";import"./GlassButton-DGdJmTjm.js";import{FloatingRestTimer as St}from"./FloatingRestTimer-DyAcPE6r.js";import{u as os,b as cs,c as xe,g as Is}from"./apollo-vendor-BMQ75Ycx.js";import{C as Ue}from"./circle-alert-p6Gfcy4u.js";import{L as ke}from"./loader-circle-CBOUmi7V.js";import{M as Ae}from"./minus-Cwx6bJ-q.js";import{A as ds}from"./award-6WKkMmte.js";import{R as ts}from"./refresh-cw-BQspzjTn.js";import{I as as}from"./info-W2T0-J_R.js";import{C as qe}from"./chevron-down-DxQkCsRL.js";import{T as _s}from"./timer-yJ-RsBdR.js";import{C as Ps}from"./check-BJTdgYiA.js";import{C as As}from"./chevron-right-BICnbdva.js";import{T as $s}from"./trash-2-BLclBsjp.js";import{R as Xe}from"./rotate-ccw-DmDdK_1D.js";import{C as kt}from"./copy-C4lgW9Nm.js";import{P as us}from"./pause-CTtrsb9P.js";import{V as Ct,a as Mt}from"./volume-x-WdrAkrRA.js";import{F as xs}from"./flag-ClqwbpxR.js";import{T as Fs}from"./trending-down-CLmmQa7E.js";import{P as Et}from"./pen-Bc_hz6Ed.js";import{C as Tt}from"./chevron-up-CpX8YGrL.js";import{S as Rt}from"./save-6rqPrg-V.js";import"./reactflow-vendor-Dz2P_-Qa.js";import"./d3-vendor-mcDw60ct.js";import"./recharts-vendor-BziRPEEi.js";import"./leaflet-vendor-DZbo3Ov0.js";import"./use-drag-controls-Dy1SiTvh.js";import"./minimize-2-DfxyKwAC.js";import"./skip-forward-DtLt2OBX.js";const It=[["path",{d:"M22 14v-4",key:"14q9d5"}],["path",{d:"M6 14v-4",key:"14a6bd"}],["rect",{x:"2",y:"6",width:"16",height:"12",rx:"2",key:"13zb55"}]],_t=fe("battery-low",It);const Pt=[["path",{d:"M10 14v-4",key:"suye4c"}],["path",{d:"M22 14v-4",key:"14q9d5"}],["path",{d:"M6 14v-4",key:"14a6bd"}],["rect",{x:"2",y:"6",width:"16",height:"12",rx:"2",key:"13zb55"}]],At=fe("battery-medium",Pt);const $t=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]],Ft=fe("chart-line",$t);const Wt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M16 16s-1.5-2-4-2-4 2-4 2",key:"epbg0q"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]],Lt=fe("frown",Wt);const Ot=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"8",x2:"16",y1:"15",y2:"15",key:"1xb1d9"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]],Dt=fe("meh",Ot);const Bt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]],ms=fe("smile",Bt);const Ut=[["path",{d:"M21 9a2.4 2.4 0 0 0-.706-1.706l-3.588-3.588A2.4 2.4 0 0 0 15 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2z",key:"1dfntj"}],["path",{d:"M15 3v5a1 1 0 0 0 1 1h5",key:"6s6qgf"}]],hs=fe("sticky-note",Ut);const Gt=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],qt=fe("tag",Gt),Ht="musclemap-sessions",Vt=1,Ge="active_session";let $e=null;function zt(){return $e||($e=new Promise((a,n)=>{try{if(typeof indexedDB>"u"){a(null);return}}catch{a(null);return}const i=indexedDB.open(Ht,Vt);i.onerror=()=>{n(i.error)},i.onsuccess=()=>{a(i.result)},i.onupgradeneeded=h=>{const v=h.target.result;v.objectStoreNames.contains(Ge)||v.createObjectStore(Ge,{keyPath:"id"})}}),$e)}async function Yt(){try{const a=await zt();if(!a)return;const i=a.transaction(Ge,"readwrite").objectStore(Ge);await new Promise((h,v)=>{const u=i.delete("current");u.onsuccess=()=>h(),u.onerror=()=>v(u.error)})}catch{}}let de=null;const Qt=5e3,Kt=3e4;let Ye=0;async function Jt(a,n=!1){if(!localStorage.getItem("token"))return;const h=Date.now();if(n||h-Ye>Kt){de&&(clearTimeout(de),de=null);try{await Ze.post("/sessions",gs(a)),Ye=h}catch{}return}de&&clearTimeout(de),de=setTimeout(async()=>{try{await Ze.post("/sessions",gs(a)),Ye=Date.now()}catch{}de=null},Qt)}async function Zt(a,n){if(localStorage.getItem("token"))try{await Ze.delete("/sessions/active",{data:{reason:a,workoutId:n}})}catch{}}function gs(a){return{sessionId:a.sessionId,startedAt:a.startTime,pausedAt:a.pausedAt,totalPausedTime:a.totalPausedTime,workoutPlan:a.workoutPlan||{exercises:a.exercises},currentExerciseIndex:a.currentExerciseIndex,currentSetIndex:a.currentSetIndex,sets:a.sets,totalVolume:a.totalVolume,totalReps:a.totalReps,estimatedCalories:a.estimatedCalories,musclesWorked:a.musclesWorked,sessionPRs:a.sessionPRs,restTimer:a.restTimer,exerciseGroups:a.exerciseGroups,activeGroup:a.activeGroup,activeGroupExerciseIndex:a.activeGroupExerciseIndex,activeGroupRound:a.activeGroupRound,groupSets:a.groupSets,clientVersion:a.clientVersion}}async function ps(a="completed",n){de&&(clearTimeout(de),de=null),await Yt(),await Zt(a,n)}function He(){const a=t.useRef(null),n=t.useRef(null),i=t.useRef(null),{data:h,loading:v,refetch:u,error:_}=os(st,{fetchPolicy:"network-only",notifyOnNetworkStatusChange:!0,errorPolicy:"all"}),{data:C,loading:M,refetch:b}=os(tt,{fetchPolicy:"network-only",errorPolicy:"all"}),[E,{data:j,loading:g}]=cs(at,{errorPolicy:"all"}),[k,{loading:T}]=cs(rt,{errorPolicy:"all"}),[l,{loading:m}]=xe(lt,{errorPolicy:"all"}),[c,{loading:N}]=xe(nt),[$,{loading:G}]=xe(it),[y,{loading:F}]=xe(ot),[x,{loading:p}]=xe(ct),[L,{loading:Y}]=xe(dt),[U,{loading:O}]=xe(ut),[Z,{loading:Q}]=xe(xt),[q,{loading:H}]=xe(mt),f=t.useMemo(()=>h?.activeWorkoutSession||null,[h]),o=t.useMemo(()=>(C?.recoverableSessions||[]).map(I=>({...I,exerciseCount:I.musclesWorked?.length||0,setCount:I.setsLogged,lastActivityAt:I.archivedAt})),[C]),P=t.useMemo(()=>{const R={};if(j?.exerciseHistory)for(const I of j.exerciseHistory)R[I.exerciseId]=I;return R},[j]),V=!!f,te=!!f?.pausedAt,ne=t.useCallback(async(R,I)=>{try{const D=await l({variables:{input:R?{workoutPlan:R,clientId:I}:void 0}}),{data:ee,errors:se}=D;if(se?.length){const we=se[0],Me=we?.extensions?.code;let Ne=we?.message||"Failed to start session";return Me==="UNAUTHENTICATED"?Ne="Session expired. Please log in again.":Me==="FORBIDDEN"&&(Ne="Permission denied. Please try again."),{success:!1,error:Ne}}return ee?.startWorkoutSession?.session?(await u(),{success:!0,sessionId:ee.startWorkoutSession.session.id}):{success:!1,error:ee?.startWorkoutSession?"Session was not created (no session data returned)":"Server returned empty response"}}catch(D){return{success:!1,error:D instanceof Error?D.message:"Unknown error"}}},[l,u]),he=t.useCallback(async R=>{try{const{data:I,errors:D}=await c({variables:{input:R}});if(D?.length)return{success:!1,error:D[0]?.message||"Failed to log set"};if(I?.logSet){const ee=I.logSet,se=ee.prsAchieved||[];for(const we of se)a.current&&a.current(we);return await u(),{success:!0,set:ee.setLogged,prs:se}}return{success:!1,error:"Failed to log set"}}catch(I){return{success:!1,error:I instanceof Error?I.message:"Unknown error"}}},[c,u]),ie=t.useCallback(async(R,I)=>{try{const{data:D,errors:ee}=await $({variables:{input:{setId:R,...I}}});return ee?.length?{success:!1,error:ee[0]?.message||"Failed to update set"}:D?.updateSet?(await u(),{success:!0,set:D.updateSet}):{success:!1,error:"Failed to update set"}}catch(D){return{success:!1,error:D instanceof Error?D.message:"Unknown error"}}},[$,u]),K=t.useCallback(async R=>{try{const{data:I,errors:D}=await y({variables:{setId:R}});return D?.length?{success:!1,error:D[0]?.message||"Failed to delete set"}:I?.deleteSet!==void 0?(await u(),{success:!0}):{success:!1,error:"Failed to delete set"}}catch(I){return{success:!1,error:I instanceof Error?I.message:"Unknown error"}}},[y,u]),oe=t.useCallback(async()=>{if(!f)return{success:!1,error:"No active session"};try{const{data:R,errors:I}=await x({variables:{sessionId:f.id}});return I?.length?{success:!1,error:I[0]?.message||"Failed to pause session"}:R?.pauseWorkoutSession?(await u(),{success:!0}):{success:!1,error:"Failed to pause session"}}catch(R){return{success:!1,error:R instanceof Error?R.message:"Unknown error"}}},[f,x,u]),re=t.useCallback(async()=>{if(!f)return{success:!1,error:"No active session"};try{const{data:R,errors:I}=await L({variables:{sessionId:f.id}});return I?.length?{success:!1,error:I[0]?.message||"Failed to resume session"}:R?.resumeWorkoutSession?(await u(),{success:!0}):{success:!1,error:"Failed to resume session"}}catch(R){return{success:!1,error:R instanceof Error?R.message:"Unknown error"}}},[f,L,u]),ae=t.useCallback(async(R,I)=>{if(!f)return{success:!1,error:"No active session"};try{const{data:D,errors:ee}=await U({variables:{input:{sessionId:f.id,notes:R,isPublic:I}}});if(ee?.length)return{success:!1,error:ee[0]?.message||"Failed to complete session"};const se=D?.completeWorkoutSession;return se?(se.levelUp&&n.current&&n.current(Math.floor(se.xpEarned/1e3)+1),i.current&&i.current(se),await u(),{success:!0,result:se}):{success:!1,error:"Failed to complete session"}}catch(D){return{success:!1,error:D instanceof Error?D.message:"Unknown error"}}},[f,U,u]),ge=t.useCallback(async R=>{if(!f)return{success:!1,error:"No active session"};try{const{data:I,errors:D}=await Z({variables:{sessionId:f.id,reason:R}});return D?.length?{success:!1,error:D[0]?.message||"Failed to abandon session"}:I?.abandonWorkoutSession!==void 0?(await u(),{success:!0}):{success:!1,error:"Failed to abandon session"}}catch(I){return{success:!1,error:I instanceof Error?I.message:"Unknown error"}}},[f,Z,u]),je=t.useCallback(async R=>{try{const{data:I,errors:D}=await q({variables:{archivedSessionId:R}});return D?.length?{success:!1,error:D[0]?.message||"Failed to recover session"}:I?.recoverWorkoutSession?(await u(),await b(),{success:!0,session:I.recoverWorkoutSession}):{success:!1,error:"Failed to recover session"}}catch(I){return{success:!1,error:I instanceof Error?I.message:"Unknown error"}}},[q,u,b]),ce=t.useCallback(async R=>{R.length!==0&&await E({variables:{exerciseIds:R}})},[E]),Ce=t.useCallback(async(R,I,D)=>{try{const{data:ee}=await k({variables:{exerciseId:R,equipment:I,maxResults:D||5}});return ee?.exerciseSubstitutions||[]}catch{return[]}},[k]),S=t.useCallback(R=>{R.onPRAchieved&&(a.current=R.onPRAchieved),R.onLevelUp&&(n.current=R.onLevelUp),R.onWorkoutComplete&&(i.current=R.onWorkoutComplete)},[]),B=t.useMemo(()=>{if(!f)return 0;const R=new Date(f.startedAt).getTime(),D=Date.now()-R;return Math.floor((D-f.totalPausedTime*1e3)/1e3)},[f]),X=t.useMemo(()=>{if(!f?.sets||f.sets.length===0)return[];const R=f.sets[f.sets.length-1];return R?f.sets.filter(I=>I.exerciseId===R.exerciseId):[]},[f]),ye=t.useCallback(R=>f?.sets?f.sets.filter(I=>I.exerciseId===R):[],[f]),Re=f?.sets?.length||0;return{activeSession:f,isSessionActive:V,isPaused:te,recoverableSessions:o,exerciseHistory:P,sessionDuration:B,currentExerciseSets:X,getSetsForExercise:ye,totalSets:Re,errors:{activeSession:_},loading:{activeSession:v,recoverableSessions:M,exerciseHistory:g,substitutions:T,startingSession:m,loggingSet:N,updatingSet:G,deletingSet:F,pausingSession:p,resumingSession:Y,completingSession:O,abandoningSession:Q,recoveringSession:H},startSession:ne,logSet:he,updateSet:ie,deleteSet:K,pauseSession:oe,resumeSession:re,completeSession:ae,abandonSession:ge,recoverSession:je,loadExerciseHistory:ce,findSubstitutes:Ce,registerCallbacks:S,refetchActiveSession:u,refetchRecoverableSessions:b}}function Xt({exerciseId:a,delay:n=2e3}){const[i,h]=t.useState(null),[v,u]=t.useState(!1),[_,C]=t.useState(!1);return t.useEffect(()=>{if(!a)return;h(null),u(!1),C(!1),(async()=>{try{const b=await Cs(`/tips/exercise/${a}`);b?.data&&(h(b.data),setTimeout(()=>u(!0),n))}catch{}})()},[a,n]),!i||!v||_?null:e.jsx("div",{className:"animate-fadeIn",children:e.jsx(Rs,{tip:i,onDismiss:()=>C(!0),compact:!0})})}const ea={first_workout:"ðŸŽ‰",workouts_10:"ðŸ”¥",workouts_50:"âš¡",workouts_100:"ðŸ†",streak_7:"ðŸ“…",streak_30:"ðŸ—“ï¸",exercises_100:"ðŸ’¯",reps_1000:"ðŸŽ¯",reps_10000:"ðŸš€",hours_10:"â±ï¸"};function sa({milestone:a,onContinue:n}){if(!a)return null;const i=ea[a.id]||"ðŸ…";return e.jsxs("div",{className:"bg-gradient-to-b from-yellow-500/20 via-amber-500/10 to-transparent rounded-2xl p-6 border border-yellow-500/30 text-center",children:[e.jsxs("div",{className:"relative inline-block mb-4",children:[e.jsx("div",{className:"text-6xl animate-bounce",children:i}),e.jsx("div",{className:"absolute -top-2 -right-2 w-8 h-8 bg-yellow-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-black",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]}),e.jsx("h3",{className:"text-xl font-bold text-yellow-400 mb-1",children:"Milestone Achieved!"}),e.jsx("p",{className:"text-2xl font-bold text-white mb-2",children:a.name}),a.description&&e.jsx("p",{className:"text-gray-300 text-sm mb-4",children:a.description}),n&&e.jsx("button",{onClick:n,className:"mt-4 px-6 py-2 bg-yellow-500 hover:bg-yellow-400 text-black font-medium rounded-lg transition-colors",children:"Awesome!"})]})}function ta({workout:a,onClose:n}){const[i,h]=t.useState(null),[v,u]=t.useState(null),[_,C]=t.useState(!0),[M,b]=t.useState(!0);t.useEffect(()=>{(async()=>{try{const g=await Cs("/tips/completion",{method:"POST",body:{goals:a?.goals||[]}});h(g?.data?.tip),u(g?.data?.milestone)}catch{}finally{C(!1)}})()},[a?.goals]);const E=[{icon:"â±ï¸",value:a?.duration||"-",label:"minutes",color:"text-blue-400"},{icon:"ðŸ‹ï¸",value:a?.exerciseCount||a?.exercises?.length||"-",label:"exercises",color:"text-yellow-400"},{icon:"ðŸ”¥",value:a?.totalSets||"-",label:"sets",color:"text-orange-400"},{icon:"ðŸ’ª",value:a?.totalTU?Math.round(a.totalTU):"-",label:"TU earned",color:"text-purple-400"}];return e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-gray-900 rounded-2xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"relative pt-8 pb-4 px-6 text-center overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute top-0 left-1/4 w-2 h-2 bg-yellow-400 rounded-full animate-ping",style:{animationDelay:"0s"}}),e.jsx("div",{className:"absolute top-4 right-1/4 w-2 h-2 bg-purple-400 rounded-full animate-ping",style:{animationDelay:"0.2s"}}),e.jsx("div",{className:"absolute top-2 left-1/2 w-2 h-2 bg-pink-400 rounded-full animate-ping",style:{animationDelay:"0.4s"}})]}),e.jsx("div",{className:"text-6xl mb-3",children:"ðŸŽ‰"}),e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Workout Complete!"}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Great job staying consistent"})]}),e.jsx("div",{className:"px-6 pb-4",children:e.jsx("div",{className:"grid grid-cols-4 gap-2",children:E.map((j,g)=>e.jsxs("div",{className:"bg-gray-800 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-lg mb-1",children:j.icon}),e.jsx("div",{className:`text-lg font-bold ${j.color}`,children:j.value}),e.jsx("div",{className:"text-xs text-gray-500",children:j.label})]},g))})}),v&&M&&e.jsx("div",{className:"px-6 pb-4",children:e.jsx(sa,{milestone:v,onContinue:()=>b(!1)})}),!_&&i&&(!v||!M)&&e.jsx("div",{className:"px-6 pb-4",children:e.jsx(Rs,{tip:i})}),_&&e.jsx("div",{className:"px-6 pb-4",children:e.jsx("div",{className:"bg-gray-800 rounded-xl p-4 animate-pulse",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-700 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-gray-700 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-700 rounded w-1/2"})]})]})})}),e.jsx("div",{className:"px-6 pb-6",children:e.jsx("button",{onClick:n,className:"w-full py-3 bg-purple-600 hover:bg-purple-500 text-white font-medium rounded-xl transition-colors",children:"Done"})})]})})}function aa({content:a,children:n}){const[i,h]=yt.useState(!1);return e.jsxs("div",{className:"relative inline-block",onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),onTouchStart:()=>h(!0),onTouchEnd:()=>setTimeout(()=>h(!1),2e3),children:[n,e.jsx(me,{children:i&&e.jsxs(J.div,{initial:{opacity:0,y:4,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:4,scale:.95},transition:{duration:.15},className:"absolute z-50 bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-2 text-xs text-gray-200 bg-gray-900 border border-gray-700 rounded-lg shadow-xl whitespace-nowrap max-w-[200px] text-center",style:{whiteSpace:"normal"},children:[a,e.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-gray-900"})]})})]})}const ra={warmup:{label:"Warmup",color:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30",icon:Es,tooltip:"Light weight to prepare muscles and joints before working sets"},working:{label:"Working",color:"bg-blue-500/20 text-blue-400 border-blue-500/30",icon:Be,tooltip:"Main sets at your target weight for building strength/muscle"},failure:{label:"Failure",color:"bg-red-500/20 text-red-400 border-red-500/30",icon:Ms,tooltip:"Pushed until you cannot complete another rep with good form"},drop:{label:"Drop",color:"bg-purple-500/20 text-purple-400 border-purple-500/30",icon:qe,tooltip:"Reduced weight immediately after a set with no rest"},amrap:{label:"AMRAP",color:"bg-orange-500/20 text-orange-400 border-orange-500/30",icon:es,tooltip:"As Many Reps As Possible - max effort set"}},la=[{value:0,label:"0 RIR",description:"Total failure"},{value:1,label:"1 RIR",description:"Could do 1 more"},{value:2,label:"2 RIR",description:"Could do 2 more"},{value:3,label:"3 RIR",description:"Could do 3 more"},{value:4,label:"4+ RIR",description:"Easy"}];function na({exerciseId:a,exerciseName:n,suggestedSets:i=3,suggestedReps:h=10,onSetLogged:v,onAllSetsComplete:u,onStartSession:_,compact:C=!1}){const{error:M}=ht(),b=gt(),[E,j]=t.useState(""),[g,k]=t.useState(h.toString()),[T,l]=t.useState("working"),[m,c]=t.useState(null),[N,$]=t.useState(null),[G,y]=t.useState(""),[F,x]=t.useState(!1),[p,L]=t.useState(null),[Y,U]=t.useState([]),{logSet:O,loadExerciseHistory:Z,exerciseHistory:Q,getSetsForExercise:q,activeSession:H,loading:f}=He(),o=f.loggingSet;t.useEffect(()=>{Z([a])},[a,Z]);const P=Q[a],V=q(a),te=V.length+1,ne=t.useMemo(()=>P?.bestWeight?Math.round(P.bestWeight*.85/5)*5:null,[P]);t.useEffect(()=>{ne&&!E&&j(ne.toString())},[ne,E]);const he=t.useCallback(async()=>{const S=parseFloat(E),B=parseInt(g);if(isNaN(S)||S<0){M("Please enter a valid weight (0 or greater)");return}if(!B||B<=0){M("Please enter reps greater than 0");return}if(!H){M("No active workout session. Please start a new workout from the beginning.");return}const X=await O({sessionId:H.id,exerciseId:a,setNumber:te,reps:B,weightKg:S/2.205,rpe:m||void 0,rir:N||void 0,tag:T||void 0,notes:G.trim()||void 0});if(X?.set){if(U(X.set.muscleActivations||[]),X.set.isPRWeight||X.set.isPR1RM||X.set.isPRReps){const ye=X.set.isPR1RM?"1rm":X.set.isPRWeight?"weight":"reps";L({type:ye,value:Math.round(ye==="1rm"?X.set.weightKg*2.205/(1.0278-.0278*B):X.set.weightKg*2.205)}),setTimeout(()=>L(null),4e3)}k(h.toString()),c(null),$(null),y(""),v?.(X.set),te>=i&&u?.()}},[E,g,T,m,N,G,a,H,O,h,i,te,v,u,M]),ie=S=>{const B=parseFloat(E)||0;j(Math.max(0,B+S).toString())},K=S=>{const B=parseFloat(S);S===""||S==="-"?j(""):isNaN(B)||j(Math.max(0,B).toString())},oe=S=>{const B=parseInt(g)||0;k(Math.max(0,B+S).toString())},re=t.useMemo(()=>{const S=parseFloat(E),B=parseInt(g);return S>0&&B>0&&B<=15?Math.round(S/(1.0278-.0278*B)):null},[E,g]),ae=re&&P?.best1RM&&re>P.best1RM,[ge,je]=t.useState(!1),ce=f.startingSession||ge,Ce=t.useCallback(async()=>{if(!(!_||ce)){je(!0);try{await _()}finally{setTimeout(()=>je(!1),500)}}},[_,ce]);return H?C?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs text-gray-400 mb-1 block",children:"Weight (lbs)"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>ie(-5),className:"p-1.5 rounded bg-gray-800 hover:bg-gray-700 text-gray-400",children:e.jsx(Ae,{className:"w-4 h-4"})}),e.jsx("input",{type:"number",min:"0",value:E,onChange:S=>K(S.target.value),placeholder:"0",className:"flex-1 bg-gray-800/50 border border-gray-700 rounded px-2 py-2 text-center text-lg font-bold focus:border-blue-500 focus:outline-none w-20"}),e.jsx("button",{onClick:()=>ie(5),className:"p-1.5 rounded bg-gray-800 hover:bg-gray-700 text-gray-400",children:e.jsx(Te,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs text-gray-400 mb-1 block",children:"Reps"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>oe(-1),className:"p-1.5 rounded bg-gray-800 hover:bg-gray-700 text-gray-400",children:e.jsx(Ae,{className:"w-4 h-4"})}),e.jsx("input",{type:"number",value:g,onChange:S=>k(S.target.value),placeholder:"0",className:"flex-1 bg-gray-800/50 border border-gray-700 rounded px-2 py-2 text-center text-lg font-bold focus:border-blue-500 focus:outline-none w-16"}),e.jsx("button",{onClick:()=>oe(1),className:"p-1.5 rounded bg-gray-800 hover:bg-gray-700 text-gray-400",children:e.jsx(Te,{className:"w-4 h-4"})})]})]})]}),e.jsx(J.button,{whileTap:{scale:.98},onClick:he,disabled:!E||!g||o,className:`w-full py-3 rounded-xl font-bold text-base transition-all flex items-center justify-center gap-2 ${E&&g&&!o?"bg-gradient-to-r from-green-600 to-green-500 hover:from-green-500 hover:to-green-400 text-white":"bg-gray-800 text-gray-500 cursor-not-allowed"}`,children:o?e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"w-4 h-4 animate-spin"}),"Logging..."]}):e.jsxs(e.Fragment,{children:[e.jsx(De,{className:"w-4 h-4"}),"Log Set ",te,"/",i]})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(me,{children:p&&e.jsxs(J.div,{initial:{opacity:0,y:-20,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-20,scale:.9},className:"bg-gradient-to-r from-yellow-500/20 to-orange-500/20 border border-yellow-500/30 rounded-lg p-4 flex items-center gap-3",children:[e.jsx(ds,{className:"w-8 h-8 text-yellow-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-yellow-400",children:"NEW PR!"}),e.jsxs("p",{className:"text-sm text-gray-300",children:[p.type==="1rm"&&`Estimated 1RM: ${p.value} lbs`,p.type==="weight"&&`Max weight: ${p.value} lbs`,p.type==="volume"&&`Set volume: ${p.value} lbs`]})]})]})}),P&&e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-3 flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[e.jsx(ts,{className:"w-4 h-4"}),e.jsxs("span",{children:["Last: ",P.totalSessions," sessions"]})]}),e.jsxs("div",{className:"flex gap-4",children:[P.bestWeight&&e.jsxs("span",{className:"text-blue-400",children:["Best: ",Math.round(P.bestWeight*2.205)," lbs"]}),P.best1RM&&e.jsxs("span",{className:"text-purple-400",children:["1RM: ",Math.round(P.best1RM*2.205)," lbs"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Set Progress:"}),e.jsx("div",{className:"flex gap-1",children:Array.from({length:i}).map((S,B)=>e.jsx("div",{className:`w-8 h-2 rounded-full transition-colors ${B<V.length?"bg-green-500":B===V.length?"bg-blue-500 animate-pulse":"bg-gray-700"}`},B))}),e.jsxs("span",{className:"text-sm font-medium",children:[V.length,"/",i]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(as,{className:"w-3 h-3"}),e.jsx("span",{children:"Tap and hold for info"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(ra).map(([S,B])=>{const X=B.icon;return e.jsx(aa,{content:B.tooltip,children:e.jsxs("button",{onClick:()=>l(S),className:`px-3 py-1.5 rounded-full text-sm font-medium border transition-all flex items-center gap-1.5 ${T===S?B.color:"bg-gray-800/50 text-gray-400 border-gray-700 hover:border-gray-600"}`,children:[e.jsx(X,{className:"w-4 h-4"}),B.label]})},S)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Weight (lbs)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>ie(-5),className:"p-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-gray-400",children:e.jsx(Ae,{className:"w-5 h-5"})}),e.jsx("input",{type:"number",min:"0",value:E,onChange:S=>K(S.target.value),placeholder:"0",className:"flex-1 bg-gray-800/50 border border-gray-700 rounded-lg px-4 py-3 text-center text-2xl font-bold focus:border-blue-500 focus:outline-none"}),e.jsx("button",{onClick:()=>ie(5),className:"p-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-gray-400",children:e.jsx(Te,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Reps"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>oe(-1),className:"p-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-gray-400",children:e.jsx(Ae,{className:"w-5 h-5"})}),e.jsx("input",{type:"number",value:g,onChange:S=>k(S.target.value),placeholder:"0",className:"flex-1 bg-gray-800/50 border border-gray-700 rounded-lg px-4 py-3 text-center text-2xl font-bold focus:border-blue-500 focus:outline-none"}),e.jsx("button",{onClick:()=>oe(1),className:"p-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-gray-400",children:e.jsx(Te,{className:"w-5 h-5"})})]})]}),re&&e.jsxs("div",{className:`p-3 rounded-lg border ${ae?"bg-yellow-500/10 border-yellow-500/30":"bg-gray-800/50 border-gray-700"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Estimated 1RM"}),e.jsxs("span",{className:`font-bold ${ae?"text-yellow-400":"text-white"}`,children:[re," lbs",ae&&e.jsx("span",{className:"ml-2 text-xs",children:"NEW PR!"})]})]}),P?.best1RM&&e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Previous Best"}),e.jsxs("span",{className:"text-xs text-gray-400",children:[Math.round(P.best1RM*2.205)," lbs"]})]})]}),Y.length>0&&e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-2",children:"Last Set - Muscle Activation"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:Y.map(S=>e.jsxs("span",{className:"bg-purple-500/30 text-purple-200 px-2 py-0.5 rounded text-xs",children:[S.muscleName," (",Math.round(S.activation*100),"%)"]},S.muscleId))})]}),e.jsxs("button",{onClick:()=>x(!F),className:"w-full py-2 text-sm text-gray-400 hover:text-gray-300 flex items-center justify-center gap-2",children:[e.jsxs("span",{children:[F?"Hide":"Show"," Advanced Options"]}),e.jsx(qe,{className:`w-4 h-4 transition-transform ${F?"rotate-180":""}`})]}),e.jsx(me,{children:F&&e.jsxs(J.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"space-y-4 overflow-hidden",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"RPE (1-10)"}),e.jsx("span",{className:"text-sm font-medium",children:m||"-"})]}),e.jsx("input",{type:"range",min:"1",max:"10",value:m||5,onChange:S=>c(parseInt(S.target.value)),className:"w-full accent-blue-500"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsx("span",{children:"Easy"}),e.jsx("span",{children:"Max Effort"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Reps in Reserve"}),e.jsx("div",{className:"flex gap-2",children:la.map(S=>e.jsx("button",{onClick:()=>$(N===S.value?null:S.value),className:`flex-1 py-2 px-2 rounded-lg text-xs font-medium border transition-all ${N===S.value?"bg-blue-500/20 text-blue-400 border-blue-500/30":"bg-gray-800/50 text-gray-400 border-gray-700 hover:border-gray-600"}`,children:S.label},S.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Notes"}),e.jsx("input",{type:"text",value:G,onChange:S=>y(S.target.value),placeholder:"Optional notes...",className:"w-full bg-gray-800/50 border border-gray-700 rounded-lg px-4 py-2 text-sm focus:border-blue-500 focus:outline-none"})]})]})}),V.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm text-gray-400",children:"Logged Sets"}),e.jsx("div",{className:"space-y-1",children:V.map((S,B)=>e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-2 flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-400",children:["Set ",B+1]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"font-medium",children:[Math.round((S.weightKg||0)*2.205)," lbs x ",S.reps]}),e.jsxs("span",{className:"text-purple-400",children:[S.tu," TU"]}),S.isPRWeight&&e.jsx(ds,{className:"w-4 h-4 text-yellow-400"})]})]},S.id))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-400 flex items-center gap-1.5",children:[e.jsx(_s,{className:"w-4 h-4"}),"Rest Timer"]}),b.isActive&&e.jsx("button",{onClick:b.stop,className:"text-xs text-red-400 hover:text-red-300",children:"Stop"})]}),e.jsx(me,{children:b.isActive&&e.jsx(J.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"overflow-hidden",children:e.jsxs("div",{className:`p-4 rounded-xl border ${b.time<=10?"bg-red-500/10 border-red-500/30":b.time<=30?"bg-yellow-500/10 border-yellow-500/30":"bg-gray-800/50 border-gray-700"}`,children:[e.jsx("div",{className:"h-1.5 bg-gray-700 rounded-full overflow-hidden mb-3",children:e.jsx(J.div,{className:`h-full ${b.time<=10?"bg-red-500":b.time<=30?"bg-yellow-500":"bg-blue-500"}`,initial:{width:"0%"},animate:{width:`${b.progress}%`},transition:{duration:.3}})}),e.jsx("div",{className:"text-center mb-3",children:e.jsx("span",{className:`text-3xl font-mono font-bold ${b.time<=10?"text-red-400":b.time<=30?"text-yellow-400":"text-white"}`,children:b.formatted})}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:()=>b.adjust(-30),className:"px-3 py-1.5 rounded-lg bg-gray-700 hover:bg-gray-600 text-gray-300 text-sm font-medium",children:"-30s"}),e.jsx("button",{onClick:()=>b.adjust(30),className:"px-3 py-1.5 rounded-lg bg-blue-500/20 hover:bg-blue-500/30 text-blue-400 text-sm font-medium",children:"+30s"})]})]})})}),!b.isActive&&e.jsx("div",{className:"flex flex-wrap gap-2",children:b.presets.slice(0,4).map(S=>e.jsxs("button",{onClick:()=>b.start(S.seconds),className:"flex-1 min-w-[60px] py-2 px-3 rounded-lg bg-gray-800/50 hover:bg-gray-700/50 border border-gray-700 hover:border-gray-600 text-gray-300 text-sm font-medium flex items-center justify-center gap-1.5 transition-all",children:[e.jsx(Oe,{className:"w-3 h-3"}),S.label]},S.seconds))})]}),e.jsx(J.button,{whileTap:{scale:.98},onClick:he,disabled:!E||!g||o,className:`w-full py-4 rounded-xl font-bold text-lg transition-all flex items-center justify-center gap-2 ${E&&g&&!o?"bg-gradient-to-r from-green-600 to-green-500 hover:from-green-500 hover:to-green-400 text-white":"bg-gray-800 text-gray-500 cursor-not-allowed"}`,children:o?e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"w-5 h-5 animate-spin"}),"Logging Set..."]}):e.jsxs(e.Fragment,{children:[e.jsx(De,{className:"w-5 h-5"}),"Log Set ",te]})})]}):e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(Ue,{className:"w-5 h-5 text-yellow-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-yellow-200 font-medium",children:"No Active Session"}),e.jsx("p",{className:"text-xs text-yellow-400/80 mt-1",children:'Please start a new workout to log your sets. Use the "Generate Workout" button or go back and start fresh.'}),_&&e.jsx("button",{type:"button",onClick:Ce,disabled:ce,className:"mt-3 flex items-center justify-center gap-2 px-4 py-3 bg-green-600 hover:bg-green-700 active:bg-green-800 disabled:bg-green-800 disabled:opacity-70 text-white text-sm font-medium rounded-lg transition-colors min-h-[48px] min-w-[160px] touch-action-manipulation select-none cursor-pointer",style:{WebkitTapHighlightColor:"transparent"},children:ce?e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"w-4 h-4 animate-spin"}),"Starting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"w-4 h-4"}),"Start Session Now"]})})]})]})})}function ia({exerciseId:a,exerciseName:n,availableEquipment:i,onSelect:h,onCancel:v}){const[u,_]=t.useState([]),[C,M]=t.useState(!0),[b,E]=t.useState(null),[j,g]=t.useState(null),{findSubstitutes:k}=He();t.useEffect(()=>{(async()=>{M(!0),E(null);const N=await k(a,i,8);N&&N.length>0?_(N):E("No alternative exercises found for your equipment."),M(!1)})()},[a,i,k]);const T=t.useCallback(c=>{g(c.exercise.id),setTimeout(()=>{h(c.exercise)},200)},[h]),l=c=>c>=.8?"text-green-400":c>=.6?"text-yellow-400":"text-orange-400",m=c=>c>=.8?"Excellent match":c>=.6?"Good match":"Partial match";return e.jsx(J.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-end sm:items-center justify-center",onClick:v,children:e.jsxs(J.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},exit:{y:100,opacity:0},onClick:c=>c.stopPropagation(),className:"bg-gray-900 rounded-t-3xl sm:rounded-3xl w-full max-w-lg max-h-[85vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-gray-800 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold",children:"Swap Exercise"}),e.jsxs("p",{className:"text-sm text-gray-400",children:["Find alternatives for ",n]})]}),e.jsx("button",{onClick:v,className:"p-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-gray-400",children:e.jsx(ve,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:C?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(ke,{className:"w-8 h-8 text-blue-400 animate-spin mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Finding similar exercises..."})]}):b?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(Ue,{className:"w-8 h-8 text-orange-400 mb-4"}),e.jsx("p",{className:"text-gray-400 text-center",children:b}),e.jsx("button",{onClick:v,className:"mt-4 px-4 py-2 bg-gray-800 hover:bg-gray-700 rounded-lg text-sm",children:"Keep Current Exercise"})]}):e.jsx("div",{className:"space-y-3",children:u.map(c=>e.jsx(J.button,{whileTap:{scale:.98},onClick:()=>T(c),className:`w-full text-left p-4 rounded-xl border transition-all ${j===c.exercise.id?"bg-green-500/20 border-green-500/50":"bg-gray-800/50 border-gray-700 hover:border-gray-600"}`,children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(De,{className:"w-4 h-4 text-blue-400"}),e.jsx("span",{className:"font-medium",children:c.exercise.name})]}),c.exercise.equipment&&c.exercise.equipment.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:c.exercise.equipment.slice(0,3).map(N=>e.jsx("span",{className:"text-xs bg-gray-700/50 text-gray-300 px-2 py-0.5 rounded",children:N},N))}),c.matchedMuscles&&c.matchedMuscles.length>0&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-400 mb-1",children:[e.jsx(Be,{className:"w-3 h-3"}),e.jsxs("span",{children:["Targets: ",c.matchedMuscles.join(", ")]})]}),c.missingMuscles&&c.missingMuscles.length>0&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-orange-400",children:[e.jsx(Ue,{className:"w-3 h-3"}),e.jsxs("span",{children:["Missing: ",c.missingMuscles.join(", ")]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsxs("div",{className:`text-sm font-medium ${l(c.similarityScore)}`,children:[Math.round(c.similarityScore*100),"%"]}),e.jsx("div",{className:"text-xs text-gray-500",children:m(c.similarityScore)}),j===c.exercise.id?e.jsx(Ps,{className:"w-5 h-5 text-green-400 mt-2"}):e.jsx(As,{className:"w-5 h-5 text-gray-600 mt-2"})]})]})},c.exercise.id))})}),!C&&!b&&e.jsx("div",{className:"p-4 border-t border-gray-800",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(ts,{className:"w-3 h-3"}),e.jsx("span",{children:"Alternatives sorted by muscle similarity"})]})})]})})}function oa({sessions:a,onRecover:n,onDiscard:i,onDismiss:h}){const[v,u]=t.useState(null),[_,C]=t.useState(!1),[M,b]=t.useState(!1),{recoverSession:E}=He(),j=l=>{const m=new Date(l),N=new Date().getTime()-m.getTime(),$=Math.round(N/6e4),G=Math.round(N/36e5),y=Math.round(N/864e5);return $<60?`${$} min ago`:G<24?`${G} hours ago`:`${y} days ago`},g=l=>l>=1e3?`${(l/1e3).toFixed(1)}k lbs`:`${Math.round(l)} lbs`,k=async l=>{u(l),C(!0),(await E(l)).success?n(l):(C(!1),u(null))},T=async l=>{u(l),b(!0),i(l),b(!1),u(null)};return a.length===0?null:e.jsx(J.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs(J.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-gray-900 rounded-2xl w-full max-w-md overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-gray-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 rounded-xl bg-orange-500/20",children:e.jsx(Ue,{className:"w-6 h-6 text-orange-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold",children:"Unfinished Workout"}),e.jsx("p",{className:"text-sm text-gray-400",children:a.length===1?"You have an incomplete session":`You have ${a.length} incomplete sessions`})]})]})}),e.jsx("div",{className:"p-4 max-h-[400px] overflow-y-auto space-y-3",children:a.map(l=>e.jsxs("div",{className:"bg-gray-800/50 rounded-xl p-4 border border-gray-700",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400 mb-1",children:[e.jsx(ss,{className:"w-4 h-4"}),e.jsx("span",{children:j(l.archivedAt||l.startedAt)})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(De,{className:"w-4 h-4 text-blue-400"}),e.jsxs("span",{className:"font-medium",children:[l.musclesWorked?.length||0," muscles"]})]}),e.jsxs("span",{className:"text-gray-400",children:[l.setsLogged||0," sets"]}),e.jsx("span",{className:"text-purple-400",children:g(l.totalVolume||0)})]})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>k(l.id),disabled:_||M,className:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg bg-green-600 hover:bg-green-500 text-white font-medium transition-colors disabled:opacity-50",children:_&&v===l.id?e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"w-4 h-4 animate-spin"}),"Resuming..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ts,{className:"w-4 h-4"}),"Resume"]})}),e.jsx("button",{onClick:()=>T(l.id),disabled:_||M,className:"flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg bg-gray-700 hover:bg-gray-600 text-gray-300 font-medium transition-colors disabled:opacity-50",children:M&&v===l.id?e.jsx(ke,{className:"w-4 h-4 animate-spin"}):e.jsx($s,{className:"w-4 h-4"})})]})]},l.id))}),e.jsx("div",{className:"p-4 border-t border-gray-800",children:e.jsxs("button",{onClick:h,disabled:_||M,className:"w-full py-3 rounded-xl bg-gray-800 hover:bg-gray-700 text-gray-300 font-medium transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[e.jsx("span",{children:"Start Fresh Instead"}),e.jsx(As,{className:"w-4 h-4"})]})})]})})}Is`
  query GetRPETrends($exerciseId: ID!, $days: Int) {
    rpeTrends(exerciseId: $exerciseId, days: $days) {
      exerciseId
      exerciseName
      trends {
        date
        avgRpe
        avgRir
        setCount
        avgWeight
        maxWeight
        avgReps
      }
      summary {
        avgRpe
        totalSets
        daysWithData
        trend
      }
    }
  }
`;Is`
  query GetFatigue {
    rpeFatigue {
      fatigueScore
      classification
      indicators
      recommendation
      suggestedIntensity
      recentRpeTrend
    }
  }
`;const bs=[{weight:25,color:"#DC2626",width:42,available:4},{weight:20,color:"#2563EB",width:40,available:4},{weight:15,color:"#FBBF24",width:36,available:4},{weight:10,color:"#22C55E",width:32,available:4},{weight:5,color:"#F8F8F8",width:28,available:4},{weight:2.5,color:"#EF4444",width:18,available:4},{weight:2,color:"#3B82F6",width:16,available:4},{weight:1.25,color:"#FCD34D",width:14,available:4},{weight:1,color:"#4ADE80",width:12,available:4},{weight:.5,color:"#A3A3A3",width:10,available:4},{weight:.25,color:"#737373",width:8,available:4}],fs=[{weight:45,color:"#2563EB",width:42,available:4},{weight:35,color:"#FBBF24",width:38,available:4},{weight:25,color:"#22C55E",width:34,available:4},{weight:10,color:"#F8F8F8",width:28,available:4},{weight:5,color:"#EF4444",width:20,available:4},{weight:2.5,color:"#A3A3A3",width:14,available:4}],ca={metric:[{label:"Olympic Bar",weight:20},{label:"Women's Bar",weight:15},{label:"EZ Curl Bar",weight:10},{label:"Trap Bar",weight:25},{label:"Custom",weight:0}],imperial:[{label:"Olympic Bar",weight:45},{label:"Women's Bar",weight:35},{label:"EZ Curl Bar",weight:25},{label:"Trap Bar",weight:55},{label:"Custom",weight:0}]};function da({targetWeight:a,isMetric:n=!0,barWeight:i,onClose:h,compact:v=!1}){const[u,_]=t.useState(n?"metric":"imperial"),[C,M]=t.useState(i||(u==="metric"?20:45)),[b,E]=t.useState(""),[j,g]=t.useState(a?.toString()||""),[k,T]=t.useState(!1),[l,m]=t.useState(u==="metric"?bs:fs),c=t.useCallback((x,p,L)=>{const Y=(x-p)/2;if(Y<=0)return{plates:[],remaining:0,valid:x===p};const U=[];let O=Y;const Z={},Q=[...L].sort((q,H)=>H.weight-q.weight);for(const q of Q){const H=Math.floor(q.available/2),f=Math.floor(O/q.weight),o=Math.min(H,f);if(o>0){for(let P=0;P<o;P++)U.push({weight:q.weight,color:q.color,width:q.width});Z[q.weight]=o,O-=o*q.weight}}return O=Math.round(O*100)/100,{plates:U,remaining:O,valid:O===0}},[]),N=t.useMemo(()=>{const x=parseFloat(j);if(isNaN(x)||x<=0)return null;const p=b?parseFloat(b):C;return x<p?{plates:[],remaining:0,valid:!1,error:"Target is less than bar weight"}:c(x,p,l)},[j,C,b,l,c]),$=x=>{_(x),m(x==="metric"?bs:fs),M(x==="metric"?20:45),g("")},G=u==="metric"?[60,80,100,120,140,160]:[135,185,225,275,315,405],y=u==="metric"?"kg":"lbs",F=b?parseFloat(b):C;return e.jsxs("div",{className:`bg-gray-900 rounded-2xl border border-gray-800 overflow-hidden ${v?"":"max-w-md"}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-800",children:[e.jsx("h3",{className:"font-semibold text-white",children:"Plate Calculator"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>T(!k),className:`p-2 rounded-lg ${k?"bg-blue-500/20 text-blue-400":"hover:bg-gray-800 text-gray-400"}`,children:e.jsx(Ts,{className:"w-4 h-4"})}),h&&e.jsx("button",{onClick:h,className:"p-2 hover:bg-gray-800 rounded-lg text-gray-400",children:e.jsx(ve,{className:"w-4 h-4"})})]})]}),e.jsx(me,{children:k&&e.jsx(J.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden border-b border-gray-800",children:e.jsxs("div",{className:"p-4 space-y-4 bg-gray-900/50",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Unit System"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>$("metric"),className:`flex-1 py-2 rounded-lg text-sm font-medium ${u==="metric"?"bg-blue-600 text-white":"bg-gray-800 text-gray-400"}`,children:"Metric (kg)"}),e.jsx("button",{onClick:()=>$("imperial"),className:`flex-1 py-2 rounded-lg text-sm font-medium ${u==="imperial"?"bg-blue-600 text-white":"bg-gray-800 text-gray-400"}`,children:"Imperial (lbs)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Bar Weight"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ca[u].map(x=>e.jsxs("button",{onClick:()=>{M(x.weight),E("")},className:`px-3 py-1.5 rounded-lg text-sm ${C===x.weight&&!b?"bg-blue-600 text-white":"bg-gray-800 text-gray-400 hover:text-white"}`,children:[x.label," ",x.weight>0&&`(${x.weight})`]},x.label))}),C===0&&e.jsx("input",{type:"number",value:b,onChange:x=>E(x.target.value),placeholder:`Custom bar weight (${y})`,className:"mt-2 w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-sm"})]})]})})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 mb-1",children:["Target Weight (",y,")"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",value:j,onChange:x=>g(x.target.value),placeholder:"Enter target weight",className:"flex-1 px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-lg font-medium"}),e.jsx("button",{onClick:()=>g(""),className:"p-2 bg-gray-800 hover:bg-gray-700 rounded-lg text-gray-400",children:e.jsx(Xe,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:G.map(x=>e.jsx("button",{onClick:()=>g(x.toString()),className:`px-3 py-1.5 rounded-lg text-sm font-medium ${j===x.toString()?"bg-blue-500/20 text-blue-400 border border-blue-500/50":"bg-gray-800 text-gray-400 hover:text-white"}`,children:x},x))}),N&&e.jsx("div",{className:"mt-4",children:!N.valid&&N.error?e.jsx("div",{className:"p-3 bg-red-500/10 border border-red-500/30 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-400",children:N.error})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative flex items-center justify-center py-6 bg-gray-800/50 rounded-xl overflow-hidden",children:[e.jsx("div",{className:"flex items-center",children:[...N.plates].reverse().map((x,p)=>e.jsx(J.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:p*.05},className:"relative flex items-center justify-center rounded",style:{backgroundColor:x.color,width:x.width,height:60+x.width,marginRight:-2,zIndex:N.plates.length-p},children:e.jsx("span",{className:"absolute text-xs font-bold",style:{color:x.color==="#F8F8F8"||x.color==="#FCD34D"||x.color==="#FBBF24"?"#333":"#fff",writingMode:"vertical-rl",transform:"rotate(180deg)"},children:x.weight})},`left-${p}`))}),e.jsxs("div",{className:"w-24 h-4 bg-gray-500 rounded-full relative z-50",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 w-4 bg-gray-600 rounded-l-full"}),e.jsx("div",{className:"absolute inset-y-0 right-0 w-4 bg-gray-600 rounded-r-full"})]}),e.jsx("div",{className:"flex items-center",children:N.plates.map((x,p)=>e.jsx(J.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:p*.05},className:"relative flex items-center justify-center rounded",style:{backgroundColor:x.color,width:x.width,height:60+x.width,marginLeft:-2,zIndex:N.plates.length-p},children:e.jsx("span",{className:"absolute text-xs font-bold",style:{color:x.color==="#F8F8F8"||x.color==="#FCD34D"||x.color==="#FBBF24"?"#333":"#fff",writingMode:"vertical-rl"},children:x.weight})},`right-${p}`))})]}),e.jsxs("div",{className:"mt-4 p-3 bg-gray-800/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Per side:"}),e.jsxs("span",{className:"text-sm font-medium",children:[((parseFloat(j)-F)/2).toFixed(1)," ",y]})]}),N.plates.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(N.plates.reduce((x,p)=>(x[p.weight]=(x[p.weight]||0)+1,x),{})).sort(([x],[p])=>parseFloat(p)-parseFloat(x)).map(([x,p])=>e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-gray-900 rounded-lg",children:[e.jsx("div",{className:"w-3 h-3 rounded",style:{backgroundColor:N.plates.find(L=>L.weight===parseFloat(x))?.color}}),e.jsxs("span",{className:"text-sm font-medium",children:[p,"Ã—",x]})]},x))}):e.jsx("p",{className:"text-sm text-gray-500",children:"Just the bar"}),!N.valid&&N.remaining>0&&e.jsxs("div",{className:"flex items-start gap-2 mt-3 p-2 bg-yellow-500/10 border border-yellow-500/30 rounded-lg",children:[e.jsx(as,{className:"w-4 h-4 text-yellow-400 flex-shrink-0 mt-0.5"}),e.jsxs("p",{className:"text-xs text-yellow-400",children:["Cannot make exact weight. Missing ",N.remaining.toFixed(2)," ",y," per side. Showing closest possible (",(parseFloat(j)-N.remaining*2).toFixed(1)," ",y," total)."]})]})]}),e.jsx("div",{className:"mt-3 text-center",children:e.jsxs("p",{className:"text-xs text-gray-500",children:["Bar: ",F,y," + Plates: ",(parseFloat(j)-F).toFixed(1),y,"= ",e.jsxs("span",{className:"font-bold text-white",children:[j,y]})]})})]})}),!j&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:e.jsx("p",{className:"text-sm",children:"Enter a target weight to see which plates to load"})})]})]})}const ys={compound:{label:"Compound (5 sets)",sets:[{percent:0,reps:10,label:"Bar"},{percent:40,reps:8,label:"40%"},{percent:60,reps:5,label:"60%"},{percent:75,reps:3,label:"75%"},{percent:90,reps:1,label:"90%"}]},moderate:{label:"Moderate (3 sets)",sets:[{percent:50,reps:8,label:"50%"},{percent:70,reps:5,label:"70%"},{percent:85,reps:3,label:"85%"}]},quick:{label:"Quick (2 sets)",sets:[{percent:50,reps:8,label:"50%"},{percent:75,reps:5,label:"75%"}]},accessory:{label:"Accessory (1 set)",sets:[{percent:50,reps:10,label:"50%"}]}};function ua({workingWeight:a,barWeight:n=45,isMetric:i=!1,onCopySet:h,onClose:v,compact:u=!1}){const[_,C]=t.useState(a?.toString()||""),[M,b]=t.useState(n.toString()),[E,j]=t.useState("compound"),[g,k]=t.useState(!1),[T,l]=t.useState(null),m=i?"kg":"lbs",c=parseFloat(M)||n,N=t.useMemo(()=>{const y=parseFloat(_);return!y||y<=c?[]:ys[E].sets.map(x=>{let p;return x.percent===0?p=c:(p=Math.round(y*(x.percent/100)/5)*5,p=Math.max(p,c)),{...x,weight:p,plates:$(p,c,i)}})},[_,E,c,i]);function $(y,F,x){const p=(y-F)/2;if(p<=0)return"Just bar";const L=x?[25,20,15,10,5,2.5,1.25]:[45,35,25,10,5,2.5],Y=[];let U=p;for(const O of L){const Z=Math.floor(U/O);Z>0&&(Y.push(`${Z}Ã—${O}`),U-=Z*O)}return Y.length>0?Y.join(" + "):"Just bar"}const G=(y,F,x)=>{h?.(y,F),l(x),setTimeout(()=>l(null),1500)};return e.jsxs("div",{className:`bg-gray-900 rounded-2xl border border-gray-800 overflow-hidden ${u?"":"max-w-md"}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Es,{className:"w-5 h-5 text-orange-400"}),e.jsx("h3",{className:"font-semibold text-white",children:"Warmup Calculator"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>k(!g),className:`p-2 rounded-lg ${g?"bg-blue-500/20 text-blue-400":"hover:bg-gray-800 text-gray-400"}`,children:e.jsx(Ts,{className:"w-4 h-4"})}),v&&e.jsx("button",{onClick:v,className:"p-2 hover:bg-gray-800 rounded-lg text-gray-400",children:e.jsx(ve,{className:"w-4 h-4"})})]})]}),e.jsx(me,{children:g&&e.jsx(J.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden border-b border-gray-800",children:e.jsxs("div",{className:"p-4 space-y-4 bg-gray-900/50",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 mb-1",children:["Bar Weight (",m,")"]}),e.jsx("div",{className:"flex gap-2",children:(i?[20,15,10]:[45,35,25]).map(y=>e.jsx("button",{onClick:()=>b(y.toString()),className:`flex-1 py-2 rounded-lg text-sm font-medium ${parseFloat(M)===y?"bg-blue-600 text-white":"bg-gray-800 text-gray-400 hover:text-white"}`,children:y},y))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Warmup Preset"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(ys).map(([y,F])=>e.jsx("button",{onClick:()=>j(y),className:`px-3 py-1.5 rounded-lg text-sm ${E===y?"bg-blue-600 text-white":"bg-gray-800 text-gray-400 hover:text-white"}`,children:F.label},y))})]})]})})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 mb-1",children:["Working Weight (",m,")"]}),e.jsx("input",{type:"number",value:_,onChange:y=>C(y.target.value),placeholder:"Enter your working weight",className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-lg font-medium"})]}),N.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Suggested Warmup Sets"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[N.length," sets"]})]}),e.jsx("div",{className:"space-y-2",children:N.map((y,F)=>e.jsxs(J.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:F*.05},className:"flex items-center gap-3 p-3 bg-gray-800/50 rounded-lg",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-orange-500/20 flex items-center justify-center text-orange-400 font-bold text-sm",children:F+1}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsxs("span",{className:"font-bold text-white",children:[y.weight," ",m]}),e.jsx("span",{className:"text-gray-400",children:"Ã—"}),e.jsxs("span",{className:"font-medium text-gray-300",children:[y.reps," reps"]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",y.label,")"]})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:y.plates})]}),h&&e.jsx("button",{onClick:()=>G(y.weight,y.reps,F),className:`p-2 rounded-lg transition-colors ${T===F?"bg-green-500/20 text-green-400":"hover:bg-gray-700 text-gray-400"}`,children:T===F?e.jsx(Ps,{className:"w-4 h-4"}):e.jsx(kt,{className:"w-4 h-4"})})]},F))})]}):_?e.jsxs("div",{className:"text-center py-6 text-gray-500 text-sm",children:["Working weight must be greater than bar weight (",c," ",m,")"]}):e.jsx("div",{className:"text-center py-6 text-gray-500 text-sm",children:"Enter your working weight to calculate warmup sets"}),e.jsxs("div",{className:"p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg text-xs text-blue-300",children:[e.jsx("strong",{children:"Tip:"})," Warmup sets prepare your muscles and joints, and help you practice form. Rest 30-60 seconds between warmup sets."]})]})]})}function Qe(a){const n=Math.floor(a/1e3),i=Math.floor(n/3600),h=Math.floor(n%3600/60),v=n%60,u=Math.floor(a%1e3/10);return i>0?`${i}:${h.toString().padStart(2,"0")}:${v.toString().padStart(2,"0")}`:`${h.toString().padStart(2,"0")}:${v.toString().padStart(2,"0")}.${u.toString().padStart(2,"0")}`}function vs(a){const n=Math.floor(a/1e3),i=Math.floor(n/60),h=n%60,v=Math.floor(a%1e3/10);return`${i}:${h.toString().padStart(2,"0")}.${v.toString().padStart(2,"0")}`}const xa=[{label:"30s",value:30},{label:"45s",value:45},{label:"1m",value:60},{label:"90s",value:90},{label:"2m",value:120},{label:"3m",value:180},{label:"5m",value:300}];function ma({onTimeRecorded:a,onClose:n,compact:i=!1,initialMode:h="stopwatch",initialCountdown:v=60}){const[u,_]=t.useState(h),[C,M]=t.useState(!1),[b,E]=t.useState(0),[j,g]=t.useState(v),[k,T]=t.useState(""),[l,m]=t.useState([]),[c,N]=t.useState(!0),[$,G]=t.useState(!1),y=t.useRef(null),F=t.useRef(0),x=t.useRef(0),p=t.useRef(null),L=t.useCallback((f=800,o=100)=>{if(c)try{p.current||(p.current=new(window.AudioContext||window.webkitAudioContext));const P=p.current,V=P.createOscillator(),te=P.createGain();V.connect(te),te.connect(P.destination),V.frequency.value=f,V.type="sine",te.gain.setValueAtTime(.3,P.currentTime),te.gain.exponentialRampToValueAtTime(.01,P.currentTime+o/1e3),V.start(P.currentTime),V.stop(P.currentTime+o/1e3)}catch{}},[c]),Y=t.useCallback(()=>{C?(y.current&&(clearInterval(y.current),y.current=null),M(!1)):(F.current=Date.now()-b,y.current=setInterval(()=>{const f=Date.now()-F.current;if(E(f),u==="countdown"){const o=j*1e3-f;o<=0?(clearInterval(y.current),y.current=null,M(!1),E(j*1e3),L(1e3,500),be("heavy"),a?.(j*1e3)):o<=3e3&&o>2900?(L(600,100),be("light")):o<=2e3&&o>1900?(L(600,100),be("light")):o<=1e3&&o>900&&(L(600,100),be("light"))}},10),M(!0),be("light"))},[C,b,u,j,L,a]),U=t.useCallback(()=>{y.current&&(clearInterval(y.current),y.current=null),M(!1),E(0),m([]),x.current=0,be("light")},[]),O=t.useCallback(()=>{const f=b-x.current,o=l.length>0?f-l[l.length-1].time:0;m(P=>[...P,{number:P.length+1,time:f,delta:o}]),x.current=b,be("medium"),L(600,50)},[b,l,L]),Z=t.useCallback(()=>{y.current&&(clearInterval(y.current),y.current=null),M(!1),a?.(b),be("medium")},[b,a]);t.useEffect(()=>()=>{y.current&&clearInterval(y.current)},[]);const Q=u==="countdown"?Math.max(0,j*1e3-b):b,q=u==="countdown"&&b>=j*1e3,H=u==="countdown"?b/(j*1e3)*100:0;return i?e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-800/50 rounded-lg",children:[e.jsx("button",{onClick:Y,className:`p-2 rounded-lg ${C?"bg-red-500/20 text-red-400":"bg-green-500/20 text-green-400"}`,children:C?e.jsx(us,{className:"w-5 h-5"}):e.jsx(Oe,{className:"w-5 h-5"})}),e.jsx("span",{className:"font-mono text-xl font-bold flex-1",children:Qe(Q)}),e.jsx("button",{onClick:U,className:"p-2 rounded-lg hover:bg-gray-700 text-gray-400",children:e.jsx(Xe,{className:"w-5 h-5"})})]}):e.jsxs("div",{className:"bg-gray-900 rounded-2xl border border-gray-800 overflow-hidden max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[u==="stopwatch"?e.jsx(ss,{className:"w-5 h-5 text-blue-400"}):e.jsx(_s,{className:"w-5 h-5 text-orange-400"}),e.jsx("h3",{className:"font-semibold text-white",children:u==="stopwatch"?"Stopwatch":"Countdown Timer"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>N(!c),className:`p-2 rounded-lg ${c?"text-blue-400":"text-gray-600"}`,children:c?e.jsx(Ct,{className:"w-4 h-4"}):e.jsx(Mt,{className:"w-4 h-4"})}),n&&e.jsx("button",{onClick:n,className:"p-2 hover:bg-gray-800 rounded-lg text-gray-400",children:e.jsx(ve,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex gap-2 p-4 border-b border-gray-800",children:[e.jsx("button",{onClick:()=>{_("stopwatch"),U()},className:`flex-1 py-2 rounded-lg text-sm font-medium ${u==="stopwatch"?"bg-blue-600 text-white":"bg-gray-800 text-gray-400"}`,children:"Stopwatch"}),e.jsx("button",{onClick:()=>{_("countdown"),U()},className:`flex-1 py-2 rounded-lg text-sm font-medium ${u==="countdown"?"bg-orange-600 text-white":"bg-gray-800 text-gray-400"}`,children:"Countdown"})]}),e.jsxs("div",{className:"p-6",children:[u==="countdown"&&e.jsxs("div",{className:"relative w-48 h-48 mx-auto mb-6",children:[e.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[e.jsx("circle",{cx:"96",cy:"96",r:"88",fill:"none",stroke:"#374151",strokeWidth:"8"}),e.jsx("circle",{cx:"96",cy:"96",r:"88",fill:"none",stroke:q||H>90?"#EF4444":H>75?"#F59E0B":"#3B82F6",strokeWidth:"8",strokeLinecap:"round",strokeDasharray:`${2*Math.PI*88}`,strokeDashoffset:`${2*Math.PI*88*(1-H/100)}`,className:"transition-all duration-100"})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("span",{className:`font-mono text-4xl font-bold ${q||Q<=1e4?"text-red-400":Q<=3e4?"text-yellow-400":"text-white"}`,children:Qe(Q)}),q&&e.jsx("span",{className:"text-red-400 text-sm mt-1",children:"Time's Up!"})]})]}),u==="stopwatch"&&e.jsx("div",{className:"text-center mb-6",children:e.jsx("span",{className:"font-mono text-5xl font-bold text-white",children:Qe(Q)})}),u==="countdown"&&!C&&e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"flex flex-wrap justify-center gap-2 mb-3",children:xa.map(f=>e.jsx("button",{onClick:()=>{g(f.value),U()},className:`px-3 py-1.5 rounded-lg text-sm font-medium ${j===f.value?"bg-orange-600 text-white":"bg-gray-800 text-gray-400 hover:text-white"}`,children:f.label},f.value))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",value:k,onChange:f=>T(f.target.value),placeholder:"Custom (seconds)",className:"flex-1 px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-sm"}),e.jsx("button",{onClick:()=>{const f=parseInt(k);f>0&&(g(f),U())},className:"px-4 py-2 bg-gray-800 hover:bg-gray-700 rounded-lg text-sm",disabled:!k||parseInt(k)<=0,children:"Set"})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx("button",{onClick:U,className:"p-3 bg-gray-800 hover:bg-gray-700 rounded-full text-gray-400",children:e.jsx(Xe,{className:"w-6 h-6"})}),e.jsx("button",{onClick:Y,disabled:q,className:`p-4 rounded-full text-white ${C?"bg-red-600 hover:bg-red-700":q?"bg-gray-700 cursor-not-allowed":"bg-green-600 hover:bg-green-700"}`,children:C?e.jsx(us,{className:"w-8 h-8"}):e.jsx(Oe,{className:"w-8 h-8 ml-1"})}),u==="stopwatch"&&C&&e.jsx("button",{onClick:O,className:"p-3 bg-blue-600 hover:bg-blue-700 rounded-full text-white",children:e.jsx(xs,{className:"w-6 h-6"})}),!C&&b>0&&a&&e.jsx("button",{onClick:Z,className:"p-3 bg-green-600 hover:bg-green-700 rounded-full text-white",children:e.jsx(xs,{className:"w-6 h-6"})})]}),u==="stopwatch"&&l.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("button",{onClick:()=>G(!$),className:"flex items-center justify-between w-full p-3 bg-gray-800/50 rounded-lg text-sm",children:[e.jsxs("span",{className:"text-gray-400",children:["Laps (",l.length,")"]}),e.jsx(qe,{className:`w-4 h-4 text-gray-500 transition-transform ${$?"rotate-180":""}`})]}),e.jsx(me,{children:$&&e.jsx(J.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsx("div",{className:"mt-2 space-y-1 max-h-40 overflow-y-auto",children:[...l].reverse().map(f=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-800/30 rounded text-sm",children:[e.jsxs("span",{className:"text-gray-500",children:["Lap ",f.number]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-mono",children:vs(f.time)}),f.delta!==0&&e.jsxs("span",{className:f.delta>0?"text-red-400":"text-green-400",children:[f.delta>0?"+":"",vs(Math.abs(f.delta))]})]})]},f.number))})})})]})]})]})}const js=[{value:"1M",label:"1 Month",days:30},{value:"3M",label:"3 Months",days:90},{value:"6M",label:"6 Months",days:180},{value:"1Y",label:"1 Year",days:365},{value:"ALL",label:"All Time",days:1/0}],Le=[{value:"weight",label:"Max Weight",unit:"kg",description:"Heaviest weight lifted per session"},{value:"volume",label:"Total Volume",unit:"kg",description:"Weight Ã— Reps summed across all sets"},{value:"e1rm",label:"Est. 1RM",unit:"kg",description:"Estimated one-rep max (Epley formula)"},{value:"reps",label:"Total Reps",unit:"",description:"Total repetitions per session"}];function ha(a,n){return n===1?a:(n>12,a*(1+n/30))}function Fe(a,n=!1){const i=new Date(a);return n?i.toLocaleDateString("en-US",{month:"short",day:"numeric"}):i.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function ws(a,n){if(n===0)return{value:0,direction:"same"};const i=(a-n)/n*100;return Math.abs(i)<.5?{value:0,direction:"same"}:{value:Math.abs(i),direction:i>0?"up":"down"}}function Ns({data:a,metric:n,height:i=200}){const h=Le.find(g=>g.value===n);if(a.length===0)return e.jsx("div",{className:"flex items-center justify-center h-48 text-white/40",children:"No data available for this period"});const v=a.map(g=>g.value),u=Math.min(...v)*.9,_=Math.max(...v)*1.1,C=_-u||1,M=a.map((g,k)=>({x:k/(a.length-1||1)*100,y:100-(g.value-u)/C*100})),b=M.length>1?`M ${M.map(g=>`${g.x},${g.y}`).join(" L ")}`:"",E=M.length>1?`M ${M[0].x},100 L ${M.map(g=>`${g.x},${g.y}`).join(" L ")} L ${M[M.length-1].x},100 Z`:"",j=[u,(u+_)/2,_].map(g=>g>=1e3?`${(g/1e3).toFixed(1)}k`:g.toFixed(0));return e.jsxs("div",{className:"relative",style:{height:i},children:[e.jsxs("div",{className:"absolute left-0 top-0 bottom-8 w-12 flex flex-col justify-between text-xs text-white/40 pr-2",children:[e.jsxs("span",{className:"text-right",children:[j[2],h?.unit]}),e.jsxs("span",{className:"text-right",children:[j[1],h?.unit]}),e.jsxs("span",{className:"text-right",children:[j[0],h?.unit]})]}),e.jsxs("div",{className:"ml-12 h-full pr-2",children:[e.jsxs("svg",{viewBox:"0 0 100 100",preserveAspectRatio:"none",className:"w-full h-[calc(100%-2rem)]",children:[e.jsx("line",{x1:"0",y1:"0",x2:"100",y2:"0",stroke:"white",strokeOpacity:"0.1",strokeWidth:"0.5",vectorEffect:"non-scaling-stroke"}),e.jsx("line",{x1:"0",y1:"50",x2:"100",y2:"50",stroke:"white",strokeOpacity:"0.1",strokeWidth:"0.5",vectorEffect:"non-scaling-stroke"}),e.jsx("line",{x1:"0",y1:"100",x2:"100",y2:"100",stroke:"white",strokeOpacity:"0.1",strokeWidth:"0.5",vectorEffect:"non-scaling-stroke"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:`gradient-${n}`,x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"#8B5CF6",stopOpacity:"0.3"}),e.jsx("stop",{offset:"100%",stopColor:"#8B5CF6",stopOpacity:"0"})]})}),E&&e.jsx("path",{d:E,fill:`url(#gradient-${n})`}),b&&e.jsx("path",{d:b,fill:"none",stroke:"#8B5CF6",strokeWidth:"2",vectorEffect:"non-scaling-stroke",strokeLinecap:"round",strokeLinejoin:"round"}),M.map((g,k)=>e.jsx("circle",{cx:g.x,cy:g.y,r:"3",fill:"#8B5CF6",stroke:"white",strokeWidth:"1",vectorEffect:"non-scaling-stroke",className:"cursor-pointer hover:r-4 transition-all",children:e.jsx("title",{children:`${Fe(a[k].date)}: ${a[k].value.toFixed(1)}${h?.unit}`})},k))]}),e.jsx("div",{className:"flex justify-between text-xs text-white/40 mt-1",children:a.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:Fe(a[0].date,!0)}),a.length>2&&e.jsx("span",{children:Fe(a[Math.floor(a.length/2)].date,!0)}),e.jsx("span",{children:Fe(a[a.length-1].date,!0)})]})})]})]})}function We({label:a,value:n,unit:i,change:h,icon:v}){return e.jsxs("div",{className:"bg-white/5 rounded-xl p-4 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[v&&e.jsx(v,{className:"w-4 h-4 text-violet-400"}),e.jsx("span",{className:"text-xs text-white/60",children:a})]}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-2xl font-bold text-white",children:n}),i&&e.jsx("span",{className:"text-sm text-white/40",children:i})]}),h&&h.direction!=="same"&&e.jsxs("div",{className:`flex items-center gap-1 mt-1 text-xs ${h.direction==="up"?"text-green-400":"text-red-400"}`,children:[h.direction==="up"?e.jsx(es,{className:"w-3 h-3"}):e.jsx(Fs,{className:"w-3 h-3"}),e.jsxs("span",{children:[h.value.toFixed(1),"%"]})]})]})}function ga({exerciseId:a,exerciseName:n,history:i,onClose:h,compact:v=!1}){const[u,_]=t.useState("3M"),[C,M]=t.useState("weight"),[b,E]=t.useState(!1),j=t.useMemo(()=>{const l=js.find(c=>c.value===u);if(!l||l.days===1/0)return i;const m=new Date;return m.setDate(m.getDate()-l.days),i.filter(c=>new Date(c.date)>=m)},[i,u]),g=t.useMemo(()=>j.map(l=>{const m=l.sets;let c;switch(C){case"weight":c=Math.max(...m.map(N=>N.weight));break;case"volume":c=m.reduce((N,$)=>N+$.weight*$.reps,0);break;case"e1rm":c=Math.max(...m.map(N=>ha(N.weight,N.reps)));break;case"reps":c=m.reduce((N,$)=>N+$.reps,0);break;default:c=0}return{date:l.date,value:c,entry:l}}).sort((l,m)=>new Date(l.date).getTime()-new Date(m.date).getTime()),[j,C]),k=t.useMemo(()=>{if(g.length===0)return null;const l=g.map(y=>y.value),m=l[l.length-1],c=l.length>1?l[l.length-2]:m,N=l[0],$=Math.max(...l),G=l.reduce((y,F)=>y+F,0)/l.length;return{current:m,max:$,avg:G,totalWorkouts:g.length,periodChange:ws(m,N),lastChange:ws(m,c)}},[g]),T=Le.find(l=>l.value===C);return v?e.jsxs("div",{className:"bg-black/40 backdrop-blur-xl rounded-2xl border border-white/10 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:n}),h&&e.jsx("button",{onClick:h,className:"p-1 rounded-lg hover:bg-white/10 transition-colors",children:e.jsx(ve,{className:"w-5 h-5 text-white/60"})})]}),e.jsx("div",{className:"flex gap-2 mb-4 overflow-x-auto pb-1",children:Le.map(l=>e.jsx("button",{onClick:()=>M(l.value),className:`px-3 py-1.5 rounded-lg text-xs font-medium whitespace-nowrap transition-colors ${C===l.value?"bg-violet-500 text-white":"bg-white/5 text-white/60 hover:bg-white/10"}`,children:l.label},l.value))}),e.jsx(Ns,{data:g,metric:C,height:160}),k&&e.jsxs("div",{className:"mt-4 flex items-center justify-between text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-white/60",children:"Current:"})," ",e.jsxs("span",{className:"text-white font-semibold",children:[k.current.toFixed(1),T?.unit]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white/60",children:"Peak:"})," ",e.jsxs("span",{className:"text-white font-semibold",children:[k.max.toFixed(1),T?.unit]})]})]})]}):e.jsxs("div",{className:"bg-black/40 backdrop-blur-xl rounded-2xl border border-white/10 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-violet-500/20 flex items-center justify-center",children:e.jsx(Pe,{className:"w-5 h-5 text-violet-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:n}),e.jsx("p",{className:"text-sm text-white/60",children:"Progress over time"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>E(!b),className:"p-2 rounded-lg hover:bg-white/10 transition-colors",children:e.jsx(as,{className:"w-5 h-5 text-white/60"})}),h&&e.jsx("button",{onClick:h,className:"p-2 rounded-lg hover:bg-white/10 transition-colors",children:e.jsx(ve,{className:"w-5 h-5 text-white/60"})})]})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-1",children:js.map(l=>e.jsx("button",{onClick:()=>_(l.value),className:`px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition-colors ${u===l.value?"bg-violet-500 text-white":"bg-white/5 text-white/60 hover:bg-white/10"}`,children:l.label},l.value))})]}),e.jsx(me,{children:b&&e.jsx(J.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"border-b border-white/10 overflow-hidden",children:e.jsx("div",{className:"p-4 bg-violet-500/10",children:e.jsxs("p",{className:"text-sm text-white/80",children:[e.jsx("strong",{children:"Estimated 1RM"})," uses the Epley formula: Weight Ã— (1 + Reps/30). Most accurate for 1-10 reps."]})})})}),e.jsxs("div",{className:"p-4 border-b border-white/10",children:[e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-1",children:Le.map(l=>e.jsxs("button",{onClick:()=>M(l.value),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition-colors ${C===l.value?"bg-white/10 text-white border border-violet-500/50":"bg-white/5 text-white/60 hover:bg-white/10 border border-transparent"}`,children:[l.value==="weight"&&e.jsx(ns,{className:"w-4 h-4"}),l.value==="volume"&&e.jsx(Pe,{className:"w-4 h-4"}),l.value==="e1rm"&&e.jsx(Be,{className:"w-4 h-4"}),l.value==="reps"&&e.jsx(Ft,{className:"w-4 h-4"}),l.label]},l.value))}),e.jsx("p",{className:"text-xs text-white/40 mt-2",children:T?.description})]}),e.jsx("div",{className:"p-6",children:e.jsx(Ns,{data:g,metric:C,height:240})}),k&&e.jsxs("div",{className:"p-6 border-t border-white/10",children:[e.jsx("h3",{className:"text-sm font-medium text-white/60 mb-4",children:"Summary"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(We,{label:"Current",value:k.current.toFixed(1),unit:T?.unit,change:k.lastChange,icon:ns}),e.jsx(We,{label:"Peak",value:k.max.toFixed(1),unit:T?.unit,icon:Be}),e.jsx(We,{label:"Average",value:k.avg.toFixed(1),unit:T?.unit,icon:Pe}),e.jsx(We,{label:"Workouts",value:k.totalWorkouts,icon:pt})]}),k.periodChange.direction!=="same"&&e.jsx("div",{className:`mt-4 p-4 rounded-xl ${k.periodChange.direction==="up"?"bg-green-500/10":"bg-red-500/10"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[k.periodChange.direction==="up"?e.jsx(es,{className:"w-5 h-5 text-green-400"}):e.jsx(Fs,{className:"w-5 h-5 text-red-400"}),e.jsxs("span",{className:`text-sm font-medium ${k.periodChange.direction==="up"?"text-green-400":"text-red-400"}`,children:[k.periodChange.direction==="up"?"+":"-",k.periodChange.value.toFixed(1),"% over this period"]})]})})]}),g.length===0&&e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(Pe,{className:"w-12 h-12 text-white/20 mx-auto mb-4"}),e.jsx("p",{className:"text-white/60",children:"No workout data for this period"}),e.jsx("p",{className:"text-sm text-white/40 mt-1",children:"Complete some workouts to see your progress"})]})]})}const pa=[{value:"great",label:"Great",icon:ms,color:"text-green-400"},{value:"good",label:"Good",icon:ms,color:"text-blue-400"},{value:"okay",label:"Okay",icon:Dt,color:"text-yellow-400"},{value:"bad",label:"Bad",icon:Lt,color:"text-red-400"}],ba=[{value:"high",label:"High Energy",icon:Ms,color:"text-yellow-400"},{value:"medium",label:"Normal",icon:At,color:"text-blue-400"},{value:"low",label:"Low Energy",icon:_t,color:"text-red-400"}],fa=[{value:"good",label:"Good Sleep",icon:ze,color:"text-violet-400"},{value:"average",label:"Average",icon:ze,color:"text-blue-400"},{value:"poor",label:"Poor Sleep",icon:ze,color:"text-orange-400"}],ya=["PR Day","Deload","Testing","Recovery","First Day Back","Travel","Morning","Evening","Fasted","Post-Meal","Pre-Workout","No Caffeine","New Exercise","Form Focus","High Volume","Low Volume"];function va({workoutId:a,initialNotes:n,onSave:i,onDelete:h,compact:v=!1,autoSave:u=!0,className:_=""}){const[C,M]=t.useState(!v),[b,E]=t.useState(!n),[j,g]=t.useState(n?.content||""),[k,T]=t.useState(n?.mood),[l,m]=t.useState(n?.energy),[c,N]=t.useState(n?.sleepQuality),[$,G]=t.useState(n?.tags||[]),[y,F]=t.useState(!1),[x,p]=t.useState(""),[L,Y]=t.useState(!1),U=t.useRef(null),O=t.useRef();t.useEffect(()=>{const o=j!==(n?.content||"")||k!==n?.mood||l!==n?.energy||c!==n?.sleepQuality||JSON.stringify($)!==JSON.stringify(n?.tags||[]);Y(o)},[j,k,l,c,$,n]);const Z=t.useCallback(()=>{U.current&&(U.current.style.height="auto",U.current.style.height=`${U.current.scrollHeight}px`)},[]);t.useEffect(()=>{Z()},[j,Z]);const Q=t.useCallback(()=>{const o={id:n?.id||`note-${Date.now()}`,content:j,mood:k,energy:l,sleepQuality:c,tags:$,createdAt:n?.createdAt||new Date().toISOString(),updatedAt:new Date().toISOString()};i?.(o),Y(!1),v||E(!1)},[j,k,l,c,$,n,i,v]);t.useEffect(()=>(u&&L&&(O.current&&clearTimeout(O.current),O.current=setTimeout(()=>{Q()},2e3)),()=>{O.current&&clearTimeout(O.current)}),[u,L,Q]);const q=t.useCallback(()=>{window.confirm("Delete this note?")&&(h?.(),g(""),T(void 0),m(void 0),N(void 0),G([]),E(!0))},[h]),H=t.useCallback(o=>{G(P=>P.includes(o)?P.filter(V=>V!==o):[...P,o])},[]),f=t.useCallback(()=>{x.trim()&&!$.includes(x.trim())&&(G(o=>[...o,x.trim()]),p(""))},[x,$]);return v&&!C?e.jsxs("button",{onClick:()=>M(!0),className:`flex items-center gap-2 px-3 py-2 rounded-lg bg-white/5 hover:bg-white/10 transition-colors ${_}`,children:[e.jsx(hs,{className:"w-4 h-4 text-yellow-400"}),e.jsx("span",{className:"text-sm text-white/60",children:n?.content?"View Notes":"Add Notes"}),n&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-yellow-400"}),e.jsx(qe,{className:"w-4 h-4 text-white/40"})]}):e.jsxs(J.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`bg-black/40 backdrop-blur-xl rounded-2xl border border-white/10 overflow-hidden ${_}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-yellow-500/20 flex items-center justify-center",children:e.jsx(hs,{className:"w-5 h-5 text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Workout Notes"}),n?.updatedAt&&e.jsxs("p",{className:"text-xs text-white/40 flex items-center gap-1",children:[e.jsx(ss,{className:"w-3 h-3"}),"Last updated ",new Date(n.updatedAt).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[L&&u&&e.jsx("span",{className:"text-xs text-yellow-400",children:"Saving..."}),!b&&n&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>E(!0),className:"p-2 rounded-lg hover:bg-white/10 transition-colors",children:e.jsx(Et,{className:"w-4 h-4 text-white/60"})}),e.jsx("button",{onClick:q,className:"p-2 rounded-lg hover:bg-red-500/20 transition-colors",children:e.jsx($s,{className:"w-4 h-4 text-red-400"})})]}),v&&e.jsx("button",{onClick:()=>M(!1),className:"p-2 rounded-lg hover:bg-white/10 transition-colors",children:e.jsx(Tt,{className:"w-4 h-4 text-white/60"})})]})]}),e.jsxs("div",{className:"p-4 border-b border-white/10 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-white/60 mb-2 block",children:"How did you feel?"}),e.jsx("div",{className:"flex gap-2",children:pa.map(o=>{const P=o.icon;return e.jsxs("button",{onClick:()=>T(k===o.value?void 0:o.value),className:`flex items-center gap-2 px-3 py-2 rounded-lg text-sm transition-colors ${k===o.value?"bg-white/10 border border-white/20":"bg-white/5 border border-transparent hover:bg-white/10"}`,children:[e.jsx(P,{className:`w-4 h-4 ${k===o.value?o.color:"text-white/40"}`}),e.jsx("span",{className:k===o.value?"text-white":"text-white/60",children:o.label})]},o.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-white/60 mb-2 block",children:"Energy level"}),e.jsx("div",{className:"flex gap-2",children:ba.map(o=>{const P=o.icon;return e.jsxs("button",{onClick:()=>m(l===o.value?void 0:o.value),className:`flex items-center gap-2 px-3 py-2 rounded-lg text-sm transition-colors ${l===o.value?"bg-white/10 border border-white/20":"bg-white/5 border border-transparent hover:bg-white/10"}`,children:[e.jsx(P,{className:`w-4 h-4 ${l===o.value?o.color:"text-white/40"}`}),e.jsx("span",{className:l===o.value?"text-white":"text-white/60",children:o.label})]},o.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-white/60 mb-2 block",children:"Sleep quality"}),e.jsx("div",{className:"flex gap-2",children:fa.map(o=>{const P=o.icon;return e.jsxs("button",{onClick:()=>N(c===o.value?void 0:o.value),className:`flex items-center gap-2 px-3 py-2 rounded-lg text-sm transition-colors ${c===o.value?"bg-white/10 border border-white/20":"bg-white/5 border border-transparent hover:bg-white/10"}`,children:[e.jsx(P,{className:`w-4 h-4 ${c===o.value?o.color:"text-white/40"}`}),e.jsx("span",{className:c===o.value?"text-white":"text-white/60",children:o.label})]},o.value)})})]})]}),e.jsxs("div",{className:"p-4 border-b border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-xs font-medium text-white/60",children:"Tags"}),e.jsxs("button",{onClick:()=>F(!y),className:"flex items-center gap-1 text-xs text-violet-400 hover:text-violet-300 transition-colors",children:[e.jsx(Te,{className:"w-3 h-3"}),"Add Tag"]})]}),$.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:$.map(o=>e.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 rounded-full bg-violet-500/20 text-violet-300 text-xs",children:[e.jsx(qt,{className:"w-3 h-3"}),o,e.jsx("button",{onClick:()=>H(o),className:"ml-1 hover:text-red-400 transition-colors",children:e.jsx(ve,{className:"w-3 h-3"})})]},o))}),e.jsx(me,{children:y&&e.jsxs(J.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:[e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:ya.filter(o=>!$.includes(o)).map(o=>e.jsx("button",{onClick:()=>H(o),className:"px-2 py-1 rounded-full bg-white/5 hover:bg-white/10 text-white/60 text-xs transition-colors",children:o},o))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:x,onChange:o=>p(o.target.value),onKeyDown:o=>o.key==="Enter"&&f(),placeholder:"Custom tag...",className:"flex-1 px-3 py-2 rounded-lg bg-white/5 border border-white/10 text-white text-sm placeholder:text-white/40 focus:outline-none focus:border-violet-500"}),e.jsx("button",{onClick:f,disabled:!x.trim(),className:"px-3 py-2 rounded-lg bg-violet-500 text-white text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:bg-violet-600 transition-colors",children:"Add"})]})]})})]}),e.jsx("div",{className:"p-4",children:b?e.jsxs(e.Fragment,{children:[e.jsx("textarea",{ref:U,value:j,onChange:o=>g(o.target.value),placeholder:"How was your workout? Any observations, adjustments, or things to remember for next time...",className:"w-full min-h-[120px] p-3 rounded-xl bg-white/5 border border-white/10 text-white placeholder:text-white/40 focus:outline-none focus:border-violet-500 resize-none"}),!u&&e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[n&&e.jsx("button",{onClick:()=>{g(n.content||""),T(n.mood),m(n.energy),N(n.sleepQuality),G(n.tags||[]),E(!1)},className:"px-4 py-2 rounded-lg text-white/60 hover:bg-white/10 transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:Q,disabled:!L,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-violet-500 text-white font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:bg-violet-600 transition-colors",children:[e.jsx(Rt,{className:"w-4 h-4"}),"Save Notes"]})]})]}):e.jsx("div",{className:"prose prose-invert prose-sm max-w-none",children:j?e.jsx("p",{className:"text-white/80 whitespace-pre-wrap",children:j}):e.jsx("p",{className:"text-white/40 italic",children:"No notes added yet"})})})]})}const ja=t.lazy(()=>ft(()=>import("./index-BcufNXW5.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(a=>({default:a.ExerciseIllustration}))),wa={"chest-upper":"chest","chest-mid":"chest","chest-lower":"chest",pectoralis:"chest",pec:"chest","back-upper":"upper_back","back-mid":"lats","back-lower":"lower_back",latissimus:"lats",rhomboids:"upper_back",trapezius:"traps",traps:"traps","rear-delts":"rear_delts","front-delts":"front_delts","side-delts":"side_delts",shoulders:"front_delts",deltoid:"front_delts",biceps:"biceps",triceps:"triceps",forearms:"forearms",quadriceps:"quads",quads:"quads",hamstrings:"hamstrings",glutes:"glutes",calves:"calves",abs:"abs",obliques:"obliques",core:"abs","hip-flexors":"hip_flexors",adductors:"adductors",erector:"lower_back"};function Se(a){const n=a.toLowerCase().replace(/[_\s]/g,"-");return wa[n]||n.replace(/-/g,"_")}const Na=[{value:15,label:"15 min",description:"Quick session"},{value:30,label:"30 min",description:"Standard"},{value:45,label:"45 min",description:"Extended"},{value:60,label:"60 min",description:"Full workout"}],Ke=[{value:"gym",label:"Gym",icon:"ðŸ‹ï¸"},{value:"home",label:"Home",icon:"ðŸ "},{value:"park",label:"Park",icon:"ðŸŒ³"},{value:"hotel",label:"Hotel",icon:"ðŸ¨"},{value:"office",label:"Office",icon:"ðŸ¢"}],Sa={gym:[{value:"barbell",label:"Barbell",icon:"ðŸ‹ï¸"},{value:"dumbbells",label:"Dumbbells",icon:"ðŸ”©"},{value:"cable_machine",label:"Cable Machine",icon:"âš™ï¸"},{value:"leg_press",label:"Leg Press",icon:"ðŸ¦µ"},{value:"lat_pulldown",label:"Lat Pulldown",icon:"ðŸ“"},{value:"bench",label:"Bench",icon:"ðŸª‘"},{value:"squat_rack",label:"Squat Rack",icon:"ðŸ—ï¸"},{value:"smith_machine",label:"Smith Machine",icon:"ðŸ”§"},{value:"rowing_machine",label:"Row Machine",icon:"ðŸš£"},{value:"treadmill",label:"Treadmill",icon:"ðŸƒ"},{value:"elliptical",label:"Elliptical",icon:"â­•"},{value:"kettlebell",label:"Kettlebell",icon:"ðŸ””"}],home:[{value:"dumbbells",label:"Dumbbells",icon:"ðŸ”©"},{value:"pullup_bar",label:"Pull-up Bar",icon:"ðŸ”²"},{value:"kettlebell",label:"Kettlebell",icon:"ðŸ””"},{value:"bands",label:"Resistance Bands",icon:"âž°"},{value:"yoga_mat",label:"Yoga Mat",icon:"ðŸ§˜"},{value:"foam_roller",label:"Foam Roller",icon:"ðŸ›¼"},{value:"jump_rope",label:"Jump Rope",icon:"ðŸª¢"},{value:"stability_ball",label:"Stability Ball",icon:"âšª"}],park:[{value:"pullup_bar",label:"Pull-up Bar",icon:"ðŸ”²"},{value:"parallel_bars",label:"Parallel Bars",icon:"â¸ï¸"},{value:"bench",label:"Park Bench",icon:"ðŸª‘"},{value:"bands",label:"Resistance Bands",icon:"âž°"},{value:"jump_rope",label:"Jump Rope",icon:"ðŸª¢"},{value:"stairs",label:"Stairs",icon:"ðŸ“¶"}],hotel:[{value:"bands",label:"Resistance Bands",icon:"âž°"},{value:"dumbbells",label:"Hotel Dumbbells",icon:"ðŸ”©"},{value:"yoga_mat",label:"Yoga Mat",icon:"ðŸ§˜"},{value:"chair",label:"Chair",icon:"ðŸ’º"},{value:"treadmill",label:"Treadmill",icon:"ðŸƒ"}],office:[{value:"bands",label:"Resistance Bands",icon:"âž°"},{value:"chair",label:"Office Chair",icon:"ðŸ’º"},{value:"desk",label:"Desk",icon:"ðŸ–¥ï¸"},{value:"stairs",label:"Stairs",icon:"ðŸ“¶"}]},ka=[{value:"dumbbells",label:"Dumbbells",icon:"ðŸ”©"},{value:"pullup_bar",label:"Pull-up Bar",icon:"ðŸ”²"},{value:"kettlebell",label:"Kettlebell",icon:"ðŸ””"},{value:"bands",label:"Resistance Bands",icon:"âž°"},{value:"barbell",label:"Barbell",icon:"ðŸ‹ï¸"}],Ca=[{value:"strength",label:"Strength",icon:"ðŸ’ª"},{value:"hypertrophy",label:"Muscle Growth",icon:"ðŸ“ˆ"},{value:"endurance",label:"Endurance",icon:"ðŸƒ"},{value:"fat_loss",label:"Fat Loss",icon:"ðŸ”¥"}],Ws=[{id:"chest",name:"Chest",icon:"ðŸª¶",match:["ch_","pec","chest"]},{id:"back",name:"Back",icon:"ðŸ”§",match:["bk_","lat","romboid","trap","back"]},{id:"shoulders",name:"Shoulders",icon:"ðŸ’ª",match:["sh_","delt","shoulder"]},{id:"arms",name:"Arms",icon:"ðŸ’ª",match:["ar_","bicep","tricep","forearm"]},{id:"legs",name:"Legs",icon:"ðŸ¦µ",match:["lg_","quad","hamstring","calf","leg"]},{id:"glutes",name:"Glutes",icon:"ðŸ‘",match:["glute"]},{id:"core",name:"Core",icon:"ðŸ¤³",match:["core","ab","oblique"]}];function Je(a){if(!a||!a.length)return null;const n=(a[0]||"").toLowerCase();for(const i of Ws)if(i.match.some(h=>n.includes(h)))return i;return null}const Ss={barbell:{c:"from-red-500 to-orange-500"},dumbbell:{c:"from-blue-500 to-purple-500"},bodyweight:{c:"from-green-500 to-teal-500"},kettlebell:{c:"from-yellow-500 to-orange-500"},machine:{c:"from-gray-500 to-gray-700"},cable:{c:"from-purple-500 to-pink-500"},default:{c:"from-gray-600 to-gray-700"}},ks=({currentExercise:a,onWeightCalculated:n})=>{const[i,h]=t.useState(!1),[v,u]=t.useState("plates"),_=[{id:"plates",label:"Plates",icon:"ðŸ”¢",description:"Calculate plates needed"},{id:"warmup",label:"Warmup",icon:"ðŸ”¥",description:"Generate warmup sets"},{id:"timer",label:"Timer",icon:"â±ï¸",description:"Stopwatch & countdown"},{id:"notes",label:"Notes",icon:"ðŸ“",description:"Session notes"},{id:"history",label:"History",icon:"ðŸ“Š",description:"Exercise progress"}];return e.jsxs("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl overflow-hidden mb-6 border border-white/5",children:[e.jsxs("button",{onClick:()=>h(!i),className:"w-full p-4 flex items-center justify-between text-left min-h-[56px] touch-action-manipulation",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-2xl",children:"ðŸ› ï¸"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-white",children:"Workout Tools"}),e.jsx("div",{className:"text-xs text-gray-400",children:"Plate calculator, warmup sets, timer & more"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-blue-400 bg-blue-400/10 px-2 py-1 rounded-full",children:"New"}),e.jsx("svg",{className:`w-5 h-5 text-gray-400 transition-transform ${i?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),i&&e.jsxs("div",{className:"p-4 pt-0",children:[e.jsx("div",{className:"flex gap-2 mb-4 overflow-x-auto pb-2 scrollbar-hide -mx-1 px-1",children:_.map(C=>e.jsxs("button",{onClick:()=>u(C.id),className:`flex items-center gap-2 px-4 py-3 rounded-xl text-sm whitespace-nowrap transition-all min-h-[48px] touch-action-manipulation ${v===C.id?"bg-blue-500 text-white shadow-lg shadow-blue-500/25":"bg-gray-700/50 text-gray-300 hover:bg-gray-700 active:scale-95"}`,title:C.description,children:[e.jsx("span",{className:"text-lg",children:C.icon}),e.jsx("span",{className:"font-medium",children:C.label})]},C.id))}),e.jsxs("div",{className:"bg-gray-900/50 rounded-xl p-4",children:[v==="plates"&&e.jsx(da,{onWeightCalculated:n}),v==="warmup"&&e.jsx(ua,{workingWeight:135}),v==="timer"&&e.jsx(ma,{}),v==="notes"&&e.jsx(va,{workoutId:`workout-${Date.now()}`}),v==="history"&&a?.id&&e.jsx(ga,{exerciseId:a.id,exerciseName:a.name||"Exercise"}),v==="history"&&!a?.id&&e.jsxs("div",{className:"text-center text-gray-400 py-8",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ðŸ“Š"}),e.jsx("p",{children:"Select an exercise to view history"})]})]})]})]})};function dr(){const{token:a}=bt(),n=vt(),[i,h]=t.useState("select"),[v,u]=t.useState(!0),[_,C]=t.useState(30),[M,b]=t.useState("gym"),[E,j]=t.useState([]),[g,k]=t.useState(["strength"]),[T,l]=t.useState(null),[m,c]=t.useState(0),[N,$]=t.useState([]),[G,y]=t.useState(""),[F,x]=t.useState(null),[p,L]=t.useState([]),[Y,U]=t.useState(!1),[O,Z]=t.useState(null),[Q,q]=t.useState(3),[H,f]=t.useState(!1),[o,P]=t.useState(null),[V,te]=t.useState(10),[ne,he]=t.useState(0),[ie,K]=t.useState(null),[oe,re]=t.useState(null),ae=t.useRef(null),ge=t.useRef(null),[je,ce]=t.useState(!1),[Ce,S]=t.useState(!1),[B,X]=t.useState([]),{activeSession:ye,isSessionActive:Re,startSession:R,completeSession:I,recoverSession:D,abandonSession:ee,recoverableSessions:se,totalSets:we,registerCallbacks:Me}=He();t.useEffect(()=>{Me({onPR:s=>{K(`NEW ${s.prType.toUpperCase()} PR! ${s.exerciseName}`),setTimeout(()=>K(null),3e3)},onLevelUp:s=>{K(`LEVEL UP! You're now level ${s}!`),setTimeout(()=>K(null),4e3)}})},[Me]),t.useEffect(()=>{se&&se.length>0&&(X(se),S(!0))},[se]),t.useEffect(()=>{(i==="workout"||i==="manual")&&!ae.current&&(ae.current=`session-${Date.now()}-${Math.random().toString(36).slice(2)}`,ge.current=Date.now())},[i]);const Ne=t.useCallback(async s=>{if(!a||!ae.current||s.length===0)return;const r={sessionId:ae.current,isActive:!0,startTime:ge.current||Date.now(),pausedAt:null,totalPausedTime:0,exercises:s.map(w=>({id:w.id,name:w.name,primaryMuscles:w.primaryMuscles||w.primary_muscles||[],secondaryMuscles:w.secondaryMuscles||w.secondary_muscles||[]})),currentExercise:s[s.length-1]||null,currentExerciseIndex:s.length-1,currentSetIndex:0,sets:s.map((w,d)=>({id:`set-${d}`,exerciseId:w.id,exerciseName:w.name,weight:w.weight||0,reps:w.reps||0,tag:"working",timestamp:Date.now()})),totalVolume:s.reduce((w,d)=>w+(d.weight||0)*(d.reps||0)*(d.sets||1),0),totalReps:s.reduce((w,d)=>w+(d.reps||0)*(d.sets||1),0),estimatedCalories:s.length*50,musclesWorked:[...new Set(s.flatMap(w=>w.primaryMuscles||w.primary_muscles||[]))],sessionPRs:[],exerciseGroups:[],activeGroupExerciseIndex:0,activeGroupRound:1,groupSets:[],clientVersion:1};try{await Jt(r,!1)}catch{}},[a]);t.useEffect(()=>{p.length>0&&(i==="workout"||i==="manual")&&Ne(p)},[p,i,Ne]),t.useEffect(()=>{j([])},[M]);const Ls=Sa[M]||ka,le=t.useCallback(()=>{if(!T)return[];const s=[];return T.warmup&&s.push(...T.warmup.map(r=>({...r,phase:"warmup"}))),T.exercises&&s.push(...T.exercises.map(r=>({...r,phase:"main"}))),T.cooldown&&s.push(...T.cooldown.map(r=>({...r,phase:"cooldown"}))),s},[T]),Ie=t.useMemo(()=>{const s={};return p.forEach(r=>{const w=r.primaryMuscles||r.primary_muscles||[],d=r.secondaryMuscles||r.secondary_muscles||[],A=r.sets||3,W=r.reps||10,z=Math.min(1,A*W/50);w.forEach(ue=>{const pe=Se(ue),Ee=s[pe]||{intensity:0};s[pe]={intensity:Math.min(1,Ee.intensity+z*.4),isPrimary:!0}}),d.forEach(ue=>{const pe=Se(ue),Ee=s[pe]||{intensity:0,isPrimary:!1};Ee.isPrimary?s[pe].intensity=Math.min(1,Ee.intensity+z*.2):s[pe]={intensity:Math.min(1,Ee.intensity+z*.2),isPrimary:!1}})}),Object.entries(s).map(([r,{intensity:w,isPrimary:d}])=>({id:r,intensity:w,isPrimary:d}))},[p]),Os=t.useMemo(()=>{if(!T)return[];const r=le()[m];if(!r)return[];const w=[],d=r.primaryMuscles||r.primary_muscles||[],A=r.secondaryMuscles||r.secondary_muscles||[];return d.forEach(W=>{w.push({id:Se(W),intensity:1,isPrimary:!0})}),A.forEach(W=>{w.push({id:Se(W),intensity:.5,isPrimary:!1})}),w},[T,m]);t.useEffect(()=>{i==="manual"&&N.length===0&&(U(!0),fetch("/api/exercises").then(s=>s.json()).then(s=>{const w=(s.data||s.exercises||[]).map(d=>({...d,primary_muscles:typeof d.primaryMuscles=="string"?d.primaryMuscles.split(",").map(A=>A.trim()).filter(Boolean):d.primaryMuscles||[]}));$(w),U(!1)}).catch(()=>U(!1)))},[i,N.length]);const Ds=async()=>{U(!0),re(null);try{const s=await fetch("/api/prescription/generate",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({timeAvailable:_,location:M,equipment:E,goals:g})}),r=await s.json();if(!s.ok)throw new Error(r.error?.message||"Failed to generate workout");const w=r.data;l(w),c(0),h("workout");const d=[...w.warmup||[],...w.exercises||[],...w.cooldown||[]].filter(A=>A.id||A.exerciseId).map(A=>({exerciseId:A.id||A.exerciseId,name:A.name,plannedSets:A.sets||3,plannedReps:typeof A.reps=="number"?A.reps:10}));if(d.length>0){const A=await R(d);A.success||re(`Session start issue: ${A.error||"Unknown error"}. Click "Start Session Now" to retry.`)}}catch(s){re(s.message||"Failed to generate workout. Try different constraints.")}finally{U(!1)}},Bs=s=>{j(r=>r.includes(s)?r.filter(w=>w!==s):[...r,s])},Us=s=>{k(r=>r.includes(s)?r.length>1?r.filter(w=>w!==s):r:[...r,s])},Gs=t.useCallback(async()=>{if(T){const w=le().filter(d=>d.id||d.exerciseId).map(d=>({exerciseId:d.id||d.exerciseId,name:d.name,plannedSets:d.sets||3,plannedReps:typeof d.reps=="number"?d.reps:10}));if(w.length>0){const d=await R(w);d.success||re(d.error||"Failed to start workout session. Please try again.");return}}const s=await R();s.success||re(s.error||"Failed to start workout session. Please try again.")},[T,le,R]),_e=t.useRef(!1),rs=async()=>{if(_e.current||p.length===0)return;_e.current=!0,f(!0);const s=[...p];try{if(Re&&ye){const r=await I();r?(ae.current&&(await ps("completed",r.workout?.id),ae.current=null,ge.current=null),P({tuEarned:r.tuEarned||0,xpEarned:r.xpEarned||0,characterStats:r.characterStats,exerciseCount:r.sessionSummary?.exerciseCount||s.length,totalSets:r.sessionSummary?.totalSets||we,exercises:s,levelUp:r.levelUp,newLevel:r.newLevel,achievements:r.achievements,sessionSummary:r.sessionSummary}),L([])):alert("Failed to complete workout. Please try again.")}else{const r=s.filter(W=>{const z=W.id&&typeof W.id=="string"&&!W.id.startsWith("activity-"),ue=!W.isActivity;return z&&ue}).map(W=>({exerciseId:W.id,sets:W.sets||3,reps:typeof W.reps=="number"?W.reps:10,weight:W.weight||void 0}));if(r.length===0){alert("No exercises to log. Complete at least one exercise (not just warmup/cooldown) to save your workout."),_e.current=!1,f(!1);return}const w=`workout-${Date.now()}-${Math.random().toString(36).slice(2)}`,d=await fetch("/api/workouts",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+a},body:JSON.stringify({exercises:r,idempotencyKey:w,notes:`${p.length} exercises completed`})}),A=await d.json();if(d.ok&&A.data){ae.current&&(await ps("completed",A.data.id),ae.current=null,ge.current=null);const W=s.length,z=s.reduce((ue,pe)=>ue+(pe.sets||0),0);P({tuEarned:A.data.totalTU,characterStats:A.data.characterStats,exerciseCount:W,totalSets:z,exercises:s}),L([])}else alert(A.error?.message||A.error||"Failed to complete workout")}}catch{alert("Error completing workout. Please try again.")}finally{_e.current=!1,f(!1)}},qs=N.filter(s=>{const r=!G||s.name.toLowerCase().includes(G.toLowerCase()),w=Je(s.primary_muscles),d=!F||w&&w.id===F;return r&&d}).slice(0,24);async function Hs(){if(O)try{await fetch("/api/workouts/exercise",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+a},body:JSON.stringify({exerciseId:O.id,sets:Q,reps:V,weight:ne})}),L([...p,{...O,sets:Q,reps:V,weight:ne}]),K(O.name),setTimeout(()=>K(null),2e3),Z(null)}catch{}}const Vs=s=>Ss[s.type]||Ss.default,Ve=s=>{const r=Je(s.primary_muscles||s.primaryMuscles);return r?r.icon:"ðŸ’ª"},ls=s=>{const r=Je(s.primary_muscles||s.primaryMuscles);return r?r.name:""},zs=async s=>{const r=s.id||s.exerciseId;if(s.isActivity||!r){const d=`activity-${m}`;p.some(z=>z.id===d)||L(z=>[...z,{id:d,name:s.name||s.description||"Activity",sets:s.sets||1,reps:s.reps||1,weight:0,isActivity:!0}]),K(s.name||s.description),setTimeout(()=>K(null),2e3);const W=le();m<W.length-1&&c(m+1);return}try{await fetch("/api/workouts/exercise",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+a},body:JSON.stringify({exerciseId:r,sets:s.sets,reps:typeof s.reps=="number"?s.reps:10,weight:0})}),L([...p,{id:r,name:s.name,sets:s.sets,reps:s.reps,weight:0,primaryMuscles:s.primaryMuscles}]),K(s.name),setTimeout(()=>K(null),2e3);const d=le();m<d.length-1&&c(m+1)}catch{}},Ys=()=>e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-gray-900 via-gray-800 to-gray-900 text-white pb-24",children:[e.jsx("header",{className:"bg-gray-900/80 backdrop-blur-lg p-4 sticky top-0 z-10 border-b border-gray-700/30",children:e.jsxs("div",{className:"max-w-5xl mx-auto flex items-center justify-between",children:[e.jsxs(jt,{to:"/dashboard",className:"flex items-center gap-2 text-blue-400 hover:text-blue-300 transition-colors",children:[e.jsx("span",{children:"â†"}),e.jsx("img",{src:"/logo.png",alt:"MuscleMap",className:"w-6 h-6 rounded-md"})]}),e.jsx("h1",{className:"text-xl font-bold",children:"Start Workout"}),e.jsx("div",{})]})}),e.jsxs("main",{className:"max-w-lg mx-auto p-4 space-y-6",children:[oe&&e.jsx("div",{className:"bg-red-500/20 border border-red-500 rounded-xl p-4 text-red-200",children:oe}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-sm text-gray-400 uppercase mb-3",children:"How long do you have?"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:Na.map(s=>e.jsxs("button",{onClick:()=>C(s.value),className:`p-3 rounded-xl text-center transition-all ${_===s.value?"bg-purple-600 ring-2 ring-purple-400":"bg-gray-800 hover:bg-gray-700"}`,children:[e.jsx("div",{className:"font-bold",children:s.label}),e.jsx("div",{className:"text-xs text-gray-400",children:s.description})]},s.value))})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-sm text-gray-400 uppercase mb-3",children:"Where are you?"}),e.jsx("div",{className:"grid grid-cols-5 gap-2",children:Ke.map(s=>e.jsxs("button",{onClick:()=>b(s.value),className:`p-3 rounded-xl text-center transition-all ${M===s.value?"bg-purple-600 ring-2 ring-purple-400":"bg-gray-800 hover:bg-gray-700"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:s.icon}),e.jsx("div",{className:"text-xs",children:s.label})]},s.value))})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-sm text-gray-400 uppercase mb-3",children:["Available at ",Ke.find(s=>s.value===M)?.label||"Location"," (optional)"]}),e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-2 max-h-48 overflow-y-auto",children:Ls.map(s=>e.jsxs("button",{onClick:()=>Bs(s.value),className:`p-3 rounded-xl text-center transition-all ${E.includes(s.value)?"bg-green-600 ring-2 ring-green-400":"bg-gray-800 hover:bg-gray-700"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:s.icon}),e.jsx("div",{className:"text-xs leading-tight",children:s.label})]},s.value))}),E.length===0&&e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"No equipment selected = bodyweight exercises"}),E.length>0&&e.jsxs("p",{className:"text-xs text-green-400 mt-2",children:[E.length," item",E.length>1?"s":""," selected"]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-sm text-gray-400 uppercase mb-3",children:"Your Goal"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Ca.map(s=>e.jsxs("button",{onClick:()=>Us(s.value),className:`p-3 rounded-xl text-left transition-all ${g.includes(s.value)?"bg-blue-600 ring-2 ring-blue-400":"bg-gray-800 hover:bg-gray-700"}`,children:[e.jsx("span",{className:"text-xl mr-2",children:s.icon}),e.jsx("span",{className:"font-medium",children:s.label})]},s.value))})]}),e.jsx("button",{onClick:Ds,disabled:Y,className:"w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-500 hover:to-blue-500 py-4 rounded-2xl font-bold text-lg transition-all disabled:opacity-50",children:Y?"Generating...":"Generate Workout"}),e.jsx("button",{onClick:()=>h("manual"),className:"w-full bg-gray-800 hover:bg-gray-700 py-3 rounded-xl text-gray-400 text-sm",children:"Or browse all exercises manually"})]})]}),Qs=()=>{const s=le(),r=s[m],w=s.length>0?(m+1)/s.length*100:0;return e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-gray-900 via-gray-800 to-gray-900 text-white pb-24",children:[ie&&e.jsxs("div",{className:"fixed top-20 left-1/2 -translate-x-1/2 z-50 bg-green-500 px-8 py-4 rounded-2xl font-bold animate-bounce",children:["Done: ",ie]}),e.jsx("header",{className:"bg-gray-900/80 backdrop-blur-lg p-4 sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-5xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("button",{onClick:()=>{h("select"),l(null)},className:"text-blue-400",children:"â† Exit"}),e.jsx("h1",{className:"text-xl font-bold",children:"Your Workout"}),e.jsxs("div",{className:"bg-green-600 px-3 py-1 rounded-full text-sm font-bold",children:[p.length,"/",s.length]})]}),e.jsx("div",{className:"h-2 bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-green-500 to-emerald-400 transition-all duration-300",style:{width:`${w}%`}})})]})}),e.jsxs("main",{className:"max-w-lg mx-auto p-4",children:[oe&&e.jsxs("div",{className:"bg-red-500/20 border border-red-500 rounded-xl p-4 text-red-200 mb-4",children:[oe,e.jsx("button",{onClick:()=>re(null),className:"ml-2 text-red-400 hover:text-red-200",children:"Ã—"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl overflow-hidden mb-6 border border-white/5",children:[e.jsxs("button",{onClick:()=>u(!v),className:"w-full p-3 flex items-center justify-between text-left",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-2xl",children:"ðŸ”¥"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-white",children:"Muscle Activation"}),e.jsxs("div",{className:"text-xs text-gray-400",children:[Ie.length," muscle groups worked"]})]})]}),e.jsx("svg",{className:`w-5 h-5 text-gray-400 transition-transform ${v?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),v&&e.jsx("div",{className:"p-4 pt-0",children:e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase mb-2",children:"Current Exercise"}),e.jsx(is,{muscles:Os,mode:"compact",interactive:!1,showLabels:!1,autoRotate:!1,className:"w-full",style:{height:140}}),r&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2 justify-center",children:r.primaryMuscles?.slice(0,3).map(d=>e.jsx("span",{className:"bg-purple-500/30 text-purple-200 px-2 py-0.5 rounded text-xs",children:d},d))})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase mb-2",children:"Workout Total"}),e.jsx(is,{muscles:Ie,mode:"compact",interactive:!1,showLabels:!1,autoRotate:!1,className:"w-full",style:{height:140}}),Ie.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2 justify-center",children:Ie.slice(0,3).map(d=>e.jsx("span",{className:"bg-green-500/30 text-green-200 px-2 py-0.5 rounded text-xs",children:d.id.replace(/_/g," ")},d.id))})]})]})})]}),e.jsx(ks,{currentExercise:r,onWeightCalculated:d=>{}}),e.jsxs("div",{className:"bg-gray-800 rounded-2xl p-4 mb-6",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-400 mb-2",children:[e.jsxs("span",{children:[T?.actualDuration||_," min"]}),e.jsxs("span",{children:[Ke.find(d=>d.value===M)?.icon," ",M]}),e.jsxs("span",{children:[s.length," exercises"]})]}),T?.muscleCoverage&&e.jsx("div",{className:"flex flex-wrap gap-1",children:Object.keys(T.muscleCoverage).slice(0,6).map(d=>e.jsx("span",{className:"bg-gray-700 px-2 py-1 rounded text-xs",children:d},d))})]}),r&&e.jsxs("div",{className:"bg-gradient-to-br from-purple-600 to-blue-600 rounded-3xl overflow-hidden mb-6 shadow-2xl",children:[r.id&&wt(r.id)&&e.jsx("div",{className:"h-40 bg-black/20",children:e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-white/5 to-white/10 animate-pulse"}),children:e.jsx(ja,{exerciseId:r.id,exerciseName:r.name,primaryMuscles:r.primaryMuscles,size:"md",showMuscleLabels:!1,interactive:!1,className:"w-full h-full"})})}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"text-xs uppercase tracking-wide opacity-70 mb-2",children:r.phase==="warmup"?"Warm-up":r.phase==="cooldown"?"Cool-down":`Exercise ${m+1-(T?.warmup?.length||0)}`}),e.jsx("h2",{className:"text-2xl font-bold mb-4",children:r.name}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-white/20 rounded-xl p-3 text-center",children:[e.jsx("div",{className:"text-3xl font-bold",children:r.sets}),e.jsx("div",{className:"text-xs opacity-80",children:"Sets"})]}),e.jsxs("div",{className:"bg-white/20 rounded-xl p-3 text-center",children:[e.jsx("div",{className:"text-3xl font-bold",children:r.reps}),e.jsx("div",{className:"text-xs opacity-80",children:"Reps"})]}),e.jsxs("div",{className:"bg-white/20 rounded-xl p-3 text-center",children:[e.jsxs("div",{className:"text-3xl font-bold",children:[r.restSeconds,"s"]}),e.jsx("div",{className:"text-xs opacity-80",children:"Rest"})]})]}),r.notes&&e.jsx("p",{className:"text-sm opacity-80 mb-4",children:r.notes}),e.jsx("div",{className:"flex gap-2 text-xs opacity-70 flex-wrap",children:r.primaryMuscles?.map(d=>e.jsx("span",{className:"bg-white/10 px-2 py-1 rounded",children:d},d))})]})]}),r&&e.jsx("div",{className:"mb-6",children:e.jsx(Xt,{exerciseId:r.exerciseId,delay:1500})}),r&&r.id&&!r.isActivity&&e.jsxs("div",{className:"mb-6 bg-gray-800/50 rounded-2xl p-4 border border-gray-700/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-300",children:"Log Your Sets"}),e.jsx("button",{onClick:()=>ce(!0),className:"text-xs text-blue-400 hover:text-blue-300",children:"Swap Exercise"})]}),e.jsx(na,{exerciseId:r.id,exerciseName:r.name,suggestedSets:r.sets||3,suggestedReps:typeof r.reps=="number"?r.reps:10,onStartSession:Gs,onSetLogged:d=>{L(A=>A.find(z=>z.id===r.id)?A.map(z=>z.id===r.id?{...z,sets:(z.sets||0)+1,tu:(z.tu||0)+(d.tu||0)}:z):[...A,{id:r.id,name:r.name,sets:1,reps:d.reps,weight:Math.round((d.weightKg||0)*2.205),tu:d.tu||0,primaryMuscles:r.primaryMuscles}])},onAllSetsComplete:()=>{const d=le();m<d.length-1&&c(m+1),K(`${r.name} completed!`),setTimeout(()=>K(null),2e3)},compact:!1})]}),r&&(r.isActivity||!r.id)&&e.jsxs("div",{className:"flex gap-3 mb-6",children:[e.jsx("button",{onClick:()=>m>0&&c(m-1),disabled:m===0,className:"flex-1 bg-gray-700 hover:bg-gray-600 disabled:opacity-50 py-4 rounded-xl font-bold",children:"Previous"}),e.jsx("button",{onClick:()=>zs(r),className:"flex-[2] bg-green-600 hover:bg-green-500 py-4 rounded-xl font-bold text-lg",children:"Done"}),e.jsx("button",{onClick:()=>m<s.length-1&&c(m+1),disabled:m===s.length-1,className:"flex-1 bg-gray-700 hover:bg-gray-600 disabled:opacity-50 py-4 rounded-xl font-bold",children:"Skip"})]}),r&&r.id&&!r.isActivity&&e.jsxs("div",{className:"flex gap-3 mb-6",children:[e.jsx("button",{onClick:()=>m>0&&c(m-1),disabled:m===0,className:"flex-1 bg-gray-700 hover:bg-gray-600 disabled:opacity-50 py-3 rounded-xl font-medium",children:"Previous"}),e.jsx("button",{onClick:()=>{p.some(W=>W.id===r.id)||L(W=>[...W,{id:r.id,name:r.name,sets:r.sets||3,reps:typeof r.reps=="number"?r.reps:10,weight:0,primaryMuscles:r.primaryMuscles}]),K(`${r.name} completed!`),setTimeout(()=>K(null),2e3);const A=le();m<A.length-1&&c(m+1)},className:"flex-[2] bg-green-600 hover:bg-green-500 py-3 rounded-xl font-bold",children:"Done"}),e.jsx("button",{onClick:()=>{const d=le();m<d.length-1&&c(m+1)},disabled:m===s.length-1,className:"flex-1 bg-gray-700 hover:bg-gray-600 disabled:opacity-50 py-3 rounded-xl font-medium",children:"Skip"})]}),p.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm text-gray-400 uppercase mb-3",children:"Completed"}),e.jsx("div",{className:"space-y-2",children:p.map((d,A)=>e.jsxs("div",{className:"bg-gray-800 rounded-xl p-3 flex items-center gap-3",children:[e.jsx("div",{className:"bg-green-600 w-8 h-8 rounded-full flex items-center justify-center text-sm",children:"âœ“"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:d.name}),e.jsxs("div",{className:"text-xs text-gray-400",children:[d.sets," x ",d.reps]})]})]},A))})]}),p.length>0&&e.jsx("button",{onClick:rs,disabled:H,className:"w-full bg-gradient-to-r from-green-600 to-emerald-500 hover:from-green-500 hover:to-emerald-400 py-4 rounded-2xl font-bold text-lg transition-all",children:H?"Completing...":`Complete Workout (${p.length} exercises)`}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-sm text-gray-400 uppercase mb-3",children:"All Exercises"}),e.jsx("div",{className:"space-y-2",children:s.map((d,A)=>{const W=p.some(ue=>ue.name===d.name),z=A===m;return e.jsxs("button",{onClick:()=>c(A),className:`w-full text-left rounded-xl p-3 flex items-center gap-3 transition-all ${z?"bg-purple-600":W?"bg-gray-800 opacity-60":"bg-gray-800 hover:bg-gray-700"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm ${W?"bg-green-600":z?"bg-white/20":"bg-gray-700"}`,children:W?"âœ“":A+1}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:d.name}),e.jsxs("div",{className:"text-xs text-gray-400",children:[d.sets," x ",d.reps," | ",d.phase]})]})]},A)})})]})]})]})},Ks=()=>e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-gray-900 via-gray-800 to-gray-900 text-white pb-24",children:[ie&&e.jsxs("div",{className:"fixed top-20 left-1/2 -translate-x-1/2 z-50 bg-green-500 px-8 py-4 rounded-2xl font-bold animate-bounce",children:[ie,"!"]}),O&&e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-end justify-center",onClick:()=>Z(null),children:e.jsxs("div",{className:"bg-gray-800 rounded-t-3xl p-6 w-full max-w-lg",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("span",{className:"text-5xl",children:Ve(O)}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:O.name}),e.jsx("p",{className:"text-gray-400",children:ls(O)})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Sets"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-2",children:[e.jsx("button",{onClick:()=>q(Math.max(1,Q-1)),className:"bg-gray-700 w-10 h-10 rounded-full text-xl",children:"-"}),e.jsx("span",{className:"text-3xl font-bold w-12 text-center",children:Q}),e.jsx("button",{onClick:()=>q(Q+1),className:"bg-gray-700 w-10 h-10 rounded-full text-xl",children:"+"})]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Reps"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-2",children:[e.jsx("button",{onClick:()=>te(Math.max(1,V-1)),className:"bg-gray-700 w-10 h-10 rounded-full text-xl",children:"-"}),e.jsx("span",{className:"text-3xl font-bold w-12 text-center",children:V}),e.jsx("button",{onClick:()=>te(V+1),className:"bg-gray-700 w-10 h-10 rounded-full text-xl",children:"+"})]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"lbs"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-2",children:[e.jsx("button",{onClick:()=>he(Math.max(0,ne-5)),className:"bg-gray-700 w-10 h-10 rounded-full text-xl",children:"-"}),e.jsx("span",{className:"text-3xl font-bold w-12 text-center",children:ne}),e.jsx("button",{onClick:()=>he(ne+5),className:"bg-gray-700 w-10 h-10 rounded-full text-xl",children:"+"})]})]})]}),e.jsx("button",{onClick:Hs,className:"w-full bg-green-600 hover:bg-green-700 py-4 rounded-2xl font-bold text-lg",children:"Log Exercise"})]})}),e.jsx("header",{className:"bg-gray-900/80 backdrop-blur-lg p-4 sticky top-0 z-10 border-b border-gray-700/30",children:e.jsxs("div",{className:"max-w-5xl mx-auto flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>h("select"),className:"flex items-center gap-2 text-blue-400 hover:text-blue-300 transition-colors",children:[e.jsx("span",{children:"â†"}),e.jsx("img",{src:"/logo.png",alt:"MuscleMap",className:"w-6 h-6 rounded-md"})]}),e.jsx("h1",{className:"text-xl font-bold",children:"Browse Exercises"}),e.jsxs("div",{className:"bg-green-600 px-3 py-1 rounded-full text-sm font-bold",children:[p.length," logged"]})]})}),e.jsxs("main",{className:"max-w-5xl mx-auto p-4",children:[e.jsx(ks,{currentExercise:O,onWeightCalculated:s=>he(s)}),p.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-sm text-gray-400 mb-2 uppercase",children:"Today's Workout"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:p.map((s,r)=>e.jsxs("div",{className:"bg-gray-800 rounded-xl p-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:Ve(s)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-sm truncate",children:s.name}),e.jsxs("div",{className:"text-xs text-gray-400",children:[s.sets,"x",s.reps," ",s.weight>0?`${s.weight}lb`:""]})]})]},r))}),e.jsx("button",{onClick:rs,disabled:H,className:"w-full bg-green-600 hover:bg-green-500 py-4 rounded-2xl font-bold text-lg mt-4 transition-all",children:H?"Completing...":"Complete Workout"})]}),e.jsx("input",{type:"text",placeholder:"Search exercises...",value:G,onChange:s=>y(s.target.value),className:"w-full bg-gray-800 rounded-2xl p-4 mb-4 text-lg"}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-4 mb-4",children:[e.jsx("button",{onClick:()=>x(null),className:`px-4 py-2 rounded-full text-sm font-bold whitespace-nowrap ${F?"bg-gray-700":"bg-purple-600"}`,children:"All"}),Ws.map(s=>e.jsxs("button",{onClick:()=>x(s.id),className:`px-4 py-2 rounded-full text-sm font-bold whitespace-nowrap ${F===s.id?"bg-purple-600":"bg-gray-700"}`,children:[s.icon," ",s.name]},s.id))]}),Y?e.jsx("div",{className:"text-center py-12 text-gray-400",children:"Loading exercises..."}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:qs.map(s=>{const r=[...(s.primary_muscles||[]).map(w=>({id:Se(w),intensity:1,isPrimary:!0})),...(s.secondary_muscles||[]).slice(0,2).map(w=>({id:Se(w),intensity:.5,isPrimary:!1}))];return e.jsxs("button",{onClick:()=>Z(s),className:`bg-gradient-to-br ${Vs(s).c} rounded-2xl p-3 text-left hover:scale-105 active:scale-95 transition-all shadow-lg relative`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("div",{className:"text-3xl",children:Ve(s)}),r.length>0&&e.jsx(Nt,{muscles:r,size:"xs",className:"opacity-90"})]}),e.jsx("div",{className:"font-bold text-sm truncate mt-1",children:s.name}),e.jsx("div",{className:"text-xs opacity-80",children:ls(s)})]},s.id)})})]})]}),Js=()=>o&&e.jsx(ta,{workout:{duration:_,exerciseCount:o.exerciseCount||0,totalSets:o.totalSets||0,totalTU:o.tuEarned||0,exercises:o.exercises||[],goals:g},onClose:()=>{P(null),h("select"),l(null),L([]),n("/dashboard")}}),Zs=async s=>{await D(s)&&ye&&(h("workout"),S(!1))},Xs=async s=>{await ee(s),X(r=>r.filter(w=>w.id!==s)),B.length<=1&&S(!1)},et=s=>{const w=le()[m];if(T&&w){const d=A=>A.map(W=>W.id===w.id||W.exerciseId===w.exerciseId?{...W,id:s.id,exerciseId:s.id,name:s.name,primaryMuscles:s.primaryMuscles}:W);l({...T,warmup:T.warmup?d(T.warmup):void 0,exercises:T.exercises?d(T.exercises):void 0,cooldown:T.cooldown?d(T.cooldown):void 0})}ce(!1),K(`Switched to ${s.name}`),setTimeout(()=>K(null),2e3)};return e.jsxs(e.Fragment,{children:[Js(),i==="select"&&Ys(),i==="workout"&&Qs(),i==="manual"&&Ks(),(i==="workout"||i==="manual")&&Re&&e.jsx(St,{}),je&&m>=0&&e.jsx(ia,{exerciseId:le()[m]?.id||"",exerciseName:le()[m]?.name||"",availableEquipment:E,onSelect:et,onCancel:()=>ce(!1)}),Ce&&B.length>0&&e.jsx(oa,{sessions:B,onRecover:Zs,onDiscard:Xs,onDismiss:()=>S(!1)})]})}export{dr as default};
