import{r as i}from"./react-vendor-D847gc3Q.js";import{c as f}from"./nutritionStore-DZGSHMmM.js";import{a3 as g}from"./index-C2MOd6aO.js";const p="/api";async function l(a,t={}){const n=g.getState().token,o=await fetch(`${p}${a}`,{...t,headers:{"Content-Type":"application/json",Authorization:n?`Bearer ${n}`:"",...t.headers}});if(!o.ok){const u=await o.json().catch(()=>({error:"Request failed"}));throw new Error(u.error?.message||u.message||"Request failed")}return o.json()}function k(){const{loadDashboard:a,setLoading:t,setError:n,isLoading:o,error:u,enabled:y,preferences:r,goals:e,todaysSummary:h,streaks:s,archetypeProfile:c}=f();return{load:i.useCallback(async()=>{t(!0),n(null);try{const d=await l("/me/nutrition");a(d)}catch(d){n(d.message)}finally{t(!1)}},[a,t,n]),isLoading:o,error:u,enabled:y,preferences:r,goals:e,todaysSummary:h,streaks:s,archetypeProfile:c}}function P(){const{setPreferences:a,setLoading:t,setError:n}=f(),o=i.useCallback(async()=>{t(!0);try{const r=await l("/me/nutrition/enable",{method:"POST"});return a(r),r}catch(r){throw n(r.message),r}finally{t(!1)}},[a,t,n]),u=i.useCallback(async(r=!1)=>{t(!0);try{await l("/me/nutrition/disable",{method:"POST",body:JSON.stringify({deleteData:r})}),a({enabled:!1})}catch(e){throw n(e.message),e}finally{t(!1)}},[a,t,n]),y=i.useCallback(async r=>{t(!0);try{const e=await l("/me/nutrition/preferences",{method:"PATCH",body:JSON.stringify(r)});return a(e),e}catch(e){throw n(e.message),e}finally{t(!1)}},[a,t,n]);return{enable:o,disable:u,updatePreferences:y}}function C(){const{setGoals:a,setLoading:t,setError:n}=f(),o=i.useCallback(async y=>{t(!0);try{const r=await l("/me/nutrition/goals/calculate",{method:"POST",body:JSON.stringify(y)});return a(r),r}catch(r){throw n(r.message),r}finally{t(!1)}},[a,t,n]),u=i.useCallback(async()=>{try{const y=await l("/me/nutrition/goals");return y&&!y.message&&a(y),y}catch{}},[a]);return{calculateGoals:o,loadGoals:u}}function L(){const{setSearchResults:a,setLoading:t,searchQuery:n,setSearchQuery:o}=f(),u=i.useCallback(async(r,e={})=>{if(!r||r.length<2)return a([]),[];t(!0);try{const h=new URLSearchParams({query:r,limit:e.limit||25,...e.source&&{source:e.source}}),s=await l(`/nutrition/foods/search?${h}`);return a(s.foods||[]),s.foods||[]}catch{return[]}finally{t(!1)}},[a,t]),y=i.useCallback(async r=>{t(!0);try{return(await l(`/nutrition/foods/barcode/${r}`)).foods||[]}catch{return[]}finally{t(!1)}},[t]);return{search:u,searchByBarcode:y,searchQuery:n,setSearchQuery:o}}function O(){const{addMealToToday:a,removeMealFromToday:t,updateMealInToday:n,setLoading:o,setError:u}=f(),y=i.useCallback(async s=>{o(!0);try{const c=await l("/me/nutrition/meals",{method:"POST",body:JSON.stringify(s)});return a(c),c}catch(c){throw u(c.message),c}finally{o(!1)}},[a,o,u]),r=i.useCallback(async(s,c)=>{o(!0);try{const m=await l(`/me/nutrition/meals/${s}`,{method:"PUT",body:JSON.stringify(c)});return n(s,m),m}catch(m){throw u(m.message),m}finally{o(!1)}},[n,o,u]),e=i.useCallback(async s=>{o(!0);try{await l(`/me/nutrition/meals/${s}`,{method:"DELETE"}),t(s)}catch(c){throw u(c.message),c}finally{o(!1)}},[t,o,u]),h=i.useCallback(async s=>{try{return await l(`/me/nutrition/meals?date=${s}`)}catch{return[]}},[]);return{logMeal:y,updateMeal:r,deleteMeal:e,loadMealsByDate:h}}function T(){const{setLoading:a,setError:t}=f(),n=i.useCallback(async(s={},c={})=>{try{const m=new URLSearchParams({...s,sort:c.field||"rating",sortDir:c.direction||"desc"});return await l(`/nutrition/recipes?${m}`)}catch{return{items:[],total:0,hasMore:!1}}},[]),o=i.useCallback(async(s=10)=>{try{return await l(`/nutrition/recipes/popular?limit=${s}`)}catch{return[]}},[]),u=i.useCallback(async s=>{try{return await l(`/nutrition/recipes/${s}`)}catch{return null}},[]),y=i.useCallback(async s=>{a(!0);try{return await l("/me/nutrition/recipes",{method:"POST",body:JSON.stringify(s)})}catch(c){throw t(c.message),c}finally{a(!1)}},[a,t]),r=i.useCallback(async s=>{try{await l(`/me/nutrition/recipes/${s}/save`,{method:"POST"})}catch{}},[]),e=i.useCallback(async s=>{try{await l(`/me/nutrition/recipes/${s}/save`,{method:"DELETE"})}catch{}},[]),h=i.useCallback(async(s,c,m)=>{try{await l(`/me/nutrition/recipes/${s}/rate`,{method:"POST",body:JSON.stringify({rating:c,review:m})})}catch{}},[]);return{searchRecipes:n,getPopularRecipes:o,getRecipe:u,createRecipe:y,saveRecipe:r,unsaveRecipe:e,rateRecipe:h}}function $(){const{setLoading:a,setError:t}=f(),n=i.useCallback(async e=>{try{const h=e?`?status=${e}`:"";return await l(`/me/nutrition/plans${h}`)}catch{return[]}},[]),o=i.useCallback(async()=>{try{const e=await l("/me/nutrition/plans/active");return e.message?null:e}catch{return null}},[]),u=i.useCallback(async e=>{a(!0);try{return await l("/me/nutrition/plans",{method:"POST",body:JSON.stringify(e)})}catch(h){throw t(h.message),h}finally{a(!1)}},[a,t]),y=i.useCallback(async e=>{a(!0);try{return await l("/me/nutrition/plans/generate",{method:"POST",body:JSON.stringify(e)})}catch(h){throw t(h.message),h}finally{a(!1)}},[a,t]),r=i.useCallback(async e=>{try{return await l(`/me/nutrition/plans/${e}/activate`,{method:"POST"})}catch(h){throw h}},[]);return{getMealPlans:n,getActivePlan:o,createMealPlan:u,generateMealPlan:y,activatePlan:r}}function E(){const{setLoading:a,setError:t,isLoading:n,error:o}=f(),u=i.useCallback(async r=>{a(!0);try{const e=await l(`/me/nutrition/plans/${r}`);return{shoppingList:e.shoppingList||[],planName:e.name,planId:e.id}}catch(e){throw t(e.message),e}finally{a(!1)}},[a,t]),y=i.useCallback(async r=>{a(!0);try{return await l(`/me/nutrition/plans/${r}/shopping-list`,{method:"POST"})}catch(e){throw t(e.message),e}finally{a(!1)}},[a,t]);return{getShoppingList:u,generateShoppingList:y,isLoading:n,error:o}}export{L as a,O as b,P as c,C as d,T as e,$ as f,E as g,k as u};
