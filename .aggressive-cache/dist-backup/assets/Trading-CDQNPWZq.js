import{l as J,r,j as e,L as E}from"./react-vendor-D1NxaRNd.js";import{c as v}from"./recharts-vendor-BziRPEEi.js";import{y as K,A as O,m as _}from"./index-VPOrxyVC.js";import"./leaflet-vendor-DZbo3Ov0.js";import"./d3-vendor-mcDw60ct.js";import"./apollo-vendor-D9c7jRvS.js";import"./reactflow-vendor-Dz2P_-Qa.js";const l={Back:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 19l-7-7 7-7"})}),Plus:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),Exchange:()=>e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),Check:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),Close:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M6 18L18 6M6 6l12 12"})}),Sparkle:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"})}),Inbox:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})}),Send:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})}),History:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),AlertTriangle:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),Trash:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),Search:()=>e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})},V={common:{label:"Common",color:"from-gray-500 to-gray-600",border:"border-gray-500/30",bg:"bg-gray-500/10"},uncommon:{label:"Uncommon",color:"from-green-500 to-emerald-600",border:"border-green-500/30",bg:"bg-green-500/10"},rare:{label:"Rare",color:"from-blue-500 to-cyan-600",border:"border-blue-500/30",bg:"bg-blue-500/10"},epic:{label:"Epic",color:"from-purple-500 to-violet-600",border:"border-purple-500/30",bg:"bg-purple-500/10"},legendary:{label:"Legendary",color:"from-amber-400 to-orange-500",border:"border-amber-500/30",bg:"bg-amber-500/10"},mythic:{label:"Mythic",color:"from-pink-500 to-rose-600",border:"border-pink-500/30",bg:"bg-pink-500/10"},divine:{label:"Divine",color:"from-cyan-400 to-sky-500",border:"border-cyan-400/30",bg:"bg-cyan-400/10"}},R={pending:{label:"Pending",color:"bg-yellow-500/20 text-yellow-400"},accepted:{label:"Accepted",color:"bg-green-500/20 text-green-400"},declined:{label:"Declined",color:"bg-red-500/20 text-red-400"},countered:{label:"Countered",color:"bg-blue-500/20 text-blue-400"},cancelled:{label:"Cancelled",color:"bg-gray-500/20 text-gray-400"},completed:{label:"Completed",color:"bg-green-500/20 text-green-400"},expired:{label:"Expired",color:"bg-gray-500/20 text-gray-400"}},X=[{key:"incoming",label:"Incoming",icon:e.jsx(l.Inbox,{})},{key:"outgoing",label:"Outgoing",icon:e.jsx(l.Send,{})},{key:"history",label:"History",icon:e.jsx(l.History,{})}];function oe(){const{token:s}=K(),{tradeId:i}=J(),[h,p]=r.useState("incoming"),[u,d]=r.useState([]),[g,C]=r.useState([]),[L,S]=r.useState([]),[b,j]=r.useState(null),[U,A]=r.useState(!0),[y,N]=r.useState(null),[Y,c]=r.useState(!1),[B,T]=r.useState(!1),[I,f]=r.useState({show:!1,message:"",type:"success"}),w=r.useCallback(async()=>{A(!0);try{const a={Authorization:`Bearer ${s}`},[o,x,F,H]=await Promise.all([fetch("/api/trades/incoming",{headers:a}),fetch("/api/trades/outgoing",{headers:a}),fetch("/api/trades/history",{headers:a}),fetch("/api/wallet",{headers:a})]),[z,P,t,m]=await Promise.all([o.json(),x.json(),F.json(),H.json()]);if(d(z.data||[]),C(P.data||[]),S(t.data||[]),j(m.data),i){const q=[...z.data||[],...P.data||[],...t.data||[]].find(Q=>Q.id===i);q&&N(q)}}catch{}finally{A(!1)}},[s,i]);r.useEffect(()=>{w()},[w]);const n=(a,o="success")=>{f({show:!0,message:a,type:o}),setTimeout(()=>f({show:!1,message:"",type:"success"}),3e3)},D=async a=>{T(!0);try{const x=await(await fetch(`/api/trades/${a}/accept`,{method:"POST",headers:{Authorization:`Bearer ${s}`}})).json();x.data?.success?(n("Trade accepted!","success"),N(null),w()):n(x.error?.message||"Failed to accept trade","error")}catch{n("Failed to accept trade","error")}finally{T(!1)}},W=async a=>{T(!0);try{const x=await(await fetch(`/api/trades/${a}/decline`,{method:"POST",headers:{Authorization:`Bearer ${s}`}})).json();x.data?.success?(n("Trade declined","success"),N(null),w()):n(x.error?.message||"Failed to decline trade","error")}catch{n("Failed to decline trade","error")}finally{T(!1)}},$=async a=>{T(!0);try{const x=await(await fetch(`/api/trades/${a}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}})).json();x.data?.success?(n("Trade cancelled","success"),N(null),w()):n(x.error?.message||"Failed to cancel trade","error")}catch{n("Failed to cancel trade","error")}finally{T(!1)}},M=()=>{switch(h){case"incoming":return u;case"outgoing":return g;case"history":return L;default:return[]}};return U?e.jsx("div",{className:"min-h-screen bg-[#0a0a0f] flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 border-2 border-violet-500 border-t-transparent rounded-full animate-spin"})}):e.jsxs("div",{className:"min-h-screen bg-[#0a0a0f] text-white pb-8",children:[e.jsx("header",{className:"sticky top-0 z-40 bg-[#0a0a0f]/80 backdrop-blur-xl border-b border-white/5",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-4 h-16 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(E,{to:"/marketplace",className:"p-2 -ml-2 rounded-xl hover:bg-white/5",children:e.jsx(l.Back,{})}),e.jsx("h1",{className:"text-xl font-semibold",children:"Trading"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>c(!0),className:"flex items-center gap-2 px-4 py-2 bg-violet-600 hover:bg-violet-700 rounded-xl transition-colors",children:[e.jsx(l.Plus,{}),e.jsx("span",{className:"hidden sm:inline",children:"New Trade"})]}),e.jsxs(E,{to:"/wallet",className:"flex items-center gap-2 px-4 py-2 bg-white/5 hover:bg-white/10 rounded-xl transition-colors",children:[e.jsx(l.Sparkle,{className:"text-violet-400"}),e.jsx("span",{className:"font-bold",children:(b?.balance||0).toLocaleString()})]})]})]})}),e.jsxs("main",{className:"max-w-5xl mx-auto px-4 py-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"p-4 bg-white/5 rounded-xl text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-yellow-400",children:u.filter(a=>a.status==="pending").length}),e.jsx("p",{className:"text-sm text-gray-400",children:"Pending Incoming"})]}),e.jsxs("div",{className:"p-4 bg-white/5 rounded-xl text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-400",children:g.filter(a=>a.status==="pending").length}),e.jsx("p",{className:"text-sm text-gray-400",children:"Pending Outgoing"})]}),e.jsxs("div",{className:"p-4 bg-white/5 rounded-xl text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-400",children:L.filter(a=>a.status==="completed").length}),e.jsx("p",{className:"text-sm text-gray-400",children:"Completed"})]})]}),e.jsx("div",{className:"flex gap-2 mb-6",children:X.map(a=>e.jsxs("button",{onClick:()=>p(a.key),className:v("flex items-center gap-2 px-4 py-2 rounded-xl transition-all",h===a.key?"bg-violet-600 text-white":"bg-white/5 text-gray-400 hover:text-white hover:bg-white/10"),children:[a.icon,e.jsx("span",{className:"font-medium",children:a.label}),a.key==="incoming"&&u.filter(o=>o.status==="pending").length>0&&e.jsx("span",{className:"ml-1 px-2 py-0.5 text-xs bg-red-500 rounded-full",children:u.filter(o=>o.status==="pending").length})]},a.key))}),e.jsx("div",{className:"space-y-4",children:M().length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(l.Exchange,{className:"w-12 h-12 mx-auto text-gray-600 mb-4"}),e.jsxs("p",{className:"text-gray-400",children:["No ",h," trades"]}),h!=="history"&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:h==="incoming"?"Waiting for trade requests":"Start a new trade"})]}):M().map(a=>e.jsx(Z,{trade:a,isIncoming:h==="incoming",onClick:()=>N(a)},a.id))})]}),e.jsx(O,{children:y&&e.jsx(_.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:()=>N(null),children:e.jsx(_.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:a=>a.stopPropagation(),className:"bg-[#12121a] border border-white/10 rounded-2xl w-full max-w-2xl overflow-hidden max-h-[90vh] overflow-y-auto",children:e.jsx(ee,{trade:y,isIncoming:u.some(a=>a.id===y.id),onAccept:()=>D(y.id),onDecline:()=>W(y.id),onCancel:()=>$(y.id),submitting:B,onClose:()=>N(null)})})})}),e.jsx(O,{children:Y&&e.jsx(_.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:()=>c(!1),children:e.jsx(_.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:a=>a.stopPropagation(),className:"bg-[#12121a] border border-white/10 rounded-2xl w-full max-w-2xl overflow-hidden max-h-[90vh] overflow-y-auto",children:e.jsx(se,{token:s,wallet:b,onSuccess:()=>{c(!1),n("Trade request sent!","success"),w()},onError:a=>n(a,"error"),onClose:()=>c(!1)})})})}),e.jsx(O,{children:I.show&&e.jsx(_.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:50},className:v("fixed bottom-4 left-4 right-4 mx-auto max-w-md px-4 py-3 rounded-xl text-center font-medium z-50",I.type==="success"?"bg-green-600":"bg-red-600"),children:I.message})})]})}function Z({trade:s,isIncoming:i,onClick:h}){const p=R[s.status]||R.pending,u=i?s.initiator_username:s.receiver_username,d=(s.initiator_items?.length||0)+(s.receiver_items?.length||0),g=(s.initiator_credits||0)+(s.receiver_credits||0);return e.jsxs(_.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},whileHover:{scale:1.01},onClick:h,className:"p-4 bg-white/5 hover:bg-white/10 border border-white/10 rounded-xl cursor-pointer transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-violet-500 to-purple-600 rounded-full flex items-center justify-center text-lg font-bold",children:(u||"U")[0].toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:u||"Unknown User"}),e.jsx("p",{className:"text-sm text-gray-400",children:new Date(s.created_at).toLocaleDateString()})]})]}),e.jsx("span",{className:v("px-2 py-1 text-xs font-medium rounded-full",p.color),children:p.label})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-400",children:[e.jsxs("span",{children:[d," items"]}),g>0&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(l.Sparkle,{className:"w-4 h-4 text-violet-400"}),g.toLocaleString()," credits"]})]}),s.value_warning&&e.jsxs("div",{className:"flex items-center gap-1 text-amber-400 text-sm",children:[e.jsx(l.AlertTriangle,{className:"w-4 h-4"}),e.jsx("span",{children:"Value mismatch"})]})]}),s.message&&e.jsxs("p",{className:"mt-2 text-sm text-gray-400 italic line-clamp-1",children:['"',s.message,'"']})]})}function ee({trade:s,isIncoming:i,onAccept:h,onDecline:p,onCancel:u,submitting:d,onClose:g}){const C=R[s.status]||R.pending,L=s.status==="pending",S=i?s.initiator_username:s.receiver_username;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-6 border-b border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-violet-500 to-purple-600 rounded-full flex items-center justify-center text-xl font-bold",children:(S||"U")[0].toUpperCase()}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-lg",children:["Trade with ",S]}),e.jsx("p",{className:"text-sm text-gray-400",children:new Date(s.created_at).toLocaleString()})]})]}),e.jsx("button",{onClick:g,className:"p-2 rounded-xl hover:bg-white/10",children:e.jsx(l.Close,{})})]}),e.jsx("div",{className:"mt-3",children:e.jsx("span",{className:v("px-3 py-1 text-sm font-medium rounded-full",C.color),children:C.label})})]}),e.jsxs("div",{className:"p-6",children:[s.value_warning&&e.jsxs("div",{className:"flex items-center gap-2 p-4 bg-amber-500/10 border border-amber-500/30 rounded-xl mb-6",children:[e.jsx(l.AlertTriangle,{className:"text-amber-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-amber-400",children:"Value Discrepancy Warning"}),e.jsx("p",{className:"text-sm text-gray-400",children:"The items in this trade have significantly different values. Review carefully before accepting."})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400 mb-3",children:i?`${s.initiator_username} offers`:"You offer"}),e.jsxs("div",{className:"space-y-2",children:[(s.initiator_items||[]).map((b,j)=>e.jsx(G,{item:b},j)),s.initiator_credits>0&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-white/5 rounded-xl",children:[e.jsx(l.Sparkle,{className:"text-violet-400"}),e.jsxs("span",{className:"font-bold",children:[s.initiator_credits.toLocaleString()," credits"]})]}),(s.initiator_items||[]).length===0&&!s.initiator_credits&&e.jsx("p",{className:"text-gray-500 italic",children:"No items offered"})]})]}),e.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 hidden md:flex",children:e.jsx("div",{className:"w-10 h-10 bg-violet-600 rounded-full flex items-center justify-center",children:e.jsx(l.Exchange,{})})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400 mb-3",children:i?"You give":`${s.receiver_username} gives`}),e.jsxs("div",{className:"space-y-2",children:[(s.receiver_items||[]).map((b,j)=>e.jsx(G,{item:b},j)),s.receiver_credits>0&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-white/5 rounded-xl",children:[e.jsx(l.Sparkle,{className:"text-violet-400"}),e.jsxs("span",{className:"font-bold",children:[s.receiver_credits.toLocaleString()," credits"]})]}),(s.receiver_items||[]).length===0&&!s.receiver_credits&&e.jsx("p",{className:"text-gray-500 italic",children:"No items requested"})]})]})]}),s.message&&e.jsxs("div",{className:"mt-6 p-4 bg-white/5 rounded-xl",children:[e.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Message"}),e.jsxs("p",{className:"text-gray-200",children:['"',s.message,'"']})]}),L&&e.jsx("div",{className:"mt-6 space-y-3",children:i?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:h,disabled:d,className:"w-full py-3 bg-green-600 hover:bg-green-700 disabled:opacity-50 rounded-xl font-semibold transition-all flex items-center justify-center gap-2",children:[e.jsx(l.Check,{}),d?"Processing...":"Accept Trade"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(E,{to:`/trades/${s.id}/counter`,className:"py-3 bg-blue-600 hover:bg-blue-700 rounded-xl font-semibold text-center transition-all",children:"Counter Offer"}),e.jsx("button",{onClick:p,disabled:d,className:"py-3 bg-red-600 hover:bg-red-700 disabled:opacity-50 rounded-xl font-semibold transition-all",children:"Decline"})]})]}):e.jsxs("button",{onClick:u,disabled:d,className:"w-full py-3 bg-red-600 hover:bg-red-700 disabled:opacity-50 rounded-xl font-semibold transition-all flex items-center justify-center gap-2",children:[e.jsx(l.Trash,{}),d?"Cancelling...":"Cancel Trade"]})})]})]})}function G({item:s}){const i=V[s.rarity]||V.common;return e.jsxs("div",{className:v("flex items-center gap-3 p-3 rounded-xl border",i.border,i.bg),children:[e.jsx("div",{className:v("w-10 h-10 rounded-lg bg-gradient-to-br flex items-center justify-center",i.color,"opacity-50"),children:e.jsx("span",{className:"text-xl",children:s.icon||"ðŸŽ¨"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:s.name}),e.jsx("p",{className:v("text-xs",i.color.replace("from-","text-").split(" ")[0].replace("text-","text-")||"text-gray-400"),children:i.label})]})]})}function se({token:s,wallet:i,onSuccess:h,onError:p,onClose:u}){const[d,g]=r.useState(1),[C,L]=r.useState(""),[S,b]=r.useState([]),[j,U]=r.useState(null),[A,y]=r.useState([]),[N,Y]=r.useState([]),[c,B]=r.useState([]),[T,I]=r.useState([]),[f,w]=r.useState(0),[n,D]=r.useState(0),[W,$]=r.useState(""),[M,a]=r.useState(!1),[o,x]=r.useState(!1),F=async t=>{if(t.length<2){b([]);return}try{const k=await(await fetch(`/api/users/search?q=${encodeURIComponent(t)}`,{headers:{Authorization:`Bearer ${s}`}})).json();b(k.data||[])}catch{}},H=async t=>{U(t),x(!0);try{const k=await(await fetch("/api/collection",{headers:{Authorization:`Bearer ${s}`}})).json();y(k.data?.items||[])}catch{}finally{x(!1)}g(2)},z=t=>{c.find(m=>m.id===t.id)?B(c.filter(m=>m.id!==t.id)):c.length<10&&B([...c,t])},P=async()=>{if(!j){p("Please select a user");return}if(c.length===0&&f===0&&theirItems.length===0&&n===0){p("Trade must include at least one item or credits");return}a(!0);try{const m=await(await fetch("/api/trades",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({receiverId:j.id,initiatorItems:c.map(k=>k.id),initiatorCredits:f,receiverItems:theirItems.map(k=>k.id),receiverCredits:n,message:W||void 0})})).json();m.data?h():p(m.error?.message||"Failed to create trade")}catch{p("Failed to create trade")}finally{a(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-6 border-b border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"New Trade Request"}),e.jsx("button",{onClick:u,className:"p-2 rounded-xl hover:bg-white/10",children:e.jsx(l.Close,{})})]}),e.jsx("div",{className:"flex gap-2 mt-4",children:[1,2,3].map(t=>e.jsx("div",{className:v("flex-1 h-1 rounded-full",t<=d?"bg-violet-600":"bg-white/10")},t))})]}),e.jsxs("div",{className:"p-6",children:[d===1&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 mb-4",children:"Who do you want to trade with?"}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(l.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search users...",value:C,onChange:t=>{L(t.target.value),F(t.target.value)},className:"w-full pl-10 pr-4 py-3 bg-white/5 border border-white/10 rounded-xl focus:outline-none focus:border-violet-500"})]}),e.jsxs("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:[S.map(t=>e.jsxs("button",{onClick:()=>H(t),className:"w-full flex items-center gap-3 p-3 bg-white/5 hover:bg-white/10 rounded-xl transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-violet-500 to-purple-600 rounded-full flex items-center justify-center font-bold",children:t.username[0].toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.username}),t.displayName&&e.jsx("p",{className:"text-sm text-gray-400",children:t.displayName})]})]},t.id)),C.length>=2&&S.length===0&&e.jsx("p",{className:"text-center text-gray-400 py-4",children:"No users found"})]})]}),d===2&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("button",{onClick:()=>g(1),className:"p-2 rounded-xl hover:bg-white/5",children:e.jsx(l.Back,{})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["Trading with ",j?.username]}),e.jsx("p",{className:"text-sm text-gray-400",children:"Select items to trade"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-400 mb-2",children:["You offer (",c.length,"/10)"]}),o?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"w-6 h-6 border-2 border-violet-500 border-t-transparent rounded-full animate-spin"})}):e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:A.map(t=>e.jsxs("button",{onClick:()=>z(t),className:v("w-full flex items-center gap-2 p-2 rounded-lg transition-colors text-left",c.find(m=>m.id===t.id)?"bg-violet-600/20 border border-violet-500":"bg-white/5 hover:bg-white/10 border border-transparent"),children:[e.jsx("span",{className:"text-lg",children:t.icon||"ðŸŽ¨"}),e.jsx("span",{className:"text-sm truncate",children:t.name})]},t.id))}),e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Credits to offer"}),e.jsx("input",{type:"number",value:f,onChange:t=>w(Math.max(0,Math.min(i?.balance||0,parseInt(t.target.value)||0))),max:i?.balance||0,className:"w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg"})]})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-400 mb-2",children:["You want (",theirItems.length,"/10)"]}),e.jsx("p",{className:"text-center text-gray-500 py-8 text-sm",children:"You can specify desired items when the other party views the trade"}),e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Credits to request"}),e.jsx("input",{type:"number",value:n,onChange:t=>D(Math.max(0,parseInt(t.target.value)||0)),className:"w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg"})]})]})]}),e.jsx("button",{onClick:()=>g(3),disabled:c.length===0&&f===0,className:"w-full mt-4 py-3 bg-violet-600 hover:bg-violet-700 disabled:opacity-50 rounded-xl font-semibold transition-all",children:"Continue"})]}),d===3&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("button",{onClick:()=>g(2),className:"p-2 rounded-xl hover:bg-white/5",children:e.jsx(l.Back,{})}),e.jsx("p",{className:"font-medium",children:"Review Trade"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400 mb-2",children:"You offer"}),c.map(t=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white/5 rounded-lg mb-1",children:[e.jsx("span",{children:t.icon||"ðŸŽ¨"}),e.jsx("span",{className:"text-sm",children:t.name})]},t.id)),f>0&&e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white/5 rounded-lg",children:[e.jsx(l.Sparkle,{className:"text-violet-400 w-4 h-4"}),e.jsxs("span",{className:"text-sm",children:[f.toLocaleString()," credits"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400 mb-2",children:"You request"}),n>0?e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white/5 rounded-lg",children:[e.jsx(l.Sparkle,{className:"text-violet-400 w-4 h-4"}),e.jsxs("span",{className:"text-sm",children:[n.toLocaleString()," credits"]})]}):e.jsx("p",{className:"text-gray-500 text-sm italic",children:"Open to offers"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-400 mb-1",children:"Message (optional)"}),e.jsx("textarea",{value:W,onChange:t=>$(t.target.value),placeholder:"Add a message...",rows:2,className:"w-full px-3 py-2 bg-white/5 border border-white/10 rounded-lg resize-none"})]}),e.jsx("button",{onClick:P,disabled:M,className:"w-full py-3 bg-green-600 hover:bg-green-700 disabled:opacity-50 rounded-xl font-semibold transition-all",children:M?"Sending...":"Send Trade Request"})]})]})]})}export{oe as default};
