<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Primary Meta Tags -->
  <title>MuscleMap - Visual Fitness Tracking</title>
  <meta name="title" content="MuscleMap - Visual Fitness Tracking">
  <meta name="description" content="MuscleMap - See every rep. Know every muscle. Own your progress. Visual fitness tracking that shows muscle activation in real-time.">
  <meta name="keywords" content="fitness tracking, muscle visualization, workout tracker, exercise app, muscle activation, fitness app, gym tracker, strength training, bodybuilding, personal training">
  <meta name="author" content="MuscleMap">
  <meta name="robots" content="index, follow">
  <meta name="theme-color" content="#0066FF">
  <meta name="application-name" content="MuscleMap">
  <meta name="apple-mobile-web-app-title" content="MuscleMap">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="format-detection" content="telephone=no">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://musclemap.me/">
  <meta property="og:title" content="MuscleMap - Visual Fitness Tracking">
  <meta property="og:description" content="See every rep. Know every muscle. Own your progress. Visual fitness tracking that shows muscle activation in real-time.">
  <meta property="og:image" content="https://musclemap.me/og-image.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:image:alt" content="MuscleMap - Visual Fitness Tracking">
  <meta property="og:site_name" content="MuscleMap">
  <meta property="og:locale" content="en_US">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@musclemapfit">
  <meta name="twitter:creator" content="@musclemapfit">
  <meta name="twitter:url" content="https://musclemap.me/">
  <meta name="twitter:title" content="MuscleMap - Visual Fitness Tracking">
  <meta name="twitter:description" content="See every rep. Know every muscle. Own your progress. Visual fitness tracking that shows muscle activation in real-time.">
  <meta name="twitter:image" content="https://musclemap.me/og-image.png">
  <meta name="twitter:image:alt" content="MuscleMap - Visual Fitness Tracking">

  <!-- Canonical URL -->
  <link rel="canonical" href="https://musclemap.me/">

  <!-- API Preconnect - establish early connections for faster data fetching -->
  <link rel="preconnect" href="https://api.musclemap.me" crossorigin>
  <link rel="dns-prefetch" href="https://api.musclemap.me">

  <!-- Self-hosted fonts - use prefetch for non-blocking load without console warnings -->
  <link rel="prefetch" href="/fonts/inter-regular.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="prefetch" href="/fonts/inter-semibold.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="prefetch" href="/fonts/bebas-neue.woff2" as="font" type="font/woff2" crossorigin>

  <!-- App Icons -->
  <link rel="manifest" href="/manifest.json">
  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" type="image/webp" sizes="48x48" href="/icon-48.webp">
  <link rel="icon" type="image/png" sizes="32x32" href="/logo-32.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icon-192.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icon-152.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icon-144.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icon-128.png">

  <!-- Structured Data - Organization -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "MuscleMap",
    "url": "https://musclemap.me",
    "logo": "https://musclemap.me/logo.png",
    "description": "Visual fitness tracking that shows muscle activation in real-time.",
    "sameAs": [
      "https://twitter.com/musclemapfit",
      "https://github.com/jeanpaulniko/musclemap"
    ]
  }
  </script>

  <!-- Structured Data - WebSite -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "MuscleMap",
    "url": "https://musclemap.me",
    "description": "Visual fitness tracking that shows muscle activation in real-time.",
    "potentialAction": {
      "@type": "SearchAction",
      "target": {
        "@type": "EntryPoint",
        "urlTemplate": "https://musclemap.me/exercises?q={search_term_string}"
      },
      "query-input": "required name=search_term_string"
    }
  }
  </script>

  <!-- Structured Data - SoftwareApplication -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "SoftwareApplication",
    "name": "MuscleMap",
    "applicationCategory": "HealthApplication",
    "operatingSystem": "Web, iOS, Android",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    },
    "description": "Cross-platform fitness tracking application that visualizes muscle activation in real-time.",
    "featureList": [
      "Real-time muscle visualization",
      "AI-powered workout generation",
      "Cross-platform sync",
      "RPG-style progression",
      "Community features"
    ]
  }
  </script>
</head>
<body>
  <div id="root"></div>

  <!-- Ultra-Early Error Capture with Dynamic Import -->
  <!-- This captures errors during module loading with FULL stack traces -->
  <script>
  (function() {
    // Check if debug mode via URL parameter
    var isDebug = window.location.search.indexOf('debug=1') !== -1;

    // Store for captured errors
    var capturedErrors = [];
    var errorOverlay = null;

    function createErrorOverlay() {
      if (errorOverlay) return errorOverlay;

      errorOverlay = document.createElement('div');
      errorOverlay.id = 'mm-error-overlay';
      errorOverlay.style.cssText = 'position:fixed;bottom:0;left:0;right:0;max-height:50vh;overflow-y:auto;' +
        'background:rgba(0,0,0,0.95);color:#ff6b6b;font-family:monospace;font-size:11px;' +
        'padding:12px;z-index:999999;border-top:2px solid #ff6b6b;';

      var header = document.createElement('div');
      header.style.cssText = 'display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;';
      header.innerHTML = '<strong style="color:#ff6b6b;">JS Errors Captured (add ?debug=1 to URL to enable)</strong>' +
        '<button onclick="this.parentElement.parentElement.remove()" style="background:#ff6b6b;color:#000;border:none;padding:4px 8px;cursor:pointer;border-radius:4px;">Close</button>';
      errorOverlay.appendChild(header);

      var content = document.createElement('div');
      content.id = 'mm-error-content';
      errorOverlay.appendChild(content);

      document.body.appendChild(errorOverlay);
      return errorOverlay;
    }

    function logError(type, message, source, lineno, colno, error, extra) {
      var errorInfo = {
        type: type,
        message: message || 'Unknown error',
        source: source || 'unknown',
        line: lineno || 0,
        col: colno || 0,
        stack: error && error.stack ? error.stack : 'No stack trace',
        time: new Date().toISOString(),
        extra: extra || null
      };

      capturedErrors.push(errorInfo);

      // Always log to console
      console.error('[MM-Error-Capture]', errorInfo);

      // Show overlay if debug mode OR if error looks critical
      var isCritical = message && (
        message.indexOf('undefined is not an object') !== -1 ||
        message.indexOf('null is not an object') !== -1 ||
        message.indexOf('Cannot read prop') !== -1 ||
        message.indexOf('is not defined') !== -1
      );

      if (isDebug || isCritical) {
        var overlay = createErrorOverlay();
        var content = document.getElementById('mm-error-content');
        if (content) {
          var entry = document.createElement('div');
          entry.style.cssText = 'border-bottom:1px solid #333;padding:8px 0;margin-bottom:8px;';
          entry.innerHTML = '<div style="color:#ff9f43;margin-bottom:4px;">[' + type + '] ' + errorInfo.message + '</div>' +
            '<div style="color:#888;font-size:10px;">Source: ' + errorInfo.source + ':' + errorInfo.line + ':' + errorInfo.col + '</div>' +
            '<pre style="color:#aaa;font-size:10px;white-space:pre-wrap;margin:4px 0 0 0;max-height:150px;overflow-y:auto;">' +
            errorInfo.stack.replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</pre>' +
            (extra ? '<pre style="color:#6bf;font-size:10px;white-space:pre-wrap;margin:4px 0 0 0;">Extra: ' + JSON.stringify(extra) + '</pre>' : '');
          content.appendChild(entry);
        }
      }

      // Send to server for debugging (fire and forget)
      try {
        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/api/client-error', true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.send(JSON.stringify(errorInfo));
      } catch (e) {
        // Silently fail - we don't want error reporting to cause more errors
      }
    }

    // Global error handler
    window.onerror = function(message, source, lineno, colno, error) {
      logError('error', message, source, lineno, colno, error);
      return false; // Don't suppress the error
    };

    // Promise rejection handler
    window.onunhandledrejection = function(event) {
      var reason = event.reason;
      var message = reason instanceof Error ? reason.message : String(reason);
      var stack = reason instanceof Error ? reason.stack : 'No stack trace';
      logError('unhandledrejection', message, 'promise', 0, 0, { stack: stack });
    };

    // Expose for debugging
    window.__MM_CAPTURED_ERRORS__ = capturedErrors;
    window.__MM_SHOW_ERRORS__ = function() {
      createErrorOverlay();
      var content = document.getElementById('mm-error-content');
      if (content && capturedErrors.length === 0) {
        content.innerHTML = '<div style="color:#6bff6b;">No errors captured yet.</div>';
      }
    };

    // Log that early capture is active
    console.log('[MM-Error-Capture] Early error capture initialized. Add ?debug=1 to URL to see overlay.');

    // DYNAMIC MODULE LOADING - This gives us FULL stack traces for import errors
    // because the error happens in THIS script's context, not a cross-origin one
    window.__MM_BOOT_START__ = Date.now();

    import('/src/main.tsx')
      .then(function() {
        console.log('[MM-Error-Capture] App loaded successfully in ' + (Date.now() - window.__MM_BOOT_START__) + 'ms');
      })
      .catch(function(error) {
        // This catch block runs in OUR script's context, so we get FULL error details!
        var message = error instanceof Error ? error.message : String(error);
        var stack = error instanceof Error ? error.stack : 'No stack trace';

        logError('module-import', message, '/src/main.tsx', 0, 0, error, {
          name: error.name,
          fileName: error.fileName,
          lineNumber: error.lineNumber,
          columnNumber: error.columnNumber,
          cause: error.cause ? String(error.cause) : undefined
        });

        // Show a fallback UI
        var root = document.getElementById('root');
        if (root) {
          root.innerHTML =
            '<div style="min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;background:#0a0a0f;color:white;padding:20px;text-align:center;font-family:system-ui,sans-serif;">' +
              '<h1 style="font-size:24px;margin-bottom:16px;">Failed to Load App</h1>' +
              '<p style="color:#999;margin-bottom:20px;">There was an error loading MuscleMap.</p>' +
              '<pre style="background:#1a1a2e;padding:16px;border-radius:8px;text-align:left;font-size:12px;max-width:90vw;overflow-x:auto;color:#ff6b6b;margin-bottom:20px;">' +
                message + '\\n\\n' + stack.replace(/</g, '&lt;').replace(/>/g, '&gt;') +
              '</pre>' +
              '<button onclick="window.location.reload()" style="background:#6366f1;color:white;border:none;padding:12px 24px;border-radius:8px;font-size:16px;cursor:pointer;">' +
                'Reload Page' +
              '</button>' +
            '</div>';
        }
      });
  })();
  </script>
</body>
</html>
